<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>dfsch: dfsch/magic.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.9 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<h1>dfsch/magic.h</h1><a href="magic_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * dfsch - dfox's quick and dirty scheme implementation</span>
<a name="l00003"></a>00003 <span class="comment"> *     Exception and continuation handling implementation</span>
<a name="l00004"></a>00004 <span class="comment"> * Copyright (C) 2005-2008 Ales Hakl</span>
<a name="l00005"></a>00005 <span class="comment"> *</span>
<a name="l00006"></a>00006 <span class="comment"> * This program is free software; you can redistribute it and/or modify</span>
<a name="l00007"></a>00007 <span class="comment"> * it under the terms of the GNU General Public License as published by</span>
<a name="l00008"></a>00008 <span class="comment"> * the Free Software Foundation; either version 2 of the License, or</span>
<a name="l00009"></a>00009 <span class="comment"> * (at your option) any later version.</span>
<a name="l00010"></a>00010 <span class="comment"> *</span>
<a name="l00011"></a>00011 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="l00012"></a>00012 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00013"></a>00013 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00014"></a>00014 <span class="comment"> * GNU General Public License for more details.</span>
<a name="l00015"></a>00015 <span class="comment"> *</span>
<a name="l00016"></a>00016 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00017"></a>00017 <span class="comment"> * along with this program; if not, write to the Free Software</span>
<a name="l00018"></a>00018 <span class="comment"> * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</span>
<a name="l00019"></a>00019 <span class="comment"> *</span>
<a name="l00020"></a>00020 <span class="comment"> */</span>
<a name="l00021"></a>00021 
<a name="l00022"></a>00022 <span class="comment">/*</span>
<a name="l00023"></a>00023 <span class="comment"> * This file contains some very ugly code, that has great potential to break </span>
<a name="l00024"></a>00024 <span class="comment"> * things if used improperly. Generaly, don't include this unless you are sure</span>
<a name="l00025"></a>00025 <span class="comment"> * you need to.</span>
<a name="l00026"></a>00026 <span class="comment"> *</span>
<a name="l00027"></a>00027 <span class="comment"> * Only the macros defined here are considered public interface, but </span>
<a name="l00028"></a>00028 <span class="comment"> * unfortunately, they are macros so changes to them breaks binary </span>
<a name="l00029"></a>00029 <span class="comment"> * compatibility and requires recompile of user code including this file.</span>
<a name="l00030"></a>00030 <span class="comment"> */</span>
<a name="l00031"></a>00031 
<a name="l00032"></a>00032 <span class="preprocessor">#ifndef H__dfsch__magic__</span>
<a name="l00033"></a>00033 <span class="preprocessor"></span><span class="preprocessor">#define H__dfsch__magic__</span>
<a name="l00034"></a>00034 <span class="preprocessor"></span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;<a class="code" href="dfsch_8h.html">dfsch/dfsch.h</a>&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &lt;<a class="code" href="conditions_8h.html">dfsch/conditions.h</a>&gt;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &lt;setjmp.h&gt;</span>
<a name="l00038"></a>00038 
<a name="l00039"></a>00039 <span class="preprocessor">#ifdef __cplusplus</span>
<a name="l00040"></a>00040 <span class="preprocessor"></span><span class="keyword">extern</span> <span class="stringliteral">"C"</span> {
<a name="l00041"></a>00041 <span class="preprocessor">#endif</span>
<a name="l00042"></a>00042 <span class="preprocessor"></span>
<a name="l00043"></a><a class="code" href="magic_8h.html#a2fe55743ded8e8041bbe1650751bf78">00043</a>   <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structdfsch____thread__info__t.html">dfsch__thread_info_t</a> <a class="code" href="structdfsch____thread__info__t.html">dfsch__thread_info_t</a>;
<a name="l00044"></a><a class="code" href="magic_8h.html#a4551672ab72a07c274709b27ac5ac30">00044</a>   <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structdfsch____restart__list__t.html">dfsch__restart_list_t</a> <a class="code" href="structdfsch____restart__list__t.html">dfsch__restart_list_t</a>;
<a name="l00045"></a><a class="code" href="magic_8h.html#4e028d958a719e7b8267522a19f98cec">00045</a>   <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structdfsch____catch__list__t.html">dfsch__catch_list_t</a> <a class="code" href="structdfsch____catch__list__t.html">dfsch__catch_list_t</a>;
<a name="l00046"></a><a class="code" href="magic_8h.html#3719236d46339b491a61aa0d73fbeecf">00046</a>   <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structdfsch____handler__list__t.html">dfsch__handler_list_t</a> <a class="code" href="structdfsch____handler__list__t.html">dfsch__handler_list_t</a>;
<a name="l00047"></a><a class="code" href="magic_8h.html#49d74aee7d3ac182601a4122b321e99a">00047</a>   <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structdfsch____stack__frame__t.html">dfsch__stack_frame_t</a> <a class="code" href="structdfsch____stack__frame__t.html">dfsch__stack_frame_t</a>;
<a name="l00048"></a>00048 
<a name="l00049"></a><a class="code" href="structdfsch____restart__list__t.html">00049</a>   <span class="keyword">struct </span><a class="code" href="structdfsch____restart__list__t.html">dfsch__restart_list_t</a> {
<a name="l00050"></a><a class="code" href="structdfsch____restart__list__t.html#a98d58b6ad7350d6cf2db5809dd58c26">00050</a>     <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="structdfsch____restart__list__t.html#a98d58b6ad7350d6cf2db5809dd58c26">restart</a>;
<a name="l00051"></a><a class="code" href="structdfsch____restart__list__t.html#1b83f54942ac7f26094dc9e444700f77">00051</a>     <a class="code" href="structdfsch____restart__list__t.html">dfsch__restart_list_t</a>* <a class="code" href="structdfsch____restart__list__t.html#1b83f54942ac7f26094dc9e444700f77">next</a>;
<a name="l00052"></a>00052   };
<a name="l00053"></a><a class="code" href="structdfsch____catch__list__t.html">00053</a>   <span class="keyword">struct </span><a class="code" href="structdfsch____catch__list__t.html">dfsch__catch_list_t</a> {
<a name="l00054"></a><a class="code" href="structdfsch____catch__list__t.html#c137f35bc40a32abc3bbc557c4aed54d">00054</a>     <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="structdfsch____catch__list__t.html#c137f35bc40a32abc3bbc557c4aed54d">tag</a>;
<a name="l00055"></a><a class="code" href="structdfsch____catch__list__t.html#115f33274c35cbfdf336069e6d6d7d6a">00055</a>     <a class="code" href="structdfsch____catch__list__t.html">dfsch__catch_list_t</a>* <a class="code" href="structdfsch____catch__list__t.html#115f33274c35cbfdf336069e6d6d7d6a">next</a>;
<a name="l00056"></a>00056   };
<a name="l00057"></a><a class="code" href="structdfsch____handler__list__t.html">00057</a>   <span class="keyword">struct </span><a class="code" href="structdfsch____handler__list__t.html">dfsch__handler_list_t</a> {
<a name="l00058"></a><a class="code" href="structdfsch____handler__list__t.html#306795f9249c56cc1ef21f561fe34638">00058</a>     <a class="code" href="structdfsch__type__t.html">dfsch_type_t</a>* <a class="code" href="structdfsch____handler__list__t.html#306795f9249c56cc1ef21f561fe34638">type</a>;
<a name="l00059"></a><a class="code" href="structdfsch____handler__list__t.html#63610ca2cebb3bcc2586274d48131b2c">00059</a>     <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="structdfsch____handler__list__t.html#63610ca2cebb3bcc2586274d48131b2c">handler</a>;
<a name="l00060"></a><a class="code" href="structdfsch____handler__list__t.html#9a4bee215a8494b1f88e85c12004a611">00060</a>     <a class="code" href="structdfsch____handler__list__t.html">dfsch__handler_list_t</a>* <a class="code" href="structdfsch____handler__list__t.html#9a4bee215a8494b1f88e85c12004a611">next</a>;
<a name="l00061"></a>00061   };
<a name="l00062"></a>00062 
<a name="l00063"></a><a class="code" href="magic_8h.html#6c256cb15a99507b2f81fc3d7c3e8428">00063</a> <span class="preprocessor">#define DFSCH_TRACEPOINT_KIND_INVALID          0</span>
<a name="l00064"></a><a class="code" href="magic_8h.html#89b63f2639152d9e3c633d43a5e69bc3">00064</a> <span class="preprocessor"></span><span class="preprocessor">#define DFSCH_TRACEPOINT_KIND_APPLY            1</span>
<a name="l00065"></a><a class="code" href="magic_8h.html#392c3ec36a642e9a4dc11aa5a54ef7b0">00065</a> <span class="preprocessor"></span><span class="preprocessor">#define DFSCH_TRACEPOINT_KIND_EVAL             2</span>
<a name="l00066"></a><a class="code" href="magic_8h.html#d3ecc86a0f14dc7cb7df22bade0249c6">00066</a> <span class="preprocessor"></span><span class="preprocessor">#define DFSCH_TRACEPOINT_KIND_ANON             3</span>
<a name="l00067"></a>00067 <span class="preprocessor"></span>
<a name="l00068"></a><a class="code" href="magic_8h.html#cd985f960da71003cd089f21a9ca307b">00068</a> <span class="preprocessor">#define DFSCH_TRACEPOINT_FLAG_APPLY_TAIL       256</span>
<a name="l00069"></a><a class="code" href="magic_8h.html#1a13843e88792381b9a9dc5fe06d96a0">00069</a> <span class="preprocessor"></span><span class="preprocessor">#define DFSCH_TRACEPOINT_FLAG_APPLY_LAZY       512</span>
<a name="l00070"></a>00070 <span class="preprocessor"></span>
<a name="l00071"></a><a class="code" href="magic_8h.html#239f5e809b1a95aa9357cb3a0cf8fa83">00071</a> <span class="preprocessor">#define DFSCH_TRACEPOINT_FLAG_ANON_STRING_DATA 256</span>
<a name="l00072"></a>00072 <span class="preprocessor"></span>
<a name="l00073"></a><a class="code" href="structdfsch____tracepoint__t.html">00073</a>   <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structdfsch____tracepoint__t.html">dfsch__tracepoint_t</a> {
<a name="l00074"></a><a class="code" href="structdfsch____tracepoint__t.html#4445e34e0c1bd7dc8f4e21b02c7945a3">00074</a>     <span class="keywordtype">int</span> <a class="code" href="structdfsch____tracepoint__t.html#4445e34e0c1bd7dc8f4e21b02c7945a3">flags</a>;
<a name="l00075"></a>00075     <span class="keyword">union </span>{
<a name="l00076"></a>00076       <span class="keyword">struct </span>{
<a name="l00077"></a><a class="code" href="structdfsch____tracepoint__t.html#a69048437939b45c80406a750a5866ed">00077</a>         <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="structdfsch____tracepoint__t.html#a69048437939b45c80406a750a5866ed">expr</a>;
<a name="l00078"></a><a class="code" href="structdfsch____tracepoint__t.html#43779beb14ed5604ecf18825e0ce81a3">00078</a>         <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="structdfsch____tracepoint__t.html#43779beb14ed5604ecf18825e0ce81a3">env</a>;
<a name="l00079"></a>00079       } <a class="code" href="structdfsch____tracepoint__t.html#e32b90e47dbd118dc2b71e6c789a33a6">eval</a>;
<a name="l00080"></a>00080       <span class="keyword">struct </span>{
<a name="l00081"></a><a class="code" href="structdfsch____tracepoint__t.html#38171cc392e84072bed3cb529eae29a9">00081</a>         <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="structdfsch____tracepoint__t.html#38171cc392e84072bed3cb529eae29a9">proc</a>;
<a name="l00082"></a><a class="code" href="structdfsch____tracepoint__t.html#46345eefa4238299a8210bcb777f7422">00082</a>         <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="structdfsch____tracepoint__t.html#46345eefa4238299a8210bcb777f7422">args</a>;
<a name="l00083"></a>00083       } <a class="code" href="structdfsch____tracepoint__t.html#a97d76ab8310bf2459ee9da1615cf140">apply</a>;
<a name="l00084"></a>00084       <span class="keyword">struct </span>{
<a name="l00085"></a><a class="code" href="structdfsch____tracepoint__t.html#ee22e578f19d0b94547e1ce74c57534d">00085</a>         <span class="keywordtype">char</span>* <a class="code" href="structdfsch____tracepoint__t.html#ee22e578f19d0b94547e1ce74c57534d">location</a>;
<a name="l00086"></a><a class="code" href="structdfsch____tracepoint__t.html#05111938b8860589d7ca8a2dbf574c09">00086</a>         <span class="keywordtype">void</span>* <a class="code" href="structdfsch____tracepoint__t.html#05111938b8860589d7ca8a2dbf574c09">data</a>;
<a name="l00087"></a>00087       } <a class="code" href="structdfsch____tracepoint__t.html#f4d8c16fcdd516a63a97517bbfbec96a">anon</a>;
<a name="l00088"></a>00088     } <a class="code" href="structdfsch____tracepoint__t.html#05111938b8860589d7ca8a2dbf574c09">data</a>;
<a name="l00089"></a>00089   } <a class="code" href="structdfsch____tracepoint__t.html">dfsch__tracepoint_t</a>;
<a name="l00090"></a>00090 
<a name="l00091"></a><a class="code" href="magic_8h.html#9c772046447dad79bd2094bd49657376">00091</a> <span class="preprocessor">#define DFSCH__TRACEPOINT_SHIFT(ti)                              \</span>
<a name="l00092"></a>00092 <span class="preprocessor">  (ti)-&gt;trace_ptr = ((ti)-&gt;trace_ptr + 1) &amp; (ti)-&gt;trace_depth; </span>
<a name="l00093"></a><a class="code" href="magic_8h.html#27c5484efa9cef29121ec1915ad9bfae">00093</a> <span class="preprocessor"></span><span class="preprocessor">#define DFSCH__TRACEPOINT(ti)                   \</span>
<a name="l00094"></a>00094 <span class="preprocessor">  ((ti)-&gt;trace_buffer[(ti)-&gt;trace_ptr])</span>
<a name="l00095"></a><a class="code" href="magic_8h.html#bfcfdda97845da195456fa4b523a9eda">00095</a> <span class="preprocessor"></span><span class="preprocessor">#define DFSCH__TRACEPOINT_NOTIFY(ti)                             \</span>
<a name="l00096"></a>00096 <span class="preprocessor">  if (DFSCH_UNLIKELY((ti)-&gt;trace_listener)){                     \</span>
<a name="l00097"></a>00097 <span class="preprocessor">    (ti)-&gt;trace_listener((ti));                                  \</span>
<a name="l00098"></a>00098 <span class="preprocessor">  }                                                              \</span>
<a name="l00099"></a>00099 <span class="preprocessor"></span>
<a name="l00100"></a><a class="code" href="magic_8h.html#25dac35224d3e6e93d15504ac68c5b5e">00100</a> <span class="preprocessor"></span><span class="preprocessor">#define DFSCH__TRACEPOINT_EVAL(ti, ex, en)                       \</span>
<a name="l00101"></a>00101 <span class="preprocessor">  DFSCH__TRACEPOINT_SHIFT(ti);                                  \</span>
<a name="l00102"></a>00102 <span class="preprocessor">  DFSCH__TRACEPOINT(ti).flags = DFSCH_TRACEPOINT_KIND_EVAL;     \</span>
<a name="l00103"></a>00103 <span class="preprocessor">  DFSCH__TRACEPOINT(ti).data.eval.expr = (ex);                  \</span>
<a name="l00104"></a>00104 <span class="preprocessor">  DFSCH__TRACEPOINT(ti).data.eval.env = (en);                   \</span>
<a name="l00105"></a>00105 <span class="preprocessor">  DFSCH__TRACEPOINT_NOTIFY(ti)</span>
<a name="l00106"></a><a class="code" href="magic_8h.html#2cb23c95586995403e7c38334c2ea10a">00106</a> <span class="preprocessor"></span><span class="preprocessor">#define DFSCH__TRACEPOINT_APPLY(ti, p, al, fl)                       \</span>
<a name="l00107"></a>00107 <span class="preprocessor">  DFSCH__TRACEPOINT_SHIFT(ti);                                       \</span>
<a name="l00108"></a>00108 <span class="preprocessor">  DFSCH__TRACEPOINT(ti).flags = DFSCH_TRACEPOINT_KIND_APPLY | (fl);  \</span>
<a name="l00109"></a>00109 <span class="preprocessor">  DFSCH__TRACEPOINT(ti).data.apply.proc = (p);                       \</span>
<a name="l00110"></a>00110 <span class="preprocessor">  DFSCH__TRACEPOINT(ti).data.apply.args = (al);                      \</span>
<a name="l00111"></a>00111 <span class="preprocessor">  DFSCH__TRACEPOINT_NOTIFY(ti)</span>
<a name="l00112"></a><a class="code" href="magic_8h.html#58a2929a37ac968cd6923582da823fb1">00112</a> <span class="preprocessor"></span><span class="preprocessor">#define DFSCH__TRACEPOINT_ANON_HELPER1(x) #x</span>
<a name="l00113"></a><a class="code" href="magic_8h.html#3f7e2fa2abfde121018b804a6d5edbd4">00113</a> <span class="preprocessor"></span><span class="preprocessor">#define DFSCH__TRACEPOINT_ANON_HELPER2(x) \</span>
<a name="l00114"></a>00114 <span class="preprocessor">  DFSCH__TRACEPOINT_ANON_HELPER1(x)</span>
<a name="l00115"></a><a class="code" href="magic_8h.html#7e6f1db64dda7cdf69b4cae04a8f405b">00115</a> <span class="preprocessor"></span><span class="preprocessor">#define DFSCH__TRACEPOINT_ANON(ti, d, fl)                            \</span>
<a name="l00116"></a>00116 <span class="preprocessor">  DFSCH__TRACEPOINT_SHIFT(ti);                                      \</span>
<a name="l00117"></a>00117 <span class="preprocessor">  DFSCH__TRACEPOINT(ti).flags = DFSCH_TRACEPOINT_KIND_ANON | (fl);  \</span>
<a name="l00118"></a>00118 <span class="preprocessor">  DFSCH__TRACEPOINT(ti).data.anon.location = __FILE__ ":"           \</span>
<a name="l00119"></a>00119 <span class="preprocessor">    DFSCH__TRACEPOINT_ANON_HELPER2(__LINE__);                       \</span>
<a name="l00120"></a>00120 <span class="preprocessor">  DFSCH__TRACEPOINT(ti).data.anon.data = (d);                       \</span>
<a name="l00121"></a>00121 <span class="preprocessor">  DFSCH__TRACEPOINT_NOTIFY(ti)</span>
<a name="l00122"></a>00122 <span class="preprocessor"></span>
<a name="l00123"></a><a class="code" href="magic_8h.html#e5851964ad1b2e58f15320854a19f2ad">00123</a> <span class="preprocessor">#define DFSCH_TRACEPOINT(d, fl)                                 \</span>
<a name="l00124"></a>00124 <span class="preprocessor">  DFSCH__TRACEPOINT_ANON(dfsch__get_thread_info(), (d), (fl))</span>
<a name="l00125"></a>00125 <span class="preprocessor"></span>
<a name="l00126"></a>00126   <span class="keyword">typedef</span> (*dfsch__tracepoint_listener_t)(<a class="code" href="structdfsch____thread__info__t.html">dfsch__thread_info_t</a>*);
<a name="l00127"></a>00127 
<a name="l00128"></a><a class="code" href="structdfsch____thread__info__t.html">00128</a>   <span class="keyword">struct </span><a class="code" href="structdfsch____thread__info__t.html">dfsch__thread_info_t</a> {
<a name="l00129"></a><a class="code" href="structdfsch____thread__info__t.html#bca619363e8adc96a32a271d637a44dd">00129</a>     <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="structdfsch____thread__info__t.html#bca619363e8adc96a32a271d637a44dd">async_apply</a>;
<a name="l00130"></a>00130 
<a name="l00131"></a><a class="code" href="structdfsch____thread__info__t.html#d8da261513955ada0551f68de0a8a1c4">00131</a>     <a class="code" href="structdfsch____tracepoint__t.html">dfsch__tracepoint_t</a>* <a class="code" href="structdfsch____thread__info__t.html#d8da261513955ada0551f68de0a8a1c4">trace_buffer</a>;
<a name="l00132"></a><a class="code" href="structdfsch____thread__info__t.html#015004cd4cd2a5e447100104beebcc92">00132</a>     <a class="code" href="magic_8h.html#34063db72ebb7789cd1b8e5f597a5160">dfsch__tracepoint_listener_t</a> <a class="code" href="structdfsch____thread__info__t.html#015004cd4cd2a5e447100104beebcc92">trace_listener</a>;    
<a name="l00133"></a><a class="code" href="structdfsch____thread__info__t.html#d788040f25d98421a683dc20e6b22483">00133</a>     <span class="keywordtype">short</span> <a class="code" href="structdfsch____thread__info__t.html#d788040f25d98421a683dc20e6b22483">trace_ptr</a>;
<a name="l00134"></a><a class="code" href="structdfsch____thread__info__t.html#3fc949b2d5d482d276b5febc4c3579cd">00134</a>     <span class="keywordtype">short</span> <a class="code" href="structdfsch____thread__info__t.html#3fc949b2d5d482d276b5febc4c3579cd">trace_depth</a>;
<a name="l00135"></a>00135 
<a name="l00136"></a><a class="code" href="structdfsch____thread__info__t.html#9efe17c0d2efaeb2ee41ee412d1afabe">00136</a>     <span class="keywordtype">void</span>* <a class="code" href="structdfsch____thread__info__t.html#9efe17c0d2efaeb2ee41ee412d1afabe">env_freelist</a>;
<a name="l00137"></a><a class="code" href="structdfsch____thread__info__t.html#2b25d4719e99fd01413481d635667e7a">00137</a>     <span class="keywordtype">void</span>* <a class="code" href="structdfsch____thread__info__t.html#2b25d4719e99fd01413481d635667e7a">pair_freelist</a>;
<a name="l00138"></a>00138 
<a name="l00139"></a><a class="code" href="structdfsch____thread__info__t.html#ab9b0e2e0532f74ef10c5db2a6cf1d88">00139</a>     jmp_buf* <a class="code" href="structdfsch____thread__info__t.html#ab9b0e2e0532f74ef10c5db2a6cf1d88">throw_ret</a>;
<a name="l00140"></a><a class="code" href="structdfsch____thread__info__t.html#4348b83383cb5104ff4a6588928e7ccb">00140</a>     <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="structdfsch____thread__info__t.html#4348b83383cb5104ff4a6588928e7ccb">throw_tag</a>;
<a name="l00141"></a><a class="code" href="structdfsch____thread__info__t.html#ef4b331ee3330c1553ad85e9ca6400b9">00141</a>     <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="structdfsch____thread__info__t.html#ef4b331ee3330c1553ad85e9ca6400b9">throw_value</a>;
<a name="l00142"></a>00142 
<a name="l00143"></a><a class="code" href="structdfsch____thread__info__t.html#107c7753892238baceb7652dd1fc3e8f">00143</a>     <a class="code" href="structdfsch____catch__list__t.html">dfsch__catch_list_t</a>* <a class="code" href="structdfsch____thread__info__t.html#107c7753892238baceb7652dd1fc3e8f">catch_list</a>;
<a name="l00144"></a><a class="code" href="structdfsch____thread__info__t.html#b978ecdac2d2f7b910262d30372017ce">00144</a>     <a class="code" href="structdfsch____handler__list__t.html">dfsch__handler_list_t</a>* <a class="code" href="structdfsch____thread__info__t.html#b978ecdac2d2f7b910262d30372017ce">handler_list</a>;
<a name="l00145"></a><a class="code" href="structdfsch____thread__info__t.html#f8f43a6ff2c9abeeb9929fc68fd3db08">00145</a>     <a class="code" href="structdfsch____restart__list__t.html">dfsch__restart_list_t</a>* <a class="code" href="structdfsch____thread__info__t.html#f8f43a6ff2c9abeeb9929fc68fd3db08">restart_list</a>; 
<a name="l00146"></a>00146 
<a name="l00147"></a>00147   };
<a name="l00148"></a>00148 
<a name="l00149"></a>00149   <span class="keyword">extern</span> <a class="code" href="structdfsch____thread__info__t.html">dfsch__thread_info_t</a>* <a class="code" href="magic_8h.html#04b33f56258adffd197b27d210525b83">dfsch__get_thread_info</a>();
<a name="l00150"></a>00150   <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="magic_8h.html#4365414e385901de9b93f012a3c6e89e">dfsch__continue_unwind</a>();
<a name="l00151"></a>00151   <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="magic_8h.html#7e8ee6f5f9d73dc09139c726bc3f9a51">dfsch__finalize_unwind</a>();
<a name="l00152"></a>00152 
<a name="l00153"></a><a class="code" href="magic_8h.html#a07975d1e6ccf149e50878b754cc87db">00153</a> <span class="preprocessor">#define DFSCH__DEBUG_TAG printf(";; %s:%d %s\n", __FILE__, __LINE__, __func__)</span>
<a name="l00154"></a>00154 <span class="preprocessor"></span>
<a name="l00163"></a><a class="code" href="magic_8h.html#e80a6dbdeb616bc8a8476268b5dda68e">00163</a> <span class="preprocessor">#define DFSCH_SCATCH_BEGIN                                      \</span>
<a name="l00164"></a>00164 <span class="preprocessor">  {                                                             \</span>
<a name="l00165"></a>00165 <span class="preprocessor">  dfsch__thread_info_t *dfsch___ei = dfsch__get_thread_info();  \</span>
<a name="l00166"></a>00166 <span class="preprocessor">  jmp_buf *dfsch___old_ret;                                     \</span>
<a name="l00167"></a>00167 <span class="preprocessor">  jmp_buf dfsch___tmpbuf;                                       \</span>
<a name="l00168"></a>00168 <span class="preprocessor">  dfsch__catch_list_t* dfsch___old_catch;                       \</span>
<a name="l00169"></a>00169 <span class="preprocessor">  dfsch__handler_list_t* dfsch___old_handlers;                  \</span>
<a name="l00170"></a>00170 <span class="preprocessor">  dfsch__restart_list_t* dfsch___old_restarts;                  \</span>
<a name="l00171"></a>00171 <span class="preprocessor">                                                                \</span>
<a name="l00172"></a>00172 <span class="preprocessor">  dfsch___old_ret = dfsch___ei-&gt;throw_ret;                      \</span>
<a name="l00173"></a>00173 <span class="preprocessor">  dfsch___old_catch = dfsch___ei-&gt;catch_list;                   \</span>
<a name="l00174"></a>00174 <span class="preprocessor">  dfsch___old_handlers = dfsch___ei-&gt;handler_list;              \</span>
<a name="l00175"></a>00175 <span class="preprocessor">  dfsch___old_restarts = dfsch___ei-&gt;restart_list;              \</span>
<a name="l00176"></a>00176 <span class="preprocessor">  dfsch___ei-&gt;throw_ret = &amp;dfsch___tmpbuf;                      \</span>
<a name="l00177"></a>00177 <span class="preprocessor">                                                                \</span>
<a name="l00178"></a>00178 <span class="preprocessor">  if(setjmp(*dfsch___ei-&gt;throw_ret) != 1){</span>
<a name="l00179"></a>00179 <span class="preprocessor"></span>
<a name="l00180"></a><a class="code" href="magic_8h.html#936551e2d05780995ba2a73c2fbe7ddc">00180</a> <span class="preprocessor">#define DFSCH_SCATCH                                            \</span>
<a name="l00181"></a>00181 <span class="preprocessor">  dfsch___ei-&gt;throw_ret = (jmp_buf*)dfsch___old_ret;            \</span>
<a name="l00182"></a>00182 <span class="preprocessor">  dfsch___ei-&gt;catch_list = dfsch___old_catch;                   \</span>
<a name="l00183"></a>00183 <span class="preprocessor">  dfsch___ei-&gt;handler_list = dfsch___old_handlers;              \</span>
<a name="l00184"></a>00184 <span class="preprocessor">  dfsch___ei-&gt;restart_list = dfsch___old_restarts;              \</span>
<a name="l00185"></a>00185 <span class="preprocessor">} else {                                                        \</span>
<a name="l00186"></a>00186 <span class="preprocessor">  dfsch___ei-&gt;throw_ret = (jmp_buf*)dfsch___old_ret;            \</span>
<a name="l00187"></a>00187 <span class="preprocessor">  dfsch___ei-&gt;catch_list = dfsch___old_catch;                   \</span>
<a name="l00188"></a>00188 <span class="preprocessor">  dfsch___ei-&gt;handler_list = dfsch___old_handlers;              \</span>
<a name="l00189"></a>00189 <span class="preprocessor">  dfsch___ei-&gt;restart_list = dfsch___old_restarts;              \</span>
<a name="l00190"></a>00190 <span class="preprocessor">  {</span>
<a name="l00191"></a>00191 <span class="preprocessor"></span>
<a name="l00192"></a><a class="code" href="magic_8h.html#942a5a0c96b908376c44fabae1a6f0df">00192</a> <span class="preprocessor">#define DFSCH_CATCH_TAG (dfsch___ei-&gt;throw_tag)</span>
<a name="l00193"></a><a class="code" href="magic_8h.html#44c931c491a77d8bef28bacf33fa3694">00193</a> <span class="preprocessor"></span><span class="preprocessor">#define DFSCH_CATCH_VALUE (dfsch___ei-&gt;throw_value)</span>
<a name="l00194"></a>00194 <span class="preprocessor"></span>  
<a name="l00195"></a><a class="code" href="magic_8h.html#c101db4fd6ecf1c94a3c81592948945e">00195</a> <span class="preprocessor">#define DFSCH_SCATCH_END                        \</span>
<a name="l00196"></a>00196 <span class="preprocessor">  }}}</span>
<a name="l00197"></a>00197 <span class="preprocessor"></span>  
<a name="l00205"></a><a class="code" href="magic_8h.html#82cd868419a090568e33e92c446c3e53">00205</a> <span class="preprocessor">#define DFSCH_UNWIND                            \</span>
<a name="l00206"></a>00206 <span class="preprocessor">  {                                             \</span>
<a name="l00207"></a>00207 <span class="preprocessor">  dfsch__thread_info_t *dfsch___ei = dfsch__get_thread_info();  \</span>
<a name="l00208"></a>00208 <span class="preprocessor">  int dfsch___caught = 0;                       \</span>
<a name="l00209"></a>00209 <span class="preprocessor">  DFSCH_SCATCH_BEGIN {</span>
<a name="l00210"></a>00210 <span class="preprocessor"></span>
<a name="l00211"></a><a class="code" href="magic_8h.html#d8e48f6756bc7f7204832377ca25ea6a">00211</a> <span class="preprocessor">#define DFSCH_PROTECT                           \</span>
<a name="l00212"></a>00212 <span class="preprocessor">  } DFSCH_SCATCH {                              \</span>
<a name="l00213"></a>00213 <span class="preprocessor">    dfsch___caught = 1;                         \</span>
<a name="l00214"></a>00214 <span class="preprocessor">  } DFSCH_SCATCH_END</span>
<a name="l00215"></a><a class="code" href="magic_8h.html#6a03aec1dcdc2077b17e95491b01449f">00215</a> <span class="preprocessor"></span><span class="preprocessor">#define DFSCH_UNWIND_DETECT                     \</span>
<a name="l00216"></a>00216 <span class="preprocessor">  if (dfsch___caught)</span>
<a name="l00217"></a><a class="code" href="magic_8h.html#de8490c2332755cf283e447775432801">00217</a> <span class="preprocessor"></span><span class="preprocessor">#define DFSCH_PROTECT_END                       \</span>
<a name="l00218"></a>00218 <span class="preprocessor">  if (dfsch___caught){                          \</span>
<a name="l00219"></a>00219 <span class="preprocessor">    dfsch__continue_unwind(dfsch___ei);         \</span>
<a name="l00220"></a>00220 <span class="preprocessor">  }                                             \</span>
<a name="l00221"></a>00221 <span class="preprocessor">}</span>
<a name="l00222"></a>00222 <span class="preprocessor"></span>
<a name="l00223"></a><a class="code" href="magic_8h.html#1db1caf9624f3f5c667dc6a906e5c141">00223</a> <span class="preprocessor">#define DFSCH_CATCH_BEGIN(atag)                                 \</span>
<a name="l00224"></a>00224 <span class="preprocessor">  {                                                             \</span>
<a name="l00225"></a>00225 <span class="preprocessor">  dfsch__catch_list_t dfsch___cl;                               \</span>
<a name="l00226"></a>00226 <span class="preprocessor">  dfsch__thread_info_t *dfsch___ei = dfsch__get_thread_info();  \</span>
<a name="l00227"></a>00227 <span class="preprocessor">  dfsch___cl.tag = (atag);                                      \</span>
<a name="l00228"></a>00228 <span class="preprocessor">  dfsch___cl.next = dfsch___ei-&gt;catch_list;                     \</span>
<a name="l00229"></a>00229 <span class="preprocessor">  dfsch___ei-&gt;catch_list = &amp;dfsch___cl;                         \</span>
<a name="l00230"></a>00230 <span class="preprocessor">  DFSCH_SCATCH_BEGIN {</span>
<a name="l00231"></a><a class="code" href="magic_8h.html#093793ece0fa3b4415bc0ea8ee8d6030">00231</a> <span class="preprocessor"></span><span class="preprocessor">#define DFSCH_CATCH                             \</span>
<a name="l00232"></a>00232 <span class="preprocessor">  } DFSCH_SCATCH {                              \</span>
<a name="l00233"></a>00233 <span class="preprocessor">  if (DFSCH_CATCH_TAG == dfsch___cl.tag) {</span>
<a name="l00234"></a><a class="code" href="magic_8h.html#cb756050dba973c69ce949e383a843b4">00234</a> <span class="preprocessor"></span><span class="preprocessor">#define DFSCH_CATCH_END                         \</span>
<a name="l00235"></a>00235 <span class="preprocessor">  dfsch__finalize_unwind(dfsch___ei);           \</span>
<a name="l00236"></a>00236 <span class="preprocessor">} else {                                        \</span>
<a name="l00237"></a>00237 <span class="preprocessor">    dfsch__continue_unwind(dfsch___ei);         \</span>
<a name="l00238"></a>00238 <span class="preprocessor">  }                                             \</span>
<a name="l00239"></a>00239 <span class="preprocessor">} DFSCH_SCATCH_END                              \</span>
<a name="l00240"></a>00240 <span class="preprocessor">  dfsch___ei-&gt;catch_list = dfsch___cl.next;     \</span>
<a name="l00241"></a>00241 <span class="preprocessor">}</span>
<a name="l00242"></a>00242 <span class="preprocessor"></span>
<a name="l00243"></a><a class="code" href="magic_8h.html#85dfec81820c36b91098e7cc7d49c84e">00243</a> <span class="preprocessor">#define DFSCH_SAVE_HANDLERS                                             \</span>
<a name="l00244"></a>00244 <span class="preprocessor">  {                                                                     \</span>
<a name="l00245"></a>00245 <span class="preprocessor">  dfsch__thread_info_t *dfsch___ei = dfsch__get_thread_info();          \</span>
<a name="l00246"></a>00246 <span class="preprocessor">  dfsch__handler_list_t* dfsch___saved_handlers = dfsch___ei-&gt;handler_list;</span>
<a name="l00247"></a>00247 <span class="preprocessor"></span>
<a name="l00248"></a><a class="code" href="magic_8h.html#9b48225fb9af2731a1a50124f8553bd5">00248</a> <span class="preprocessor">#define DFSCH_RESTORE_HANDLERS                          \</span>
<a name="l00249"></a>00249 <span class="preprocessor">  dfsch___ei-&gt;handler_list = dfsch___saved_handlers;   \</span>
<a name="l00250"></a>00250 <span class="preprocessor">}</span>
<a name="l00251"></a>00251 <span class="preprocessor"></span>
<a name="l00252"></a><a class="code" href="magic_8h.html#5213f63998de5f3f5bb5cba2cd0ed87a">00252</a> <span class="preprocessor">#define DFSCH_SAVE_RESTARTS                                             \</span>
<a name="l00253"></a>00253 <span class="preprocessor">  {                                                                     \</span>
<a name="l00254"></a>00254 <span class="preprocessor">  dfsch__thread_info_t *dfsch___ei = dfsch__get_thread_info();          \</span>
<a name="l00255"></a>00255 <span class="preprocessor">  dfsch__restart_list_t* dfsch___saved_restarts = dfsch___ei-&gt;restart_list;</span>
<a name="l00256"></a>00256 <span class="preprocessor"></span>
<a name="l00257"></a><a class="code" href="magic_8h.html#cb6b0840741301dfafbedf2f02e684a7">00257</a> <span class="preprocessor">#define DFSCH_RESTORE_RESTARTS                          \</span>
<a name="l00258"></a>00258 <span class="preprocessor">  dfsch___ei-&gt;restart_list = dfsch___saved_restarts;   \</span>
<a name="l00259"></a>00259 <span class="preprocessor">}</span>
<a name="l00260"></a>00260 <span class="preprocessor"></span>
<a name="l00261"></a><a class="code" href="magic_8h.html#8cf0748c84bf847e47af5cd928d6278d">00261</a> <span class="preprocessor">#define DFSCH_WITH_SIMPLE_RESTART(name, description)                    \</span>
<a name="l00262"></a>00262 <span class="preprocessor">  {                                                                     \</span>
<a name="l00263"></a>00263 <span class="preprocessor">  dfsch_object_t* dfsch___tag = dfsch_gensym();                         \</span>
<a name="l00264"></a>00264 <span class="preprocessor">  DFSCH_CATCH_BEGIN(dfsch___tag){                                       \</span>
<a name="l00265"></a>00265 <span class="preprocessor">  dfsch_restart_bind(dfsch_make_restart(name,                           \</span>
<a name="l00266"></a>00266 <span class="preprocessor">                                        dfsch_make_throw_proc(dfsch___tag), \</span>
<a name="l00267"></a>00267 <span class="preprocessor">                                        description,                    \</span>
<a name="l00268"></a>00268 <span class="preprocessor">                                        NULL));</span>
<a name="l00269"></a><a class="code" href="magic_8h.html#5315c4b0077a3ceba0b115828011e7f0">00269</a> <span class="preprocessor"></span><span class="preprocessor">#define DFSCH_END_WITH_SIMPLE_RESTART           \</span>
<a name="l00270"></a>00270 <span class="preprocessor">  } DFSCH_CATCH {} DFSCH_CATCH_END              \</span>
<a name="l00271"></a>00271 <span class="preprocessor">}</span>
<a name="l00272"></a>00272 <span class="preprocessor"></span>
<a name="l00273"></a><a class="code" href="magic_8h.html#4471599e098e7187247293373930253a">00273</a> <span class="preprocessor">#define DFSCH_WITH_RETRY_WITH_RESTART(name, description)                \</span>
<a name="l00274"></a>00274 <span class="preprocessor">  {                                                                     \</span>
<a name="l00275"></a>00275 <span class="preprocessor">  dfsch_object_t* dfsch___tag = dfsch_gensym();                         \</span>
<a name="l00276"></a>00276 <span class="preprocessor">  DFSCH_CATCH_BEGIN(dfsch___tag){                                       \</span>
<a name="l00277"></a>00277 <span class="preprocessor">  dfsch_restart_bind(dfsch_make_restart(name,                           \</span>
<a name="l00278"></a>00278 <span class="preprocessor">                                        dfsch_make_throw_proc_arg(dfsch___tag), \</span>
<a name="l00279"></a>00279 <span class="preprocessor">                                        description,                    \</span>
<a name="l00280"></a>00280 <span class="preprocessor">                                        "Alternate value"));</span>
<a name="l00281"></a><a class="code" href="magic_8h.html#4810fc2f2d399735e50ee2fd98f1bd71">00281</a> <span class="preprocessor"></span><span class="preprocessor">#define DFSCH_END_WITH_RETRY_WITH_RESTART(obj)                          \</span>
<a name="l00282"></a>00282 <span class="preprocessor">  } DFSCH_CATCH { obj = DFSCH_CATCH_VALUE; } DFSCH_CATCH_END \</span>
<a name="l00283"></a>00283 <span class="preprocessor">}</span>
<a name="l00284"></a>00284 <span class="preprocessor"></span>  
<a name="l00285"></a>00285 
<a name="l00286"></a>00286 <span class="preprocessor">#ifdef __cplusplus</span>
<a name="l00287"></a>00287 <span class="preprocessor"></span>}
<a name="l00288"></a>00288 <span class="preprocessor">#endif</span>
<a name="l00289"></a>00289 <span class="preprocessor"></span>
<a name="l00290"></a>00290 
<a name="l00291"></a>00291 <span class="preprocessor">#endif</span>
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Fri Jul 3 16:02:13 2009 for dfsch by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.9 </small></address>
</body>
</html>
