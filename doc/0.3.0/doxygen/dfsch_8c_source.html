<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>dfsch: src/dfsch.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.9 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<h1>src/dfsch.c</h1><a href="dfsch_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * dfsch - Scheme-like Lisp dialect</span>
<a name="l00003"></a>00003 <span class="comment"> * Copyright (C) 2005-2009 Ales Hakl</span>
<a name="l00004"></a>00004 <span class="comment"> *</span>
<a name="l00005"></a>00005 <span class="comment"> * This program is free software; you can redistribute it and/or modify</span>
<a name="l00006"></a>00006 <span class="comment"> * it under the terms of the GNU General Public License as published by</span>
<a name="l00007"></a>00007 <span class="comment"> * the Free Software Foundation; either version 2 of the License, or</span>
<a name="l00008"></a>00008 <span class="comment"> * (at your option) any later version.</span>
<a name="l00009"></a>00009 <span class="comment"> *</span>
<a name="l00010"></a>00010 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="l00011"></a>00011 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00012"></a>00012 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00013"></a>00013 <span class="comment"> * GNU General Public License for more details.</span>
<a name="l00014"></a>00014 <span class="comment"> *</span>
<a name="l00015"></a>00015 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00016"></a>00016 <span class="comment"> * along with this program; if not, write to the Free Software</span>
<a name="l00017"></a>00017 <span class="comment"> * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</span>
<a name="l00018"></a>00018 <span class="comment"> *</span>
<a name="l00019"></a>00019 <span class="comment"> */</span>
<a name="l00020"></a>00020 
<a name="l00023"></a>00023 <span class="preprocessor">#ifdef HAVE_CONFIG_H</span>
<a name="l00024"></a>00024 <span class="preprocessor"></span><span class="preprocessor"># include &lt;config.h&gt;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#endif</span>
<a name="l00026"></a>00026 <span class="preprocessor"></span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;<a class="code" href="dfsch_8h.html">dfsch/dfsch.h</a>&gt;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;<a class="code" href="hash_8h.html">dfsch/hash.h</a>&gt;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;<a class="code" href="number_8h.html">dfsch/number.h</a>&gt;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;<a class="code" href="parse_8h.html">dfsch/parse.h</a>&gt;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;<a class="code" href="strings_8h.html">dfsch/strings.h</a>&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;<a class="code" href="magic_8h.html">dfsch/magic.h</a>&gt;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;<a class="code" href="conditions_8h.html">dfsch/conditions.h</a>&gt;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;<a class="code" href="introspect_8h.html">dfsch/introspect.h</a>&gt;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;<a class="code" href="weak_8h.html">dfsch/weak.h</a>&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include "<a class="code" href="src_2util_8h.html">util.h</a>"</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include "<a class="code" href="internal_8h.html">internal.h</a>"</span>
<a name="l00038"></a>00038 
<a name="l00039"></a>00039 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &lt;stdarg.h&gt;</span>
<a name="l00044"></a>00044 
<a name="l00045"></a>00045 <span class="preprocessor">#include "<a class="code" href="src_2types_8h.html">types.h</a>"</span>
<a name="l00046"></a>00046 
<a name="l00047"></a>00047 <span class="comment">//#define ALLOC_DEBUG</span>
<a name="l00048"></a>00048 
<a name="l00049"></a>00049 <span class="preprocessor">#ifdef ALLOC_DEBUG</span>
<a name="l00050"></a>00050 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">int</span> obj_count = 0;
<a name="l00051"></a>00051 <span class="keyword">static</span> <span class="keywordtype">int</span> obj_size = 0;
<a name="l00052"></a>00052 <span class="preprocessor">#endif</span>
<a name="l00053"></a>00053 <span class="preprocessor"></span>
<a name="l00054"></a><a class="code" href="dfsch_8c.html#701b0d85fa7104aa9b1efb76e68bc3a7">00054</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8c.html#701b0d85fa7104aa9b1efb76e68bc3a7">dfsch_make_object_var</a>(<span class="keyword">const</span> <a class="code" href="structdfsch__type__t.html">dfsch_type_t</a>* type, <span class="keywordtype">size_t</span> size){
<a name="l00055"></a>00055   <a class="code" href="structdfsch__object__t.html">object_t</a>* o = GC_MALLOC(type-&gt;<a class="code" href="structdfsch__type__t.html#33ba35271bd502dbc169d7cd8ea774b3">size</a> + size);
<a name="l00056"></a>00056   <span class="keywordflow">if</span> (!o)
<a name="l00057"></a>00057     <span class="keywordflow">return</span> NULL;
<a name="l00058"></a>00058 
<a name="l00059"></a>00059   o-&gt;<a class="code" href="structdfsch__object__t.html#ddb9df3a14880d9ca0ca62583ad7a49b">type</a> = (<a class="code" href="structdfsch__type__t.html">dfsch_type_t</a>*)type;
<a name="l00060"></a>00060 
<a name="l00061"></a>00061 <span class="preprocessor">#ifdef ALLOC_DEBUG</span>
<a name="l00062"></a>00062 <span class="preprocessor"></span>  obj_count ++;
<a name="l00063"></a>00063   obj_size += type-&gt;<a class="code" href="structdfsch__type__t.html#33ba35271bd502dbc169d7cd8ea774b3">size</a>;
<a name="l00064"></a>00064   printf(<span class="stringliteral">";; Alloc'd: #&lt;%s 0x%x&gt; serial %d arena %d\n"</span>, type-&gt;<a class="code" href="structdfsch__type__t.html#4e5167d85735a6000d0281b203f9fcf0">name</a>, o, 
<a name="l00065"></a>00065          obj_count, obj_size);
<a name="l00066"></a>00066 <span class="preprocessor">#endif</span>
<a name="l00067"></a>00067 <span class="preprocessor"></span>
<a name="l00068"></a>00068   <span class="keywordflow">return</span> o;
<a name="l00069"></a>00069 }
<a name="l00070"></a>00070 
<a name="l00071"></a><a class="code" href="dfsch_8c.html#7307ddbd343289326764031b2263b099">00071</a> <a class="code" href="structdfsch__object__t.html">object_t</a>* <a class="code" href="dfsch_8h.html#8aa9f840eedefa1a63cbce47cee49547">dfsch_make_object</a>(<span class="keyword">const</span> <a class="code" href="structdfsch__type__t.html">dfsch_type_t</a>* type){
<a name="l00072"></a>00072   <span class="keywordflow">return</span> <a class="code" href="dfsch_8c.html#701b0d85fa7104aa9b1efb76e68bc3a7">dfsch_make_object_var</a>(type, 0);
<a name="l00073"></a>00073 }
<a name="l00074"></a>00074 
<a name="l00075"></a>00075 
<a name="l00076"></a><a class="code" href="dfsch_8c.html#6d5e4c5c887f33dbab3f2a68530fb02a">00076</a> <span class="keywordtype">int</span> <a class="code" href="dfsch_8h.html#6d5e4c5c887f33dbab3f2a68530fb02a">dfsch_eq_p</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a> *a, <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a> *b){
<a name="l00077"></a>00077   <span class="keywordflow">return</span> (a==b);
<a name="l00078"></a>00078 }
<a name="l00079"></a>00079 
<a name="l00080"></a><a class="code" href="dfsch_8c.html#f0dae085f9947e96f051e4a35ce0487d">00080</a> <span class="keywordtype">int</span> <a class="code" href="dfsch_8h.html#f0dae085f9947e96f051e4a35ce0487d">dfsch_eqv_p</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a> *a, <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a> *b){
<a name="l00081"></a>00081   <span class="keywordflow">if</span> (a==b)
<a name="l00082"></a>00082     <span class="keywordflow">return</span> 1;
<a name="l00083"></a>00083 
<a name="l00084"></a>00084   <span class="keywordflow">if</span> (!a || !b)
<a name="l00085"></a>00085     <span class="keywordflow">return</span> 0;
<a name="l00086"></a>00086 
<a name="l00087"></a>00087   <span class="keywordflow">if</span> ((<a class="code" href="dfsch_2types_8h.html#5f142f7ca5170520a5c736a4a7d3a2b7">DFSCH_TYPE_OF</a>(a) == <a class="code" href="dfsch_2types_8h.html#5f142f7ca5170520a5c736a4a7d3a2b7">DFSCH_TYPE_OF</a>(b)) &amp;&amp; <a class="code" href="dfsch_8h.html#94389c22ee4bbe9e885f3b27c97c9c92">dfsch_number_p</a>(a))
<a name="l00088"></a>00088     <span class="keywordflow">return</span> <a class="code" href="number_8c.html#5c3a55f7baf66a63a1648cffa9766258">dfsch_number_equal_p</a>(a,b);
<a name="l00089"></a>00089 
<a name="l00090"></a>00090   <span class="keywordflow">return</span> 0;
<a name="l00091"></a>00091 }
<a name="l00092"></a>00092 
<a name="l00093"></a><a class="code" href="dfsch_8c.html#bbe1fbb1fc7739ab514130fd3f6f410f">00093</a> <span class="keywordtype">int</span> <a class="code" href="dfsch_8h.html#bbe1fbb1fc7739ab514130fd3f6f410f">dfsch_equal_p</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a> *a, <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a> *b){
<a name="l00094"></a>00094   <span class="keywordflow">if</span> (a==b)
<a name="l00095"></a>00095     <span class="keywordflow">return</span> 1;
<a name="l00096"></a>00096 
<a name="l00097"></a>00097   <span class="keywordflow">if</span> (!a || !b)
<a name="l00098"></a>00098     <span class="keywordflow">return</span> 0;
<a name="l00099"></a>00099 
<a name="l00100"></a>00100   <span class="keywordflow">if</span> (<a class="code" href="dfsch_2types_8h.html#5f142f7ca5170520a5c736a4a7d3a2b7">DFSCH_TYPE_OF</a>(a) != <a class="code" href="dfsch_2types_8h.html#5f142f7ca5170520a5c736a4a7d3a2b7">DFSCH_TYPE_OF</a>(b)){
<a name="l00101"></a>00101     <span class="keywordflow">if</span> (<a class="code" href="dfsch_2types_8h.html#6ec0a17695d07350d56eaffe994e29f4">DFSCH_PAIR_P</a>(a) &amp;&amp; <a class="code" href="dfsch_2types_8h.html#6ec0a17695d07350d56eaffe994e29f4">DFSCH_PAIR_P</a>(b)){
<a name="l00102"></a>00102       <span class="keywordflow">return</span> (<a class="code" href="dfsch_8h.html#bbe1fbb1fc7739ab514130fd3f6f410f">dfsch_equal_p</a>(<a class="code" href="dfsch_2types_8h.html#873da07e10c696bf321a42629cdb863e">DFSCH_FAST_CAR</a>(a), <a class="code" href="dfsch_2types_8h.html#873da07e10c696bf321a42629cdb863e">DFSCH_FAST_CAR</a>(b)) &amp;&amp;
<a name="l00103"></a>00103               <a class="code" href="dfsch_8h.html#bbe1fbb1fc7739ab514130fd3f6f410f">dfsch_equal_p</a>(<a class="code" href="dfsch_2types_8h.html#9621e19e10bbf916d031fc55631f48df">DFSCH_FAST_CDR</a>(a), <a class="code" href="dfsch_2types_8h.html#9621e19e10bbf916d031fc55631f48df">DFSCH_FAST_CDR</a>(b)));
<a name="l00104"></a>00104     } <span class="keywordflow">else</span> {
<a name="l00105"></a>00105       <span class="keywordflow">return</span> 0;
<a name="l00106"></a>00106     }
<a name="l00107"></a>00107   }
<a name="l00108"></a>00108 
<a name="l00109"></a>00109   <span class="keywordflow">if</span> (!<a class="code" href="dfsch_2types_8h.html#5f142f7ca5170520a5c736a4a7d3a2b7">DFSCH_TYPE_OF</a>(a))
<a name="l00110"></a>00110     <span class="keywordflow">return</span> 0;
<a name="l00111"></a>00111   <span class="keywordflow">if</span> (!<a class="code" href="dfsch_2types_8h.html#5f142f7ca5170520a5c736a4a7d3a2b7">DFSCH_TYPE_OF</a>(a)-&gt;equal_p)
<a name="l00112"></a>00112     <span class="keywordflow">return</span> 0;
<a name="l00113"></a>00113 
<a name="l00114"></a>00114   <span class="keywordflow">return</span> <a class="code" href="dfsch_2types_8h.html#5f142f7ca5170520a5c736a4a7d3a2b7">DFSCH_TYPE_OF</a>(a)-&gt;equal_p(a,b);
<a name="l00115"></a>00115 }
<a name="l00116"></a>00116 
<a name="l00117"></a><a class="code" href="dfsch_8c.html#64db22771730cacbcce181f16ec3b3f6">00117</a> <span class="keyword">static</span> <span class="keywordtype">size_t</span> <a class="code" href="dfsch_8c.html#64db22771730cacbcce181f16ec3b3f6">ptr_hash</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* ptr){
<a name="l00118"></a>00118   <span class="keywordtype">size_t</span> a = (size_t)ptr;        
<a name="l00119"></a>00119   <span class="keywordtype">size_t</span> b = (size_t)ptr &gt;&gt; 16 | (<span class="keywordtype">size_t</span>)ptr &lt;&lt; 16;
<a name="l00120"></a>00120 
<a name="l00121"></a>00121   a ^= b &gt;&gt; 2;
<a name="l00122"></a>00122   b ^= a &gt;&gt; 3;
<a name="l00123"></a>00123   a ^= b &lt;&lt; 5;
<a name="l00124"></a>00124   b ^= a &lt;&lt; 7;
<a name="l00125"></a>00125   a ^= b &gt;&gt; 11;
<a name="l00126"></a>00126   b ^= a &gt;&gt; 13;
<a name="l00127"></a>00127   a ^= b &lt;&lt; 17;
<a name="l00128"></a>00128   b ^= a &lt;&lt; 23;
<a name="l00129"></a>00129   
<a name="l00130"></a>00130   <span class="keywordflow">return</span> b ^ a;
<a name="l00131"></a>00131 }
<a name="l00132"></a>00132 
<a name="l00133"></a><a class="code" href="dfsch_8c.html#ce2facbb4f5975786673b3418a040892">00133</a> <span class="keyword">static</span> <span class="keywordtype">size_t</span> <a class="code" href="dfsch_8c.html#ce2facbb4f5975786673b3418a040892">hash_combine</a>(<span class="keywordtype">size_t</span> a, <span class="keywordtype">size_t</span> b){
<a name="l00134"></a>00134   a ^= b &gt;&gt; 2;
<a name="l00135"></a>00135   b ^= a &gt;&gt; 3;
<a name="l00136"></a>00136   a ^= b &lt;&lt; 5;
<a name="l00137"></a>00137   b ^= a &lt;&lt; 7;
<a name="l00138"></a>00138   a ^= b &gt;&gt; 11;
<a name="l00139"></a>00139   b ^= a &gt;&gt; 13;
<a name="l00140"></a>00140   a ^= b &lt;&lt; 17;
<a name="l00141"></a>00141   b ^= a &lt;&lt; 23;
<a name="l00142"></a>00142   
<a name="l00143"></a>00143   <span class="keywordflow">return</span> b ^ a;
<a name="l00144"></a>00144 }
<a name="l00145"></a>00145 
<a name="l00146"></a>00146 
<a name="l00147"></a><a class="code" href="dfsch_8c.html#35dde354e438308e6f88f8043c9bc8a5">00147</a> uint32_t <a class="code" href="dfsch_8h.html#35dde354e438308e6f88f8043c9bc8a5">dfsch_hash</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* obj){
<a name="l00148"></a>00148   <span class="keywordflow">if</span> (!obj){
<a name="l00149"></a>00149     <span class="keywordflow">return</span> 0;
<a name="l00150"></a>00150   }
<a name="l00151"></a>00151   <span class="keywordflow">if</span> (!<a class="code" href="dfsch_2types_8h.html#5f142f7ca5170520a5c736a4a7d3a2b7">DFSCH_TYPE_OF</a>(obj) || !<a class="code" href="dfsch_2types_8h.html#5f142f7ca5170520a5c736a4a7d3a2b7">DFSCH_TYPE_OF</a>(obj)-&gt;hash){
<a name="l00152"></a>00152     <span class="keywordflow">return</span> <a class="code" href="dfsch_8c.html#64db22771730cacbcce181f16ec3b3f6">ptr_hash</a>(obj);
<a name="l00153"></a>00153   }
<a name="l00154"></a>00154 
<a name="l00155"></a>00155   <span class="keywordflow">return</span> <a class="code" href="dfsch_2types_8h.html#5f142f7ca5170520a5c736a4a7d3a2b7">DFSCH_TYPE_OF</a>(obj)-&gt;hash(obj);
<a name="l00156"></a>00156 }
<a name="l00157"></a>00157 
<a name="l00158"></a><a class="code" href="dfsch_8c.html#d0adb1df6aab1132957510c9175e794b">00158</a> <a class="code" href="structdfsch__type__t.html">dfsch_type_t</a>* <a class="code" href="dfsch_8h.html#d0adb1df6aab1132957510c9175e794b">dfsch_type_of</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* obj){
<a name="l00159"></a>00159   <span class="keywordflow">return</span> <a class="code" href="dfsch_2types_8h.html#5f142f7ca5170520a5c736a4a7d3a2b7">DFSCH_TYPE_OF</a>(obj);
<a name="l00160"></a>00160 }
<a name="l00161"></a>00161 
<a name="l00162"></a><a class="code" href="dfsch_8c.html#588d713cc55f2ff4672f616009e606f0">00162</a> <a class="code" href="structdfsch__type__t.html">dfsch_type_t</a>* <a class="code" href="dfsch_8h.html#588d713cc55f2ff4672f616009e606f0">dfsch_object_as_type</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* obj){
<a name="l00163"></a>00163   <span class="keywordflow">return</span> (<a class="code" href="structdfsch__type__t.html">dfsch_type_t</a>*)<a class="code" href="dfsch_2types_8h.html#33e61f1f3b6316194f14eb58e17b2d65">DFSCH_ASSERT_INSTANCE</a>(obj, <a class="code" href="dfsch_2types_8h.html#800da821ab7e802b28d92a03ee3f969c">DFSCH_STANDARD_TYPE</a>);
<a name="l00164"></a>00164 }
<a name="l00165"></a>00165 
<a name="l00166"></a><a class="code" href="dfsch_8c.html#164db64582ba3b9ec30200b19476dfc5">00166</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8h.html#164db64582ba3b9ec30200b19476dfc5">dfsch_superclass</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* obj){  
<a name="l00167"></a>00167   <span class="keywordflow">return</span> (<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>*)<a class="code" href="dfsch_8h.html#588d713cc55f2ff4672f616009e606f0">dfsch_object_as_type</a>(obj)-&gt;<a class="code" href="structdfsch__type__t.html#b95d018cb0e57355d12cc5774d940830">superclass</a>;
<a name="l00168"></a>00168 }
<a name="l00169"></a>00169 
<a name="l00170"></a><a class="code" href="dfsch_8c.html#ec306b677692778ef9c88c4a34995ac8">00170</a> <span class="keywordtype">int</span> <a class="code" href="dfsch_8h.html#ec306b677692778ef9c88c4a34995ac8">dfsch_superclass_p</a>(<a class="code" href="structdfsch__type__t.html">dfsch_type_t</a>* sub, <a class="code" href="structdfsch__type__t.html">dfsch_type_t</a>* super){
<a name="l00171"></a>00171   <span class="keywordflow">if</span> (sub == super)
<a name="l00172"></a>00172     <span class="keywordflow">return</span> 1;
<a name="l00173"></a>00173 
<a name="l00174"></a>00174   <span class="keywordflow">while</span> (sub){
<a name="l00175"></a>00175     sub = sub-&gt;<a class="code" href="structdfsch__type__t.html#b95d018cb0e57355d12cc5774d940830">superclass</a>;
<a name="l00176"></a>00176     <span class="keywordflow">if</span> (sub==super){
<a name="l00177"></a>00177       <span class="keywordflow">return</span> 1;
<a name="l00178"></a>00178     }
<a name="l00179"></a>00179   }
<a name="l00180"></a>00180 
<a name="l00181"></a>00181   <span class="keywordflow">return</span> 0;
<a name="l00182"></a>00182 }
<a name="l00183"></a><a class="code" href="dfsch_8c.html#78c67a77444c6e4d26da2e5a7ce1bd6d">00183</a> <span class="keywordtype">int</span> <a class="code" href="dfsch_8h.html#78c67a77444c6e4d26da2e5a7ce1bd6d">dfsch_instance_p</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* obj, <a class="code" href="structdfsch__type__t.html">dfsch_type_t</a>* type){
<a name="l00184"></a>00184   <span class="keywordflow">return</span> <a class="code" href="dfsch_8h.html#ec306b677692778ef9c88c4a34995ac8">dfsch_superclass_p</a>(<a class="code" href="dfsch_2types_8h.html#5f142f7ca5170520a5c736a4a7d3a2b7">DFSCH_TYPE_OF</a>(obj), type);
<a name="l00185"></a>00185 }
<a name="l00186"></a>00186 
<a name="l00187"></a><a class="code" href="dfsch_8c.html#56f46a50d05a3558146b1a5a40df13d3">00187</a> <span class="keywordtype">void</span>* <a class="code" href="dfsch_8h.html#56f46a50d05a3558146b1a5a40df13d3">dfsch_assert_type</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* obj, <a class="code" href="structdfsch__type__t.html">dfsch_type_t</a>* type){
<a name="l00188"></a>00188   <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* o = obj;
<a name="l00189"></a>00189   <span class="keywordflow">while</span> (<a class="code" href="dfsch_2types_8h.html#5f142f7ca5170520a5c736a4a7d3a2b7">DFSCH_TYPE_OF</a>(o) != type){
<a name="l00190"></a>00190     <a class="code" href="magic_8h.html#4471599e098e7187247293373930253a">DFSCH_WITH_RETRY_WITH_RESTART</a>(<a class="code" href="dfsch_8h.html#f089f50dde23f0a132670368a9e341d5">dfsch_make_symbol</a>(<span class="stringliteral">"use-value"</span>), 
<a name="l00191"></a>00191                                   <span class="stringliteral">"Retry with alternate value"</span>) {
<a name="l00192"></a>00192       <a class="code" href="conditions_8h.html#753bcd9b14333b81e0b2dafd35cd2074">dfsch_type_error</a>(o, type, 0);
<a name="l00193"></a>00193     } <a class="code" href="magic_8h.html#4810fc2f2d399735e50ee2fd98f1bd71">DFSCH_END_WITH_RETRY_WITH_RESTART</a>(o);
<a name="l00194"></a>00194   }
<a name="l00195"></a>00195   <span class="keywordflow">return</span> o;
<a name="l00196"></a>00196 }
<a name="l00197"></a><a class="code" href="dfsch_8c.html#eab7649f8b25c7b17d7679a6d8adcfac">00197</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8h.html#eab7649f8b25c7b17d7679a6d8adcfac">dfsch_assert_instance</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* obj, 
<a name="l00198"></a>00198                                       <a class="code" href="structdfsch__type__t.html">dfsch_type_t</a>* type){
<a name="l00199"></a>00199   <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* o = obj;
<a name="l00200"></a>00200   <span class="keywordflow">while</span> (!<a class="code" href="dfsch_2types_8h.html#431cd198807ab14cc691b9e1f8600422">DFSCH_INSTANCE_P</a>(o, type)){
<a name="l00201"></a>00201     <a class="code" href="magic_8h.html#4471599e098e7187247293373930253a">DFSCH_WITH_RETRY_WITH_RESTART</a>(<a class="code" href="dfsch_8h.html#f089f50dde23f0a132670368a9e341d5">dfsch_make_symbol</a>(<span class="stringliteral">"use-value"</span>), 
<a name="l00202"></a>00202                                   <span class="stringliteral">"Retry with alternate value"</span>) {
<a name="l00203"></a>00203       <a class="code" href="conditions_8h.html#753bcd9b14333b81e0b2dafd35cd2074">dfsch_type_error</a>(o, type, 1);
<a name="l00204"></a>00204     } <a class="code" href="magic_8h.html#4810fc2f2d399735e50ee2fd98f1bd71">DFSCH_END_WITH_RETRY_WITH_RESTART</a>(o);
<a name="l00205"></a>00205   }
<a name="l00206"></a>00206   <span class="keywordflow">return</span> o;
<a name="l00207"></a>00207 }
<a name="l00208"></a>00208 
<a name="l00209"></a>00209 
<a name="l00210"></a><a class="code" href="dfsch_8c.html#5db94288aea962de145b196fca6a2978">00210</a> <span class="keyword">static</span> <a class="code" href="structdfsch__slot__t.html">dfsch_slot_t</a> <a class="code" href="dfsch_8c.html#5db94288aea962de145b196fca6a2978">slot_slots</a>[] = {
<a name="l00211"></a>00211   <a class="code" href="dfsch_2types_8h.html#0973d3a45f97fb73e1a06feede5e7495">DFSCH_STRING_SLOT</a>(<a class="code" href="structdfsch__slot__t.html">dfsch_slot_t</a>, name, <a class="code" href="dfsch_2types_8h.html#b7a8a678fd8a0061d23945e82e8f90c3">DFSCH_SLOT_ACCESS_RO</a>,
<a name="l00212"></a>00212                     <span class="stringliteral">"Slot name"</span>),
<a name="l00213"></a>00213   <a class="code" href="dfsch_2types_8h.html#c8b055fbbab4aea8d7e454031fb1fa91">DFSCH_SIZE_T_SLOT</a>(<a class="code" href="structdfsch__slot__t.html">dfsch_slot_t</a>, offset, <a class="code" href="dfsch_2types_8h.html#b7a8a678fd8a0061d23945e82e8f90c3">DFSCH_SLOT_ACCESS_RO</a>,
<a name="l00214"></a>00214                     <span class="stringliteral">"Offset of data item in object"</span>),
<a name="l00215"></a>00215   <a class="code" href="dfsch_2types_8h.html#cd3ba413e329d11dd79172b06b7f7406">DFSCH_INT_SLOT</a>(<a class="code" href="structdfsch__slot__t.html">dfsch_slot_t</a>, access, <a class="code" href="dfsch_2types_8h.html#b7a8a678fd8a0061d23945e82e8f90c3">DFSCH_SLOT_ACCESS_RO</a>,
<a name="l00216"></a>00216                  <span class="stringliteral">"Access mode of slot"</span>),
<a name="l00217"></a>00217   <a class="code" href="dfsch_2types_8h.html#0973d3a45f97fb73e1a06feede5e7495">DFSCH_STRING_SLOT</a>(<a class="code" href="structdfsch__slot__t.html">dfsch_slot_t</a>, documentation, <a class="code" href="dfsch_2types_8h.html#b7a8a678fd8a0061d23945e82e8f90c3">DFSCH_SLOT_ACCESS_RO</a>,
<a name="l00218"></a>00218                     <span class="stringliteral">"Slot documentation string"</span>),
<a name="l00219"></a>00219   <a class="code" href="dfsch_2types_8h.html#c6e0c8423bccc472557d5ec45c276261">DFSCH_SLOT_TERMINATOR</a>
<a name="l00220"></a>00220 };
<a name="l00221"></a>00221 
<a name="l00222"></a><a class="code" href="dfsch_8c.html#efd63f7419fe8c451fd066a1a699c6cb">00222</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="dfsch_8c.html#efd63f7419fe8c451fd066a1a699c6cb">slot_write</a>(<a class="code" href="structdfsch__slot__t.html">dfsch_slot_t</a>* slot, <a class="code" href="structdfsch__writer__state__t.html">dfsch_writer_state_t</a>* state){
<a name="l00223"></a>00223   <a class="code" href="writer_8h.html#7b0273790f2a1734ad5f46c44ce80029">dfsch_write_unreadable</a>(state, (<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>*)slot, <span class="stringliteral">"%s"</span>, slot-&gt;name);
<a name="l00224"></a>00224 }
<a name="l00225"></a>00225 
<a name="l00226"></a><a class="code" href="dfsch_8c.html#8467b8b4f16bbc2eafe722355e651633">00226</a> <a class="code" href="structdfsch__type__t.html">dfsch_type_t</a> <a class="code" href="dfsch_2types_8h.html#8467b8b4f16bbc2eafe722355e651633">dfsch_slot_type</a> = {
<a name="l00227"></a>00227   <a class="code" href="dfsch_2types_8h.html#901cee456df0772ed6f8047d5db26e05">DFSCH_ABSTRACT_TYPE</a>,
<a name="l00228"></a>00228   NULL,
<a name="l00229"></a>00229   <span class="keyword">sizeof</span>(<a class="code" href="structdfsch__slot__t.html">dfsch_slot_t</a>),
<a name="l00230"></a>00230   <span class="stringliteral">"slot"</span>,
<a name="l00231"></a>00231 
<a name="l00232"></a>00232   NULL,
<a name="l00233"></a>00233   (<a class="code" href="dfsch_2types_8h.html#f9caf55a3116d8b33005ed84c3dce964">dfsch_type_write_t</a>)<a class="code" href="dfsch_8c.html#efd63f7419fe8c451fd066a1a699c6cb">slot_write</a>,
<a name="l00234"></a>00234   NULL,
<a name="l00235"></a>00235   NULL,
<a name="l00236"></a>00236 
<a name="l00237"></a>00237   &amp;slot_slots,
<a name="l00238"></a>00238   <span class="stringliteral">"Common superclass of all slot types"</span>
<a name="l00239"></a>00239 };
<a name="l00240"></a>00240 
<a name="l00241"></a><a class="code" href="dfsch_8c.html#70569773ce670e1e2e9a7690d3777817">00241</a> <span class="keyword">static</span> <a class="code" href="structdfsch__slot__t.html">dfsch_slot_t</a> <a class="code" href="dfsch_8c.html#70569773ce670e1e2e9a7690d3777817">slot_type_slots</a>[] = {
<a name="l00242"></a>00242   <a class="code" href="dfsch_2types_8h.html#c8b055fbbab4aea8d7e454031fb1fa91">DFSCH_SIZE_T_SLOT</a>(<a class="code" href="structdfsch__slot__type__t.html">dfsch_slot_type_t</a>, size, <a class="code" href="dfsch_2types_8h.html#b7a8a678fd8a0061d23945e82e8f90c3">DFSCH_SLOT_ACCESS_RO</a>,
<a name="l00243"></a>00243                     <span class="stringliteral">"Size of slot"</span>),
<a name="l00244"></a>00244   <a class="code" href="dfsch_2types_8h.html#c6e0c8423bccc472557d5ec45c276261">DFSCH_SLOT_TERMINATOR</a>
<a name="l00245"></a>00245 };
<a name="l00246"></a>00246 
<a name="l00247"></a><a class="code" href="dfsch_8c.html#85a6fef0f48805dd0bda97b4183d61e8">00247</a> <a class="code" href="structdfsch__type__t.html">dfsch_type_t</a> <a class="code" href="dfsch_2types_8h.html#85a6fef0f48805dd0bda97b4183d61e8">dfsch_slot_type_type</a> = {
<a name="l00248"></a>00248   <a class="code" href="dfsch_2types_8h.html#d926c26c3c386619db91d5ab879d2a4c">DFSCH_META_TYPE</a>,
<a name="l00249"></a>00249   <a class="code" href="dfsch_2types_8h.html#800da821ab7e802b28d92a03ee3f969c">DFSCH_STANDARD_TYPE</a>,
<a name="l00250"></a>00250   <span class="keyword">sizeof</span>(<a class="code" href="structdfsch__slot__type__t.html">dfsch_slot_type_t</a>),
<a name="l00251"></a>00251   <span class="stringliteral">"slot-type"</span>,
<a name="l00252"></a>00252   NULL,
<a name="l00253"></a>00253   NULL,
<a name="l00254"></a>00254   NULL,
<a name="l00255"></a>00255   NULL,
<a name="l00256"></a>00256   &amp;slot_type_slots,
<a name="l00257"></a>00257   <span class="stringliteral">"Slot metaclass - describes methods for reading and writing"</span>
<a name="l00258"></a>00258 };
<a name="l00259"></a>00259 
<a name="l00260"></a><a class="code" href="dfsch_8c.html#4536fad660d84a7607338616155b993c">00260</a> <span class="keyword">static</span> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8c.html#4536fad660d84a7607338616155b993c">object_accessor_ref</a>(<span class="keywordtype">void</span>* ptr){
<a name="l00261"></a>00261   <span class="keywordflow">return</span> *((<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>**)ptr);
<a name="l00262"></a>00262 }
<a name="l00263"></a><a class="code" href="dfsch_8c.html#caded0d913d054eac9a49d6e0c827af5">00263</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="dfsch_8c.html#caded0d913d054eac9a49d6e0c827af5">object_accessor_set</a>(<span class="keywordtype">void</span>* ptr, <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* obj){
<a name="l00264"></a>00264   *((<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>**)ptr) = obj;
<a name="l00265"></a>00265 }
<a name="l00266"></a><a class="code" href="dfsch_8c.html#122427919389f428d95aae526261dfc6">00266</a> <a class="code" href="structdfsch__slot__type__t.html">dfsch_slot_type_t</a> <a class="code" href="dfsch_2types_8h.html#122427919389f428d95aae526261dfc6">dfsch_object_slot_type</a> = {
<a name="l00267"></a>00267   <a class="code" href="dfsch_2types_8h.html#b4e1fd2438905ebab38954a89078edc4">DFSCH_SLOT_TYPE_HEAD</a>(<span class="stringliteral">"object-slot"</span>, <span class="stringliteral">"Generic object-pointer slot"</span>),
<a name="l00268"></a>00268   <a class="code" href="dfsch_8c.html#4536fad660d84a7607338616155b993c">object_accessor_ref</a>,
<a name="l00269"></a>00269   <a class="code" href="dfsch_8c.html#caded0d913d054eac9a49d6e0c827af5">object_accessor_set</a>,
<a name="l00270"></a>00270   <span class="keyword">sizeof</span>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>*)
<a name="l00271"></a>00271 };
<a name="l00272"></a>00272 
<a name="l00273"></a><a class="code" href="dfsch_8c.html#066a746fc64dddbbef41ceceb045a7b2">00273</a> <span class="keyword">static</span> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8c.html#066a746fc64dddbbef41ceceb045a7b2">boolean_accessor_ref</a>(<span class="keywordtype">void</span>* ptr){
<a name="l00274"></a>00274   <span class="keywordflow">return</span> <a class="code" href="dfsch_8h.html#983a28126fe9d43b78523d5e0f303acb">dfsch_bool</a>(*((<span class="keywordtype">int</span>*)ptr));
<a name="l00275"></a>00275 }
<a name="l00276"></a><a class="code" href="dfsch_8c.html#e5f4f4554e1cb596a4448ccd1f1a94dd">00276</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="dfsch_8c.html#e5f4f4554e1cb596a4448ccd1f1a94dd">boolean_accessor_set</a>(<span class="keywordtype">void</span>* ptr, <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* obj){
<a name="l00277"></a>00277   *((<span class="keywordtype">int</span>**)ptr) = (obj != NULL);
<a name="l00278"></a>00278 }
<a name="l00279"></a><a class="code" href="dfsch_8c.html#5dfe07775272ddd56db63fb155aed5ac">00279</a> <a class="code" href="structdfsch__slot__type__t.html">dfsch_slot_type_t</a> <a class="code" href="dfsch_2types_8h.html#5dfe07775272ddd56db63fb155aed5ac">dfsch_boolean_slot_type</a> = {
<a name="l00280"></a>00280   <a class="code" href="dfsch_2types_8h.html#b4e1fd2438905ebab38954a89078edc4">DFSCH_SLOT_TYPE_HEAD</a>(<span class="stringliteral">"boolean-slot"</span>, <span class="stringliteral">"Slot holding boolean value as C int"</span>),
<a name="l00281"></a>00281   <a class="code" href="dfsch_8c.html#066a746fc64dddbbef41ceceb045a7b2">boolean_accessor_ref</a>,
<a name="l00282"></a>00282   <a class="code" href="dfsch_8c.html#e5f4f4554e1cb596a4448ccd1f1a94dd">boolean_accessor_set</a>,
<a name="l00283"></a>00283   <span class="keyword">sizeof</span>(int)
<a name="l00284"></a>00284 };
<a name="l00285"></a>00285 
<a name="l00286"></a><a class="code" href="dfsch_8c.html#5cca42756df829e3fe9a9786db3e11c0">00286</a> <span class="keyword">static</span> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8c.html#5cca42756df829e3fe9a9786db3e11c0">string_accessor_ref</a>(<span class="keywordtype">void</span>* ptr){
<a name="l00287"></a>00287   <span class="keywordflow">return</span> <a class="code" href="strings_8h.html#537f9a00a23ad18b6dffb9a9c00f5a30">dfsch_make_string_cstr</a>(*((<span class="keywordtype">char</span>**)ptr));
<a name="l00288"></a>00288 }
<a name="l00289"></a><a class="code" href="dfsch_8c.html#47841e1e4054739185942c3fb5f20024">00289</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="dfsch_8c.html#47841e1e4054739185942c3fb5f20024">string_accessor_set</a>(<span class="keywordtype">void</span>* ptr, <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* obj){
<a name="l00290"></a>00290   *((<span class="keywordtype">char</span>**)ptr) = <a class="code" href="strings_8h.html#e3ebfef661dc933387c6d03d56205289">dfsch_string_to_cstr</a>(obj);
<a name="l00291"></a>00291 }
<a name="l00292"></a><a class="code" href="dfsch_8c.html#27acb031a5a275375b911a5bb6a0e48c">00292</a> <a class="code" href="structdfsch__slot__type__t.html">dfsch_slot_type_t</a> <a class="code" href="dfsch_2types_8h.html#27acb031a5a275375b911a5bb6a0e48c">dfsch_string_slot_type</a> = {
<a name="l00293"></a>00293   <a class="code" href="dfsch_2types_8h.html#b4e1fd2438905ebab38954a89078edc4">DFSCH_SLOT_TYPE_HEAD</a>(<span class="stringliteral">"string-slot"</span>, <span class="stringliteral">"Slot holding string as C char*"</span>),
<a name="l00294"></a>00294   <a class="code" href="dfsch_8c.html#5cca42756df829e3fe9a9786db3e11c0">string_accessor_ref</a>,
<a name="l00295"></a>00295   <a class="code" href="dfsch_8c.html#47841e1e4054739185942c3fb5f20024">string_accessor_set</a>,
<a name="l00296"></a>00296   <span class="keyword">sizeof</span>(<span class="keywordtype">char</span>*)
<a name="l00297"></a>00297 };
<a name="l00298"></a>00298 
<a name="l00299"></a><a class="code" href="dfsch_8c.html#533b1cc67a3b219dd961a2ad317eb1b8">00299</a> <span class="preprocessor">#define INT_ACCESSOR(type, name) \</span>
<a name="l00300"></a>00300 <span class="preprocessor">  static dfsch_object_t* name ## _accessor_ref(void* ptr){              \</span>
<a name="l00301"></a>00301 <span class="preprocessor">    return dfsch_make_number_from_long(*((type*)ptr));                  \</span>
<a name="l00302"></a>00302 <span class="preprocessor">  }                                                                     \</span>
<a name="l00303"></a>00303 <span class="preprocessor">  static void name ## _accessor_set(void* ptr, dfsch_object_t* obj){    \</span>
<a name="l00304"></a>00304 <span class="preprocessor">    *((type*)ptr) = dfsch_number_to_long(obj);                          \</span>
<a name="l00305"></a>00305 <span class="preprocessor">  }                                                                     \</span>
<a name="l00306"></a>00306 <span class="preprocessor">  dfsch_slot_type_t dfsch_ ## name ## _slot_type = {                    \</span>
<a name="l00307"></a>00307 <span class="preprocessor">    DFSCH_SLOT_TYPE_HEAD(#name "-slot",                                 \</span>
<a name="l00308"></a>00308 <span class="preprocessor">                         "Slot containing C " #name "value"),      \</span>
<a name="l00309"></a>00309 <span class="preprocessor">    name ## _accessor_ref,                                              \</span>
<a name="l00310"></a>00310 <span class="preprocessor">    name ## _accessor_set,                                              \</span>
<a name="l00311"></a>00311 <span class="preprocessor">    sizeof(type)                                                        \</span>
<a name="l00312"></a>00312 <span class="preprocessor">  };                                                                    \</span>
<a name="l00313"></a>00313 <span class="preprocessor"></span>
<a name="l00314"></a>00314 <span class="preprocessor"></span><a class="code" href="dfsch_8c.html#533b1cc67a3b219dd961a2ad317eb1b8">INT_ACCESSOR</a>(<span class="keywordtype">int</span>, <span class="keywordtype">int</span>)
<a name="l00315"></a>00315 <a class="code" href="dfsch_8c.html#533b1cc67a3b219dd961a2ad317eb1b8">INT_ACCESSOR</a>(<span class="keywordtype">long</span>, <span class="keywordtype">long</span>)
<a name="l00316"></a>00316 <a class="code" href="dfsch_8c.html#533b1cc67a3b219dd961a2ad317eb1b8">INT_ACCESSOR</a>(<span class="keywordtype">size_t</span>, <span class="keywordtype">size_t</span>)
<a name="l00317"></a>00317 
<a name="l00318"></a><a class="code" href="dfsch_8c.html#418efe352afc0b6511257839ff3df8e8">00318</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8h.html#418efe352afc0b6511257839ff3df8e8">dfsch_get_slots</a>(<a class="code" href="structdfsch__type__t.html">dfsch_type_t</a>* type){
<a name="l00319"></a>00319   <a class="code" href="structdfsch__slot__t.html">dfsch_slot_t</a>* i;
<a name="l00320"></a>00320   <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* head = NULL;
<a name="l00321"></a>00321   <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* tail;
<a name="l00322"></a>00322   <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* tmp;
<a name="l00323"></a>00323   <span class="keywordflow">while</span>(type){
<a name="l00324"></a>00324     <span class="keywordflow">if</span> (type-&gt;slots){
<a name="l00325"></a>00325       i = type-&gt;slots;
<a name="l00326"></a>00326       <span class="keywordflow">while</span> (i-&gt;<a class="code" href="structdfsch__slot__t.html#467498abb8f1750cb02e13595b511816">type</a>){
<a name="l00327"></a>00327         tmp = <a class="code" href="dfsch_8h.html#ff85cf17ead5b89f43244a3010bc155c">dfsch_cons</a>((<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>*)i, NULL);
<a name="l00328"></a>00328         <span class="keywordflow">if</span> (!head) {
<a name="l00329"></a>00329           head = tail = tmp;
<a name="l00330"></a>00330         } <span class="keywordflow">else</span> {
<a name="l00331"></a>00331           <a class="code" href="dfsch_2types_8h.html#bb4a2056ae9d34d125eba3ac229f8ada">DFSCH_FAST_CDR_MUT</a>(tail) = tmp;
<a name="l00332"></a>00332           tail = tmp;
<a name="l00333"></a>00333         }
<a name="l00334"></a>00334         i++;
<a name="l00335"></a>00335       }
<a name="l00336"></a>00336     }
<a name="l00337"></a>00337     type = type-&gt;superclass;
<a name="l00338"></a>00338   }
<a name="l00339"></a>00339   <span class="keywordflow">return</span> head;
<a name="l00340"></a>00340 }
<a name="l00341"></a>00341 
<a name="l00342"></a><a class="code" href="dfsch_8c.html#23d5450e41e3849dc28ef92c9837f443">00342</a> <a class="code" href="structdfsch__slot__t.html">dfsch_slot_t</a>* <a class="code" href="dfsch_8h.html#23d5450e41e3849dc28ef92c9837f443">dfsch_find_slot</a>(<a class="code" href="structdfsch__type__t.html">dfsch_type_t</a>* type, 
<a name="l00343"></a>00343                               <span class="keywordtype">char</span>* name){
<a name="l00344"></a>00344   <a class="code" href="structdfsch__slot__t.html">dfsch_slot_t</a>* i;
<a name="l00345"></a>00345   <span class="keywordflow">while</span>(type){
<a name="l00346"></a>00346     <span class="keywordflow">if</span> (type-&gt;<a class="code" href="structdfsch__type__t.html#cb2be45de1a37cf59232953f17fd42d2">slots</a>){
<a name="l00347"></a>00347     i = type-&gt;<a class="code" href="structdfsch__type__t.html#cb2be45de1a37cf59232953f17fd42d2">slots</a>;
<a name="l00348"></a>00348     <span class="keywordflow">while</span> (i-&gt;<a class="code" href="structdfsch__slot__t.html#467498abb8f1750cb02e13595b511816">type</a>){
<a name="l00349"></a>00349       <span class="keywordflow">if</span> (strcmp(i-&gt;<a class="code" href="structdfsch__slot__t.html#e833ae9ca4267d1285988e4f36342473">name</a>, name)==0){
<a name="l00350"></a>00350         <span class="keywordflow">return</span> i;
<a name="l00351"></a>00351       }
<a name="l00352"></a>00352       i++;
<a name="l00353"></a>00353     }
<a name="l00354"></a>00354     }
<a name="l00355"></a>00355     type = type-&gt;<a class="code" href="structdfsch__type__t.html#b95d018cb0e57355d12cc5774d940830">superclass</a>;
<a name="l00356"></a>00356   }
<a name="l00357"></a>00357   <a class="code" href="dfsch_8h.html#646ee34c82a726fdc33d8a28af39270a">dfsch_error</a>(<span class="stringliteral">"No such slot"</span>, <a class="code" href="dfsch_8h.html#f089f50dde23f0a132670368a9e341d5">dfsch_make_symbol</a>(name));
<a name="l00358"></a>00358 }
<a name="l00359"></a>00359 
<a name="l00360"></a><a class="code" href="dfsch_8c.html#2ea6caaef53299a98ef801df9ea32f29">00360</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8h.html#2ea6caaef53299a98ef801df9ea32f29">dfsch_slot_ref</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* obj, 
<a name="l00361"></a>00361                                <a class="code" href="structdfsch__slot__t.html">dfsch_slot_t</a>* slot,
<a name="l00362"></a>00362                                <span class="keywordtype">int</span> debug){
<a name="l00363"></a>00363   <span class="keywordflow">if</span> (!debug &amp;&amp; slot-&gt;<a class="code" href="structdfsch__slot__t.html#516132e7492eb51ca62ce8dc11797e40">access</a> == <a class="code" href="dfsch_2types_8h.html#e878855a3a5a7794d4c346fd9cda361f">DFSCH_SLOT_ACCESS_DEBUG_READ</a>) {
<a name="l00364"></a>00364     <a class="code" href="dfsch_8h.html#646ee34c82a726fdc33d8a28af39270a">dfsch_error</a>(<span class="stringliteral">"Slot not accesible"</span>, (<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>*)slot);
<a name="l00365"></a>00365   }
<a name="l00366"></a>00366 
<a name="l00367"></a>00367   <span class="keywordflow">return</span> slot-&gt;<a class="code" href="structdfsch__slot__t.html#467498abb8f1750cb02e13595b511816">type</a>-&gt;<a class="code" href="structdfsch__slot__type__t.html#724ad69684802951b9a5967f3a625ded">ref</a>(((<span class="keywordtype">char</span>*) obj)+slot-&gt;<a class="code" href="structdfsch__slot__t.html#ff8bbcc935b51b9bdd97698c36cc748f">offset</a>);
<a name="l00368"></a>00368 }
<a name="l00369"></a><a class="code" href="dfsch_8c.html#62096bf98633dcc010d34ff77588a32a">00369</a> <span class="keywordtype">void</span> <a class="code" href="dfsch_8h.html#62096bf98633dcc010d34ff77588a32a">dfsch_slot_set</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* obj, 
<a name="l00370"></a>00370                     <a class="code" href="structdfsch__slot__t.html">dfsch_slot_t</a>* slot, 
<a name="l00371"></a>00371                     <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* value, 
<a name="l00372"></a>00372                     <span class="keywordtype">int</span> debug){
<a name="l00373"></a>00373   <span class="keywordflow">if</span> (!debug &amp;&amp; slot-&gt;<a class="code" href="structdfsch__slot__t.html#516132e7492eb51ca62ce8dc11797e40">access</a> != <a class="code" href="dfsch_2types_8h.html#ba5189321e1bdfed8d63428df62027ed">DFSCH_SLOT_ACCESS_RW</a>) {
<a name="l00374"></a>00374     <a class="code" href="dfsch_8h.html#646ee34c82a726fdc33d8a28af39270a">dfsch_error</a>(<span class="stringliteral">"Slot not accesible"</span>, (<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>*)slot);
<a name="l00375"></a>00375   }  
<a name="l00376"></a>00376   
<a name="l00377"></a>00377   slot-&gt;<a class="code" href="structdfsch__slot__t.html#467498abb8f1750cb02e13595b511816">type</a>-&gt;<a class="code" href="structdfsch__slot__type__t.html#fece6f7d33d2ee6ec2bff38aa2afe829">set</a>(((<span class="keywordtype">char</span>*) obj)+slot-&gt;<a class="code" href="structdfsch__slot__t.html#ff8bbcc935b51b9bdd97698c36cc748f">offset</a>, value);
<a name="l00378"></a>00378 }
<a name="l00379"></a><a class="code" href="dfsch_8c.html#b782ff31e21b89ca64076b5eebe4e762">00379</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8h.html#b782ff31e21b89ca64076b5eebe4e762">dfsch_slot_ref_by_name</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* obj, 
<a name="l00380"></a>00380                                        <span class="keywordtype">char</span>* slot,
<a name="l00381"></a>00381                                        <span class="keywordtype">int</span> debug){
<a name="l00382"></a>00382   <span class="keywordflow">return</span> <a class="code" href="dfsch_8h.html#2ea6caaef53299a98ef801df9ea32f29">dfsch_slot_ref</a>(obj, <a class="code" href="dfsch_8h.html#23d5450e41e3849dc28ef92c9837f443">dfsch_find_slot</a>(<a class="code" href="dfsch_2types_8h.html#5f142f7ca5170520a5c736a4a7d3a2b7">DFSCH_TYPE_OF</a>(obj),
<a name="l00383"></a>00383                                              slot),
<a name="l00384"></a>00384                         debug);
<a name="l00385"></a>00385 }
<a name="l00386"></a><a class="code" href="dfsch_8c.html#76d659f9fcd4fb0f0e193fa3faabb96a">00386</a> <span class="keywordtype">void</span> <a class="code" href="dfsch_8h.html#76d659f9fcd4fb0f0e193fa3faabb96a">dfsch_slot_set_by_name</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* obj, 
<a name="l00387"></a>00387                             <span class="keywordtype">char</span>* slot, 
<a name="l00388"></a>00388                             <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* value,
<a name="l00389"></a>00389                             <span class="keywordtype">int</span> debug){
<a name="l00390"></a>00390   <a class="code" href="dfsch_8h.html#62096bf98633dcc010d34ff77588a32a">dfsch_slot_set</a>(obj, <a class="code" href="dfsch_8h.html#23d5450e41e3849dc28ef92c9837f443">dfsch_find_slot</a>(<a class="code" href="dfsch_2types_8h.html#5f142f7ca5170520a5c736a4a7d3a2b7">DFSCH_TYPE_OF</a>(obj),
<a name="l00391"></a>00391                                       slot), 
<a name="l00392"></a>00392                  value,
<a name="l00393"></a>00393                  debug);
<a name="l00394"></a>00394 }
<a name="l00395"></a>00395 
<a name="l00396"></a><a class="code" href="dfsch_8c.html#2e3466ffc665a8a1870955b3facc020c">00396</a> <a class="code" href="structdfsch__type__t.html">dfsch_type_t</a> <a class="code" href="dfsch_2types_8h.html#2e3466ffc665a8a1870955b3facc020c">dfsch_abstract_type</a> = {
<a name="l00397"></a>00397   <a class="code" href="dfsch_2types_8h.html#d926c26c3c386619db91d5ab879d2a4c">DFSCH_META_TYPE</a>,
<a name="l00398"></a>00398   DFSCH_STANDARD_TYPE,
<a name="l00399"></a>00399   <span class="keyword">sizeof</span>(<a class="code" href="structdfsch__type__t.html">dfsch_type_t</a>),
<a name="l00400"></a>00400   <span class="stringliteral">"abstract-type"</span>,
<a name="l00401"></a>00401   NULL,
<a name="l00402"></a>00402   NULL,
<a name="l00403"></a>00403   NULL
<a name="l00404"></a>00404 };
<a name="l00405"></a>00405 
<a name="l00406"></a><a class="code" href="dfsch_8c.html#aa09af8650c2932ae51785a71b990701">00406</a> <a class="code" href="structdfsch__type__t.html">dfsch_type_t</a> <a class="code" href="dfsch_2types_8h.html#aa09af8650c2932ae51785a71b990701">dfsch_meta_type</a> = {
<a name="l00407"></a>00407   <a class="code" href="dfsch_2types_8h.html#d926c26c3c386619db91d5ab879d2a4c">DFSCH_META_TYPE</a>,
<a name="l00408"></a>00408   DFSCH_STANDARD_TYPE,
<a name="l00409"></a>00409   <span class="keyword">sizeof</span>(<a class="code" href="structdfsch__type__t.html">dfsch_type_t</a>),
<a name="l00410"></a>00410   <span class="stringliteral">"meta-type"</span>,
<a name="l00411"></a>00411   NULL,
<a name="l00412"></a>00412   NULL,
<a name="l00413"></a>00413   NULL
<a name="l00414"></a>00414 };
<a name="l00415"></a>00415 
<a name="l00416"></a>00416 
<a name="l00417"></a><a class="code" href="dfsch_8c.html#b83012a6d2ade2a79973ac6310803e3d">00417</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="dfsch_8c.html#b83012a6d2ade2a79973ac6310803e3d">type_write</a>(<a class="code" href="structdfsch__type__t.html">dfsch_type_t</a>* t, <a class="code" href="structdfsch__writer__state__t.html">dfsch_writer_state_t</a>* state){
<a name="l00418"></a>00418   <a class="code" href="writer_8h.html#7b0273790f2a1734ad5f46c44ce80029">dfsch_write_unreadable</a>(state, (<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>*)t, 
<a name="l00419"></a>00419                          <span class="stringliteral">"%s instance-size: %d"</span>, t-&gt;name, t-&gt;size);
<a name="l00420"></a>00420 }
<a name="l00421"></a>00421 
<a name="l00422"></a><a class="code" href="dfsch_8c.html#ff1185fe083865eaf693a2e168356c2b">00422</a> <span class="keyword">static</span> <a class="code" href="structdfsch__slot__t.html">dfsch_slot_t</a> <a class="code" href="dfsch_8c.html#ff1185fe083865eaf693a2e168356c2b">type_slots</a>[] = {
<a name="l00423"></a>00423   <a class="code" href="dfsch_2types_8h.html#0973d3a45f97fb73e1a06feede5e7495">DFSCH_STRING_SLOT</a>(<a class="code" href="structdfsch__type__t.html">dfsch_type_t</a>, name, <a class="code" href="dfsch_2types_8h.html#b7a8a678fd8a0061d23945e82e8f90c3">DFSCH_SLOT_ACCESS_RO</a>,
<a name="l00424"></a>00424                     <span class="stringliteral">"Type name"</span>),
<a name="l00425"></a>00425   <a class="code" href="dfsch_2types_8h.html#0973d3a45f97fb73e1a06feede5e7495">DFSCH_STRING_SLOT</a>(<a class="code" href="structdfsch__type__t.html">dfsch_type_t</a>, documentation, <a class="code" href="dfsch_2types_8h.html#b7a8a678fd8a0061d23945e82e8f90c3">DFSCH_SLOT_ACCESS_RO</a>,
<a name="l00426"></a>00426                     <span class="stringliteral">"Documentation string"</span>),
<a name="l00427"></a>00427   <a class="code" href="dfsch_2types_8h.html#c6e0c8423bccc472557d5ec45c276261">DFSCH_SLOT_TERMINATOR</a>
<a name="l00428"></a>00428 };
<a name="l00429"></a>00429 
<a name="l00430"></a><a class="code" href="dfsch_8c.html#6550f6ca90fad4aae900141c05efc0e6">00430</a> <a class="code" href="structdfsch__type__t.html">dfsch_type_t</a> <a class="code" href="dfsch_2types_8h.html#6550f6ca90fad4aae900141c05efc0e6">dfsch_standard_type</a> = {
<a name="l00431"></a>00431   <a class="code" href="dfsch_2types_8h.html#d926c26c3c386619db91d5ab879d2a4c">DFSCH_META_TYPE</a>,
<a name="l00432"></a>00432   NULL,
<a name="l00433"></a>00433   <span class="keyword">sizeof</span>(<a class="code" href="structdfsch__type__t.html">dfsch_type_t</a>),
<a name="l00434"></a>00434   <span class="stringliteral">"standard-type"</span>,
<a name="l00435"></a>00435   NULL,
<a name="l00436"></a>00436   (<a class="code" href="dfsch_2types_8h.html#f9caf55a3116d8b33005ed84c3dce964">dfsch_type_write_t</a>)<a class="code" href="dfsch_8c.html#b83012a6d2ade2a79973ac6310803e3d">type_write</a>,
<a name="l00437"></a>00437   NULL,
<a name="l00438"></a>00438   NULL,
<a name="l00439"></a>00439   &amp;type_slots,
<a name="l00440"></a>00440   <span class="stringliteral">"Base metaclass representing common methods of all objects"</span>
<a name="l00441"></a>00441 };
<a name="l00442"></a>00442 
<a name="l00443"></a><a class="code" href="dfsch_8c.html#56843b2917e8136597a1d7e8dc8d931a">00443</a> <a class="code" href="structdfsch__type__t.html">dfsch_type_t</a> <a class="code" href="dfsch_2types_8h.html#56843b2917e8136597a1d7e8dc8d931a">dfsch_special_type</a> = {
<a name="l00444"></a>00444   <a class="code" href="dfsch_2types_8h.html#d926c26c3c386619db91d5ab879d2a4c">DFSCH_META_TYPE</a>,
<a name="l00445"></a>00445   DFSCH_STANDARD_TYPE,
<a name="l00446"></a>00446   <span class="keyword">sizeof</span>(<a class="code" href="structdfsch__type__t.html">dfsch_type_t</a>),
<a name="l00447"></a>00447   <span class="stringliteral">"special-type"</span>,
<a name="l00448"></a>00448   NULL,
<a name="l00449"></a>00449   NULL,
<a name="l00450"></a>00450   NULL,
<a name="l00451"></a>00451   NULL,
<a name="l00452"></a>00452   &amp;type_slots,
<a name="l00453"></a>00453   <span class="stringliteral">"Metaclass of types with special in-memory representation"</span>
<a name="l00454"></a>00454 };
<a name="l00455"></a>00455 
<a name="l00456"></a><a class="code" href="dfsch_8c.html#cc29d02809149608a3deb29178406de8">00456</a> <a class="code" href="structdfsch__type__t.html">dfsch_type_t</a> <a class="code" href="dfsch_2types_8h.html#cc29d02809149608a3deb29178406de8">dfsch_list_type</a> = {
<a name="l00457"></a>00457   <a class="code" href="dfsch_2types_8h.html#901cee456df0772ed6f8047d5db26e05">DFSCH_ABSTRACT_TYPE</a>,
<a name="l00458"></a>00458   NULL,
<a name="l00459"></a>00459   0,
<a name="l00460"></a>00460   <span class="stringliteral">"list"</span>,
<a name="l00461"></a>00461   NULL,
<a name="l00462"></a>00462   NULL,
<a name="l00463"></a>00463   NULL,
<a name="l00464"></a>00464   NULL,
<a name="l00465"></a>00465   NULL,
<a name="l00466"></a>00466   <span class="stringliteral">"Abstract superclass of list-like objects"</span>
<a name="l00467"></a>00467 };
<a name="l00468"></a>00468 
<a name="l00469"></a><a class="code" href="dfsch_8c.html#8d45ee01a7f01f4444c8c23572fa4d4d">00469</a> <a class="code" href="structdfsch__type__t.html">dfsch_type_t</a> <a class="code" href="dfsch_2types_8h.html#8d45ee01a7f01f4444c8c23572fa4d4d">dfsch_function_type</a> = {
<a name="l00470"></a>00470   <a class="code" href="dfsch_2types_8h.html#901cee456df0772ed6f8047d5db26e05">DFSCH_ABSTRACT_TYPE</a>,
<a name="l00471"></a>00471   NULL,
<a name="l00472"></a>00472   0,
<a name="l00473"></a>00473   <span class="stringliteral">"function"</span>,
<a name="l00474"></a>00474   NULL,
<a name="l00475"></a>00475   NULL,
<a name="l00476"></a>00476   NULL,
<a name="l00477"></a>00477   NULL,
<a name="l00478"></a>00478   NULL,
<a name="l00479"></a>00479   <span class="stringliteral">"Abstract superclass for functions"</span>
<a name="l00480"></a>00480   <span class="comment">/* N.B.: anything could work as function, this is only notational </span>
<a name="l00481"></a>00481 <span class="comment">   *       convention */</span>
<a name="l00482"></a>00482 };
<a name="l00483"></a>00483 
<a name="l00484"></a>00484 
<a name="l00485"></a><a class="code" href="dfsch_8c.html#00e3ae4ea2e1c7d3a2e0f68ece97778d">00485</a> <a class="code" href="structdfsch__type__t.html">dfsch_type_t</a> <a class="code" href="dfsch_2types_8h.html#00e3ae4ea2e1c7d3a2e0f68ece97778d">dfsch_empty_list_type</a> = {
<a name="l00486"></a>00486   <a class="code" href="dfsch_2types_8h.html#53189e7bb2cca77f7a85457ddef3cc29">DFSCH_SPECIAL_TYPE</a>,
<a name="l00487"></a>00487   <a class="code" href="dfsch_2types_8h.html#f68c7145dd8463d15d30fa4a1ffc532e">DFSCH_LIST_TYPE</a>,
<a name="l00488"></a>00488   0,
<a name="l00489"></a>00489   <span class="stringliteral">"empty-list"</span>,
<a name="l00490"></a>00490   NULL,
<a name="l00491"></a>00491   NULL,
<a name="l00492"></a>00492   NULL,
<a name="l00493"></a>00493   NULL,
<a name="l00494"></a>00494   NULL,
<a name="l00495"></a>00495   <span class="stringliteral">"Class with only one instance - ()"</span>
<a name="l00496"></a>00496 };
<a name="l00497"></a>00497 
<a name="l00498"></a><a class="code" href="dfsch_8c.html#dc660f750827255db1f086493cb1e6e2">00498</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="dfsch_8c.html#dc660f750827255db1f086493cb1e6e2">pair_equal_p</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>*a, <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>*b){
<a name="l00499"></a>00499   <span class="keywordflow">return</span> <a class="code" href="dfsch_8h.html#bbe1fbb1fc7739ab514130fd3f6f410f">dfsch_equal_p</a>(<a class="code" href="dfsch_2types_8h.html#873da07e10c696bf321a42629cdb863e">DFSCH_FAST_CAR</a>(a), <a class="code" href="dfsch_2types_8h.html#873da07e10c696bf321a42629cdb863e">DFSCH_FAST_CAR</a>(b)) 
<a name="l00500"></a>00500     &amp;&amp; <a class="code" href="dfsch_8h.html#bbe1fbb1fc7739ab514130fd3f6f410f">dfsch_equal_p</a>(<a class="code" href="dfsch_2types_8h.html#9621e19e10bbf916d031fc55631f48df">DFSCH_FAST_CDR</a>(a), <a class="code" href="dfsch_2types_8h.html#9621e19e10bbf916d031fc55631f48df">DFSCH_FAST_CDR</a>(b));
<a name="l00501"></a>00501 }
<a name="l00502"></a><a class="code" href="dfsch_8c.html#653683212df38cc3f841b623b7ad4602">00502</a> <span class="keyword">static</span> <span class="keywordtype">size_t</span> <a class="code" href="dfsch_8c.html#653683212df38cc3f841b623b7ad4602">pair_hash</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* p){
<a name="l00503"></a>00503   <span class="keywordflow">return</span> <a class="code" href="dfsch_8c.html#ce2facbb4f5975786673b3418a040892">hash_combine</a>(<a class="code" href="dfsch_8h.html#35dde354e438308e6f88f8043c9bc8a5">dfsch_hash</a>(<a class="code" href="dfsch_2types_8h.html#873da07e10c696bf321a42629cdb863e">DFSCH_FAST_CAR</a>(p)), 
<a name="l00504"></a>00504                       <a class="code" href="dfsch_8h.html#35dde354e438308e6f88f8043c9bc8a5">dfsch_hash</a>(<a class="code" href="dfsch_2types_8h.html#9621e19e10bbf916d031fc55631f48df">DFSCH_FAST_CDR</a>(p)));
<a name="l00505"></a>00505 }
<a name="l00506"></a><a class="code" href="dfsch_8c.html#c4111c399a82c3bf5d4ece14c4168bef">00506</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="dfsch_8c.html#c4111c399a82c3bf5d4ece14c4168bef">pair_write</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>*p, <a class="code" href="structdfsch__writer__state__t.html">dfsch_writer_state_t</a>* state){
<a name="l00507"></a>00507   <a class="code" href="structdfsch__object__t.html">object_t</a>* i=p;
<a name="l00508"></a>00508   <a class="code" href="structdfsch__object__t.html">object_t</a>* j=p;
<a name="l00509"></a>00509   <span class="keywordtype">int</span> c = 0;
<a name="l00510"></a>00510     
<a name="l00511"></a>00511   <a class="code" href="writer_8h.html#2c8fa380efd4f78037e0a3e36b520cd2">dfsch_write_string</a>(state, <span class="stringliteral">"("</span>);
<a name="l00512"></a>00512   <span class="keywordflow">while</span> (<a class="code" href="dfsch_2types_8h.html#6ec0a17695d07350d56eaffe994e29f4">DFSCH_PAIR_P</a>(i)){
<a name="l00513"></a>00513     <a class="code" href="writer_8h.html#3be6837800ae6f88ea035dc892a2ae88">dfsch_write_object</a>(state, <a class="code" href="dfsch_2types_8h.html#873da07e10c696bf321a42629cdb863e">DFSCH_FAST_CAR</a>(i));
<a name="l00514"></a>00514     i = <a class="code" href="dfsch_2types_8h.html#9621e19e10bbf916d031fc55631f48df">DFSCH_FAST_CDR</a>(i);
<a name="l00515"></a>00515     <span class="keywordflow">if</span> (i == j){
<a name="l00516"></a>00516       <a class="code" href="writer_8h.html#2c8fa380efd4f78037e0a3e36b520cd2">dfsch_write_string</a>(state, <span class="stringliteral">"... #&lt;infinite-list&gt;)"</span>);
<a name="l00517"></a>00517       <span class="keywordflow">return</span>;
<a name="l00518"></a>00518     }
<a name="l00519"></a>00519 
<a name="l00520"></a>00520     c++;
<a name="l00521"></a>00521     <span class="keywordflow">if</span> (c == 2){
<a name="l00522"></a>00522       c = 0;
<a name="l00523"></a>00523       j = <a class="code" href="dfsch_2types_8h.html#9621e19e10bbf916d031fc55631f48df">DFSCH_FAST_CDR</a>(j);
<a name="l00524"></a>00524     }
<a name="l00525"></a>00525     <span class="keywordflow">if</span> (i) {
<a name="l00526"></a>00526       <a class="code" href="writer_8h.html#2c8fa380efd4f78037e0a3e36b520cd2">dfsch_write_string</a>(state, <span class="stringliteral">" "</span>);  
<a name="l00527"></a>00527     }
<a name="l00528"></a>00528   }
<a name="l00529"></a>00529   
<a name="l00530"></a>00530   <span class="keywordflow">if</span> (i){  
<a name="l00531"></a>00531     <a class="code" href="writer_8h.html#2c8fa380efd4f78037e0a3e36b520cd2">dfsch_write_string</a>(state, <span class="stringliteral">". "</span>);  
<a name="l00532"></a>00532     <a class="code" href="writer_8h.html#3be6837800ae6f88ea035dc892a2ae88">dfsch_write_object</a>(state, i);
<a name="l00533"></a>00533   }
<a name="l00534"></a>00534 
<a name="l00535"></a>00535   <a class="code" href="writer_8h.html#2c8fa380efd4f78037e0a3e36b520cd2">dfsch_write_string</a>(state, <span class="stringliteral">")"</span>);  
<a name="l00536"></a>00536 }
<a name="l00537"></a><a class="code" href="dfsch_8c.html#efef34dc377da0ddfc3892458d8dbcfc">00537</a> <a class="code" href="structdfsch__type__t.html">dfsch_type_t</a> <a class="code" href="dfsch_2types_8h.html#efef34dc377da0ddfc3892458d8dbcfc">dfsch_pair_type</a> = {
<a name="l00538"></a>00538   <a class="code" href="dfsch_2types_8h.html#901cee456df0772ed6f8047d5db26e05">DFSCH_ABSTRACT_TYPE</a>,
<a name="l00539"></a>00539   <a class="code" href="dfsch_2types_8h.html#f68c7145dd8463d15d30fa4a1ffc532e">DFSCH_LIST_TYPE</a>,
<a name="l00540"></a>00540   <span class="keyword">sizeof</span>(<a class="code" href="structdfsch__pair__t.html">dfsch_pair_t</a>), 
<a name="l00541"></a>00541   <span class="stringliteral">"pair"</span>,
<a name="l00542"></a>00542   (<a class="code" href="dfsch_2types_8h.html#b6971aeeb1835b06f61c7603ae3911bc">dfsch_type_equal_p_t</a>)<a class="code" href="dfsch_8c.html#dc660f750827255db1f086493cb1e6e2">pair_equal_p</a>,
<a name="l00543"></a>00543   (<a class="code" href="dfsch_2types_8h.html#f9caf55a3116d8b33005ed84c3dce964">dfsch_type_write_t</a>)<a class="code" href="dfsch_8c.html#c4111c399a82c3bf5d4ece14c4168bef">pair_write</a>,
<a name="l00544"></a>00544   NULL,
<a name="l00545"></a>00545   (<a class="code" href="dfsch_2types_8h.html#c1daca59c9425289f9b3eca8c6bbbbfe">dfsch_type_hash_t</a>)<a class="code" href="dfsch_8c.html#653683212df38cc3f841b623b7ad4602">pair_hash</a>,
<a name="l00546"></a>00546   NULL,
<a name="l00547"></a>00547   <span class="stringliteral">"Abstract superclass for all pair representations"</span>
<a name="l00548"></a>00548 };
<a name="l00549"></a><a class="code" href="dfsch_8c.html#8f0b5b0dedaf5c25c4887f03ebfdd425">00549</a> <span class="preprocessor">#define PAIR (&amp;dfsch_pair_type)</span>
<a name="l00550"></a>00550 <span class="preprocessor"></span>
<a name="l00551"></a><a class="code" href="dfsch_8c.html#85999819accdfdcc690d7b2ef7d09e4c">00551</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="dfsch_8c.html#85999819accdfdcc690d7b2ef7d09e4c">symbol_write</a>(<a class="code" href="structdfsch__object__t.html">object_t</a>* o, <a class="code" href="structdfsch__writer__state__t.html">dfsch_writer_state_t</a>* state){
<a name="l00552"></a>00552   <a class="code" href="structdfsch____symbol__t.html">symbol_t</a>* s;
<a name="l00553"></a>00553   s = <a class="code" href="dfsch_2types_8h.html#723dc3032e2859270937a020df018c8f">DFSCH_TAG_REF</a>(o);
<a name="l00554"></a>00554   <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structdfsch____symbol__t.html#b0665edd7cd6a8a20b6015876c9d4296">data</a>){
<a name="l00555"></a>00555     <a class="code" href="writer_8h.html#2c8fa380efd4f78037e0a3e36b520cd2">dfsch_write_string</a>(state, s-&gt;<a class="code" href="structdfsch____symbol__t.html#b0665edd7cd6a8a20b6015876c9d4296">data</a>);
<a name="l00556"></a>00556   } <span class="keywordflow">else</span> {
<a name="l00557"></a>00557     <a class="code" href="writer_8h.html#7b0273790f2a1734ad5f46c44ce80029">dfsch_write_unreadable</a>(state, o, <span class="stringliteral">""</span>); 
<a name="l00558"></a>00558   }
<a name="l00559"></a>00559 }
<a name="l00560"></a><a class="code" href="dfsch_8c.html#5f9ae9ce6aa6f82108b260135b2e63a0">00560</a> <span class="preprocessor">#define SYMBOL DFSCH_SYMBOL_TYPE </span>
<a name="l00561"></a>00561 <span class="preprocessor"></span>
<a name="l00562"></a>00562 
<a name="l00563"></a><a class="code" href="dfsch_8c.html#ebb05f2d4cea9eab5305cd275b988b34">00563</a> <a class="code" href="structdfsch__type__t.html">dfsch_type_t</a> <a class="code" href="dfsch_2types_8h.html#ebb05f2d4cea9eab5305cd275b988b34">dfsch_tagged_types</a>[4] = {
<a name="l00564"></a>00564   {
<a name="l00565"></a>00565     <a class="code" href="dfsch_2types_8h.html#53189e7bb2cca77f7a85457ddef3cc29">DFSCH_SPECIAL_TYPE</a>,
<a name="l00566"></a>00566     <a class="code" href="dfsch_2types_8h.html#bb95cba20c3135562f58335551f68e85">DFSCH_IMMUTABLE_PAIR_TYPE</a>,
<a name="l00567"></a>00567     <span class="keyword">sizeof</span>(<a class="code" href="structdfsch__pair__t.html">dfsch_pair_t</a>), 
<a name="l00568"></a>00568     <span class="stringliteral">"compact-list"</span>,
<a name="l00569"></a>00569     (<a class="code" href="dfsch_2types_8h.html#b6971aeeb1835b06f61c7603ae3911bc">dfsch_type_equal_p_t</a>)<a class="code" href="dfsch_8c.html#dc660f750827255db1f086493cb1e6e2">pair_equal_p</a>,
<a name="l00570"></a>00570     (<a class="code" href="dfsch_2types_8h.html#f9caf55a3116d8b33005ed84c3dce964">dfsch_type_write_t</a>)<a class="code" href="dfsch_8c.html#c4111c399a82c3bf5d4ece14c4168bef">pair_write</a>,
<a name="l00571"></a>00571     NULL,
<a name="l00572"></a>00572     (<a class="code" href="dfsch_2types_8h.html#c1daca59c9425289f9b3eca8c6bbbbfe">dfsch_type_hash_t</a>)<a class="code" href="dfsch_8c.html#653683212df38cc3f841b623b7ad4602">pair_hash</a>,
<a name="l00573"></a>00573     NULL,
<a name="l00574"></a>00574     <span class="stringliteral">"Immutable list stored as array"</span>
<a name="l00575"></a>00575   },
<a name="l00576"></a>00576   {
<a name="l00577"></a>00577     <a class="code" href="dfsch_2types_8h.html#53189e7bb2cca77f7a85457ddef3cc29">DFSCH_SPECIAL_TYPE</a>,
<a name="l00578"></a>00578     <a class="code" href="dfsch_2types_8h.html#b7f8ae918d879f11a2cfb049a568bb66">DFSCH_PAIR_TYPE</a>,
<a name="l00579"></a>00579     <span class="keyword">sizeof</span>(<a class="code" href="structdfsch__pair__t.html">dfsch_pair_t</a>), 
<a name="l00580"></a>00580     <span class="stringliteral">"mutable-pair"</span>,
<a name="l00581"></a>00581     (<a class="code" href="dfsch_2types_8h.html#b6971aeeb1835b06f61c7603ae3911bc">dfsch_type_equal_p_t</a>)<a class="code" href="dfsch_8c.html#dc660f750827255db1f086493cb1e6e2">pair_equal_p</a>,
<a name="l00582"></a>00582     (<a class="code" href="dfsch_2types_8h.html#f9caf55a3116d8b33005ed84c3dce964">dfsch_type_write_t</a>)<a class="code" href="dfsch_8c.html#c4111c399a82c3bf5d4ece14c4168bef">pair_write</a>,
<a name="l00583"></a>00583     NULL,
<a name="l00584"></a>00584     (<a class="code" href="dfsch_2types_8h.html#c1daca59c9425289f9b3eca8c6bbbbfe">dfsch_type_hash_t</a>)<a class="code" href="dfsch_8c.html#653683212df38cc3f841b623b7ad4602">pair_hash</a>,
<a name="l00585"></a>00585     NULL,
<a name="l00586"></a>00586     <span class="stringliteral">"Normal mutable cons cell"</span>
<a name="l00587"></a>00587   },
<a name="l00588"></a>00588   {
<a name="l00589"></a>00589     DFSCH_STANDARD_TYPE,
<a name="l00590"></a>00590     NULL,
<a name="l00591"></a>00591     <span class="keyword">sizeof</span>(<a class="code" href="structdfsch____symbol__t.html">symbol_t</a>), 
<a name="l00592"></a>00592     <span class="stringliteral">"symbol"</span>,
<a name="l00593"></a>00593     NULL,
<a name="l00594"></a>00594     (<a class="code" href="dfsch_2types_8h.html#f9caf55a3116d8b33005ed84c3dce964">dfsch_type_write_t</a>)<a class="code" href="dfsch_8c.html#85999819accdfdcc690d7b2ef7d09e4c">symbol_write</a>,
<a name="l00595"></a>00595     NULL,
<a name="l00596"></a>00596     NULL,
<a name="l00597"></a>00597     NULL,
<a name="l00598"></a>00598     <span class="stringliteral">"Symbol - equal? instances are always eq?"</span>,
<a name="l00599"></a>00599     <a class="code" href="dfsch_2types_8h.html#6ee6d0257a04d2554cc9ea3be29b27ba">DFSCH_TYPEF_NO_WEAK_REFERENCES</a>
<a name="l00600"></a>00600   },
<a name="l00601"></a>00601   {
<a name="l00602"></a>00602     <a class="code" href="dfsch_2types_8h.html#53189e7bb2cca77f7a85457ddef3cc29">DFSCH_SPECIAL_TYPE</a>,
<a name="l00603"></a>00603     <a class="code" href="dfsch_2types_8h.html#b7f8ae918d879f11a2cfb049a568bb66">DFSCH_PAIR_TYPE</a>,
<a name="l00604"></a>00604     <span class="keyword">sizeof</span>(<a class="code" href="structdfsch__pair__t.html">dfsch_pair_t</a>), 
<a name="l00605"></a>00605     <span class="stringliteral">"immutable-pair"</span>,
<a name="l00606"></a>00606     (<a class="code" href="dfsch_2types_8h.html#b6971aeeb1835b06f61c7603ae3911bc">dfsch_type_equal_p_t</a>)<a class="code" href="dfsch_8c.html#dc660f750827255db1f086493cb1e6e2">pair_equal_p</a>,
<a name="l00607"></a>00607     (<a class="code" href="dfsch_2types_8h.html#f9caf55a3116d8b33005ed84c3dce964">dfsch_type_write_t</a>)<a class="code" href="dfsch_8c.html#c4111c399a82c3bf5d4ece14c4168bef">pair_write</a>,
<a name="l00608"></a>00608     NULL,
<a name="l00609"></a>00609     (<a class="code" href="dfsch_2types_8h.html#c1daca59c9425289f9b3eca8c6bbbbfe">dfsch_type_hash_t</a>)<a class="code" href="dfsch_8c.html#653683212df38cc3f841b623b7ad4602">pair_hash</a>,
<a name="l00610"></a>00610     NULL,
<a name="l00611"></a>00611     <span class="stringliteral">"Immutable cons cell"</span>
<a name="l00612"></a>00612   },
<a name="l00613"></a>00613 };
<a name="l00614"></a>00614 
<a name="l00615"></a>00615 
<a name="l00616"></a>00616 
<a name="l00617"></a><a class="code" href="dfsch_8c.html#4d0dc8ead6084407a311a544407a1fe8">00617</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="dfsch_8c.html#4d0dc8ead6084407a311a544407a1fe8">primitive_write</a>(<a class="code" href="structdfsch__primitive__t.html">dfsch_primitive_t</a>* p, 
<a name="l00618"></a>00618                             <a class="code" href="structdfsch__writer__state__t.html">dfsch_writer_state_t</a>* state){
<a name="l00619"></a>00619   <span class="keywordtype">char</span>* name = p-&gt;<a class="code" href="structdfsch__primitive__t.html#2b99e57e8019c479b6442dda0f86ba05">name</a> ? p-&gt;<a class="code" href="structdfsch__primitive__t.html#2b99e57e8019c479b6442dda0f86ba05">name</a> : <span class="stringliteral">"()"</span>;
<a name="l00620"></a>00620   <a class="code" href="writer_8h.html#7b0273790f2a1734ad5f46c44ce80029">dfsch_write_unreadable</a>(state, (<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>*)p, <span class="stringliteral">"%s"</span>, name);
<a name="l00621"></a>00621 }
<a name="l00622"></a>00622 
<a name="l00623"></a><a class="code" href="dfsch_8c.html#45b02668f0a99ed154ddbb81079a4282">00623</a> <span class="keyword">static</span> <a class="code" href="structdfsch__slot__t.html">dfsch_slot_t</a> <a class="code" href="dfsch_8c.html#45b02668f0a99ed154ddbb81079a4282">primitive_slots</a>[] = {
<a name="l00624"></a>00624   <a class="code" href="dfsch_2types_8h.html#0973d3a45f97fb73e1a06feede5e7495">DFSCH_STRING_SLOT</a>(<a class="code" href="structdfsch__primitive__t.html">dfsch_primitive_t</a>, name, <a class="code" href="dfsch_2types_8h.html#b7a8a678fd8a0061d23945e82e8f90c3">DFSCH_SLOT_ACCESS_RO</a>,
<a name="l00625"></a>00625                     <span class="stringliteral">"Primitive's internal name"</span>),
<a name="l00626"></a>00626   <a class="code" href="dfsch_2types_8h.html#0973d3a45f97fb73e1a06feede5e7495">DFSCH_STRING_SLOT</a>(<a class="code" href="structdfsch__primitive__t.html">dfsch_primitive_t</a>, documentation, <a class="code" href="dfsch_2types_8h.html#b7a8a678fd8a0061d23945e82e8f90c3">DFSCH_SLOT_ACCESS_RO</a>,
<a name="l00627"></a>00627                     <span class="stringliteral">"Documentation string"</span>),
<a name="l00628"></a>00628   <a class="code" href="dfsch_2types_8h.html#c6e0c8423bccc472557d5ec45c276261">DFSCH_SLOT_TERMINATOR</a>
<a name="l00629"></a>00629 };
<a name="l00630"></a>00630 
<a name="l00631"></a><a class="code" href="dfsch_8c.html#e935088504e342f3d61f561a3ef12e7f">00631</a> <a class="code" href="structdfsch__type__t.html">dfsch_type_t</a> <a class="code" href="dfsch_2types_8h.html#e935088504e342f3d61f561a3ef12e7f">dfsch_primitive_type</a> = {
<a name="l00632"></a>00632   DFSCH_STANDARD_TYPE,
<a name="l00633"></a>00633   <a class="code" href="dfsch_2types_8h.html#ff428d311e2ce0959378f161d056deb4">DFSCH_STANDARD_FUNCTION_TYPE</a>,
<a name="l00634"></a>00634   <span class="keyword">sizeof</span>(<a class="code" href="structdfsch__primitive__t.html">primitive_t</a>),
<a name="l00635"></a>00635   <span class="stringliteral">"primitive"</span>,
<a name="l00636"></a>00636   NULL,
<a name="l00637"></a>00637   (<a class="code" href="dfsch_2types_8h.html#f9caf55a3116d8b33005ed84c3dce964">dfsch_type_write_t</a>)<a class="code" href="dfsch_8c.html#4d0dc8ead6084407a311a544407a1fe8">primitive_write</a>,
<a name="l00638"></a>00638   NULL,
<a name="l00639"></a>00639   NULL,
<a name="l00640"></a>00640   &amp;primitive_slots,
<a name="l00641"></a>00641   <span class="stringliteral">"Function implemented in C code"</span>
<a name="l00642"></a>00642 };
<a name="l00643"></a><a class="code" href="dfsch_8c.html#a0f458f5ca6cb8ca94e5f076f5b88be9">00643</a> <span class="preprocessor">#define PRIMITIVE (&amp;dfsch_primitive_type)</span>
<a name="l00644"></a>00644 <span class="preprocessor"></span>
<a name="l00645"></a><a class="code" href="dfsch_8c.html#32225a7da5265315ef6b9d5cb5fd74db">00645</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="dfsch_8c.html#32225a7da5265315ef6b9d5cb5fd74db">print_lambda_list</a>(<a class="code" href="structlambda__list__t.html">lambda_list_t</a>* ll, <a class="code" href="structdfsch__writer__state__t.html">dfsch_writer_state_t</a>* ws){
<a name="l00646"></a>00646   <span class="keywordtype">int</span> i;
<a name="l00647"></a>00647   <span class="keywordflow">for</span> (i = 0; i &lt; ll-&gt;<a class="code" href="structlambda__list__t.html#400c2dbdf6c03556c2a2e2c1c17811a5">positional_count</a>; i++){
<a name="l00648"></a>00648     <a class="code" href="writer_8h.html#3be6837800ae6f88ea035dc892a2ae88">dfsch_write_object</a>(ws, ll-&gt;<a class="code" href="structlambda__list__t.html#7e821448243aab6adbbb23e29fc5906a">positional</a>[i]);
<a name="l00649"></a>00649     <a class="code" href="writer_8h.html#2c8fa380efd4f78037e0a3e36b520cd2">dfsch_write_string</a>(ws, <span class="stringliteral">" "</span>);
<a name="l00650"></a>00650   }
<a name="l00651"></a>00651   <span class="keywordflow">if</span> (ll-&gt;<a class="code" href="structlambda__list__t.html#9b8f3afdedc6a741e7997f0b78b386ca">rest</a>){
<a name="l00652"></a>00652     <a class="code" href="writer_8h.html#2c8fa380efd4f78037e0a3e36b520cd2">dfsch_write_string</a>(ws, <span class="stringliteral">"&amp;rest "</span>);
<a name="l00653"></a>00653     <a class="code" href="writer_8h.html#3be6837800ae6f88ea035dc892a2ae88">dfsch_write_object</a>(ws, ll-&gt;<a class="code" href="structlambda__list__t.html#9b8f3afdedc6a741e7997f0b78b386ca">rest</a>);    
<a name="l00654"></a>00654   }
<a name="l00655"></a>00655 }
<a name="l00656"></a>00656 
<a name="l00657"></a><a class="code" href="dfsch_8c.html#60e87fee482940fb5e951b6cf339a452">00657</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="dfsch_8c.html#60e87fee482940fb5e951b6cf339a452">function_write</a>(<a class="code" href="structclosure__t.html">closure_t</a>* c, <a class="code" href="structdfsch__writer__state__t.html">dfsch_writer_state_t</a>* state){
<a name="l00658"></a>00658   <a class="code" href="writer_8h.html#8044d9479e02dc84608ea96c08d38d86">dfsch_write_unreadable_start</a>(state, (<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>*)c);
<a name="l00659"></a>00659 
<a name="l00660"></a>00660   <span class="keywordflow">if</span> (c-&gt;name){
<a name="l00661"></a>00661     <a class="code" href="writer_8h.html#3be6837800ae6f88ea035dc892a2ae88">dfsch_write_object</a>(state, c-&gt;name);
<a name="l00662"></a>00662   }
<a name="l00663"></a>00663   <a class="code" href="writer_8h.html#2c8fa380efd4f78037e0a3e36b520cd2">dfsch_write_string</a>(state, <span class="stringliteral">" ("</span>);
<a name="l00664"></a>00664   <a class="code" href="dfsch_8c.html#32225a7da5265315ef6b9d5cb5fd74db">print_lambda_list</a>(c-&gt;args, state);
<a name="l00665"></a>00665   <a class="code" href="writer_8h.html#2c8fa380efd4f78037e0a3e36b520cd2">dfsch_write_string</a>(state, <span class="stringliteral">")"</span>);
<a name="l00666"></a>00666 
<a name="l00667"></a>00667   <a class="code" href="writer_8h.html#815730c993aae9242baadbf4cc03eeef">dfsch_write_unreadable_end</a>(state);
<a name="l00668"></a>00668 }
<a name="l00669"></a>00669 
<a name="l00670"></a><a class="code" href="dfsch_8c.html#54cbd472df44bb6939af7dbbd79a03b9">00670</a> <span class="keyword">static</span> <a class="code" href="structdfsch__slot__t.html">dfsch_slot_t</a> <a class="code" href="dfsch_8c.html#54cbd472df44bb6939af7dbbd79a03b9">closure_slots</a>[] = {
<a name="l00671"></a>00671   <a class="code" href="dfsch_2types_8h.html#735afbc447efac1f89062f5acad775a1">DFSCH_OBJECT_SLOT</a>(<a class="code" href="structclosure__t.html">closure_t</a>, args, <a class="code" href="dfsch_2types_8h.html#9f7555adc2161c8907f15bdc8cd280e1">DFSCH_SLOT_ACCESS_DEBUG_WRITE</a>,
<a name="l00672"></a>00672                     <span class="stringliteral">"Arguments of function (compiled lambda-list)"</span>),
<a name="l00673"></a>00673   <a class="code" href="dfsch_2types_8h.html#735afbc447efac1f89062f5acad775a1">DFSCH_OBJECT_SLOT</a>(<a class="code" href="structclosure__t.html">closure_t</a>, code, <a class="code" href="dfsch_2types_8h.html#9f7555adc2161c8907f15bdc8cd280e1">DFSCH_SLOT_ACCESS_DEBUG_WRITE</a>,
<a name="l00674"></a>00674                     <span class="stringliteral">"Actual implementation code"</span>),
<a name="l00675"></a>00675   <a class="code" href="dfsch_2types_8h.html#735afbc447efac1f89062f5acad775a1">DFSCH_OBJECT_SLOT</a>(<a class="code" href="structclosure__t.html">closure_t</a>, env, <a class="code" href="dfsch_2types_8h.html#9f7555adc2161c8907f15bdc8cd280e1">DFSCH_SLOT_ACCESS_DEBUG_WRITE</a>,
<a name="l00676"></a>00676                     <span class="stringliteral">"Lexically enclosing environment"</span>),
<a name="l00677"></a>00677   <a class="code" href="dfsch_2types_8h.html#735afbc447efac1f89062f5acad775a1">DFSCH_OBJECT_SLOT</a>(<a class="code" href="structclosure__t.html">closure_t</a>, name, <a class="code" href="dfsch_2types_8h.html#9f7555adc2161c8907f15bdc8cd280e1">DFSCH_SLOT_ACCESS_DEBUG_WRITE</a>,
<a name="l00678"></a>00678                     <span class="stringliteral">"Primitive name"</span>),
<a name="l00679"></a>00679   <a class="code" href="dfsch_2types_8h.html#735afbc447efac1f89062f5acad775a1">DFSCH_OBJECT_SLOT</a>(<a class="code" href="structclosure__t.html">closure_t</a>, orig_code, <a class="code" href="dfsch_2types_8h.html#9f7555adc2161c8907f15bdc8cd280e1">DFSCH_SLOT_ACCESS_DEBUG_WRITE</a>,
<a name="l00680"></a>00680                     <span class="stringliteral">"Original expression of closure"</span>),
<a name="l00681"></a>00681   <a class="code" href="dfsch_2types_8h.html#735afbc447efac1f89062f5acad775a1">DFSCH_OBJECT_SLOT</a>(<a class="code" href="structclosure__t.html">closure_t</a>, documentation, <a class="code" href="dfsch_2types_8h.html#9f7555adc2161c8907f15bdc8cd280e1">DFSCH_SLOT_ACCESS_DEBUG_WRITE</a>,
<a name="l00682"></a>00682                     <span class="stringliteral">"Documentation string"</span>),
<a name="l00683"></a>00683   <a class="code" href="dfsch_2types_8h.html#c6e0c8423bccc472557d5ec45c276261">DFSCH_SLOT_TERMINATOR</a>
<a name="l00684"></a>00684 };
<a name="l00685"></a>00685 
<a name="l00686"></a><a class="code" href="dfsch_8c.html#05d0e4f453968deb6200f5a9d0171335">00686</a> <a class="code" href="structdfsch__type__t.html">dfsch_type_t</a> <a class="code" href="dfsch_2types_8h.html#05d0e4f453968deb6200f5a9d0171335">dfsch_standard_function_type</a> = {
<a name="l00687"></a>00687   DFSCH_STANDARD_TYPE,
<a name="l00688"></a>00688   <a class="code" href="dfsch_2types_8h.html#5549eb83828d7b0306cc53cf745987ce">DFSCH_FUNCTION_TYPE</a>,
<a name="l00689"></a>00689   <span class="keyword">sizeof</span>(<a class="code" href="structclosure__t.html">closure_t</a>),
<a name="l00690"></a>00690   <span class="stringliteral">"function"</span>,
<a name="l00691"></a>00691   NULL,
<a name="l00692"></a>00692   (<a class="code" href="dfsch_2types_8h.html#f9caf55a3116d8b33005ed84c3dce964">dfsch_type_write_t</a>)<a class="code" href="dfsch_8c.html#60e87fee482940fb5e951b6cf339a452">function_write</a>,
<a name="l00693"></a>00693   NULL,
<a name="l00694"></a>00694   NULL,
<a name="l00695"></a>00695   &amp;closure_slots,
<a name="l00696"></a>00696   <span class="stringliteral">"User defined function"</span>
<a name="l00697"></a>00697 };
<a name="l00698"></a><a class="code" href="dfsch_8c.html#ee0cf83ee6d754df700e396da8987f1f">00698</a> <span class="preprocessor">#define FUNCTION DFSCH_STANDARD_FUNCTION_TYPE</span>
<a name="l00699"></a>00699 <span class="preprocessor"></span>
<a name="l00700"></a><a class="code" href="dfsch_8c.html#99daf0459279262f02919459192af871">00700</a> <span class="keyword">static</span> <a class="code" href="structdfsch__slot__t.html">dfsch_slot_t</a> <a class="code" href="dfsch_8c.html#99daf0459279262f02919459192af871">macro_slots</a>[] = {
<a name="l00701"></a>00701   <a class="code" href="dfsch_2types_8h.html#0973d3a45f97fb73e1a06feede5e7495">DFSCH_STRING_SLOT</a>(<a class="code" href="structmacro__t.html">macro_t</a>, proc, <a class="code" href="dfsch_2types_8h.html#b7a8a678fd8a0061d23945e82e8f90c3">DFSCH_SLOT_ACCESS_RO</a>,
<a name="l00702"></a>00702                     <span class="stringliteral">"Procedure implementing macro"</span>),
<a name="l00703"></a>00703 };
<a name="l00704"></a>00704 
<a name="l00705"></a><a class="code" href="dfsch_8c.html#8962288f85bf90b1becf737cb384e999">00705</a> <a class="code" href="structdfsch__type__t.html">dfsch_type_t</a> <a class="code" href="dfsch_2types_8h.html#8962288f85bf90b1becf737cb384e999">dfsch_macro_type</a> = {
<a name="l00706"></a>00706   DFSCH_STANDARD_TYPE,
<a name="l00707"></a>00707   NULL,
<a name="l00708"></a>00708   <span class="keyword">sizeof</span>(<a class="code" href="structmacro__t.html">macro_t</a>),
<a name="l00709"></a>00709   <span class="stringliteral">"macro"</span>,
<a name="l00710"></a>00710   NULL,
<a name="l00711"></a>00711   NULL,
<a name="l00712"></a>00712   NULL,
<a name="l00713"></a>00713   NULL,
<a name="l00714"></a>00714   &amp;macro_slots,
<a name="l00715"></a>00715   <span class="stringliteral">"Macro implemented by arbitrary function"</span>
<a name="l00716"></a>00716 };
<a name="l00717"></a><a class="code" href="dfsch_8c.html#824c99cb152a3c2e9111a2cb9c34891e">00717</a> <span class="preprocessor">#define MACRO DFSCH_MACRO_TYPE</span>
<a name="l00718"></a>00718 <span class="preprocessor"></span>
<a name="l00719"></a><a class="code" href="dfsch_8c.html#aa9c681017cafde5910bd76142670be0">00719</a> <span class="keyword">static</span> <a class="code" href="structdfsch__slot__t.html">dfsch_slot_t</a> <a class="code" href="dfsch_8c.html#aa9c681017cafde5910bd76142670be0">form_slots</a>[] = {
<a name="l00720"></a>00720   <a class="code" href="dfsch_2types_8h.html#0973d3a45f97fb73e1a06feede5e7495">DFSCH_STRING_SLOT</a>(<a class="code" href="structdfsch__form__t.html">dfsch_form_t</a>, name, <a class="code" href="dfsch_2types_8h.html#b7a8a678fd8a0061d23945e82e8f90c3">DFSCH_SLOT_ACCESS_RO</a>,
<a name="l00721"></a>00721                     <span class="stringliteral">"Internal name of special form"</span>),
<a name="l00722"></a>00722   <a class="code" href="dfsch_2types_8h.html#0973d3a45f97fb73e1a06feede5e7495">DFSCH_STRING_SLOT</a>(<a class="code" href="structdfsch__form__t.html">dfsch_form_t</a>, documentation, <a class="code" href="dfsch_2types_8h.html#b7a8a678fd8a0061d23945e82e8f90c3">DFSCH_SLOT_ACCESS_RO</a>,
<a name="l00723"></a>00723                     <span class="stringliteral">"Documentation string"</span>),
<a name="l00724"></a>00724   <a class="code" href="dfsch_2types_8h.html#c6e0c8423bccc472557d5ec45c276261">DFSCH_SLOT_TERMINATOR</a>
<a name="l00725"></a>00725 };
<a name="l00726"></a>00726 
<a name="l00727"></a><a class="code" href="dfsch_8c.html#88036b8d78006f97bfc550154d8a6808">00727</a> <a class="code" href="structdfsch__type__t.html">dfsch_type_t</a> <a class="code" href="dfsch_2types_8h.html#88036b8d78006f97bfc550154d8a6808">dfsch_form_type</a> = {
<a name="l00728"></a>00728   DFSCH_STANDARD_TYPE,
<a name="l00729"></a>00729   NULL,
<a name="l00730"></a>00730   <span class="keyword">sizeof</span>(<a class="code" href="structdfsch__form__t.html">dfsch_form_t</a>),
<a name="l00731"></a>00731   <span class="stringliteral">"form"</span>,
<a name="l00732"></a>00732   NULL,
<a name="l00733"></a>00733   NULL,
<a name="l00734"></a>00734   NULL,
<a name="l00735"></a>00735   NULL,
<a name="l00736"></a>00736   &amp;form_slots,
<a name="l00737"></a>00737   <span class="stringliteral">"C-implemented special form"</span>
<a name="l00738"></a>00738 };
<a name="l00739"></a><a class="code" href="dfsch_8c.html#ff4519d858ed63ac8308bb4f95d7afa4">00739</a> <span class="preprocessor">#define FORM (&amp;dfsch_form_type)</span>
<a name="l00740"></a>00740 <span class="preprocessor"></span>
<a name="l00741"></a><a class="code" href="dfsch_8c.html#a57589c0d15855749248c1492f00c4c9">00741</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="dfsch_8c.html#a57589c0d15855749248c1492f00c4c9">vector_equal_p</a>(<a class="code" href="structvector__t.html">vector_t</a>* a, <a class="code" href="structvector__t.html">vector_t</a>* b){
<a name="l00742"></a>00742   <span class="keywordtype">size_t</span> i;
<a name="l00743"></a>00743   <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structvector__t.html#fc0402ca1ef07006c7a28840ff092e97">length</a> != b-&gt;<a class="code" href="structvector__t.html#fc0402ca1ef07006c7a28840ff092e97">length</a>)
<a name="l00744"></a>00744     <span class="keywordflow">return</span> 0;
<a name="l00745"></a>00745 
<a name="l00746"></a>00746   <span class="keywordflow">for</span> (i=0; i&lt;a-&gt;<a class="code" href="structvector__t.html#fc0402ca1ef07006c7a28840ff092e97">length</a>; i++){
<a name="l00747"></a>00747     <span class="keywordflow">if</span> (!<a class="code" href="dfsch_8h.html#bbe1fbb1fc7739ab514130fd3f6f410f">dfsch_equal_p</a>(a-&gt;<a class="code" href="structvector__t.html#2976e8b5b8c21525a7f1fefafe029927">data</a>[i], b-&gt;<a class="code" href="structvector__t.html#2976e8b5b8c21525a7f1fefafe029927">data</a>[i]))
<a name="l00748"></a>00748       <span class="keywordflow">return</span> 0;
<a name="l00749"></a>00749   }
<a name="l00750"></a>00750 
<a name="l00751"></a>00751   <span class="keywordflow">return</span> 1;
<a name="l00752"></a>00752 }
<a name="l00753"></a>00753 
<a name="l00754"></a><a class="code" href="dfsch_8c.html#7e9d0bca732123f76a5c04772037601e">00754</a> <span class="keyword">static</span> <span class="keywordtype">size_t</span> <a class="code" href="dfsch_8c.html#7e9d0bca732123f76a5c04772037601e">vector_hash</a>(<a class="code" href="structvector__t.html">vector_t</a>* v){
<a name="l00755"></a>00755   <span class="keywordtype">size_t</span> i;
<a name="l00756"></a>00756   <span class="keywordtype">size_t</span> ret = 0;
<a name="l00757"></a>00757 
<a name="l00758"></a>00758   <span class="keywordflow">for</span> (i=0; i&lt;v-&gt;<a class="code" href="structvector__t.html#fc0402ca1ef07006c7a28840ff092e97">length</a>; i++){
<a name="l00759"></a>00759     ret = <a class="code" href="dfsch_8c.html#ce2facbb4f5975786673b3418a040892">hash_combine</a>(ret, <a class="code" href="dfsch_8h.html#35dde354e438308e6f88f8043c9bc8a5">dfsch_hash</a>(v-&gt;<a class="code" href="structvector__t.html#2976e8b5b8c21525a7f1fefafe029927">data</a>[i]));
<a name="l00760"></a>00760   }
<a name="l00761"></a>00761 
<a name="l00762"></a>00762   <span class="keywordflow">return</span> ret;
<a name="l00763"></a>00763 }
<a name="l00764"></a>00764 
<a name="l00765"></a>00765 
<a name="l00766"></a><a class="code" href="dfsch_8c.html#fd824bb6848e9090fc6c5cdae5ca734c">00766</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="dfsch_8c.html#fd824bb6848e9090fc6c5cdae5ca734c">vector_write</a>(<a class="code" href="structvector__t.html">vector_t</a>* v, <a class="code" href="structdfsch__writer__state__t.html">dfsch_writer_state_t</a>* state){
<a name="l00767"></a>00767   <span class="keywordtype">size_t</span> i;
<a name="l00768"></a>00768   <a class="code" href="writer_8h.html#2c8fa380efd4f78037e0a3e36b520cd2">dfsch_write_string</a>(state, <span class="stringliteral">"#("</span>);
<a name="l00769"></a>00769   
<a name="l00770"></a>00770   <span class="keywordflow">if</span> (v-&gt;<a class="code" href="structvector__t.html#fc0402ca1ef07006c7a28840ff092e97">length</a> &gt; 0){
<a name="l00771"></a>00771     <span class="keywordflow">for</span>(i = 0; i &lt; v-&gt;<a class="code" href="structvector__t.html#fc0402ca1ef07006c7a28840ff092e97">length</a>-1; ++i){
<a name="l00772"></a>00772       <a class="code" href="writer_8h.html#3be6837800ae6f88ea035dc892a2ae88">dfsch_write_object</a>(state, v-&gt;<a class="code" href="structvector__t.html#2976e8b5b8c21525a7f1fefafe029927">data</a>[i]);
<a name="l00773"></a>00773       <a class="code" href="writer_8h.html#2c8fa380efd4f78037e0a3e36b520cd2">dfsch_write_string</a>(state, <span class="stringliteral">" "</span>);
<a name="l00774"></a>00774     }
<a name="l00775"></a>00775     <a class="code" href="writer_8h.html#3be6837800ae6f88ea035dc892a2ae88">dfsch_write_object</a>(state, v-&gt;<a class="code" href="structvector__t.html#2976e8b5b8c21525a7f1fefafe029927">data</a>[v-&gt;<a class="code" href="structvector__t.html#fc0402ca1ef07006c7a28840ff092e97">length</a> - 1]);
<a name="l00776"></a>00776   }
<a name="l00777"></a>00777   <a class="code" href="writer_8h.html#2c8fa380efd4f78037e0a3e36b520cd2">dfsch_write_string</a>(state, <span class="stringliteral">")"</span>);
<a name="l00778"></a>00778 }
<a name="l00779"></a>00779 
<a name="l00780"></a><a class="code" href="dfsch_8c.html#6dd920f93d2d43353cac1c6f167ddaea">00780</a> <a class="code" href="structdfsch__type__t.html">dfsch_type_t</a> <a class="code" href="dfsch_2types_8h.html#6dd920f93d2d43353cac1c6f167ddaea">dfsch_vector_type</a> = {
<a name="l00781"></a>00781   DFSCH_STANDARD_TYPE,
<a name="l00782"></a>00782   NULL,
<a name="l00783"></a>00783   <span class="keyword">sizeof</span>(<a class="code" href="structvector__t.html">vector_t</a>),
<a name="l00784"></a>00784   <span class="stringliteral">"vector"</span>,
<a name="l00785"></a>00785   (<a class="code" href="dfsch_2types_8h.html#b6971aeeb1835b06f61c7603ae3911bc">dfsch_type_equal_p_t</a>)<a class="code" href="dfsch_8c.html#a57589c0d15855749248c1492f00c4c9">vector_equal_p</a>,
<a name="l00786"></a>00786   (<a class="code" href="dfsch_2types_8h.html#f9caf55a3116d8b33005ed84c3dce964">dfsch_type_write_t</a>)<a class="code" href="dfsch_8c.html#fd824bb6848e9090fc6c5cdae5ca734c">vector_write</a>,
<a name="l00787"></a>00787   NULL,
<a name="l00788"></a>00788   (<a class="code" href="dfsch_2types_8h.html#c1daca59c9425289f9b3eca8c6bbbbfe">dfsch_type_hash_t</a>)<a class="code" href="dfsch_8c.html#7e9d0bca732123f76a5c04772037601e">vector_hash</a>
<a name="l00789"></a>00789 };
<a name="l00790"></a><a class="code" href="dfsch_8c.html#c6e89954deaa373db52a91ac6db50884">00790</a> <span class="preprocessor">#define VECTOR DFSCH_VECTOR_TYPE</span>
<a name="l00791"></a>00791 <span class="preprocessor"></span>
<a name="l00792"></a><a class="code" href="dfsch_8c.html#1954231b8f10bcb8a7eff4da92bdf050">00792</a> <span class="keyword">static</span> <a class="code" href="structdfsch__slot__t.html">dfsch_slot_t</a> <a class="code" href="dfsch_8c.html#1954231b8f10bcb8a7eff4da92bdf050">environment_slots</a>[] = {
<a name="l00793"></a>00793   <a class="code" href="dfsch_2types_8h.html#735afbc447efac1f89062f5acad775a1">DFSCH_OBJECT_SLOT</a>(<a class="code" href="structenvironment__t.html">environment_t</a>, parent, <a class="code" href="dfsch_2types_8h.html#9f7555adc2161c8907f15bdc8cd280e1">DFSCH_SLOT_ACCESS_DEBUG_WRITE</a>,
<a name="l00794"></a>00794                     <span class="stringliteral">"Enclosing environment or NIL for top-level"</span>),
<a name="l00795"></a>00795   <a class="code" href="dfsch_2types_8h.html#c6e0c8423bccc472557d5ec45c276261">DFSCH_SLOT_TERMINATOR</a>
<a name="l00796"></a>00796 };
<a name="l00797"></a>00797 
<a name="l00798"></a><a class="code" href="dfsch_8c.html#751cc4243816512370729df7fdc90eeb">00798</a> <a class="code" href="structdfsch__type__t.html">dfsch_type_t</a> <a class="code" href="dfsch_2types_8h.html#751cc4243816512370729df7fdc90eeb">dfsch_environment_type</a> = {
<a name="l00799"></a>00799   DFSCH_STANDARD_TYPE,
<a name="l00800"></a>00800   NULL,
<a name="l00801"></a>00801   <span class="keyword">sizeof</span>(<a class="code" href="structenvironment__t.html">environment_t</a>),
<a name="l00802"></a>00802   <span class="stringliteral">"environment"</span>,
<a name="l00803"></a>00803 
<a name="l00804"></a>00804   NULL,
<a name="l00805"></a>00805   NULL,
<a name="l00806"></a>00806   NULL,
<a name="l00807"></a>00807   NULL,
<a name="l00808"></a>00808   
<a name="l00809"></a>00809   &amp;environment_slots,
<a name="l00810"></a>00810   <span class="stringliteral">"Lexical environment frame"</span>
<a name="l00811"></a>00811 };
<a name="l00812"></a>00812 
<a name="l00813"></a>00813 
<a name="l00814"></a><a class="code" href="dfsch_8c.html#f7945f0242cc53a27563f2cd996ac0bc">00814</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="dfsch_8c.html#f7945f0242cc53a27563f2cd996ac0bc">lambda_list_write</a>(<a class="code" href="structlambda__list__t.html">lambda_list_t</a>* ll, <a class="code" href="structdfsch__writer__state__t.html">dfsch_writer_state_t</a>* ws){
<a name="l00815"></a>00815   <a class="code" href="writer_8h.html#8044d9479e02dc84608ea96c08d38d86">dfsch_write_unreadable_start</a>(ws, (<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>*)ll);
<a name="l00816"></a>00816   <a class="code" href="dfsch_8c.html#32225a7da5265315ef6b9d5cb5fd74db">print_lambda_list</a>(ll, ws);
<a name="l00817"></a>00817   <a class="code" href="writer_8h.html#815730c993aae9242baadbf4cc03eeef">dfsch_write_unreadable_end</a>(ws);
<a name="l00818"></a>00818 }
<a name="l00819"></a><a class="code" href="dfsch_8c.html#fa6bba70114cc142a59af9b882145d2c">00819</a> <a class="code" href="structdfsch__type__t.html">dfsch_type_t</a> <a class="code" href="dfsch_2types_8h.html#fa6bba70114cc142a59af9b882145d2c">dfsch_lambda_list_type</a> = {
<a name="l00820"></a>00820   DFSCH_STANDARD_TYPE,
<a name="l00821"></a>00821   NULL,
<a name="l00822"></a>00822   <span class="keyword">sizeof</span>(<a class="code" href="structlambda__list__t.html">lambda_list_t</a>),
<a name="l00823"></a>00823   <span class="stringliteral">"lambda-list"</span>,
<a name="l00824"></a>00824   NULL,
<a name="l00825"></a>00825   (<a class="code" href="dfsch_2types_8h.html#f9caf55a3116d8b33005ed84c3dce964">dfsch_type_write_t</a>)<a class="code" href="dfsch_8c.html#f7945f0242cc53a27563f2cd996ac0bc">lambda_list_write</a>,
<a name="l00826"></a>00826   NULL,
<a name="l00827"></a>00827   NULL,
<a name="l00828"></a>00828   NULL,
<a name="l00829"></a>00829   <span class="stringliteral">"Compiled lambda-list for effective destructuring"</span>
<a name="l00830"></a>00830 };
<a name="l00831"></a>00831 
<a name="l00832"></a>00832 
<a name="l00833"></a>00833 
<a name="l00834"></a><a class="code" href="dfsch_8c.html#9e911eebf580f60f7223286aa5994812">00834</a> <span class="keywordtype">int</span> <a class="code" href="dfsch_8h.html#9e911eebf580f60f7223286aa5994812">dfsch_null_p</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* obj){
<a name="l00835"></a>00835   <span class="keywordflow">return</span> !obj;
<a name="l00836"></a>00836 }
<a name="l00837"></a><a class="code" href="dfsch_8c.html#0515779c8c66eadcdd9fa52d1efd957e">00837</a> <span class="keywordtype">int</span> <a class="code" href="dfsch_8h.html#0515779c8c66eadcdd9fa52d1efd957e">dfsch_pair_p</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* obj){
<a name="l00838"></a>00838   <span class="keywordflow">return</span> <a class="code" href="dfsch_2types_8h.html#6ec0a17695d07350d56eaffe994e29f4">DFSCH_PAIR_P</a>(obj);
<a name="l00839"></a>00839 }
<a name="l00840"></a><a class="code" href="dfsch_8c.html#9c4f272e7639e5c553fe6a2ffab57717">00840</a> <span class="keywordtype">int</span> <a class="code" href="dfsch_8h.html#9c4f272e7639e5c553fe6a2ffab57717">dfsch_list_p</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* obj){
<a name="l00841"></a>00841   <span class="keywordflow">return</span> <a class="code" href="dfsch_2types_8h.html#431cd198807ab14cc691b9e1f8600422">DFSCH_INSTANCE_P</a>(obj, <a class="code" href="dfsch_2types_8h.html#f68c7145dd8463d15d30fa4a1ffc532e">DFSCH_LIST_TYPE</a>);
<a name="l00842"></a>00842 }
<a name="l00843"></a><a class="code" href="dfsch_8c.html#18fb31c528ea5e699b6c1786b7a2c152">00843</a> <span class="keywordtype">int</span> <a class="code" href="dfsch_8h.html#18fb31c528ea5e699b6c1786b7a2c152">dfsch_atom_p</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* obj){
<a name="l00844"></a>00844   <span class="keywordflow">return</span> !<a class="code" href="dfsch_2types_8h.html#6ec0a17695d07350d56eaffe994e29f4">DFSCH_PAIR_P</a>(obj);
<a name="l00845"></a>00845 }
<a name="l00846"></a><a class="code" href="dfsch_8c.html#437a3d2884fc7ca53bdcce5688af4457">00846</a> <span class="keywordtype">int</span> <a class="code" href="dfsch_8h.html#437a3d2884fc7ca53bdcce5688af4457">dfsch_symbol_p</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* obj){
<a name="l00847"></a>00847   <span class="keywordflow">return</span> <a class="code" href="dfsch_2types_8h.html#5f142f7ca5170520a5c736a4a7d3a2b7">DFSCH_TYPE_OF</a>(obj) == <a class="code" href="dfsch_8c.html#5f9ae9ce6aa6f82108b260135b2e63a0">SYMBOL</a>;
<a name="l00848"></a>00848 }
<a name="l00849"></a><a class="code" href="dfsch_8c.html#3fa75767f04549b4b33573a1de10737f">00849</a> <span class="keywordtype">int</span> <a class="code" href="dfsch_8h.html#3fa75767f04549b4b33573a1de10737f">dfsch_primitive_p</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* obj){
<a name="l00850"></a>00850   <span class="keywordflow">return</span> <a class="code" href="dfsch_2types_8h.html#5f142f7ca5170520a5c736a4a7d3a2b7">DFSCH_TYPE_OF</a>(obj) == <a class="code" href="dfsch_8c.html#a0f458f5ca6cb8ca94e5f076f5b88be9">PRIMITIVE</a>;
<a name="l00851"></a>00851 
<a name="l00852"></a>00852 }
<a name="l00853"></a><a class="code" href="dfsch_8c.html#5f3eca6af85c97c3cbd533b541023b92">00853</a> <span class="keywordtype">int</span> <a class="code" href="dfsch_8c.html#5f3eca6af85c97c3cbd533b541023b92">dfsch_function_p</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* obj){
<a name="l00854"></a>00854   <span class="keywordflow">return</span> <a class="code" href="dfsch_2types_8h.html#5f142f7ca5170520a5c736a4a7d3a2b7">DFSCH_TYPE_OF</a>(obj) == <a class="code" href="dfsch_8c.html#ee0cf83ee6d754df700e396da8987f1f">FUNCTION</a>;
<a name="l00855"></a>00855 }
<a name="l00856"></a><a class="code" href="dfsch_8c.html#97fa4b8afddfd380b662544f14d4fef1">00856</a> <span class="keywordtype">int</span> <a class="code" href="dfsch_8h.html#97fa4b8afddfd380b662544f14d4fef1">dfsch_procedure_p</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* obj){
<a name="l00857"></a>00857   <span class="keywordflow">return</span> (<a class="code" href="dfsch_2types_8h.html#5f142f7ca5170520a5c736a4a7d3a2b7">DFSCH_TYPE_OF</a>(obj) == <a class="code" href="dfsch_8c.html#a0f458f5ca6cb8ca94e5f076f5b88be9">PRIMITIVE</a> || <a class="code" href="dfsch_2types_8h.html#5f142f7ca5170520a5c736a4a7d3a2b7">DFSCH_TYPE_OF</a>(obj) == <a class="code" href="dfsch_8c.html#ee0cf83ee6d754df700e396da8987f1f">FUNCTION</a>) || 
<a name="l00858"></a>00858     (<a class="code" href="dfsch_2types_8h.html#5f142f7ca5170520a5c736a4a7d3a2b7">DFSCH_TYPE_OF</a>(obj)-&gt;apply);
<a name="l00859"></a>00859 }
<a name="l00860"></a><a class="code" href="dfsch_8c.html#4f8c81570e84b6967b0bbff0d028293e">00860</a> <span class="keywordtype">int</span> <a class="code" href="dfsch_8h.html#4f8c81570e84b6967b0bbff0d028293e">dfsch_macro_p</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* obj){
<a name="l00861"></a>00861   <span class="keywordflow">return</span> <a class="code" href="dfsch_2types_8h.html#5f142f7ca5170520a5c736a4a7d3a2b7">DFSCH_TYPE_OF</a>(obj) == <a class="code" href="dfsch_8c.html#824c99cb152a3c2e9111a2cb9c34891e">MACRO</a>;
<a name="l00862"></a>00862 }
<a name="l00863"></a><a class="code" href="dfsch_8c.html#7557fd871ecd3a7d5a03b035a8faf2ec">00863</a> <span class="keywordtype">int</span> <a class="code" href="dfsch_8h.html#7557fd871ecd3a7d5a03b035a8faf2ec">dfsch_form_p</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* obj){
<a name="l00864"></a>00864   <span class="keywordflow">return</span> <a class="code" href="dfsch_2types_8h.html#5f142f7ca5170520a5c736a4a7d3a2b7">DFSCH_TYPE_OF</a>(obj) == <a class="code" href="dfsch_8c.html#ff4519d858ed63ac8308bb4f95d7afa4">FORM</a>;
<a name="l00865"></a>00865 }
<a name="l00866"></a>00866 
<a name="l00867"></a><a class="code" href="dfsch_8c.html#4f811b06e8c3e6350421c3f5b2e3e7a8">00867</a> <span class="keywordtype">int</span> <a class="code" href="dfsch_8h.html#4f811b06e8c3e6350421c3f5b2e3e7a8">dfsch_vector_p</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* obj){
<a name="l00868"></a>00868   <span class="keywordflow">return</span> <a class="code" href="dfsch_2types_8h.html#5f142f7ca5170520a5c736a4a7d3a2b7">DFSCH_TYPE_OF</a>(obj) == <a class="code" href="dfsch_8c.html#c6e89954deaa373db52a91ac6db50884">VECTOR</a>;
<a name="l00869"></a>00869 }
<a name="l00870"></a>00870 
<a name="l00871"></a>00871 
<a name="l00872"></a><a class="code" href="dfsch_8c.html#86fdfcd40d200f65f8f86b53ff7dbc85">00872</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8h.html#86fdfcd40d200f65f8f86b53ff7dbc85">dfsch_nil</a>(){
<a name="l00873"></a>00873   <span class="keywordflow">return</span> NULL;
<a name="l00874"></a>00874 }
<a name="l00875"></a>00875 
<a name="l00876"></a>00876 <span class="comment">// Pairs</span>
<a name="l00877"></a>00877 
<a name="l00878"></a><a class="code" href="dfsch_8c.html#ff85cf17ead5b89f43244a3010bc155c">00878</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8h.html#ff85cf17ead5b89f43244a3010bc155c">dfsch_cons</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* car, <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* cdr){
<a name="l00879"></a>00879   <a class="code" href="structdfsch__pair__t.html">dfsch_pair_t</a>* p = GC_NEW(<a class="code" href="structdfsch__pair__t.html">dfsch_pair_t</a>);
<a name="l00880"></a>00880 
<a name="l00881"></a>00881   p-&gt;<a class="code" href="structdfsch__pair__t.html#f7b9d90cf4e3efeb820f6f24355f4657">car</a> = car;
<a name="l00882"></a>00882   p-&gt;<a class="code" href="structdfsch__pair__t.html#781744a48052e698995e220560d22a19">cdr</a> = cdr;
<a name="l00883"></a>00883 
<a name="l00884"></a>00884   <span class="keywordflow">return</span> <a class="code" href="dfsch_2types_8h.html#61b5b7a97cb4ab963f84ed3d8ac94a51">DFSCH_TAG_ENCODE</a>(p, 1);
<a name="l00885"></a>00885 }
<a name="l00886"></a>00886 
<a name="l00887"></a><a class="code" href="dfsch_8c.html#e5734a250a429a47731c7cc4ff9b5e12">00887</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8h.html#e5734a250a429a47731c7cc4ff9b5e12">dfsch_cons_immutable</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* car, <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* cdr){
<a name="l00888"></a>00888   <a class="code" href="structdfsch__pair__t.html">dfsch_pair_t</a>* p = GC_NEW(<a class="code" href="structdfsch__pair__t.html">dfsch_pair_t</a>);
<a name="l00889"></a>00889 
<a name="l00890"></a>00890   p-&gt;<a class="code" href="structdfsch__pair__t.html#f7b9d90cf4e3efeb820f6f24355f4657">car</a> = car;
<a name="l00891"></a>00891   p-&gt;<a class="code" href="structdfsch__pair__t.html#781744a48052e698995e220560d22a19">cdr</a> = cdr;
<a name="l00892"></a>00892 
<a name="l00893"></a>00893   <span class="keywordflow">return</span> <a class="code" href="dfsch_2types_8h.html#61b5b7a97cb4ab963f84ed3d8ac94a51">DFSCH_TAG_ENCODE</a>(p, 3);
<a name="l00894"></a>00894 }
<a name="l00895"></a>00895 
<a name="l00896"></a><a class="code" href="dfsch_8c.html#c8138a49f893766dd443e7a7b7552e28">00896</a> <span class="keyword">static</span> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8c.html#c8138a49f893766dd443e7a7b7552e28">tl_cons</a>(<a class="code" href="structdfsch____thread__info__t.html">dfsch__thread_info_t</a>* ti,
<a name="l00897"></a>00897                                <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* car, <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* cdr){
<a name="l00898"></a>00898   <a class="code" href="structdfsch__pair__t.html">dfsch_pair_t</a>* p;
<a name="l00899"></a>00899   
<a name="l00900"></a>00900 <span class="preprocessor">#ifdef GC_NEXT</span>
<a name="l00901"></a>00901 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (!ti-&gt;<a class="code" href="structdfsch____thread__info__t.html#2b25d4719e99fd01413481d635667e7a">pair_freelist</a>){
<a name="l00902"></a>00902     ti-&gt;<a class="code" href="structdfsch____thread__info__t.html#2b25d4719e99fd01413481d635667e7a">pair_freelist</a> = GC_malloc_many(<span class="keyword">sizeof</span>(<a class="code" href="structdfsch__pair__t.html">dfsch_pair_t</a>));
<a name="l00903"></a>00903   }
<a name="l00904"></a>00904   
<a name="l00905"></a>00905   p = ti-&gt;<a class="code" href="structdfsch____thread__info__t.html#2b25d4719e99fd01413481d635667e7a">pair_freelist</a>;
<a name="l00906"></a>00906   ti-&gt;<a class="code" href="structdfsch____thread__info__t.html#2b25d4719e99fd01413481d635667e7a">pair_freelist</a> = GC_NEXT(ti-&gt;<a class="code" href="structdfsch____thread__info__t.html#2b25d4719e99fd01413481d635667e7a">pair_freelist</a>);
<a name="l00907"></a>00907 <span class="preprocessor">#else</span>
<a name="l00908"></a>00908 <span class="preprocessor"></span>  p = GC_NEW(<a class="code" href="structdfsch__pair__t.html">dfsch_pair_t</a>);
<a name="l00909"></a>00909 <span class="preprocessor">#endif</span>
<a name="l00910"></a>00910 <span class="preprocessor"></span>
<a name="l00911"></a>00911   p-&gt;<a class="code" href="structdfsch__pair__t.html#f7b9d90cf4e3efeb820f6f24355f4657">car</a> = car;
<a name="l00912"></a>00912   p-&gt;<a class="code" href="structdfsch__pair__t.html#781744a48052e698995e220560d22a19">cdr</a> = cdr;
<a name="l00913"></a>00913 
<a name="l00914"></a>00914   <span class="keywordflow">return</span> <a class="code" href="dfsch_2types_8h.html#61b5b7a97cb4ab963f84ed3d8ac94a51">DFSCH_TAG_ENCODE</a>(p, 1);
<a name="l00915"></a>00915 }
<a name="l00916"></a>00916 
<a name="l00917"></a>00917 
<a name="l00918"></a>00918 
<a name="l00919"></a><a class="code" href="dfsch_8c.html#3cc33fb709ad0f829315288fda0a49a1">00919</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8c.html#3cc33fb709ad0f829315288fda0a49a1">dfsch_multicons</a>(<span class="keywordtype">size_t</span> n){
<a name="l00920"></a>00920   <span class="keywordtype">size_t</span> i;
<a name="l00921"></a>00921   <a class="code" href="structdfsch__pair__t.html">dfsch_pair_t</a>* p;
<a name="l00922"></a>00922 
<a name="l00923"></a>00923   <span class="keywordflow">if</span> (n == 0){
<a name="l00924"></a>00924     <span class="keywordflow">return</span> NULL;
<a name="l00925"></a>00925   }
<a name="l00926"></a>00926 
<a name="l00927"></a>00927   p = GC_MALLOC(<span class="keyword">sizeof</span>(<a class="code" href="structdfsch__pair__t.html">dfsch_pair_t</a>)*n);
<a name="l00928"></a>00928 
<a name="l00929"></a>00929   <span class="keywordflow">for</span> (i = 0; i &lt; (n-1); i++){
<a name="l00930"></a>00930     p[i].<a class="code" href="structdfsch__pair__t.html#781744a48052e698995e220560d22a19">cdr</a> = <a class="code" href="dfsch_2types_8h.html#61b5b7a97cb4ab963f84ed3d8ac94a51">DFSCH_TAG_ENCODE</a>(&amp;(p[i+1]), 1);
<a name="l00931"></a>00931   }
<a name="l00932"></a>00932 
<a name="l00933"></a>00933   <span class="keywordflow">return</span> <a class="code" href="dfsch_2types_8h.html#61b5b7a97cb4ab963f84ed3d8ac94a51">DFSCH_TAG_ENCODE</a>(&amp;(p[0]), 1);
<a name="l00934"></a>00934 }
<a name="l00935"></a>00935 
<a name="l00936"></a><a class="code" href="dfsch_8c.html#fa8b1de0edaa892e808ab624b35101b2">00936</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8h.html#fa8b1de0edaa892e808ab624b35101b2">dfsch_car</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* pair){
<a name="l00937"></a>00937   <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* p = <a class="code" href="dfsch_2types_8h.html#a43cac742ec15d6238e141297e119e17">DFSCH_ASSERT_PAIR</a>(pair);
<a name="l00938"></a>00938   <span class="keywordflow">return</span> <a class="code" href="dfsch_2types_8h.html#873da07e10c696bf321a42629cdb863e">DFSCH_FAST_CAR</a>(p);
<a name="l00939"></a>00939 }
<a name="l00940"></a><a class="code" href="dfsch_8c.html#41cae0a7d870e4727489a6af6fee335a">00940</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8h.html#41cae0a7d870e4727489a6af6fee335a">dfsch_cdr</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* pair){
<a name="l00941"></a>00941   <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* p = <a class="code" href="dfsch_2types_8h.html#a43cac742ec15d6238e141297e119e17">DFSCH_ASSERT_PAIR</a>(pair);
<a name="l00942"></a>00942   <span class="keywordflow">return</span> <a class="code" href="dfsch_2types_8h.html#9621e19e10bbf916d031fc55631f48df">DFSCH_FAST_CDR</a>(p);
<a name="l00943"></a>00943 }
<a name="l00944"></a>00944 
<a name="l00945"></a><a class="code" href="dfsch_8c.html#5a402719317475f60eaf502381b966c2">00945</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8h.html#ec7306fbb3e033de3a165f39abf05128">dfsch_set_car</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* pair,
<a name="l00946"></a>00946                               <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* car){
<a name="l00947"></a>00947   <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* p = <a class="code" href="dfsch_2types_8h.html#f9b3a4b9a5fe6a12721504cd292a3327">DFSCH_ASSERT_TYPE</a>(pair, <a class="code" href="dfsch_2types_8h.html#eb83bb2d546d88e25d9298fbbee1a293">DFSCH_MUTABLE_PAIR_TYPE</a>);
<a name="l00948"></a>00948 
<a name="l00949"></a>00949   <a class="code" href="dfsch_2types_8h.html#873da07e10c696bf321a42629cdb863e">DFSCH_FAST_CAR</a>(p) = car;
<a name="l00950"></a>00950   
<a name="l00951"></a>00951   <span class="keywordflow">return</span> p;
<a name="l00952"></a>00952 }
<a name="l00953"></a><a class="code" href="dfsch_8c.html#416a6151a5d3d144c68b883b40cf1812">00953</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8h.html#df97a679c630d7217bbcd989a65b3b55">dfsch_set_cdr</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* pair,
<a name="l00954"></a>00954                               <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* cdr){
<a name="l00955"></a>00955   <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* p = <a class="code" href="dfsch_2types_8h.html#f9b3a4b9a5fe6a12721504cd292a3327">DFSCH_ASSERT_TYPE</a>(pair, <a class="code" href="dfsch_2types_8h.html#eb83bb2d546d88e25d9298fbbee1a293">DFSCH_MUTABLE_PAIR_TYPE</a>);
<a name="l00956"></a>00956 
<a name="l00957"></a>00957   <a class="code" href="dfsch_2types_8h.html#bb4a2056ae9d34d125eba3ac229f8ada">DFSCH_FAST_CDR_MUT</a>(p) = cdr;
<a name="l00958"></a>00958   
<a name="l00959"></a>00959   <span class="keywordflow">return</span> p;
<a name="l00960"></a>00960 }
<a name="l00961"></a><a class="code" href="dfsch_8c.html#500bdd4f0f3107b974f2ae8f8569268b">00961</a> <span class="keywordtype">long</span> <a class="code" href="dfsch_8h.html#26c642487bb2b16a3ec386eac30b4575">dfsch_list_length_fast</a>(<a class="code" href="structdfsch__object__t.html">object_t</a>* list){
<a name="l00962"></a>00962   <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a> *i;
<a name="l00963"></a>00963   <span class="keywordtype">long</span> count;
<a name="l00964"></a>00964 
<a name="l00965"></a>00965   <span class="keywordflow">if</span> (!list)
<a name="l00966"></a>00966     <span class="keywordflow">return</span> 0;
<a name="l00967"></a>00967 
<a name="l00968"></a>00968   <span class="keywordflow">if</span> (!<a class="code" href="dfsch_2types_8h.html#6ec0a17695d07350d56eaffe994e29f4">DFSCH_PAIR_P</a>(list))
<a name="l00969"></a>00969     <span class="keywordflow">return</span> -1;
<a name="l00970"></a>00970 
<a name="l00971"></a>00971   i = list;
<a name="l00972"></a>00972   count = 0;
<a name="l00973"></a>00973 
<a name="l00974"></a>00974   <span class="keywordflow">while</span> (<a class="code" href="dfsch_2types_8h.html#6ec0a17695d07350d56eaffe994e29f4">DFSCH_PAIR_P</a>(i)){
<a name="l00975"></a>00975     i = <a class="code" href="dfsch_2types_8h.html#9621e19e10bbf916d031fc55631f48df">DFSCH_FAST_CDR</a>(i);
<a name="l00976"></a>00976     ++count;
<a name="l00977"></a>00977   }
<a name="l00978"></a>00978 
<a name="l00979"></a>00979   <span class="keywordflow">return</span> count;
<a name="l00980"></a>00980 }
<a name="l00981"></a><a class="code" href="dfsch_8c.html#ca518ac066d0b0b243f9a3a5c65cc97f">00981</a> <span class="keywordtype">long</span> <a class="code" href="dfsch_8h.html#9be2641c051ee5a0148811826056eea7">dfsch_list_length</a>(<a class="code" href="structdfsch__object__t.html">object_t</a>* list, <span class="keywordtype">int</span> *proper){
<a name="l00982"></a>00982   <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a> *i;
<a name="l00983"></a>00983   <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a> *j; 
<a name="l00984"></a>00984   <span class="keywordtype">long</span> count;
<a name="l00985"></a>00985 
<a name="l00986"></a>00986   <span class="keywordflow">if</span> (!list)
<a name="l00987"></a>00987     <span class="keywordflow">return</span> 0;
<a name="l00988"></a>00988 
<a name="l00989"></a>00989   <span class="keywordflow">if</span> (!<a class="code" href="dfsch_2types_8h.html#6ec0a17695d07350d56eaffe994e29f4">DFSCH_PAIR_P</a>(list))
<a name="l00990"></a>00990     <span class="keywordflow">return</span> -1;
<a name="l00991"></a>00991 
<a name="l00992"></a>00992   i = j = list;
<a name="l00993"></a>00993   count = 0;
<a name="l00994"></a>00994 
<a name="l00995"></a>00995   <span class="keywordflow">while</span> (<a class="code" href="dfsch_2types_8h.html#6ec0a17695d07350d56eaffe994e29f4">DFSCH_PAIR_P</a>(i)){
<a name="l00996"></a>00996     i = <a class="code" href="dfsch_2types_8h.html#9621e19e10bbf916d031fc55631f48df">DFSCH_FAST_CDR</a>(i);
<a name="l00997"></a>00997     ++count;
<a name="l00998"></a>00998     <span class="keywordflow">if</span> (i == j) {
<a name="l00999"></a>00999       <span class="keywordflow">return</span> -1;
<a name="l01000"></a>01000     }
<a name="l01001"></a>01001     j = <a class="code" href="dfsch_2types_8h.html#9621e19e10bbf916d031fc55631f48df">DFSCH_FAST_CDR</a>(j);
<a name="l01002"></a>01002     <span class="keywordflow">if</span> (!<a class="code" href="dfsch_2types_8h.html#6ec0a17695d07350d56eaffe994e29f4">DFSCH_PAIR_P</a>(i)){
<a name="l01003"></a>01003       <span class="keywordflow">break</span>;
<a name="l01004"></a>01004     }
<a name="l01005"></a>01005     i = <a class="code" href="dfsch_2types_8h.html#9621e19e10bbf916d031fc55631f48df">DFSCH_FAST_CDR</a>(i);
<a name="l01006"></a>01006     ++count;
<a name="l01007"></a>01007     <span class="keywordflow">if</span> (i == j) {
<a name="l01008"></a>01008       <span class="keywordflow">return</span> -1;
<a name="l01009"></a>01009     }
<a name="l01010"></a>01010   }
<a name="l01011"></a>01011 
<a name="l01012"></a>01012   <span class="keywordflow">if</span> (proper){
<a name="l01013"></a>01013     *proper = (i == NULL);
<a name="l01014"></a>01014   } <span class="keywordflow">else</span> { 
<a name="l01015"></a>01015     <span class="keywordflow">if</span> (i) {
<a name="l01016"></a>01016       <span class="keywordflow">return</span> -1;
<a name="l01017"></a>01017     }
<a name="l01018"></a>01018   } 
<a name="l01019"></a>01019 
<a name="l01020"></a>01020   <span class="keywordflow">return</span> count;
<a name="l01021"></a>01021 }
<a name="l01022"></a>01022 
<a name="l01023"></a><a class="code" href="dfsch_8c.html#91da3a10c7511a11775a78a2b97a5b4e">01023</a> <span class="keywordtype">int</span> <a class="code" href="dfsch_8h.html#dfbcdb6d51408adfec6854d79f37fac9">dfsch_list_mutable_p</a>(<a class="code" href="structdfsch__object__t.html">object_t</a>* list){
<a name="l01024"></a>01024   <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a> *i;
<a name="l01025"></a>01025   <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a> *j; 
<a name="l01026"></a>01026   <span class="keywordtype">long</span> count;
<a name="l01027"></a>01027 
<a name="l01028"></a>01028   <span class="keywordflow">if</span> (!list)
<a name="l01029"></a>01029     <span class="keywordflow">return</span> 1;
<a name="l01030"></a>01030 
<a name="l01031"></a>01031   <span class="keywordflow">if</span> (<a class="code" href="dfsch_2types_8h.html#5f142f7ca5170520a5c736a4a7d3a2b7">DFSCH_TYPE_OF</a>(list) != <a class="code" href="dfsch_2types_8h.html#eb83bb2d546d88e25d9298fbbee1a293">DFSCH_MUTABLE_PAIR_TYPE</a>){
<a name="l01032"></a>01032     <span class="keywordflow">return</span> 0;
<a name="l01033"></a>01033   }
<a name="l01034"></a>01034 
<a name="l01035"></a>01035   i = j = list;
<a name="l01036"></a>01036   count = 0;
<a name="l01037"></a>01037 
<a name="l01038"></a>01038   <span class="keywordflow">while</span> (<a class="code" href="dfsch_2types_8h.html#5f142f7ca5170520a5c736a4a7d3a2b7">DFSCH_TYPE_OF</a>(i) == <a class="code" href="dfsch_2types_8h.html#eb83bb2d546d88e25d9298fbbee1a293">DFSCH_MUTABLE_PAIR_TYPE</a>){
<a name="l01039"></a>01039     i = <a class="code" href="dfsch_2types_8h.html#9621e19e10bbf916d031fc55631f48df">DFSCH_FAST_CDR</a>(i);
<a name="l01040"></a>01040     ++count;
<a name="l01041"></a>01041     <span class="keywordflow">if</span> (i == j) {
<a name="l01042"></a>01042       <span class="keywordflow">return</span> 0;
<a name="l01043"></a>01043     }
<a name="l01044"></a>01044     j = <a class="code" href="dfsch_2types_8h.html#9621e19e10bbf916d031fc55631f48df">DFSCH_FAST_CDR</a>(j);
<a name="l01045"></a>01045     <span class="keywordflow">if</span> (<a class="code" href="dfsch_2types_8h.html#5f142f7ca5170520a5c736a4a7d3a2b7">DFSCH_TYPE_OF</a>(i) != <a class="code" href="dfsch_2types_8h.html#eb83bb2d546d88e25d9298fbbee1a293">DFSCH_MUTABLE_PAIR_TYPE</a>){
<a name="l01046"></a>01046       <span class="keywordflow">break</span>;
<a name="l01047"></a>01047     }
<a name="l01048"></a>01048     i = <a class="code" href="dfsch_2types_8h.html#9621e19e10bbf916d031fc55631f48df">DFSCH_FAST_CDR</a>(i);
<a name="l01049"></a>01049     ++count;
<a name="l01050"></a>01050     <span class="keywordflow">if</span> (i == j) {
<a name="l01051"></a>01051       <span class="keywordflow">return</span> 0;
<a name="l01052"></a>01052     }
<a name="l01053"></a>01053   }
<a name="l01054"></a>01054 
<a name="l01055"></a>01055   <span class="keywordflow">if</span> (i)
<a name="l01056"></a>01056     <span class="keywordflow">return</span> 0;
<a name="l01057"></a>01057 
<a name="l01058"></a>01058   <span class="keywordflow">return</span> 1;
<a name="l01059"></a>01059 }
<a name="l01060"></a>01060 
<a name="l01061"></a><a class="code" href="dfsch_8c.html#523e9cf113a409a9a309cfd18efbdd6e">01061</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8h.html#523e9cf113a409a9a309cfd18efbdd6e">dfsch_ensure_mutable_list</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* list){
<a name="l01062"></a>01062   <span class="keywordflow">if</span> (<a class="code" href="dfsch_8h.html#dfbcdb6d51408adfec6854d79f37fac9">dfsch_list_mutable_p</a>(list)){
<a name="l01063"></a>01063     <span class="keywordflow">return</span> list;
<a name="l01064"></a>01064   }
<a name="l01065"></a>01065   <a class="code" href="dfsch_8h.html#68223e669b153b8bdcc08704955d2ce9">dfsch_list_length_check</a>(list);
<a name="l01066"></a>01066   <span class="keywordflow">return</span> <a class="code" href="dfsch_8h.html#881c65ea795fdbd4d687f1f0bde3bf11">dfsch_list_copy</a>(list);
<a name="l01067"></a>01067 }
<a name="l01068"></a>01068 
<a name="l01069"></a><a class="code" href="dfsch_8c.html#8dafdd4f508978265fc5298ef6d9b46d">01069</a> <span class="keywordtype">long</span> <a class="code" href="dfsch_8h.html#68223e669b153b8bdcc08704955d2ce9">dfsch_list_length_check</a>(<a class="code" href="structdfsch__object__t.html">object_t</a>* list){
<a name="l01070"></a>01070   <span class="keywordtype">long</span> len;
<a name="l01071"></a>01071   len = <a class="code" href="dfsch_8h.html#9be2641c051ee5a0148811826056eea7">dfsch_list_length</a>(list, NULL);
<a name="l01072"></a>01072   <span class="keywordflow">if</span> (len &lt; 0)
<a name="l01073"></a>01073     <a class="code" href="conditions_8h.html#753bcd9b14333b81e0b2dafd35cd2074">dfsch_type_error</a>(list, <a class="code" href="dfsch_2types_8h.html#f68c7145dd8463d15d30fa4a1ffc532e">DFSCH_LIST_TYPE</a>, 1);
<a name="l01074"></a>01074   <span class="keywordflow">return</span> len;
<a name="l01075"></a>01075 }
<a name="l01076"></a>01076 
<a name="l01077"></a><a class="code" href="dfsch_8c.html#1a7f8297d0e5df3e446d8533354d61ad">01077</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8h.html#1a7f8297d0e5df3e446d8533354d61ad">dfsch_list_item</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* list, <span class="keywordtype">int</span> index){
<a name="l01078"></a>01078   <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* it = list;
<a name="l01079"></a>01079   <span class="keywordtype">int</span> i;
<a name="l01080"></a>01080   <span class="keywordflow">for</span> (i=0; i&lt;index; ++i){
<a name="l01081"></a>01081     <span class="keywordflow">if</span> (<a class="code" href="dfsch_2types_8h.html#6ec0a17695d07350d56eaffe994e29f4">DFSCH_PAIR_P</a>(it)){
<a name="l01082"></a>01082       it = <a class="code" href="dfsch_2types_8h.html#9621e19e10bbf916d031fc55631f48df">DFSCH_FAST_CDR</a>(it);
<a name="l01083"></a>01083     }<span class="keywordflow">else</span>{
<a name="l01084"></a>01084       <a class="code" href="dfsch_8h.html#646ee34c82a726fdc33d8a28af39270a">dfsch_error</a>(<span class="stringliteral">"No such item of list"</span>, <a class="code" href="number_8h.html#f04b0714b3163f77e7981e5506426a43">dfsch_make_number_from_long</a>(index));
<a name="l01085"></a>01085     }
<a name="l01086"></a>01086   }
<a name="l01087"></a>01087   <span class="keywordflow">return</span> <a class="code" href="dfsch_8h.html#fa8b1de0edaa892e808ab624b35101b2">dfsch_car</a>(it);
<a name="l01088"></a>01088 }
<a name="l01089"></a>01089 
<a name="l01090"></a><a class="code" href="dfsch_8c.html#3c1f03e54874c274ac91d3537e964217">01090</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8h.html#3c1f03e54874c274ac91d3537e964217">dfsch_list_from_array</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>** array, <span class="keywordtype">size_t</span> length){
<a name="l01091"></a>01091   <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a> *head; 
<a name="l01092"></a>01092   <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a> *cur;
<a name="l01093"></a>01093   <span class="keywordtype">size_t</span> i;
<a name="l01094"></a>01094 
<a name="l01095"></a>01095   <span class="keywordflow">if</span> (length == 0)
<a name="l01096"></a>01096     <span class="keywordflow">return</span> NULL;
<a name="l01097"></a>01097 
<a name="l01098"></a>01098   head = cur = <a class="code" href="dfsch_8c.html#3cc33fb709ad0f829315288fda0a49a1">dfsch_multicons</a>(length);
<a name="l01099"></a>01099 
<a name="l01100"></a>01100   <span class="keywordflow">for</span>(i = 0; i &lt; length; ++i){
<a name="l01101"></a>01101     <a class="code" href="dfsch_2types_8h.html#873da07e10c696bf321a42629cdb863e">DFSCH_FAST_CAR</a>(cur) = array[i];
<a name="l01102"></a>01102     cur = <a class="code" href="dfsch_2types_8h.html#9621e19e10bbf916d031fc55631f48df">DFSCH_FAST_CDR</a>(cur);
<a name="l01103"></a>01103   }
<a name="l01104"></a>01104 
<a name="l01105"></a>01105   <span class="keywordflow">return</span> (<a class="code" href="structdfsch__object__t.html">object_t</a>*)head;
<a name="l01106"></a>01106 }
<a name="l01107"></a><a class="code" href="dfsch_8c.html#8c423fcccf437f32cba17f0e9747831a">01107</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>** <a class="code" href="dfsch_8h.html#8c423fcccf437f32cba17f0e9747831a">dfsch_list_as_array</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* list, <span class="keywordtype">size_t</span>* length){
<a name="l01108"></a>01108   <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* j = list;
<a name="l01109"></a>01109   <span class="keywordtype">size_t</span> i=0;
<a name="l01110"></a>01110   <span class="keywordtype">size_t</span> len;
<a name="l01111"></a>01111   <a class="code" href="structdfsch__object__t.html">object_t</a>** data;
<a name="l01112"></a>01112 
<a name="l01113"></a>01113   len = <a class="code" href="dfsch_8h.html#68223e669b153b8bdcc08704955d2ce9">dfsch_list_length_check</a>(list);
<a name="l01114"></a>01114   data = GC_MALLOC(<span class="keyword">sizeof</span>(<a class="code" href="structdfsch__object__t.html">object_t</a>*)*len);
<a name="l01115"></a>01115   
<a name="l01116"></a>01116   <span class="keywordflow">while</span> (<a class="code" href="dfsch_2types_8h.html#6ec0a17695d07350d56eaffe994e29f4">DFSCH_PAIR_P</a>(j)){
<a name="l01117"></a>01117     <span class="keywordflow">if</span> (i &gt;= len){
<a name="l01118"></a>01118       <span class="keywordflow">break</span>; <span class="comment">/* Can happen due to race condition in user code */</span>
<a name="l01119"></a>01119     }
<a name="l01120"></a>01120     data[i] = <a class="code" href="dfsch_2types_8h.html#873da07e10c696bf321a42629cdb863e">DFSCH_FAST_CAR</a>(j);
<a name="l01121"></a>01121     j = <a class="code" href="dfsch_2types_8h.html#9621e19e10bbf916d031fc55631f48df">DFSCH_FAST_CDR</a>(j);
<a name="l01122"></a>01122     i++;
<a name="l01123"></a>01123   }
<a name="l01124"></a>01124 
<a name="l01125"></a>01125   <span class="keywordflow">if</span> (length){
<a name="l01126"></a>01126     *length = len;
<a name="l01127"></a>01127   }
<a name="l01128"></a>01128 
<a name="l01129"></a>01129   <span class="keywordflow">return</span> data;
<a name="l01130"></a>01130 }
<a name="l01131"></a>01131 
<a name="l01132"></a><a class="code" href="dfsch_8c.html#412ff1000f00dcfa12c7b56ffc29c2f2">01132</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8h.html#412ff1000f00dcfa12c7b56ffc29c2f2">dfsch_list_copy_immutable</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* list){
<a name="l01133"></a>01133   <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* j = list;
<a name="l01134"></a>01134   <span class="keywordtype">size_t</span> i=0;
<a name="l01135"></a>01135   <span class="keywordtype">size_t</span> len;
<a name="l01136"></a>01136   <a class="code" href="structdfsch__object__t.html">object_t</a>** data;
<a name="l01137"></a>01137   <span class="keywordtype">int</span> proper;
<a name="l01138"></a>01138 
<a name="l01139"></a>01139   <span class="keywordflow">if</span> (list == NULL){
<a name="l01140"></a>01140     <span class="keywordflow">return</span> NULL;
<a name="l01141"></a>01141   }
<a name="l01142"></a>01142 
<a name="l01143"></a>01143   len = <a class="code" href="dfsch_8h.html#9be2641c051ee5a0148811826056eea7">dfsch_list_length</a>(list, &amp;proper);
<a name="l01144"></a>01144 
<a name="l01145"></a>01145   <span class="keywordflow">if</span> (len == 1){
<a name="l01146"></a>01146     <span class="keywordflow">return</span> <a class="code" href="dfsch_8h.html#e5734a250a429a47731c7cc4ff9b5e12">dfsch_cons_immutable</a>(<a class="code" href="dfsch_8h.html#fa8b1de0edaa892e808ab624b35101b2">dfsch_car</a>(list),
<a name="l01147"></a>01147                                 <a class="code" href="dfsch_8h.html#41cae0a7d870e4727489a6af6fee335a">dfsch_cdr</a>(list));
<a name="l01148"></a>01148   }
<a name="l01149"></a>01149 
<a name="l01150"></a>01150   data = GC_MALLOC(<span class="keyword">sizeof</span>(<a class="code" href="structdfsch__object__t.html">object_t</a>*)*(len+4));
<a name="l01151"></a>01151   
<a name="l01152"></a>01152   <span class="keywordflow">while</span> (<a class="code" href="dfsch_2types_8h.html#6ec0a17695d07350d56eaffe994e29f4">DFSCH_PAIR_P</a>(j)){
<a name="l01153"></a>01153     <span class="keywordflow">if</span> (i &gt;= len){
<a name="l01154"></a>01154       <span class="keywordflow">break</span>; <span class="comment">/* Can happen due to race condition in user code */</span>
<a name="l01155"></a>01155     }
<a name="l01156"></a>01156     data[i] = <a class="code" href="dfsch_2types_8h.html#873da07e10c696bf321a42629cdb863e">DFSCH_FAST_CAR</a>(j);
<a name="l01157"></a>01157     j = <a class="code" href="dfsch_2types_8h.html#9621e19e10bbf916d031fc55631f48df">DFSCH_FAST_CDR</a>(j);
<a name="l01158"></a>01158     i++;
<a name="l01159"></a>01159   }
<a name="l01160"></a>01160 
<a name="l01161"></a>01161   data[i] = <a class="code" href="dfsch_2types_8h.html#eb709d9887860cbd23490e6d0879fdf3">DFSCH_INVALID_OBJECT</a>;
<a name="l01162"></a>01162   i++;
<a name="l01163"></a>01163   data[i] = j;
<a name="l01164"></a>01164   data[i+1] = NULL;
<a name="l01165"></a>01165   data[i+2] = NULL;
<a name="l01166"></a>01166 
<a name="l01167"></a>01167   <span class="keywordflow">return</span> <a class="code" href="dfsch_2types_8h.html#1109ed3c9f1fd01d561a621f68ca3927">DFSCH_MAKE_CLIST</a>(data);
<a name="l01168"></a>01168 }
<a name="l01169"></a>01169 
<a name="l01170"></a><a class="code" href="dfsch_8c.html#f085346a8a868f3d415f1413c219c766">01170</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8h.html#f085346a8a868f3d415f1413c219c766">dfsch_list_annotate</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* list, 
<a name="l01171"></a>01171                                     <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* source,
<a name="l01172"></a>01172                                     <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* location){
<a name="l01173"></a>01173   <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* j = list;
<a name="l01174"></a>01174   <span class="keywordtype">size_t</span> i=0;
<a name="l01175"></a>01175   <span class="keywordtype">size_t</span> len;
<a name="l01176"></a>01176   <a class="code" href="structdfsch__object__t.html">object_t</a>** data;
<a name="l01177"></a>01177   <span class="keywordtype">int</span> proper;
<a name="l01178"></a>01178 
<a name="l01179"></a>01179   <span class="keywordflow">if</span> (list == NULL){
<a name="l01180"></a>01180     <span class="keywordflow">return</span> NULL;
<a name="l01181"></a>01181   }
<a name="l01182"></a>01182 
<a name="l01183"></a>01183   len = <a class="code" href="dfsch_8h.html#9be2641c051ee5a0148811826056eea7">dfsch_list_length</a>(list, &amp;proper);
<a name="l01184"></a>01184 
<a name="l01185"></a>01185   data = GC_MALLOC(<span class="keyword">sizeof</span>(<a class="code" href="structdfsch__object__t.html">object_t</a>*)*(len+4));
<a name="l01186"></a>01186   
<a name="l01187"></a>01187   <span class="keywordflow">while</span> (<a class="code" href="dfsch_2types_8h.html#6ec0a17695d07350d56eaffe994e29f4">DFSCH_PAIR_P</a>(j)){
<a name="l01188"></a>01188     <span class="keywordflow">if</span> (i &gt;= len){
<a name="l01189"></a>01189       <span class="keywordflow">break</span>; <span class="comment">/* Can happen due to race condition in user code */</span>
<a name="l01190"></a>01190     }
<a name="l01191"></a>01191     data[i] = <a class="code" href="dfsch_2types_8h.html#873da07e10c696bf321a42629cdb863e">DFSCH_FAST_CAR</a>(j);
<a name="l01192"></a>01192     j = <a class="code" href="dfsch_2types_8h.html#9621e19e10bbf916d031fc55631f48df">DFSCH_FAST_CDR</a>(j);
<a name="l01193"></a>01193     i++;
<a name="l01194"></a>01194   }
<a name="l01195"></a>01195 
<a name="l01196"></a>01196   data[i] = <a class="code" href="dfsch_2types_8h.html#eb709d9887860cbd23490e6d0879fdf3">DFSCH_INVALID_OBJECT</a>;
<a name="l01197"></a>01197   data[i+1] = j;
<a name="l01198"></a>01198   data[i+2] = source;
<a name="l01199"></a>01199   data[i+3] = location;
<a name="l01200"></a>01200 
<a name="l01201"></a>01201   <span class="keywordflow">return</span> <a class="code" href="dfsch_2types_8h.html#1109ed3c9f1fd01d561a621f68ca3927">DFSCH_MAKE_CLIST</a>(data);
<a name="l01202"></a>01202 }
<a name="l01203"></a>01203 
<a name="l01204"></a><a class="code" href="dfsch_8c.html#8b7e45eea61986bc89746e573f0c56c1">01204</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8h.html#8b7e45eea61986bc89746e573f0c56c1">dfsch_get_list_annotation</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* list){
<a name="l01205"></a>01205   <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>** i;
<a name="l01206"></a>01206   <span class="keywordflow">if</span> (!<a class="code" href="dfsch_2types_8h.html#6ec0a17695d07350d56eaffe994e29f4">DFSCH_PAIR_P</a>(list) || !<a class="code" href="dfsch_2types_8h.html#3bc62f050705950c63111ee8b706ac79">DFSCH__FAST_CDR_CODED_P</a>(list)){
<a name="l01207"></a>01207     <span class="keywordflow">return</span> NULL;
<a name="l01208"></a>01208   }
<a name="l01209"></a>01209 
<a name="l01210"></a>01210   i = (<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>**) <a class="code" href="dfsch_2types_8h.html#d7ca8b64da97b215772b89095021e28b">DFSCH_PAIR_REF</a>(list);
<a name="l01211"></a>01211 
<a name="l01212"></a>01212   <span class="keywordflow">while</span> (*i != <a class="code" href="dfsch_2types_8h.html#eb709d9887860cbd23490e6d0879fdf3">DFSCH_INVALID_OBJECT</a>){
<a name="l01213"></a>01213     i++;
<a name="l01214"></a>01214   }
<a name="l01215"></a>01215 
<a name="l01216"></a>01216   <span class="comment">/* i[1] is last CDR */</span>
<a name="l01217"></a>01217 
<a name="l01218"></a>01218   <span class="keywordflow">if</span> (i[2] || i[3]){
<a name="l01219"></a>01219     <span class="keywordflow">return</span> <a class="code" href="dfsch_8h.html#ff85cf17ead5b89f43244a3010bc155c">dfsch_cons</a>(i[2], i[3]);
<a name="l01220"></a>01220   } <span class="keywordflow">else</span> {
<a name="l01221"></a>01221     <span class="keywordflow">return</span> NULL;
<a name="l01222"></a>01222   }
<a name="l01223"></a>01223 }
<a name="l01224"></a>01224 
<a name="l01225"></a>01225 
<a name="l01226"></a><a class="code" href="dfsch_8c.html#f3d0c8d5fa061ec43f2a5620560f963e">01226</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8h.html#f3d0c8d5fa061ec43f2a5620560f963e">dfsch_zip</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* llist){
<a name="l01227"></a>01227   <span class="keywordtype">size_t</span> len;
<a name="l01228"></a>01228   <a class="code" href="structdfsch__object__t.html">object_t</a>** args = <a class="code" href="dfsch_8h.html#8c423fcccf437f32cba17f0e9747831a">dfsch_list_as_array</a>(llist, &amp;len);
<a name="l01229"></a>01229 
<a name="l01230"></a>01230   <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* shead;
<a name="l01231"></a>01231   <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* stail;
<a name="l01232"></a>01232 
<a name="l01233"></a>01233   <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a> *head = NULL; 
<a name="l01234"></a>01234   <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a> *tail;
<a name="l01235"></a>01235 
<a name="l01236"></a>01236   <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* tmp;
<a name="l01237"></a>01237   <span class="keywordtype">size_t</span> i;
<a name="l01238"></a>01238 
<a name="l01239"></a>01239   <span class="keywordflow">if</span> (len == 0){
<a name="l01240"></a>01240     <span class="keywordflow">return</span> NULL;
<a name="l01241"></a>01241   }
<a name="l01242"></a>01242 
<a name="l01243"></a>01243   <span class="keywordflow">while</span>(1){
<a name="l01244"></a>01244     shead = NULL;
<a name="l01245"></a>01245 
<a name="l01246"></a>01246     <span class="keywordflow">for</span> (i = 0; i&lt;len; i++){
<a name="l01247"></a>01247       <span class="keywordflow">if</span> (!args[i]){
<a name="l01248"></a>01248         <span class="keywordflow">if</span> (i != 0){
<a name="l01249"></a>01249           <a class="code" href="dfsch_8h.html#646ee34c82a726fdc33d8a28af39270a">dfsch_error</a>(<span class="stringliteral">"Not a list of same length lists"</span>, llist);
<a name="l01250"></a>01250         }
<a name="l01251"></a>01251         <span class="keywordflow">goto</span> out;
<a name="l01252"></a>01252       }
<a name="l01253"></a>01253       <span class="keywordflow">if</span> (!<a class="code" href="dfsch_2types_8h.html#6ec0a17695d07350d56eaffe994e29f4">DFSCH_PAIR_P</a>(args[i])){
<a name="l01254"></a>01254         <a class="code" href="conditions_8h.html#753bcd9b14333b81e0b2dafd35cd2074">dfsch_type_error</a>(args[i], <a class="code" href="dfsch_2types_8h.html#b7f8ae918d879f11a2cfb049a568bb66">DFSCH_PAIR_TYPE</a>, 0);
<a name="l01255"></a>01255       }
<a name="l01256"></a>01256 
<a name="l01257"></a>01257       tmp = <a class="code" href="dfsch_8h.html#ff85cf17ead5b89f43244a3010bc155c">dfsch_cons</a>(<a class="code" href="dfsch_2types_8h.html#873da07e10c696bf321a42629cdb863e">DFSCH_FAST_CAR</a>(args[i]), NULL);
<a name="l01258"></a>01258       <span class="keywordflow">if</span> (shead){
<a name="l01259"></a>01259         <a class="code" href="dfsch_2types_8h.html#bb4a2056ae9d34d125eba3ac229f8ada">DFSCH_FAST_CDR_MUT</a>(stail) = tmp;
<a name="l01260"></a>01260       } <span class="keywordflow">else</span> {
<a name="l01261"></a>01261         shead = tmp;
<a name="l01262"></a>01262       }
<a name="l01263"></a>01263       stail = tmp;
<a name="l01264"></a>01264 
<a name="l01265"></a>01265       args[i] = <a class="code" href="dfsch_2types_8h.html#9621e19e10bbf916d031fc55631f48df">DFSCH_FAST_CDR</a>(args[i]);
<a name="l01266"></a>01266     }
<a name="l01267"></a>01267 
<a name="l01268"></a>01268 
<a name="l01269"></a>01269     tmp = <a class="code" href="dfsch_8h.html#ff85cf17ead5b89f43244a3010bc155c">dfsch_cons</a>(shead, NULL);
<a name="l01270"></a>01270     <span class="keywordflow">if</span> (head){
<a name="l01271"></a>01271       <a class="code" href="dfsch_2types_8h.html#bb4a2056ae9d34d125eba3ac229f8ada">DFSCH_FAST_CDR_MUT</a>(tail) = tmp;
<a name="l01272"></a>01272     } <span class="keywordflow">else</span> {
<a name="l01273"></a>01273       head = tmp;
<a name="l01274"></a>01274     }
<a name="l01275"></a>01275     tail = tmp;
<a name="l01276"></a>01276 
<a name="l01277"></a>01277   }
<a name="l01278"></a>01278   
<a name="l01279"></a>01279 
<a name="l01280"></a>01280  out:
<a name="l01281"></a>01281   <span class="keywordflow">for</span> (i = 0; i&lt;len; i++){
<a name="l01282"></a>01282     <span class="keywordflow">if</span> (args[i]){
<a name="l01283"></a>01283       <a class="code" href="dfsch_8h.html#646ee34c82a726fdc33d8a28af39270a">dfsch_error</a>(<span class="stringliteral">"Not a list of same length lists"</span>, llist);
<a name="l01284"></a>01284     }
<a name="l01285"></a>01285   }
<a name="l01286"></a>01286   
<a name="l01287"></a>01287   <span class="keywordflow">return</span> head;
<a name="l01288"></a>01288 }
<a name="l01289"></a>01289 
<a name="l01290"></a>01290 
<a name="l01291"></a><a class="code" href="dfsch_8c.html#0ee779bec69600534328fa366e2aa56c">01291</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8h.html#0ee779bec69600534328fa366e2aa56c">dfsch_append</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* llist){
<a name="l01292"></a>01292   <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* head=NULL;
<a name="l01293"></a>01293   <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* tail=NULL;
<a name="l01294"></a>01294   <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* i = llist;
<a name="l01295"></a>01295   <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* j;
<a name="l01296"></a>01296 
<a name="l01297"></a>01297   <span class="keywordflow">if</span> (!llist)
<a name="l01298"></a>01298     <span class="keywordflow">return</span> NULL;
<a name="l01299"></a>01299 
<a name="l01300"></a>01300   <span class="keywordflow">while</span>(<a class="code" href="dfsch_2types_8h.html#6ec0a17695d07350d56eaffe994e29f4">DFSCH_PAIR_P</a>(i) &amp;&amp; <a class="code" href="dfsch_2types_8h.html#6ec0a17695d07350d56eaffe994e29f4">DFSCH_PAIR_P</a>(<a class="code" href="dfsch_2types_8h.html#9621e19e10bbf916d031fc55631f48df">DFSCH_FAST_CDR</a>(i))){
<a name="l01301"></a>01301     
<a name="l01302"></a>01302     j = <a class="code" href="dfsch_2types_8h.html#873da07e10c696bf321a42629cdb863e">DFSCH_FAST_CAR</a>(i);
<a name="l01303"></a>01303     <span class="keywordflow">while</span>(<a class="code" href="dfsch_2types_8h.html#6ec0a17695d07350d56eaffe994e29f4">DFSCH_PAIR_P</a>(j)){
<a name="l01304"></a>01304       <span class="keywordflow">if</span> (head){
<a name="l01305"></a>01305         <a class="code" href="structdfsch__object__t.html">object_t</a>* tmp = <a class="code" href="dfsch_8h.html#ff85cf17ead5b89f43244a3010bc155c">dfsch_cons</a>(<a class="code" href="dfsch_2types_8h.html#873da07e10c696bf321a42629cdb863e">DFSCH_FAST_CAR</a>(j),NULL);
<a name="l01306"></a>01306         <a class="code" href="dfsch_2types_8h.html#bb4a2056ae9d34d125eba3ac229f8ada">DFSCH_FAST_CDR_MUT</a>(tail) = tmp;
<a name="l01307"></a>01307         tail = tmp;
<a name="l01308"></a>01308       }<span class="keywordflow">else</span>{
<a name="l01309"></a>01309         head = tail = <a class="code" href="dfsch_8h.html#ff85cf17ead5b89f43244a3010bc155c">dfsch_cons</a>(<a class="code" href="dfsch_2types_8h.html#873da07e10c696bf321a42629cdb863e">DFSCH_FAST_CAR</a>(j),NULL);
<a name="l01310"></a>01310       }
<a name="l01311"></a>01311       j = <a class="code" href="dfsch_2types_8h.html#9621e19e10bbf916d031fc55631f48df">DFSCH_FAST_CDR</a>(j);
<a name="l01312"></a>01312     }
<a name="l01313"></a>01313     <span class="keywordflow">if</span> (j &amp;&amp; !<a class="code" href="dfsch_2types_8h.html#6ec0a17695d07350d56eaffe994e29f4">DFSCH_PAIR_P</a>(j)) {
<a name="l01314"></a>01314       <a class="code" href="conditions_8h.html#753bcd9b14333b81e0b2dafd35cd2074">dfsch_type_error</a>(j, <a class="code" href="dfsch_8c.html#8f0b5b0dedaf5c25c4887f03ebfdd425">PAIR</a>, 0);
<a name="l01315"></a>01315     }
<a name="l01316"></a>01316 
<a name="l01317"></a>01317     i = <a class="code" href="dfsch_2types_8h.html#9621e19e10bbf916d031fc55631f48df">DFSCH_FAST_CDR</a>(i);
<a name="l01318"></a>01318   }
<a name="l01319"></a>01319 
<a name="l01320"></a>01320   <span class="keywordflow">if</span> (!<a class="code" href="dfsch_2types_8h.html#6ec0a17695d07350d56eaffe994e29f4">DFSCH_PAIR_P</a>(i)){
<a name="l01321"></a>01321     <a class="code" href="conditions_8h.html#753bcd9b14333b81e0b2dafd35cd2074">dfsch_type_error</a>(i, <a class="code" href="dfsch_8c.html#8f0b5b0dedaf5c25c4887f03ebfdd425">PAIR</a>, 0);
<a name="l01322"></a>01322   }
<a name="l01323"></a>01323 
<a name="l01324"></a>01324   <span class="keywordflow">if</span> (tail){
<a name="l01325"></a>01325     <a class="code" href="dfsch_2types_8h.html#bb4a2056ae9d34d125eba3ac229f8ada">DFSCH_FAST_CDR_MUT</a>(tail) = <a class="code" href="dfsch_2types_8h.html#873da07e10c696bf321a42629cdb863e">DFSCH_FAST_CAR</a>(i);
<a name="l01326"></a>01326   }<span class="keywordflow">else</span>{
<a name="l01327"></a>01327     head = <a class="code" href="dfsch_2types_8h.html#873da07e10c696bf321a42629cdb863e">DFSCH_FAST_CAR</a>(i);
<a name="l01328"></a>01328   }
<a name="l01329"></a>01329 
<a name="l01330"></a>01330   <span class="keywordflow">return</span> head;
<a name="l01331"></a>01331 }
<a name="l01332"></a>01332 
<a name="l01333"></a><a class="code" href="dfsch_8c.html#d1735dbe5d8d5331eebbe8e20bbb37be">01333</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8h.html#d1735dbe5d8d5331eebbe8e20bbb37be">dfsch_list</a>(<span class="keywordtype">size_t</span> count, ...){
<a name="l01334"></a>01334   <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a> *head; 
<a name="l01335"></a>01335   <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a> *cur;
<a name="l01336"></a>01336   <span class="keywordtype">size_t</span> i;
<a name="l01337"></a>01337   va_list al;
<a name="l01338"></a>01338 
<a name="l01339"></a>01339   va_start(al,count);
<a name="l01340"></a>01340 
<a name="l01341"></a>01341   <span class="keywordflow">if</span> (count == 0)
<a name="l01342"></a>01342     <span class="keywordflow">return</span> NULL;
<a name="l01343"></a>01343 
<a name="l01344"></a>01344   head = cur = <a class="code" href="dfsch_8c.html#3cc33fb709ad0f829315288fda0a49a1">dfsch_multicons</a>(count);
<a name="l01345"></a>01345 
<a name="l01346"></a>01346   <span class="keywordflow">for</span>(i = 0; i &lt; count; ++i){
<a name="l01347"></a>01347     <a class="code" href="dfsch_2types_8h.html#873da07e10c696bf321a42629cdb863e">DFSCH_FAST_CAR</a>(cur) = va_arg(al, <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>*);
<a name="l01348"></a>01348     cur = <a class="code" href="dfsch_2types_8h.html#9621e19e10bbf916d031fc55631f48df">DFSCH_FAST_CDR</a>(cur);
<a name="l01349"></a>01349   }
<a name="l01350"></a>01350 
<a name="l01351"></a>01351   va_end(al);
<a name="l01352"></a>01352   <span class="keywordflow">return</span> head;
<a name="l01353"></a>01353 
<a name="l01354"></a>01354 }
<a name="l01355"></a>01355 
<a name="l01356"></a><a class="code" href="dfsch_8c.html#881c65ea795fdbd4d687f1f0bde3bf11">01356</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8h.html#881c65ea795fdbd4d687f1f0bde3bf11">dfsch_list_copy</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* list){
<a name="l01357"></a>01357   <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a> *head; 
<a name="l01358"></a>01358   <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a> *tail;
<a name="l01359"></a>01359   <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a> *i =  list;
<a name="l01360"></a>01360 
<a name="l01361"></a>01361   head = tail = NULL;
<a name="l01362"></a>01362 
<a name="l01363"></a>01363   <span class="keywordflow">while</span>(<a class="code" href="dfsch_2types_8h.html#6ec0a17695d07350d56eaffe994e29f4">DFSCH_PAIR_P</a>(i)){
<a name="l01364"></a>01364     <span class="keywordflow">if</span> (head){
<a name="l01365"></a>01365       <a class="code" href="structdfsch__object__t.html">object_t</a>* tmp = <a class="code" href="dfsch_8h.html#ff85cf17ead5b89f43244a3010bc155c">dfsch_cons</a>(<a class="code" href="dfsch_2types_8h.html#873da07e10c696bf321a42629cdb863e">DFSCH_FAST_CAR</a>(i),NULL);
<a name="l01366"></a>01366       <a class="code" href="dfsch_2types_8h.html#bb4a2056ae9d34d125eba3ac229f8ada">DFSCH_FAST_CDR_MUT</a>(tail) = tmp;
<a name="l01367"></a>01367       tail = tmp;
<a name="l01368"></a>01368     }<span class="keywordflow">else</span>{
<a name="l01369"></a>01369       head = tail = <a class="code" href="dfsch_8h.html#ff85cf17ead5b89f43244a3010bc155c">dfsch_cons</a>(<a class="code" href="dfsch_2types_8h.html#873da07e10c696bf321a42629cdb863e">DFSCH_FAST_CAR</a>(i),NULL);
<a name="l01370"></a>01370     }
<a name="l01371"></a>01371     i = <a class="code" href="dfsch_2types_8h.html#9621e19e10bbf916d031fc55631f48df">DFSCH_FAST_CDR</a>(i);
<a name="l01372"></a>01372   }
<a name="l01373"></a>01373   <span class="keywordflow">if</span> (i &amp;&amp; !<a class="code" href="dfsch_2types_8h.html#6ec0a17695d07350d56eaffe994e29f4">DFSCH_PAIR_P</a>(i)){
<a name="l01374"></a>01374     <a class="code" href="conditions_8h.html#753bcd9b14333b81e0b2dafd35cd2074">dfsch_type_error</a>(i, <a class="code" href="dfsch_2types_8h.html#f68c7145dd8463d15d30fa4a1ffc532e">DFSCH_LIST_TYPE</a>, 1);
<a name="l01375"></a>01375   }
<a name="l01376"></a>01376 
<a name="l01377"></a>01377   <span class="keywordflow">return</span> (<a class="code" href="structdfsch__object__t.html">object_t</a>*)head;
<a name="l01378"></a>01378 
<a name="l01379"></a>01379 }
<a name="l01380"></a>01380 
<a name="l01381"></a>01381 
<a name="l01382"></a><a class="code" href="dfsch_8c.html#9b021a4f13c416bd6bf7043ce24aaf6e">01382</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8h.html#9b021a4f13c416bd6bf7043ce24aaf6e">dfsch_reverse</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* list){
<a name="l01383"></a>01383   <a class="code" href="structdfsch__object__t.html">object_t</a> *head; 
<a name="l01384"></a>01384   <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a> *i =  list;
<a name="l01385"></a>01385 
<a name="l01386"></a>01386   head = NULL;
<a name="l01387"></a>01387 
<a name="l01388"></a>01388   <span class="keywordflow">while</span>(<a class="code" href="dfsch_2types_8h.html#6ec0a17695d07350d56eaffe994e29f4">DFSCH_PAIR_P</a>(i)){
<a name="l01389"></a>01389     head = <a class="code" href="dfsch_8h.html#ff85cf17ead5b89f43244a3010bc155c">dfsch_cons</a>(<a class="code" href="dfsch_2types_8h.html#873da07e10c696bf321a42629cdb863e">DFSCH_FAST_CAR</a>(i), head);
<a name="l01390"></a>01390     i = <a class="code" href="dfsch_2types_8h.html#9621e19e10bbf916d031fc55631f48df">DFSCH_FAST_CDR</a>(i);
<a name="l01391"></a>01391   }
<a name="l01392"></a>01392   <span class="keywordflow">if</span> (i){
<a name="l01393"></a>01393     <a class="code" href="conditions_8h.html#753bcd9b14333b81e0b2dafd35cd2074">dfsch_type_error</a>(i, <a class="code" href="dfsch_2types_8h.html#f68c7145dd8463d15d30fa4a1ffc532e">DFSCH_LIST_TYPE</a>, 1);
<a name="l01394"></a>01394   }
<a name="l01395"></a>01395 
<a name="l01396"></a>01396   <span class="keywordflow">return</span> (<a class="code" href="structdfsch__object__t.html">object_t</a>*)head;
<a name="l01397"></a>01397 }
<a name="l01398"></a>01398 
<a name="l01399"></a><a class="code" href="dfsch_8c.html#547783ea19b4e2ea692f3eca7239e379">01399</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8h.html#d7da2a98c7e3ff2608f2805006db9667">dfsch_member</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a> *key,
<a name="l01400"></a>01400                              <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a> *list){
<a name="l01401"></a>01401   <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* i;
<a name="l01402"></a>01402   i=list;
<a name="l01403"></a>01403   
<a name="l01404"></a>01404   <span class="keywordflow">while</span> (<a class="code" href="dfsch_2types_8h.html#6ec0a17695d07350d56eaffe994e29f4">DFSCH_PAIR_P</a>(i)){
<a name="l01405"></a>01405     <span class="keywordflow">if</span> (<a class="code" href="dfsch_8h.html#bbe1fbb1fc7739ab514130fd3f6f410f">dfsch_equal_p</a>(key, <a class="code" href="dfsch_2types_8h.html#873da07e10c696bf321a42629cdb863e">DFSCH_FAST_CAR</a>(i))){
<a name="l01406"></a>01406       <span class="keywordflow">return</span> (<a class="code" href="structdfsch__object__t.html">object_t</a>*)i;
<a name="l01407"></a>01407     }
<a name="l01408"></a>01408 
<a name="l01409"></a>01409     i = <a class="code" href="dfsch_2types_8h.html#9621e19e10bbf916d031fc55631f48df">DFSCH_FAST_CDR</a>(i);
<a name="l01410"></a>01410   }
<a name="l01411"></a>01411 
<a name="l01412"></a>01412   <span class="keywordflow">if</span> (i){
<a name="l01413"></a>01413     <a class="code" href="conditions_8h.html#753bcd9b14333b81e0b2dafd35cd2074">dfsch_type_error</a>(i, <a class="code" href="dfsch_2types_8h.html#f68c7145dd8463d15d30fa4a1ffc532e">DFSCH_LIST_TYPE</a>, 1);
<a name="l01414"></a>01414   }
<a name="l01415"></a>01415 
<a name="l01416"></a>01416   <span class="keywordflow">return</span> NULL;
<a name="l01417"></a>01417 }
<a name="l01418"></a>01418 
<a name="l01419"></a><a class="code" href="dfsch_8c.html#2df2d96d90703bbfd9851eebe44e2176">01419</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8h.html#956c7ed6727150f9cb3674aee5a37203">dfsch_memv</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a> *key,
<a name="l01420"></a>01420                            <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a> *list){
<a name="l01421"></a>01421   <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* i;
<a name="l01422"></a>01422   i=list;
<a name="l01423"></a>01423   
<a name="l01424"></a>01424   <span class="keywordflow">while</span> (<a class="code" href="dfsch_2types_8h.html#6ec0a17695d07350d56eaffe994e29f4">DFSCH_PAIR_P</a>(i)){
<a name="l01425"></a>01425     <span class="keywordflow">if</span> (<a class="code" href="dfsch_8h.html#f0dae085f9947e96f051e4a35ce0487d">dfsch_eqv_p</a>(key, <a class="code" href="dfsch_2types_8h.html#873da07e10c696bf321a42629cdb863e">DFSCH_FAST_CAR</a>(i))){
<a name="l01426"></a>01426       <span class="keywordflow">return</span> (<a class="code" href="structdfsch__object__t.html">object_t</a>*)i;
<a name="l01427"></a>01427     }
<a name="l01428"></a>01428 
<a name="l01429"></a>01429     i = <a class="code" href="dfsch_2types_8h.html#9621e19e10bbf916d031fc55631f48df">DFSCH_FAST_CDR</a>(i);
<a name="l01430"></a>01430   }
<a name="l01431"></a>01431 
<a name="l01432"></a>01432   <span class="keywordflow">if</span> (i){
<a name="l01433"></a>01433     <a class="code" href="conditions_8h.html#753bcd9b14333b81e0b2dafd35cd2074">dfsch_type_error</a>(i, <a class="code" href="dfsch_2types_8h.html#f68c7145dd8463d15d30fa4a1ffc532e">DFSCH_LIST_TYPE</a>, 1);
<a name="l01434"></a>01434   }
<a name="l01435"></a>01435 
<a name="l01436"></a>01436   <span class="keywordflow">return</span> NULL;
<a name="l01437"></a>01437 }
<a name="l01438"></a>01438 
<a name="l01439"></a><a class="code" href="dfsch_8c.html#cd4ed602bcdacd6321bd8282ef5cde0e">01439</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8h.html#5523844ac2bce5c21b7fc5d01d83deab">dfsch_memq</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a> *key,
<a name="l01440"></a>01440                            <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a> *list){
<a name="l01441"></a>01441   <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* i;
<a name="l01442"></a>01442   i=list;
<a name="l01443"></a>01443   
<a name="l01444"></a>01444   <span class="keywordflow">while</span> (<a class="code" href="dfsch_2types_8h.html#6ec0a17695d07350d56eaffe994e29f4">DFSCH_PAIR_P</a>(i)){
<a name="l01445"></a>01445     <span class="keywordflow">if</span> (key == <a class="code" href="dfsch_2types_8h.html#873da07e10c696bf321a42629cdb863e">DFSCH_FAST_CAR</a>(i)){
<a name="l01446"></a>01446       <span class="keywordflow">return</span> (<a class="code" href="structdfsch__object__t.html">object_t</a>*)i;
<a name="l01447"></a>01447     }
<a name="l01448"></a>01448 
<a name="l01449"></a>01449     i = <a class="code" href="dfsch_2types_8h.html#9621e19e10bbf916d031fc55631f48df">DFSCH_FAST_CDR</a>(i);
<a name="l01450"></a>01450   }
<a name="l01451"></a>01451 
<a name="l01452"></a>01452   <span class="keywordflow">if</span> (i){
<a name="l01453"></a>01453     <a class="code" href="conditions_8h.html#753bcd9b14333b81e0b2dafd35cd2074">dfsch_type_error</a>(i, <a class="code" href="dfsch_2types_8h.html#f68c7145dd8463d15d30fa4a1ffc532e">DFSCH_LIST_TYPE</a>, 1);
<a name="l01454"></a>01454   }
<a name="l01455"></a>01455 
<a name="l01456"></a>01456   <span class="keywordflow">return</span> NULL;
<a name="l01457"></a>01457 }
<a name="l01458"></a>01458 
<a name="l01459"></a>01459 <span class="comment">/*</span>
<a name="l01460"></a>01460 <span class="comment"> * Linked list mergesort as described by Simon Tatham at</span>
<a name="l01461"></a>01461 <span class="comment"> * http://www.chiark.greenend.org.uk/~sgtatham/algorithms/listsort.html</span>
<a name="l01462"></a>01462 <span class="comment"> */</span>
<a name="l01463"></a><a class="code" href="dfsch_8c.html#d90e993ddf870673afcb8f3277c6c737">01463</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8c.html#d90e993ddf870673afcb8f3277c6c737">dfsch_sort_list</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* list,
<a name="l01464"></a>01464                                 <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* comp){
<a name="l01465"></a>01465   <span class="keywordtype">size_t</span> k = 1;
<a name="l01466"></a>01466   <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* p = list;
<a name="l01467"></a>01467   <span class="keywordtype">size_t</span> p_s;
<a name="l01468"></a>01468   <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* q;
<a name="l01469"></a>01469   <span class="keywordtype">size_t</span> q_s;
<a name="l01470"></a>01470   <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* l;
<a name="l01471"></a>01471   <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* lt;
<a name="l01472"></a>01472   <span class="keywordtype">int</span> nmerges;
<a name="l01473"></a>01473   <span class="keywordtype">size_t</span> i;
<a name="l01474"></a>01474   <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* e;
<a name="l01475"></a>01475 
<a name="l01476"></a>01476   list = <a class="code" href="dfsch_8h.html#523e9cf113a409a9a309cfd18efbdd6e">dfsch_ensure_mutable_list</a>(list);
<a name="l01477"></a>01477   l = list;
<a name="l01478"></a>01478 
<a name="l01479"></a>01479   <span class="keywordflow">do</span> {
<a name="l01480"></a>01480     nmerges = 0;
<a name="l01481"></a>01481     p = l;
<a name="l01482"></a>01482     l = NULL;
<a name="l01483"></a>01483     lt = NULL;
<a name="l01484"></a>01484     <span class="keywordflow">while</span> (<a class="code" href="dfsch_2types_8h.html#6ec0a17695d07350d56eaffe994e29f4">DFSCH_PAIR_P</a>(p)){
<a name="l01485"></a>01485       nmerges++;
<a name="l01486"></a>01486       q = p;
<a name="l01487"></a>01487       p_s = 0;
<a name="l01488"></a>01488       <span class="keywordflow">for</span> (i = 0; <a class="code" href="dfsch_2types_8h.html#6ec0a17695d07350d56eaffe994e29f4">DFSCH_PAIR_P</a>(q) &amp;&amp; i &lt; k; i++){
<a name="l01489"></a>01489         q = <a class="code" href="dfsch_2types_8h.html#9621e19e10bbf916d031fc55631f48df">DFSCH_FAST_CDR</a>(q);
<a name="l01490"></a>01490         p_s++;
<a name="l01491"></a>01491       }
<a name="l01492"></a>01492       q_s = k;
<a name="l01493"></a>01493       <span class="keywordflow">while</span> (p_s &gt; 0 || (q_s &gt;0 &amp;&amp; <a class="code" href="dfsch_2types_8h.html#6ec0a17695d07350d56eaffe994e29f4">DFSCH_PAIR_P</a>(q))){
<a name="l01494"></a>01494         <span class="keywordflow">if</span> (p_s == 0){
<a name="l01495"></a>01495           q_s--;
<a name="l01496"></a>01496           e = q;
<a name="l01497"></a>01497           q = <a class="code" href="dfsch_2types_8h.html#9621e19e10bbf916d031fc55631f48df">DFSCH_FAST_CDR</a>(q);
<a name="l01498"></a>01498         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (q_s == 0 || !<a class="code" href="dfsch_2types_8h.html#6ec0a17695d07350d56eaffe994e29f4">DFSCH_PAIR_P</a>(q)){
<a name="l01499"></a>01499           p_s--;
<a name="l01500"></a>01500           e = p;
<a name="l01501"></a>01501           p = <a class="code" href="dfsch_2types_8h.html#9621e19e10bbf916d031fc55631f48df">DFSCH_FAST_CDR</a>(p);
<a name="l01502"></a>01502         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="dfsch_8h.html#2772937dcff7850968639e3054e65384">dfsch_apply</a>(comp, <a class="code" href="dfsch_8h.html#d1735dbe5d8d5331eebbe8e20bbb37be">dfsch_list</a>(2, <a class="code" href="dfsch_2types_8h.html#873da07e10c696bf321a42629cdb863e">DFSCH_FAST_CAR</a>(q), 
<a name="l01503"></a>01503                                                 <a class="code" href="dfsch_2types_8h.html#873da07e10c696bf321a42629cdb863e">DFSCH_FAST_CAR</a>(p))) != NULL){
<a name="l01504"></a>01504           q_s--;
<a name="l01505"></a>01505           e = q;
<a name="l01506"></a>01506           q = <a class="code" href="dfsch_2types_8h.html#9621e19e10bbf916d031fc55631f48df">DFSCH_FAST_CDR</a>(q);          
<a name="l01507"></a>01507         } <span class="keywordflow">else</span> {
<a name="l01508"></a>01508           p_s--;
<a name="l01509"></a>01509           e = p;
<a name="l01510"></a>01510           p = <a class="code" href="dfsch_2types_8h.html#9621e19e10bbf916d031fc55631f48df">DFSCH_FAST_CDR</a>(p);
<a name="l01511"></a>01511         }
<a name="l01512"></a>01512         <a class="code" href="dfsch_2types_8h.html#bb4a2056ae9d34d125eba3ac229f8ada">DFSCH_FAST_CDR_MUT</a>(e) = NULL;
<a name="l01513"></a>01513         <span class="keywordflow">if</span> (l) {
<a name="l01514"></a>01514           <a class="code" href="dfsch_2types_8h.html#bb4a2056ae9d34d125eba3ac229f8ada">DFSCH_FAST_CDR_MUT</a>(lt) = e;
<a name="l01515"></a>01515           lt = e;
<a name="l01516"></a>01516         } <span class="keywordflow">else</span> {
<a name="l01517"></a>01517           l = lt = e;
<a name="l01518"></a>01518         }
<a name="l01519"></a>01519       }
<a name="l01520"></a>01520       p = q;
<a name="l01521"></a>01521     }
<a name="l01522"></a>01522     k *= 2;
<a name="l01523"></a>01523   } <span class="keywordflow">while</span>(nmerges &gt; 1);
<a name="l01524"></a>01524 
<a name="l01525"></a>01525   <span class="keywordflow">return</span> l;
<a name="l01526"></a>01526 }
<a name="l01527"></a>01527 
<a name="l01528"></a>01528 
<a name="l01529"></a>01529 <span class="comment">// Alists </span>
<a name="l01530"></a>01530 
<a name="l01531"></a><a class="code" href="dfsch_8c.html#b1ee0b70025339d735c11353a59111ff">01531</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8h.html#b1ee0b70025339d735c11353a59111ff">dfsch_assoc</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a> *key,
<a name="l01532"></a>01532                             <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a> *alist){
<a name="l01533"></a>01533   <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* i;
<a name="l01534"></a>01534   
<a name="l01535"></a>01535 
<a name="l01536"></a>01536   i=alist;
<a name="l01537"></a>01537   
<a name="l01538"></a>01538   <span class="keywordflow">while</span> (<a class="code" href="dfsch_2types_8h.html#6ec0a17695d07350d56eaffe994e29f4">DFSCH_PAIR_P</a>(i)){
<a name="l01539"></a>01539     <span class="keywordflow">if</span> (!<a class="code" href="dfsch_2types_8h.html#6ec0a17695d07350d56eaffe994e29f4">DFSCH_PAIR_P</a>(<a class="code" href="dfsch_2types_8h.html#873da07e10c696bf321a42629cdb863e">DFSCH_FAST_CAR</a>(i))){
<a name="l01540"></a>01540       <a class="code" href="dfsch_8h.html#646ee34c82a726fdc33d8a28af39270a">dfsch_error</a>(<span class="stringliteral">"Not a alist"</span>,(<a class="code" href="structdfsch__object__t.html">object_t</a>*)alist);
<a name="l01541"></a>01541     }
<a name="l01542"></a>01542 
<a name="l01543"></a>01543     <span class="keywordflow">if</span> (<a class="code" href="dfsch_8h.html#bbe1fbb1fc7739ab514130fd3f6f410f">dfsch_equal_p</a>(key, <a class="code" href="dfsch_2types_8h.html#873da07e10c696bf321a42629cdb863e">DFSCH_FAST_CAR</a>(<a class="code" href="dfsch_2types_8h.html#873da07e10c696bf321a42629cdb863e">DFSCH_FAST_CAR</a>(i)))){
<a name="l01544"></a>01544       <span class="keywordflow">return</span> <a class="code" href="dfsch_2types_8h.html#873da07e10c696bf321a42629cdb863e">DFSCH_FAST_CAR</a>(i);
<a name="l01545"></a>01545     }
<a name="l01546"></a>01546     
<a name="l01547"></a>01547     i = <a class="code" href="dfsch_2types_8h.html#9621e19e10bbf916d031fc55631f48df">DFSCH_FAST_CDR</a>(i);
<a name="l01548"></a>01548   }
<a name="l01549"></a>01549 
<a name="l01550"></a>01550   <span class="keywordflow">if</span> (i){
<a name="l01551"></a>01551     <a class="code" href="dfsch_8h.html#646ee34c82a726fdc33d8a28af39270a">dfsch_error</a>(<span class="stringliteral">"Not a alist"</span>, (<a class="code" href="structdfsch__object__t.html">object_t</a>*)i);
<a name="l01552"></a>01552   }
<a name="l01553"></a>01553 
<a name="l01554"></a>01554   <span class="keywordflow">return</span> NULL;
<a name="l01555"></a>01555 
<a name="l01556"></a>01556 }
<a name="l01557"></a><a class="code" href="dfsch_8c.html#88eb743fa86a58036683bee3900b9936">01557</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8h.html#88eb743fa86a58036683bee3900b9936">dfsch_assq</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a> *key,
<a name="l01558"></a>01558                            <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a> *alist){
<a name="l01559"></a>01559   <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* i;
<a name="l01560"></a>01560   
<a name="l01561"></a>01561 
<a name="l01562"></a>01562   i=alist;
<a name="l01563"></a>01563   
<a name="l01564"></a>01564   <span class="keywordflow">while</span> (<a class="code" href="dfsch_2types_8h.html#6ec0a17695d07350d56eaffe994e29f4">DFSCH_PAIR_P</a>(i)){
<a name="l01565"></a>01565     <span class="keywordflow">if</span> (!<a class="code" href="dfsch_2types_8h.html#6ec0a17695d07350d56eaffe994e29f4">DFSCH_PAIR_P</a>(<a class="code" href="dfsch_2types_8h.html#873da07e10c696bf321a42629cdb863e">DFSCH_FAST_CAR</a>(i))){
<a name="l01566"></a>01566       <a class="code" href="dfsch_8h.html#646ee34c82a726fdc33d8a28af39270a">dfsch_error</a>(<span class="stringliteral">"Not a alist"</span>,(<a class="code" href="structdfsch__object__t.html">object_t</a>*)alist);
<a name="l01567"></a>01567     }
<a name="l01568"></a>01568 
<a name="l01569"></a>01569     <span class="keywordflow">if</span> (key == <a class="code" href="dfsch_2types_8h.html#873da07e10c696bf321a42629cdb863e">DFSCH_FAST_CAR</a>(<a class="code" href="dfsch_2types_8h.html#873da07e10c696bf321a42629cdb863e">DFSCH_FAST_CAR</a>(i))){
<a name="l01570"></a>01570       <span class="keywordflow">return</span> <a class="code" href="dfsch_2types_8h.html#873da07e10c696bf321a42629cdb863e">DFSCH_FAST_CAR</a>(i);
<a name="l01571"></a>01571     }
<a name="l01572"></a>01572     
<a name="l01573"></a>01573     i = <a class="code" href="dfsch_2types_8h.html#9621e19e10bbf916d031fc55631f48df">DFSCH_FAST_CDR</a>(i);
<a name="l01574"></a>01574   }
<a name="l01575"></a>01575 
<a name="l01576"></a>01576   <span class="keywordflow">if</span> (i){
<a name="l01577"></a>01577     <a class="code" href="dfsch_8h.html#646ee34c82a726fdc33d8a28af39270a">dfsch_error</a>(<span class="stringliteral">"Not a alist"</span>,(<a class="code" href="structdfsch__object__t.html">object_t</a>*)i);
<a name="l01578"></a>01578   }
<a name="l01579"></a>01579 
<a name="l01580"></a>01580   <span class="keywordflow">return</span> NULL;
<a name="l01581"></a>01581 }
<a name="l01582"></a><a class="code" href="dfsch_8c.html#acc585f45b2523b957ed938676d83ac6">01582</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8h.html#acc585f45b2523b957ed938676d83ac6">dfsch_assv</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a> *key,
<a name="l01583"></a>01583                            <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a> *alist){
<a name="l01584"></a>01584   <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* i;
<a name="l01585"></a>01585   
<a name="l01586"></a>01586 
<a name="l01587"></a>01587   i=alist;
<a name="l01588"></a>01588   
<a name="l01589"></a>01589   <span class="keywordflow">while</span> (<a class="code" href="dfsch_2types_8h.html#6ec0a17695d07350d56eaffe994e29f4">DFSCH_PAIR_P</a>(i)){
<a name="l01590"></a>01590     <span class="keywordflow">if</span> (!<a class="code" href="dfsch_2types_8h.html#6ec0a17695d07350d56eaffe994e29f4">DFSCH_PAIR_P</a>(<a class="code" href="dfsch_2types_8h.html#873da07e10c696bf321a42629cdb863e">DFSCH_FAST_CAR</a>(i))){
<a name="l01591"></a>01591       <a class="code" href="dfsch_8h.html#646ee34c82a726fdc33d8a28af39270a">dfsch_error</a>(<span class="stringliteral">"Not a alist"</span>,(<a class="code" href="structdfsch__object__t.html">object_t</a>*)alist);
<a name="l01592"></a>01592     }
<a name="l01593"></a>01593 
<a name="l01594"></a>01594     <span class="keywordflow">if</span> (<a class="code" href="dfsch_8h.html#f0dae085f9947e96f051e4a35ce0487d">dfsch_eqv_p</a>(key, <a class="code" href="dfsch_2types_8h.html#873da07e10c696bf321a42629cdb863e">DFSCH_FAST_CAR</a>(<a class="code" href="dfsch_2types_8h.html#873da07e10c696bf321a42629cdb863e">DFSCH_FAST_CAR</a>(i)))){
<a name="l01595"></a>01595       <span class="keywordflow">return</span> <a class="code" href="dfsch_2types_8h.html#873da07e10c696bf321a42629cdb863e">DFSCH_FAST_CAR</a>(i);
<a name="l01596"></a>01596     }
<a name="l01597"></a>01597     
<a name="l01598"></a>01598     i = <a class="code" href="dfsch_2types_8h.html#9621e19e10bbf916d031fc55631f48df">DFSCH_FAST_CDR</a>(i);
<a name="l01599"></a>01599   }
<a name="l01600"></a>01600 
<a name="l01601"></a>01601   <span class="keywordflow">if</span> (i){
<a name="l01602"></a>01602     <a class="code" href="dfsch_8h.html#646ee34c82a726fdc33d8a28af39270a">dfsch_error</a>(<span class="stringliteral">"Not a alist"</span>,(<a class="code" href="structdfsch__object__t.html">object_t</a>*)i);
<a name="l01603"></a>01603   }
<a name="l01604"></a>01604 
<a name="l01605"></a>01605   <span class="keywordflow">return</span> NULL;
<a name="l01606"></a>01606 }
<a name="l01607"></a>01607 
<a name="l01608"></a>01608 
<a name="l01609"></a>01609 
<a name="l01610"></a>01610 <span class="comment">// Symbols</span>
<a name="l01611"></a>01611 
<a name="l01612"></a><a class="code" href="dfsch_8c.html#b0bc977d3fec2517ebda1a77e1cfaecc">01612</a> <span class="preprocessor">#define HASH_BITS 10</span>
<a name="l01613"></a><a class="code" href="dfsch_8c.html#d6074dd11ab3c97c8135c43aab03ae95">01613</a> <span class="preprocessor"></span><span class="preprocessor">#define HASH_SIZE (1 &lt;&lt; HASH_BITS)</span>
<a name="l01614"></a>01614 <span class="preprocessor"></span>
<a name="l01615"></a><a class="code" href="dfsch_8c.html#22e4279714f16e4b986c81ae539ad766">01615</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structhash__entry__t.html">hash_entry_t</a> <a class="code" href="structhash__entry__t.html">hash_entry_t</a>;
<a name="l01616"></a><a class="code" href="structhash__entry__t.html">01616</a> <span class="keyword">struct </span><a class="code" href="structhash__entry__t.html">hash_entry_t</a> {
<a name="l01617"></a><a class="code" href="structhash__entry__t.html#17bca819a3d7fc93ffb17dbc045b9606">01617</a>   <a class="code" href="structdfsch____symbol__t.html">symbol_t</a>* <a class="code" href="structhash__entry__t.html#17bca819a3d7fc93ffb17dbc045b9606">entry</a>;
<a name="l01618"></a><a class="code" href="structhash__entry__t.html#7123b5a09816bb7e0aaf825e640ada2e">01618</a>   <span class="keywordtype">size_t</span> <a class="code" href="structhash__entry__t.html#7123b5a09816bb7e0aaf825e640ada2e">hash</a>;
<a name="l01619"></a><a class="code" href="structhash__entry__t.html#ded70ce501d4020e8eca47d8efd64d28">01619</a>   <a class="code" href="structhash__entry__t.html">hash_entry_t</a>* <a class="code" href="structhash__entry__t.html#ded70ce501d4020e8eca47d8efd64d28">next</a>;
<a name="l01620"></a>01620 };
<a name="l01621"></a>01621 
<a name="l01622"></a>01622 
<a name="l01623"></a>01623 <span class="comment">/*</span>
<a name="l01624"></a>01624 <span class="comment"> * ugly case-insensitive string hash used for symbols</span>
<a name="l01625"></a>01625 <span class="comment"> */</span>
<a name="l01626"></a><a class="code" href="dfsch_8c.html#1e3fac8f1d93582d776849d679f9970f">01626</a> <span class="keyword">static</span> <span class="keywordtype">size_t</span> <a class="code" href="dfsch_8c.html#1e3fac8f1d93582d776849d679f9970f">string_hash</a>(<span class="keywordtype">char</span>* <span class="keywordtype">string</span>){
<a name="l01627"></a>01627   <span class="keywordtype">size_t</span> tmp=0;
<a name="l01628"></a>01628 
<a name="l01629"></a>01629   <span class="keywordflow">while</span> (*<span class="keywordtype">string</span>){
<a name="l01630"></a>01630     <span class="keywordtype">char</span> c = *string; 
<a name="l01631"></a>01631     tmp ^= c ^ (tmp &lt;&lt; 7); 
<a name="l01632"></a>01632     tmp ^= ((size_t)c &lt;&lt; 17) ^ (tmp &gt;&gt; 11); 
<a name="l01633"></a>01633     ++string;
<a name="l01634"></a>01634   }
<a name="l01635"></a>01635 
<a name="l01636"></a>01636   <span class="keywordflow">return</span> tmp &amp; (<a class="code" href="dfsch_8c.html#d6074dd11ab3c97c8135c43aab03ae95">HASH_SIZE</a> - 1); 
<a name="l01637"></a>01637 }
<a name="l01638"></a>01638 
<a name="l01639"></a><a class="code" href="dfsch_8c.html#b1e547e9d17a05784a2f4d6d96d830f2">01639</a> <span class="keyword">static</span> <a class="code" href="structhash__entry__t.html">hash_entry_t</a>*  <a class="code" href="dfsch_8c.html#b1e547e9d17a05784a2f4d6d96d830f2">global_symbol_hash</a>[<a class="code" href="dfsch_8c.html#d6074dd11ab3c97c8135c43aab03ae95">HASH_SIZE</a>];
<a name="l01640"></a><a class="code" href="dfsch_8c.html#bd18a6443acd8f9780f76887766bc51a">01640</a> <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="dfsch_8c.html#bd18a6443acd8f9780f76887766bc51a">gsh_init</a> = 0;
<a name="l01641"></a><a class="code" href="dfsch_8c.html#55c1238905f8cd560779572ed761a9d4">01641</a> <span class="keyword">static</span> pthread_mutex_t <a class="code" href="dfsch_8c.html#55c1238905f8cd560779572ed761a9d4">symbol_lock</a> = PTHREAD_MUTEX_INITIALIZER;
<a name="l01642"></a><a class="code" href="dfsch_8c.html#cdf1a77c9610242e84312d815f6c533b">01642</a> <a class="code" href="structdfsch____symbol__t.html">dfsch__symbol_t</a> <a class="code" href="dfsch_2types_8h.html#cdf1a77c9610242e84312d815f6c533b">dfsch__static_symbols</a>[] = {
<a name="l01643"></a>01643   {<span class="stringliteral">"true"</span>},
<a name="l01644"></a>01644   {<span class="stringliteral">"quote"</span>},
<a name="l01645"></a>01645   {<span class="stringliteral">"quasiquote"</span>},
<a name="l01646"></a>01646   {<span class="stringliteral">"unquote"</span>},
<a name="l01647"></a>01647   {<span class="stringliteral">"unquote-splicing"</span>},
<a name="l01648"></a>01648   {<span class="stringliteral">"else"</span>},
<a name="l01649"></a>01649   {<span class="stringliteral">"=&gt;"</span>},
<a name="l01650"></a>01650 };
<a name="l01651"></a>01651 
<a name="l01652"></a>01652 <span class="comment">/*</span>
<a name="l01653"></a>01653 <span class="comment"> * It's possible to use rwlock here (althought such solution is not so </span>
<a name="l01654"></a>01654 <span class="comment"> * straightforward), but it seem unnecessary - most symbol creations are </span>
<a name="l01655"></a>01655 <span class="comment"> * done when reading source and in such case there will be probably only</span>
<a name="l01656"></a>01656 <span class="comment"> * one thread doing such things.</span>
<a name="l01657"></a>01657 <span class="comment"> */</span>
<a name="l01658"></a>01658 
<a name="l01659"></a><a class="code" href="dfsch_8c.html#82d33ff4620e54ff308b75384ecaa593">01659</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="dfsch_8c.html#82d33ff4620e54ff308b75384ecaa593">register_static_symbol</a>(<a class="code" href="structdfsch____symbol__t.html">symbol_t</a>* s){
<a name="l01660"></a>01660   <a class="code" href="structhash__entry__t.html">hash_entry_t</a> *e = malloc(<span class="keyword">sizeof</span>(<a class="code" href="structhash__entry__t.html">hash_entry_t</a>));
<a name="l01661"></a>01661 
<a name="l01662"></a>01662   e-&gt;<a class="code" href="structhash__entry__t.html#17bca819a3d7fc93ffb17dbc045b9606">entry</a> = s;
<a name="l01663"></a>01663   e-&gt;<a class="code" href="structhash__entry__t.html#7123b5a09816bb7e0aaf825e640ada2e">hash</a> = <a class="code" href="dfsch_8c.html#1e3fac8f1d93582d776849d679f9970f">string_hash</a>(s-&gt;<a class="code" href="structdfsch____symbol__t.html#b0665edd7cd6a8a20b6015876c9d4296">data</a>);
<a name="l01664"></a>01664 
<a name="l01665"></a>01665   e-&gt;<a class="code" href="structhash__entry__t.html#ded70ce501d4020e8eca47d8efd64d28">next</a> = global_symbol_hash[e-&gt;<a class="code" href="structhash__entry__t.html#7123b5a09816bb7e0aaf825e640ada2e">hash</a>];
<a name="l01666"></a>01666   global_symbol_hash[e-&gt;<a class="code" href="structhash__entry__t.html#7123b5a09816bb7e0aaf825e640ada2e">hash</a>] = e;
<a name="l01667"></a>01667 }
<a name="l01668"></a>01668 
<a name="l01669"></a><a class="code" href="dfsch_8c.html#c27dd9eb4f16c2ca4e729d12144e96af">01669</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="dfsch_8c.html#c27dd9eb4f16c2ca4e729d12144e96af">gsh_check_init</a>(){
<a name="l01670"></a>01670   <span class="keywordtype">int</span> i;
<a name="l01671"></a>01671   <span class="keywordflow">if</span> (gsh_init){
<a name="l01672"></a>01672     <span class="keywordflow">return</span>;
<a name="l01673"></a>01673   }
<a name="l01674"></a>01674 
<a name="l01675"></a>01675   memset(global_symbol_hash, 0, <span class="keyword">sizeof</span>(<a class="code" href="structhash__entry__t.html">hash_entry_t</a>*)*<a class="code" href="dfsch_8c.html#d6074dd11ab3c97c8135c43aab03ae95">HASH_SIZE</a>);
<a name="l01676"></a>01676   <span class="keywordflow">for</span> (i = 0; i &lt; <span class="keyword">sizeof</span>(dfsch__static_symbols)/<span class="keyword">sizeof</span>(<a class="code" href="structdfsch____symbol__t.html">symbol_t</a>); i++){
<a name="l01677"></a>01677     <a class="code" href="dfsch_8c.html#82d33ff4620e54ff308b75384ecaa593">register_static_symbol</a>(dfsch__static_symbols + i);
<a name="l01678"></a>01678   }
<a name="l01679"></a>01679   gsh_init = 1;
<a name="l01680"></a>01680 }
<a name="l01681"></a>01681 
<a name="l01682"></a><a class="code" href="dfsch_8c.html#678c4918645ba05f3c8e4e00a475a920">01682</a> <span class="keyword">static</span> <a class="code" href="structdfsch____symbol__t.html">symbol_t</a>* <a class="code" href="dfsch_8c.html#678c4918645ba05f3c8e4e00a475a920">lookup_symbol</a>(<span class="keywordtype">char</span> *symbol){
<a name="l01683"></a>01683 
<a name="l01684"></a>01684   <span class="keywordtype">size_t</span> hash = <a class="code" href="dfsch_8c.html#1e3fac8f1d93582d776849d679f9970f">string_hash</a>(symbol);
<a name="l01685"></a>01685   <a class="code" href="structhash__entry__t.html">hash_entry_t</a> *i = global_symbol_hash[hash];
<a name="l01686"></a>01686 
<a name="l01687"></a>01687   <span class="keywordflow">while</span> (i){
<a name="l01688"></a>01688     <span class="keywordflow">if</span> (i-&gt;<a class="code" href="structhash__entry__t.html#7123b5a09816bb7e0aaf825e640ada2e">hash</a> == hash &amp;&amp; strcmp(i-&gt;<a class="code" href="structhash__entry__t.html#17bca819a3d7fc93ffb17dbc045b9606">entry</a>-&gt;<a class="code" href="structdfsch____symbol__t.html#b0665edd7cd6a8a20b6015876c9d4296">data</a>, symbol)==0){
<a name="l01689"></a>01689       <span class="keywordflow">return</span> i-&gt;<a class="code" href="structhash__entry__t.html#17bca819a3d7fc93ffb17dbc045b9606">entry</a>;
<a name="l01690"></a>01690     }
<a name="l01691"></a>01691     i = i-&gt;<a class="code" href="structhash__entry__t.html#ded70ce501d4020e8eca47d8efd64d28">next</a>;
<a name="l01692"></a>01692   }
<a name="l01693"></a>01693 
<a name="l01694"></a>01694   <span class="keywordflow">return</span> NULL;
<a name="l01695"></a>01695 }
<a name="l01696"></a>01696 
<a name="l01697"></a><a class="code" href="dfsch_8c.html#6951f471e69ea2fea516413a92906e09">01697</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="dfsch_8c.html#6951f471e69ea2fea516413a92906e09">free_symbol</a>(<a class="code" href="structdfsch____symbol__t.html">symbol_t</a>* s){
<a name="l01698"></a>01698   <a class="code" href="structhash__entry__t.html">hash_entry_t</a> *i;
<a name="l01699"></a>01699   <a class="code" href="structhash__entry__t.html">hash_entry_t</a> *j;
<a name="l01700"></a>01700 
<a name="l01701"></a>01701   pthread_mutex_lock(&amp;symbol_lock);
<a name="l01702"></a>01702 
<a name="l01703"></a>01703   i = global_symbol_hash[<a class="code" href="dfsch_8c.html#1e3fac8f1d93582d776849d679f9970f">string_hash</a>(s-&gt;<a class="code" href="structdfsch____symbol__t.html#b0665edd7cd6a8a20b6015876c9d4296">data</a>)];
<a name="l01704"></a>01704   j = NULL;
<a name="l01705"></a>01705   
<a name="l01706"></a>01706   <span class="keywordflow">while</span> (i){
<a name="l01707"></a>01707     <span class="keywordflow">if</span> (i-&gt;<a class="code" href="structhash__entry__t.html#17bca819a3d7fc93ffb17dbc045b9606">entry</a> == s){
<a name="l01708"></a>01708       <span class="keywordflow">if</span> (j){
<a name="l01709"></a>01709         j-&gt;<a class="code" href="structhash__entry__t.html#ded70ce501d4020e8eca47d8efd64d28">next</a> = i-&gt;<a class="code" href="structhash__entry__t.html#ded70ce501d4020e8eca47d8efd64d28">next</a>;
<a name="l01710"></a>01710       } <span class="keywordflow">else</span> {
<a name="l01711"></a>01711         global_symbol_hash[<a class="code" href="dfsch_8c.html#1e3fac8f1d93582d776849d679f9970f">string_hash</a>(s-&gt;<a class="code" href="structdfsch____symbol__t.html#b0665edd7cd6a8a20b6015876c9d4296">data</a>)] = i-&gt;<a class="code" href="structhash__entry__t.html#ded70ce501d4020e8eca47d8efd64d28">next</a>;
<a name="l01712"></a>01712       }
<a name="l01713"></a>01713       free(i);
<a name="l01714"></a>01714       <span class="keywordflow">break</span>;
<a name="l01715"></a>01715     }
<a name="l01716"></a>01716     j = i;
<a name="l01717"></a>01717     i = i-&gt;<a class="code" href="structhash__entry__t.html#ded70ce501d4020e8eca47d8efd64d28">next</a>;
<a name="l01718"></a>01718   }
<a name="l01719"></a>01719 
<a name="l01720"></a>01720   pthread_mutex_unlock(&amp;symbol_lock);
<a name="l01721"></a>01721 
<a name="l01722"></a>01722   s-&gt;<a class="code" href="structdfsch____symbol__t.html#b0665edd7cd6a8a20b6015876c9d4296">data</a> = NULL;
<a name="l01723"></a>01723 }
<a name="l01724"></a>01724 
<a name="l01725"></a><a class="code" href="dfsch_8c.html#5db346bd89094528fd8dd526e19892c6">01725</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="dfsch_8c.html#5db346bd89094528fd8dd526e19892c6">symbol_finalizer</a>(<a class="code" href="structdfsch____symbol__t.html">symbol_t</a>* symbol, <span class="keywordtype">void</span>* cd){
<a name="l01726"></a>01726   <a class="code" href="dfsch_8c.html#6951f471e69ea2fea516413a92906e09">free_symbol</a>(symbol);
<a name="l01727"></a>01727 }
<a name="l01728"></a>01728 
<a name="l01729"></a><a class="code" href="dfsch_8c.html#c9ac5fa81091c4f9d38dc77772fc279b">01729</a> <span class="keyword">static</span> <a class="code" href="structdfsch____symbol__t.html">symbol_t</a>* <a class="code" href="dfsch_8c.html#c9ac5fa81091c4f9d38dc77772fc279b">make_symbol</a>(<span class="keywordtype">char</span> *symbol){
<a name="l01730"></a>01730   <a class="code" href="structdfsch____symbol__t.html">symbol_t</a> *s;
<a name="l01731"></a>01731   <a class="code" href="structdfsch____symbol__t.html">symbol_t</a> *f;
<a name="l01732"></a>01732 
<a name="l01733"></a>01733   s = GC_NEW(<a class="code" href="structdfsch____symbol__t.html">symbol_t</a>); <span class="comment">/* !!! free_symbol could be called by this */</span>
<a name="l01734"></a>01734   s-&gt;<a class="code" href="structdfsch____symbol__t.html#b0665edd7cd6a8a20b6015876c9d4296">data</a> = <a class="code" href="src_2util_8h.html#04a078081c17e4f61738149f6103a8be">stracpy</a>(symbol);
<a name="l01735"></a>01735 
<a name="l01736"></a>01736   pthread_mutex_lock(&amp;symbol_lock);
<a name="l01737"></a>01737 
<a name="l01738"></a>01738   f = <a class="code" href="dfsch_8c.html#678c4918645ba05f3c8e4e00a475a920">lookup_symbol</a>(symbol); 
<a name="l01739"></a>01739   <span class="keywordflow">if</span> (f){ 
<a name="l01740"></a>01740     GC_FREE(s-&gt;<a class="code" href="structdfsch____symbol__t.html#b0665edd7cd6a8a20b6015876c9d4296">data</a>);
<a name="l01741"></a>01741     GC_FREE(s);
<a name="l01742"></a>01742     pthread_mutex_unlock(&amp;symbol_lock);
<a name="l01743"></a>01743     <span class="keywordflow">return</span> f;
<a name="l01744"></a>01744   }
<a name="l01745"></a>01745 
<a name="l01746"></a>01746 
<a name="l01747"></a>01747   GC_REGISTER_FINALIZER(s, 
<a name="l01748"></a>01748                         (GC_finalization_proc)<a class="code" href="dfsch_8c.html#5db346bd89094528fd8dd526e19892c6">symbol_finalizer</a>, NULL, 
<a name="l01749"></a>01749                         NULL, NULL);
<a name="l01750"></a>01750     
<a name="l01751"></a>01751   <a class="code" href="structhash__entry__t.html">hash_entry_t</a> *e = malloc(<span class="keyword">sizeof</span>(<a class="code" href="structhash__entry__t.html">hash_entry_t</a>));
<a name="l01752"></a>01752 
<a name="l01753"></a>01753   e-&gt;<a class="code" href="structhash__entry__t.html#17bca819a3d7fc93ffb17dbc045b9606">entry</a> = s;
<a name="l01754"></a>01754   e-&gt;<a class="code" href="structhash__entry__t.html#7123b5a09816bb7e0aaf825e640ada2e">hash</a> = <a class="code" href="dfsch_8c.html#1e3fac8f1d93582d776849d679f9970f">string_hash</a>(symbol);
<a name="l01755"></a>01755 
<a name="l01756"></a>01756   e-&gt;<a class="code" href="structhash__entry__t.html#ded70ce501d4020e8eca47d8efd64d28">next</a> = global_symbol_hash[e-&gt;<a class="code" href="structhash__entry__t.html#7123b5a09816bb7e0aaf825e640ada2e">hash</a>];
<a name="l01757"></a>01757   global_symbol_hash[e-&gt;<a class="code" href="structhash__entry__t.html#7123b5a09816bb7e0aaf825e640ada2e">hash</a>] = e;
<a name="l01758"></a>01758 
<a name="l01759"></a>01759   pthread_mutex_unlock(&amp;symbol_lock);
<a name="l01760"></a>01760   
<a name="l01761"></a>01761   <span class="keywordflow">return</span> s;
<a name="l01762"></a>01762 }
<a name="l01763"></a>01763 
<a name="l01764"></a><a class="code" href="dfsch_8c.html#039341e7a1ccef02ceb8d381d44d758e">01764</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8h.html#039341e7a1ccef02ceb8d381d44d758e">dfsch_gensym</a>(){
<a name="l01765"></a>01765   <a class="code" href="structdfsch____symbol__t.html">symbol_t</a> *s = GC_NEW(<a class="code" href="structdfsch____symbol__t.html">symbol_t</a>);
<a name="l01766"></a>01766 
<a name="l01767"></a>01767   s-&gt;<a class="code" href="structdfsch____symbol__t.html#b0665edd7cd6a8a20b6015876c9d4296">data</a> = NULL;
<a name="l01768"></a>01768 
<a name="l01769"></a>01769   <span class="keywordflow">return</span> <a class="code" href="dfsch_2types_8h.html#61b5b7a97cb4ab963f84ed3d8ac94a51">DFSCH_TAG_ENCODE</a>(s, 2);
<a name="l01770"></a>01770 }
<a name="l01771"></a>01771 
<a name="l01772"></a><a class="code" href="dfsch_8c.html#f089f50dde23f0a132670368a9e341d5">01772</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8h.html#f089f50dde23f0a132670368a9e341d5">dfsch_make_symbol</a>(<span class="keywordtype">char</span>* symbol){
<a name="l01773"></a>01773 
<a name="l01774"></a>01774   <a class="code" href="structdfsch____symbol__t.html">symbol_t</a> *s;
<a name="l01775"></a>01775 
<a name="l01776"></a>01776   <span class="keywordflow">if</span> (!symbol){
<a name="l01777"></a>01777     <span class="keywordflow">return</span> <a class="code" href="dfsch_8h.html#039341e7a1ccef02ceb8d381d44d758e">dfsch_gensym</a>();
<a name="l01778"></a>01778   }
<a name="l01779"></a>01779 
<a name="l01780"></a>01780   pthread_mutex_lock(&amp;symbol_lock);
<a name="l01781"></a>01781 
<a name="l01782"></a>01782   <a class="code" href="dfsch_8c.html#c27dd9eb4f16c2ca4e729d12144e96af">gsh_check_init</a>(); 
<a name="l01783"></a>01783   <span class="comment">// This code is slow already, so this check does not matter (too much)</span>
<a name="l01784"></a>01784 
<a name="l01785"></a>01785   s = <a class="code" href="dfsch_8c.html#678c4918645ba05f3c8e4e00a475a920">lookup_symbol</a>(symbol);
<a name="l01786"></a>01786 
<a name="l01787"></a>01787   pthread_mutex_unlock(&amp;symbol_lock);
<a name="l01788"></a>01788 
<a name="l01789"></a>01789   <span class="keywordflow">if</span> (!s)
<a name="l01790"></a>01790     s = <a class="code" href="dfsch_8c.html#c9ac5fa81091c4f9d38dc77772fc279b">make_symbol</a>(symbol);
<a name="l01791"></a>01791 
<a name="l01792"></a>01792   <span class="keywordflow">return</span> <a class="code" href="dfsch_2types_8h.html#61b5b7a97cb4ab963f84ed3d8ac94a51">DFSCH_TAG_ENCODE</a>(s, 2);
<a name="l01793"></a>01793 
<a name="l01794"></a>01794 }
<a name="l01795"></a><a class="code" href="dfsch_8c.html#952727ed3e9a4e7408c975ed5aaedc7f">01795</a> <span class="keywordtype">char</span>* <a class="code" href="dfsch_8h.html#952727ed3e9a4e7408c975ed5aaedc7f">dfsch_symbol</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* symbol){
<a name="l01796"></a>01796   <span class="keywordflow">return</span> ((<a class="code" href="structdfsch____symbol__t.html">symbol_t</a>*)<a class="code" href="dfsch_2types_8h.html#723dc3032e2859270937a020df018c8f">DFSCH_TAG_REF</a>(<a class="code" href="dfsch_2types_8h.html#f9b3a4b9a5fe6a12721504cd292a3327">DFSCH_ASSERT_TYPE</a>(symbol, <a class="code" href="dfsch_8c.html#5f9ae9ce6aa6f82108b260135b2e63a0">SYMBOL</a>)))-&gt;data;
<a name="l01797"></a>01797 }
<a name="l01798"></a>01798 
<a name="l01799"></a><a class="code" href="dfsch_8c.html#ae660a2b9b06ba48cc8b21be847d45b1">01799</a> <span class="keywordtype">char</span>* <a class="code" href="dfsch_8h.html#ae660a2b9b06ba48cc8b21be847d45b1">dfsch_symbol_2_typename</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* symbol){
<a name="l01800"></a>01800   <span class="keywordtype">char</span> *name;
<a name="l01801"></a>01801   <span class="keywordtype">char</span> *flt;
<a name="l01802"></a>01802 
<a name="l01803"></a>01803   name = <a class="code" href="dfsch_8h.html#952727ed3e9a4e7408c975ed5aaedc7f">dfsch_symbol</a>(symbol);
<a name="l01804"></a>01804 
<a name="l01805"></a>01805   <span class="keywordflow">if</span> (name[strlen(name)-1] == <span class="charliteral">'&gt;'</span>){
<a name="l01806"></a>01806     flt = strchr(name, <span class="charliteral">'&lt;'</span>);
<a name="l01807"></a>01807     <span class="keywordflow">if</span> (flt){
<a name="l01808"></a>01808       <span class="keywordflow">if</span> (flt == name){
<a name="l01809"></a>01809         <span class="keywordflow">return</span> <a class="code" href="src_2util_8h.html#9cc85fe59192cd7d2eaae76882c174d9">strancpy</a>(name+1, strlen(name) - 2);
<a name="l01810"></a>01810       } <span class="keywordflow">else</span> {
<a name="l01811"></a>01811         <span class="keywordflow">return</span> <a class="code" href="src_2util_8h.html#cbb80460be0945591e89551df77d8b7d">strancat</a>(name, flt - name, flt+1, strlen(flt+1)-1);
<a name="l01812"></a>01812       }
<a name="l01813"></a>01813     }
<a name="l01814"></a>01814   }
<a name="l01815"></a>01815 
<a name="l01816"></a>01816   <span class="keywordflow">return</span> name;
<a name="l01817"></a>01817 }
<a name="l01818"></a>01818 
<a name="l01819"></a>01819 
<a name="l01820"></a>01820 
<a name="l01821"></a><a class="code" href="dfsch_8c.html#bf4e20ee44c29a43ac2c642da5940674">01821</a> <span class="keywordtype">int</span> <a class="code" href="dfsch_8h.html#bf4e20ee44c29a43ac2c642da5940674">dfsch_compare_symbol</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* symbol,
<a name="l01822"></a>01822                          <span class="keywordtype">char</span>* <span class="keywordtype">string</span>){
<a name="l01823"></a>01823   <span class="keywordflow">return</span> (<a class="code" href="src_2util_8h.html#0202e34456d2afa82431835aefa51011">ascii_strcasecmp</a>(<span class="keywordtype">string</span>, <a class="code" href="dfsch_8h.html#952727ed3e9a4e7408c975ed5aaedc7f">dfsch_symbol</a>(symbol)) == 0);
<a name="l01824"></a>01824 }
<a name="l01825"></a>01825 
<a name="l01826"></a><a class="code" href="dfsch_8c.html#983a28126fe9d43b78523d5e0f303acb">01826</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8h.html#983a28126fe9d43b78523d5e0f303acb">dfsch_bool</a>(<span class="keywordtype">int</span> <span class="keywordtype">bool</span>){
<a name="l01827"></a>01827   <span class="keywordflow">return</span> <span class="keywordtype">bool</span> ? <a class="code" href="dfsch_2types_8h.html#8ed8bdc644ca6b847dca5b074eba29a0">DFSCH_SYM_TRUE</a> : NULL;
<a name="l01828"></a>01828 }
<a name="l01829"></a>01829 
<a name="l01830"></a><a class="code" href="structdfsch__symbol__iter__t.html">01830</a> <span class="keyword">struct </span><a class="code" href="structdfsch__symbol__iter__t.html">dfsch_symbol_iter_t</a>{
<a name="l01831"></a><a class="code" href="structdfsch__symbol__iter__t.html#fb069833ce97d9f03552fc82230745a0">01831</a>   <a class="code" href="structhash__entry__t.html">hash_entry_t</a>* <a class="code" href="structdfsch__symbol__iter__t.html#fb069833ce97d9f03552fc82230745a0">item</a>;
<a name="l01832"></a><a class="code" href="structdfsch__symbol__iter__t.html#7e20905cbe7a9109d995daf507dd913d">01832</a>   <span class="keywordtype">size_t</span> <a class="code" href="structdfsch__symbol__iter__t.html#7e20905cbe7a9109d995daf507dd913d">bucket</a>;
<a name="l01833"></a>01833 };
<a name="l01834"></a>01834 
<a name="l01835"></a><a class="code" href="dfsch_8c.html#9e55d755664179de08ba62d44577bb6b">01835</a> <span class="keywordtype">char</span>* <a class="code" href="dfsch_8h.html#9e55d755664179de08ba62d44577bb6b">dfsch_get_next_symbol</a>(<a class="code" href="structdfsch__symbol__iter__t.html">dfsch_symbol_iter_t</a> **iter){ <span class="comment">// deep magic</span>
<a name="l01836"></a>01836   <span class="keywordflow">if</span> (*iter == NULL){
<a name="l01837"></a>01837     *iter = GC_MALLOC(<span class="keyword">sizeof</span>(<a class="code" href="structdfsch__symbol__iter__t.html">dfsch_symbol_iter_t</a>));
<a name="l01838"></a>01838     (*iter)-&gt;bucket = 0;
<a name="l01839"></a>01839     (*iter)-&gt;item = global_symbol_hash[(*iter)-&gt;bucket];
<a name="l01840"></a>01840   }
<a name="l01841"></a>01841   <span class="keywordflow">while</span> ((*iter)-&gt;bucket &lt; <a class="code" href="dfsch_8c.html#d6074dd11ab3c97c8135c43aab03ae95">HASH_SIZE</a>){
<a name="l01842"></a>01842     <span class="keywordflow">if</span> (!(*iter)-&gt;item){
<a name="l01843"></a>01843       (*iter)-&gt;bucket ++;
<a name="l01844"></a>01844       (*iter)-&gt;item = global_symbol_hash[(*iter)-&gt;bucket];
<a name="l01845"></a>01845     }<span class="keywordflow">else</span>{
<a name="l01846"></a>01846       <a class="code" href="structhash__entry__t.html">hash_entry_t</a> *i = (*iter)-&gt;item;
<a name="l01847"></a>01847       (*iter)-&gt;item = (*iter)-&gt;item-&gt;<a class="code" href="structhash__entry__t.html#ded70ce501d4020e8eca47d8efd64d28">next</a>;
<a name="l01848"></a>01848       <span class="keywordflow">return</span> i-&gt;<a class="code" href="structhash__entry__t.html#17bca819a3d7fc93ffb17dbc045b9606">entry</a>-&gt;<a class="code" href="structdfsch____symbol__t.html#b0665edd7cd6a8a20b6015876c9d4296">data</a>;
<a name="l01849"></a>01849     }
<a name="l01850"></a>01850   }  
<a name="l01851"></a>01851   <span class="keywordflow">return</span> NULL;
<a name="l01852"></a>01852 }
<a name="l01853"></a>01853 
<a name="l01854"></a>01854 
<a name="l01855"></a>01855 <span class="comment">// closures</span>
<a name="l01856"></a>01856 
<a name="l01857"></a><a class="code" href="dfsch_8c.html#7b0d46958e4a4d4d441ea22f0008cb3b">01857</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8h.html#7b0d46958e4a4d4d441ea22f0008cb3b">dfsch_named_lambda</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* env,
<a name="l01858"></a>01858                                    <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* args,
<a name="l01859"></a>01859                                    <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* code,
<a name="l01860"></a>01860                                    <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* name){
<a name="l01861"></a>01861   <a class="code" href="structclosure__t.html">closure_t</a> *c = (<a class="code" href="structclosure__t.html">closure_t</a>*)<a class="code" href="dfsch_8h.html#8aa9f840eedefa1a63cbce47cee49547">dfsch_make_object</a>(<a class="code" href="dfsch_2types_8h.html#ff428d311e2ce0959378f161d056deb4">DFSCH_STANDARD_FUNCTION_TYPE</a>);
<a name="l01862"></a>01862   
<a name="l01863"></a>01863   c-&gt;<a class="code" href="structclosure__t.html#5ca6e70e6475837f5b7aec1736b15cc3">env</a> = <a class="code" href="dfsch_2types_8h.html#f9b3a4b9a5fe6a12721504cd292a3327">DFSCH_ASSERT_TYPE</a>(env, <a class="code" href="dfsch_2types_8h.html#e0e9762c5177d0b4932e47f39c924e22">DFSCH_ENVIRONMENT_TYPE</a>);
<a name="l01864"></a>01864   c-&gt;<a class="code" href="structclosure__t.html#594081508db00585cb0354b10fc72821">args</a> = (<a class="code" href="structlambda__list__t.html">lambda_list_t</a>*)<a class="code" href="dfsch_8h.html#f2ab6203cb4fc3a0c7bb25116da486a2">dfsch_compile_lambda_list</a>(args);
<a name="l01865"></a>01865   c-&gt;<a class="code" href="structclosure__t.html#1451b76b7a926e199d48451a2adbb662">orig_code</a> = code;
<a name="l01866"></a>01866 
<a name="l01867"></a>01867   <span class="keywordflow">if</span> (<a class="code" href="dfsch_2types_8h.html#6ec0a17695d07350d56eaffe994e29f4">DFSCH_PAIR_P</a>(code) &amp;&amp; <a class="code" href="strings_8h.html#a4792e06df471746454c8ba57c9decac">dfsch_string_p</a>(<a class="code" href="dfsch_2types_8h.html#873da07e10c696bf321a42629cdb863e">DFSCH_FAST_CAR</a>(code))){
<a name="l01868"></a>01868     c-&gt;<a class="code" href="structclosure__t.html#32b0400a0b8320d2b4690676e0f89a37">code</a> = <a class="code" href="dfsch_2types_8h.html#9621e19e10bbf916d031fc55631f48df">DFSCH_FAST_CDR</a>(code);
<a name="l01869"></a>01869     c-&gt;<a class="code" href="structclosure__t.html#3dfa656b89bf8cfac8d0ee6560435b5c">documentation</a> = <a class="code" href="dfsch_2types_8h.html#873da07e10c696bf321a42629cdb863e">DFSCH_FAST_CAR</a>(code);
<a name="l01870"></a>01870   } <span class="keywordflow">else</span> {
<a name="l01871"></a>01871     c-&gt;<a class="code" href="structclosure__t.html#32b0400a0b8320d2b4690676e0f89a37">code</a> = code;
<a name="l01872"></a>01872     c-&gt;<a class="code" href="structclosure__t.html#3dfa656b89bf8cfac8d0ee6560435b5c">documentation</a> = NULL;
<a name="l01873"></a>01873   }
<a name="l01874"></a>01874 
<a name="l01875"></a>01875   c-&gt;<a class="code" href="structclosure__t.html#aa8bf4ebdcad7fad6aed010b8d51f1f7">name</a> = name;
<a name="l01876"></a>01876 
<a name="l01877"></a>01877   <span class="keywordflow">return</span> (<a class="code" href="structdfsch__object__t.html">object_t</a>*)c;
<a name="l01878"></a>01878 }
<a name="l01879"></a>01879 
<a name="l01880"></a><a class="code" href="dfsch_8c.html#6fb4d7fcc992e1f3ae7ab44407f94ca1">01880</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8h.html#6fb4d7fcc992e1f3ae7ab44407f94ca1">dfsch_lambda</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* env,
<a name="l01881"></a>01881                              <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* args,
<a name="l01882"></a>01882                              <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* code){
<a name="l01883"></a>01883 
<a name="l01884"></a>01884   <span class="keywordflow">return</span> <a class="code" href="dfsch_8h.html#7b0d46958e4a4d4d441ea22f0008cb3b">dfsch_named_lambda</a>(env, args, code, NULL); 
<a name="l01885"></a>01885 }
<a name="l01886"></a>01886 
<a name="l01887"></a>01887 <span class="comment">// native code</span>
<a name="l01888"></a><a class="code" href="dfsch_8c.html#4a8a9c30c8742171c2204c98e30113c9">01888</a> <a class="code" href="structdfsch__object__t.html">object_t</a>* <a class="code" href="dfsch_8h.html#e65da936bd129e8b9ece1e37b1885a30">dfsch_make_primitive</a>(<a class="code" href="dfsch_8h.html#1a5dbcd8e70580b1a019887d2b1f1fc8">dfsch_primitive_impl_t</a> prim, <span class="keywordtype">void</span> *baton){
<a name="l01889"></a>01889   <span class="keywordflow">return</span> <a class="code" href="dfsch_8h.html#28b7317a9c45ac57414865a59a446b14">dfsch_make_primitive_flags</a>(prim, baton, 0);
<a name="l01890"></a>01890 }
<a name="l01891"></a>01891 
<a name="l01892"></a><a class="code" href="dfsch_8c.html#8898fcd130387015f182b2ed5a4703fa">01892</a> <a class="code" href="structdfsch__object__t.html">object_t</a>* <a class="code" href="dfsch_8h.html#28b7317a9c45ac57414865a59a446b14">dfsch_make_primitive_flags</a>(<a class="code" href="dfsch_8h.html#1a5dbcd8e70580b1a019887d2b1f1fc8">dfsch_primitive_impl_t</a> prim, 
<a name="l01893"></a>01893                                      <span class="keywordtype">void</span> *baton, 
<a name="l01894"></a>01894                                      <span class="keywordtype">int</span> flags){
<a name="l01895"></a>01895   <a class="code" href="structdfsch__primitive__t.html">primitive_t</a>* p = (<a class="code" href="structdfsch__primitive__t.html">primitive_t</a>*)<a class="code" href="dfsch_8h.html#8aa9f840eedefa1a63cbce47cee49547">dfsch_make_object</a>(<a class="code" href="dfsch_8c.html#a0f458f5ca6cb8ca94e5f076f5b88be9">PRIMITIVE</a>);
<a name="l01896"></a>01896   <span class="keywordflow">if</span> (!p)
<a name="l01897"></a>01897     <span class="keywordflow">return</span> NULL;
<a name="l01898"></a>01898 
<a name="l01899"></a>01899   p-&gt;<a class="code" href="structdfsch__primitive__t.html#348734b5b2b7699269c64dea0d94dfe6">proc</a> = prim;
<a name="l01900"></a>01900   p-&gt;<a class="code" href="structdfsch__primitive__t.html#03be48e9c073fc24d864ba4666a11792">baton</a> = baton;
<a name="l01901"></a>01901   p-&gt;<a class="code" href="structdfsch__primitive__t.html#ced68c10da607c13a23c80cd399f2982">flags</a> = 0;
<a name="l01902"></a>01902   
<a name="l01903"></a>01903   <span class="keywordflow">return</span> (<a class="code" href="structdfsch__object__t.html">object_t</a>*)p;
<a name="l01904"></a>01904 }
<a name="l01905"></a>01905 
<a name="l01906"></a>01906 <span class="comment">// macros</span>
<a name="l01907"></a>01907 
<a name="l01908"></a><a class="code" href="dfsch_8c.html#8ec48c880215c3ac3f751b31443e2dcc">01908</a> <a class="code" href="structdfsch__object__t.html">object_t</a>* <a class="code" href="dfsch_8h.html#ed48c6d67ea870d41f284daad03731eb">dfsch_make_macro</a>(<a class="code" href="structdfsch__object__t.html">object_t</a> *proc){
<a name="l01909"></a>01909   <a class="code" href="structmacro__t.html">macro_t</a> *m = (<a class="code" href="structmacro__t.html">macro_t</a>*)<a class="code" href="dfsch_8h.html#8aa9f840eedefa1a63cbce47cee49547">dfsch_make_object</a>(<a class="code" href="dfsch_8c.html#824c99cb152a3c2e9111a2cb9c34891e">MACRO</a>);
<a name="l01910"></a>01910   
<a name="l01911"></a>01911   <span class="keywordflow">if</span> (!m)
<a name="l01912"></a>01912     <span class="keywordflow">return</span> NULL;
<a name="l01913"></a>01913 
<a name="l01914"></a>01914   m-&gt;<a class="code" href="structmacro__t.html#3b343b63122c9ae4f2619cb5da4ee76c">proc</a> = proc;
<a name="l01915"></a>01915 
<a name="l01916"></a>01916   <span class="keywordflow">return</span> (<a class="code" href="structdfsch__object__t.html">object_t</a>*)m;
<a name="l01917"></a>01917 }
<a name="l01918"></a><a class="code" href="dfsch_8c.html#45f9a3faec1078bf8c66aad1fce3bf2f">01918</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8h.html#45f9a3faec1078bf8c66aad1fce3bf2f">dfsch_make_form</a>(<a class="code" href="dfsch_2types_8h.html#c864010b7df92e71c021c142cd1e8d4f">dfsch_form_impl_t</a> impl,
<a name="l01919"></a>01919                                 <span class="keywordtype">void</span>* baton,
<a name="l01920"></a>01920                                 <span class="keywordtype">char</span>* name){
<a name="l01921"></a>01921   <a class="code" href="structdfsch__form__t.html">dfsch_form_t</a> *f = (<a class="code" href="structdfsch__form__t.html">dfsch_form_t</a>*)<a class="code" href="dfsch_8h.html#8aa9f840eedefa1a63cbce47cee49547">dfsch_make_object</a>(<a class="code" href="dfsch_8c.html#ff4519d858ed63ac8308bb4f95d7afa4">FORM</a>);
<a name="l01922"></a>01922   
<a name="l01923"></a>01923   f-&gt;<a class="code" href="structdfsch__form__t.html#1555af14799dbe591e1047a426a3da48">impl</a> = impl;
<a name="l01924"></a>01924   f-&gt;<a class="code" href="structdfsch__form__t.html#858a4006ae7a8b6d97cf9035601773e6">baton</a> = baton;
<a name="l01925"></a>01925   f-&gt;<a class="code" href="structdfsch__form__t.html#4a2f2180aea944297cd3fc05cc2d6217">name</a> = name;
<a name="l01926"></a>01926 
<a name="l01927"></a>01927   <span class="keywordflow">return</span> (<a class="code" href="structdfsch__object__t.html">object_t</a>*)f;
<a name="l01928"></a>01928 }
<a name="l01929"></a>01929 
<a name="l01930"></a>01930 
<a name="l01931"></a><a class="code" href="dfsch_8c.html#8f57932ffa3e6ede0cfdd67b1c08d6ff">01931</a> <span class="keyword">static</span> pthread_key_t <a class="code" href="dfsch_8c.html#8f57932ffa3e6ede0cfdd67b1c08d6ff">thread_key</a>;
<a name="l01932"></a><a class="code" href="dfsch_8c.html#caa0ac73e7e7e0b8c171e0e1eb055743">01932</a> <span class="keyword">static</span> pthread_once_t <a class="code" href="dfsch_8c.html#caa0ac73e7e7e0b8c171e0e1eb055743">thread_once</a> = PTHREAD_ONCE_INIT;
<a name="l01933"></a>01933 
<a name="l01934"></a><a class="code" href="dfsch_8c.html#443248dc650f0ae5b71e4b6156f82500">01934</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="dfsch_8c.html#443248dc650f0ae5b71e4b6156f82500">thread_info_destroy</a>(<span class="keywordtype">void</span>* ptr){
<a name="l01935"></a>01935   <span class="keywordflow">if</span> (ptr)
<a name="l01936"></a>01936     GC_FREE(ptr);
<a name="l01937"></a>01937 }
<a name="l01938"></a><a class="code" href="dfsch_8c.html#aa5e6f9e691dc46c3d9a5f7a5cbf3f48">01938</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="dfsch_8c.html#aa5e6f9e691dc46c3d9a5f7a5cbf3f48">thread_key_alloc</a>(){
<a name="l01939"></a>01939   pthread_key_create(&amp;thread_key, <a class="code" href="dfsch_8c.html#443248dc650f0ae5b71e4b6156f82500">thread_info_destroy</a>);
<a name="l01940"></a>01940 }
<a name="l01941"></a>01941 
<a name="l01942"></a><a class="code" href="dfsch_8c.html#edbd54a78d3a5bd72c49311f929810c3">01942</a> <span class="keywordtype">int</span> <a class="code" href="dfsch_8c.html#edbd54a78d3a5bd72c49311f929810c3">dfsch_default_trace_depth</a> = 3;
<a name="l01943"></a>01943 
<a name="l01944"></a><a class="code" href="dfsch_8c.html#90708990153b32107b5fbc79414a7622">01944</a> <span class="keyword">static</span> <a class="code" href="structdfsch____tracepoint__t.html">dfsch__tracepoint_t</a>* <a class="code" href="dfsch_8c.html#90708990153b32107b5fbc79414a7622">alloc_trace_buffer</a>(<a class="code" href="structdfsch____thread__info__t.html">dfsch__thread_info_t</a>* ti,
<a name="l01945"></a>01945                                                <span class="keywordtype">int</span> depth){
<a name="l01946"></a>01946   <span class="keywordtype">size_t</span> size;
<a name="l01947"></a>01947   depth = depth % (8 * <span class="keyword">sizeof</span>(short));
<a name="l01948"></a>01948   size = 1 &lt;&lt; depth;
<a name="l01949"></a>01949   ti-&gt;<a class="code" href="structdfsch____thread__info__t.html#3fc949b2d5d482d276b5febc4c3579cd">trace_depth</a> = size - 1;
<a name="l01950"></a>01950   ti-&gt;<a class="code" href="structdfsch____thread__info__t.html#d788040f25d98421a683dc20e6b22483">trace_ptr</a> = 0;
<a name="l01951"></a>01951   ti-&gt;<a class="code" href="structdfsch____thread__info__t.html#d8da261513955ada0551f68de0a8a1c4">trace_buffer</a> = GC_MALLOC(<span class="keyword">sizeof</span>(<a class="code" href="structdfsch____tracepoint__t.html">dfsch__tracepoint_t</a>) * size);
<a name="l01952"></a>01952 }
<a name="l01953"></a>01953 
<a name="l01954"></a><a class="code" href="dfsch_8c.html#04b33f56258adffd197b27d210525b83">01954</a> <a class="code" href="structdfsch____thread__info__t.html">dfsch__thread_info_t</a>* <a class="code" href="magic_8h.html#04b33f56258adffd197b27d210525b83">dfsch__get_thread_info</a>(){
<a name="l01955"></a>01955 <span class="preprocessor">#ifdef DFSCH__USE_TLS____BROKEN</span>
<a name="l01956"></a>01956 <span class="preprocessor"></span>  <span class="keyword">static</span> __thread <a class="code" href="structdfsch____thread__info__t.html">dfsch__thread_info_t</a>* ei;
<a name="l01957"></a>01957 <span class="preprocessor">#else</span>
<a name="l01958"></a>01958 <span class="preprocessor"></span>  <a class="code" href="structdfsch____thread__info__t.html">dfsch__thread_info_t</a> *ei;
<a name="l01959"></a>01959   pthread_once(&amp;thread_once, <a class="code" href="dfsch_8c.html#aa5e6f9e691dc46c3d9a5f7a5cbf3f48">thread_key_alloc</a>);
<a name="l01960"></a>01960   ei = pthread_getspecific(thread_key);
<a name="l01961"></a>01961 <span class="preprocessor">#endif</span>
<a name="l01962"></a>01962 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (<a class="code" href="defines_8h.html#9d3fca805f1a5348d2cb5488cab8d3d8">DFSCH_UNLIKELY</a>(!ei)){
<a name="l01963"></a>01963     ei = GC_MALLOC_UNCOLLECTABLE(<span class="keyword">sizeof</span>(<a class="code" href="structdfsch____thread__info__t.html">dfsch__thread_info_t</a>)); 
<a name="l01964"></a>01964     ei-&gt;<a class="code" href="structdfsch____thread__info__t.html#ab9b0e2e0532f74ef10c5db2a6cf1d88">throw_ret</a> = NULL;
<a name="l01965"></a>01965     ei-&gt;<a class="code" href="structdfsch____thread__info__t.html#bca619363e8adc96a32a271d637a44dd">async_apply</a> = NULL;
<a name="l01966"></a>01966     <a class="code" href="dfsch_8c.html#90708990153b32107b5fbc79414a7622">alloc_trace_buffer</a>(ei, dfsch_default_trace_depth);
<a name="l01967"></a>01967     pthread_setspecific(thread_key, ei);
<a name="l01968"></a>01968   }
<a name="l01969"></a>01969   <span class="keywordflow">return</span> ei;
<a name="l01970"></a>01970 }
<a name="l01971"></a>01971 
<a name="l01972"></a>01972 <span class="comment">/*</span>
<a name="l01973"></a>01973 <span class="comment"> * It seems so volatile really isn't needed around this magic, only automatic</span>
<a name="l01974"></a>01974 <span class="comment"> * variables that have been _CHANGED_ since call to setjmp(3) are indeterminate</span>
<a name="l01975"></a>01975 <span class="comment"> * and there are none such. Actually only thing that happen in these functions</span>
<a name="l01976"></a>01976 <span class="comment"> * between setjmp(3) and opportunity to call longjmp(3) (from corresponding </span>
<a name="l01977"></a>01977 <span class="comment"> * wrapper function) is function call. This is only case of undefined behavior</span>
<a name="l01978"></a>01978 <span class="comment"> * related to "proper" use of setjmp(3)/longjmp(3) in IEEE 1003.1.</span>
<a name="l01979"></a>01979 <span class="comment"> */</span>
<a name="l01980"></a>01980 
<a name="l01981"></a><a class="code" href="dfsch_8c.html#8cc05af0d7897f559989afb4b8415b38">01981</a> <span class="keywordtype">void</span> <a class="code" href="magic_8h.html#4365414e385901de9b93f012a3c6e89e">dfsch__continue_unwind</a>(<a class="code" href="structdfsch____thread__info__t.html">dfsch__thread_info_t</a>* ti){
<a name="l01982"></a>01982   <span class="keywordflow">if</span> (!ti-&gt;<a class="code" href="structdfsch____thread__info__t.html#ab9b0e2e0532f74ef10c5db2a6cf1d88">throw_ret</a>){
<a name="l01983"></a>01983     fputs(<span class="stringliteral">"No unwind target!!!\n"</span>, stderr);
<a name="l01984"></a>01984     abort();
<a name="l01985"></a>01985   }
<a name="l01986"></a>01986   longjmp(*ti-&gt;<a class="code" href="structdfsch____thread__info__t.html#ab9b0e2e0532f74ef10c5db2a6cf1d88">throw_ret</a>, 1);
<a name="l01987"></a>01987 }
<a name="l01988"></a><a class="code" href="dfsch_8c.html#89bcdcd0a601c647afec715b299056b9">01988</a> <span class="keywordtype">void</span> <a class="code" href="magic_8h.html#7e8ee6f5f9d73dc09139c726bc3f9a51">dfsch__finalize_unwind</a>(<a class="code" href="structdfsch____thread__info__t.html">dfsch__thread_info_t</a>* ti){
<a name="l01989"></a>01989   ti-&gt;<a class="code" href="structdfsch____thread__info__t.html#4348b83383cb5104ff4a6588928e7ccb">throw_tag</a> = NULL;
<a name="l01990"></a>01990   ti-&gt;<a class="code" href="structdfsch____thread__info__t.html#ef4b331ee3330c1553ad85e9ca6400b9">throw_value</a> = NULL;
<a name="l01991"></a>01991 }
<a name="l01992"></a>01992 
<a name="l01993"></a><a class="code" href="dfsch_8c.html#6d586ee267fc170379f27ccfe778696b">01993</a> <span class="keywordtype">void</span> <a class="code" href="dfsch_8h.html#6d586ee267fc170379f27ccfe778696b">dfsch_throw</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* tag,
<a name="l01994"></a>01994                  <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* value){
<a name="l01995"></a>01995   <a class="code" href="structdfsch____thread__info__t.html">dfsch__thread_info_t</a> *ti = <a class="code" href="magic_8h.html#04b33f56258adffd197b27d210525b83">dfsch__get_thread_info</a>();
<a name="l01996"></a>01996   <a class="code" href="structdfsch____catch__list__t.html">dfsch__catch_list_t</a>* i = ti-&gt;<a class="code" href="structdfsch____thread__info__t.html#107c7753892238baceb7652dd1fc3e8f">catch_list</a>;
<a name="l01997"></a>01997   <span class="keywordflow">while</span> (i){
<a name="l01998"></a>01998     <span class="keywordflow">if</span> (i-&gt;<a class="code" href="structdfsch____catch__list__t.html#c137f35bc40a32abc3bbc557c4aed54d">tag</a> == tag){
<a name="l01999"></a>01999       ti-&gt;<a class="code" href="structdfsch____thread__info__t.html#4348b83383cb5104ff4a6588928e7ccb">throw_tag</a> = tag;
<a name="l02000"></a>02000       ti-&gt;<a class="code" href="structdfsch____thread__info__t.html#ef4b331ee3330c1553ad85e9ca6400b9">throw_value</a> = value;
<a name="l02001"></a>02001       <a class="code" href="magic_8h.html#4365414e385901de9b93f012a3c6e89e">dfsch__continue_unwind</a>(ti);
<a name="l02002"></a>02002     }
<a name="l02003"></a>02003     i = i-&gt;<a class="code" href="structdfsch____catch__list__t.html#115f33274c35cbfdf336069e6d6d7d6a">next</a>;
<a name="l02004"></a>02004   }
<a name="l02005"></a>02005   <a class="code" href="dfsch_8h.html#646ee34c82a726fdc33d8a28af39270a">dfsch_error</a>(<span class="stringliteral">"Invalid catch tag"</span>, tag);
<a name="l02006"></a>02006 }
<a name="l02007"></a>02007 
<a name="l02008"></a><a class="code" href="dfsch_8c.html#c33f959e68991468cd8f7deda21d7c88">02008</a> <span class="keywordtype">void</span> <a class="code" href="dfsch_8h.html#646ee34c82a726fdc33d8a28af39270a">dfsch_error</a>(<span class="keywordtype">char</span>* name, 
<a name="l02009"></a>02009                  <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* detail){
<a name="l02010"></a>02010   <a class="code" href="conditions_8h.html#98694b59dec57ff76083c5dfd36f24c4">dfsch_signal</a>(<a class="code" href="conditions_8h.html#d2d05e1ea3a56e90bc98a272c5333d74">dfsch_condition</a>(<a class="code" href="conditions_8h.html#f8b9c906a1430e785268b6594adffe83">DFSCH_ERROR_TYPE</a>, 
<a name="l02011"></a>02011                                <span class="stringliteral">"message"</span>, <a class="code" href="strings_8h.html#537f9a00a23ad18b6dffb9a9c00f5a30">dfsch_make_string_cstr</a>(name),
<a name="l02012"></a>02012                                <span class="stringliteral">"object"</span>, detail,
<a name="l02013"></a>02013                                NULL));
<a name="l02014"></a>02014 }
<a name="l02015"></a><a class="code" href="dfsch_8c.html#80cc2e0330c6b833bba7b0c27287be35">02015</a> <span class="keywordtype">void</span> <a class="code" href="dfsch_8h.html#49759b8796fdf85468fef24a4c1d76e1">dfsch_cerror</a>(<span class="keywordtype">char</span>* name, 
<a name="l02016"></a>02016                   <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* detail){
<a name="l02017"></a>02017   <a class="code" href="magic_8h.html#8cf0748c84bf847e47af5cd928d6278d">DFSCH_WITH_SIMPLE_RESTART</a>(<a class="code" href="dfsch_8h.html#f089f50dde23f0a132670368a9e341d5">dfsch_make_symbol</a>(<span class="stringliteral">"continue"</span>),
<a name="l02018"></a>02018                             <span class="stringliteral">"Ignore error condition"</span>){
<a name="l02019"></a>02019     <a class="code" href="conditions_8h.html#98694b59dec57ff76083c5dfd36f24c4">dfsch_signal</a>(<a class="code" href="conditions_8h.html#d2d05e1ea3a56e90bc98a272c5333d74">dfsch_condition</a>(<a class="code" href="conditions_8h.html#f8b9c906a1430e785268b6594adffe83">DFSCH_ERROR_TYPE</a>, 
<a name="l02020"></a>02020                                  <span class="stringliteral">"message"</span>, <a class="code" href="strings_8h.html#537f9a00a23ad18b6dffb9a9c00f5a30">dfsch_make_string_cstr</a>(name),
<a name="l02021"></a>02021                                  <span class="stringliteral">"object"</span>, detail,
<a name="l02022"></a>02022                                  NULL));
<a name="l02023"></a>02023   } <a class="code" href="magic_8h.html#5315c4b0077a3ceba0b115828011e7f0">DFSCH_END_WITH_SIMPLE_RESTART</a>;
<a name="l02024"></a>02024 }
<a name="l02025"></a>02025 
<a name="l02026"></a><a class="code" href="dfsch_8c.html#baf66ef59a04cc12ca339701be3d2205">02026</a> <span class="keywordtype">void</span> <a class="code" href="dfsch_8h.html#baf66ef59a04cc12ca339701be3d2205">dfsch_async_apply_self</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* proc){
<a name="l02027"></a>02027   <a class="code" href="magic_8h.html#04b33f56258adffd197b27d210525b83">dfsch__get_thread_info</a>()-&gt;<a class="code" href="structdfsch____thread__info__t.html#bca619363e8adc96a32a271d637a44dd">async_apply</a> = proc;
<a name="l02028"></a>02028 }
<a name="l02029"></a>02029 
<a name="l02030"></a>02030 <span class="comment">// Vectors</span>
<a name="l02031"></a>02031 
<a name="l02032"></a><a class="code" href="dfsch_8c.html#9faa1445e2316a3fd5609318422b3729">02032</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8h.html#9faa1445e2316a3fd5609318422b3729">dfsch_make_vector</a>(<span class="keywordtype">size_t</span> length, <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* fill){
<a name="l02033"></a>02033   <a class="code" href="structvector__t.html">vector_t</a>* v;
<a name="l02034"></a>02034   <span class="keywordtype">size_t</span> i;
<a name="l02035"></a>02035 
<a name="l02036"></a>02036   v = (<a class="code" href="structvector__t.html">vector_t</a>*)<a class="code" href="dfsch_8c.html#701b0d85fa7104aa9b1efb76e68bc3a7">dfsch_make_object_var</a>(<a class="code" href="dfsch_8c.html#c6e89954deaa373db52a91ac6db50884">VECTOR</a>, 
<a name="l02037"></a>02037                                        length * <span class="keyword">sizeof</span>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>*));
<a name="l02038"></a>02038   v-&gt;<a class="code" href="structvector__t.html#fc0402ca1ef07006c7a28840ff092e97">length</a> = length;
<a name="l02039"></a>02039 
<a name="l02040"></a>02040   <span class="keywordflow">for</span>(i = 0; i&lt;length; ++i){
<a name="l02041"></a>02041     v-&gt;<a class="code" href="structvector__t.html#2976e8b5b8c21525a7f1fefafe029927">data</a>[i] = fill;
<a name="l02042"></a>02042   }
<a name="l02043"></a>02043 
<a name="l02044"></a>02044   <span class="keywordflow">return</span> (<a class="code" href="structdfsch__object__t.html">object_t</a>*)v;
<a name="l02045"></a>02045 }
<a name="l02046"></a><a class="code" href="dfsch_8c.html#25885557acc18590c3c16e2233dfb3aa">02046</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8h.html#25885557acc18590c3c16e2233dfb3aa">dfsch_vector</a>(<span class="keywordtype">size_t</span> count, ...){
<a name="l02047"></a>02047   <span class="keywordtype">size_t</span> i;
<a name="l02048"></a>02048   <a class="code" href="structvector__t.html">vector_t</a>* v = 
<a name="l02049"></a>02049     (<a class="code" href="structvector__t.html">vector_t</a>*)<a class="code" href="dfsch_8c.html#701b0d85fa7104aa9b1efb76e68bc3a7">dfsch_make_object_var</a>(<a class="code" href="dfsch_8c.html#c6e89954deaa373db52a91ac6db50884">VECTOR</a>, count * <span class="keyword">sizeof</span>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>*));
<a name="l02050"></a>02050   va_list al;
<a name="l02051"></a>02051 
<a name="l02052"></a>02052   va_start(al,count);
<a name="l02053"></a>02053 
<a name="l02054"></a>02054   v-&gt;<a class="code" href="structvector__t.html#fc0402ca1ef07006c7a28840ff092e97">length</a> = count;
<a name="l02055"></a>02055 
<a name="l02056"></a>02056   <span class="keywordflow">for</span>(i = 0; i &lt; count; ++i){
<a name="l02057"></a>02057     v-&gt;<a class="code" href="structvector__t.html#2976e8b5b8c21525a7f1fefafe029927">data</a>[i] = va_arg(al, <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>*);
<a name="l02058"></a>02058   }
<a name="l02059"></a>02059 
<a name="l02060"></a>02060   va_end(al);
<a name="l02061"></a>02061   <span class="keywordflow">return</span> (<a class="code" href="structdfsch__object__t.html">object_t</a>*)v;
<a name="l02062"></a>02062 
<a name="l02063"></a>02063 }
<a name="l02064"></a>02064 
<a name="l02065"></a><a class="code" href="dfsch_8c.html#9b9fdbeb7463f94b07c5912da3ae5752">02065</a> <span class="keywordtype">size_t</span> <a class="code" href="dfsch_8h.html#9b9fdbeb7463f94b07c5912da3ae5752">dfsch_vector_length</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a> *vector){
<a name="l02066"></a>02066   <span class="keywordflow">return</span> ((<a class="code" href="structvector__t.html">vector_t</a>*)<a class="code" href="dfsch_2types_8h.html#f9b3a4b9a5fe6a12721504cd292a3327">DFSCH_ASSERT_TYPE</a>(vector, <a class="code" href="dfsch_8c.html#c6e89954deaa373db52a91ac6db50884">VECTOR</a>))-&gt;length;  
<a name="l02067"></a>02067 }
<a name="l02068"></a>02068 
<a name="l02069"></a><a class="code" href="dfsch_8c.html#23fd67478a69ef5b1678e42a6e2b29e2">02069</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>** <a class="code" href="dfsch_8h.html#23fd67478a69ef5b1678e42a6e2b29e2">dfsch_vector_as_array</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a> *vector, <span class="keywordtype">size_t</span> *length){
<a name="l02070"></a>02070   <a class="code" href="structvector__t.html">vector_t</a>* v = <a class="code" href="dfsch_2types_8h.html#f9b3a4b9a5fe6a12721504cd292a3327">DFSCH_ASSERT_TYPE</a>(vector, <a class="code" href="dfsch_8c.html#c6e89954deaa373db52a91ac6db50884">VECTOR</a>);
<a name="l02071"></a>02071 
<a name="l02072"></a>02072   <span class="keywordflow">if</span> (length){
<a name="l02073"></a>02073     *length = v-&gt;<a class="code" href="structvector__t.html#fc0402ca1ef07006c7a28840ff092e97">length</a>;
<a name="l02074"></a>02074   }
<a name="l02075"></a>02075 
<a name="l02076"></a>02076   <span class="keywordflow">return</span> v-&gt;<a class="code" href="structvector__t.html#2976e8b5b8c21525a7f1fefafe029927">data</a>;
<a name="l02077"></a>02077 }
<a name="l02078"></a>02078 
<a name="l02079"></a><a class="code" href="dfsch_8c.html#c9deb623b959b49bd33a98405199a851">02079</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8h.html#c9deb623b959b49bd33a98405199a851">dfsch_vector_from_array</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a> **array, 
<a name="l02080"></a>02080                                         <span class="keywordtype">size_t</span> length){
<a name="l02081"></a>02081   <a class="code" href="structvector__t.html">vector_t</a>* v = 
<a name="l02082"></a>02082     (<a class="code" href="structvector__t.html">vector_t</a>*)<a class="code" href="dfsch_8c.html#701b0d85fa7104aa9b1efb76e68bc3a7">dfsch_make_object_var</a>(<a class="code" href="dfsch_8c.html#c6e89954deaa373db52a91ac6db50884">VECTOR</a>, 
<a name="l02083"></a>02083                                      <span class="keyword">sizeof</span>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>*) * length);
<a name="l02084"></a>02084 
<a name="l02085"></a>02085   v-&gt;<a class="code" href="structvector__t.html#fc0402ca1ef07006c7a28840ff092e97">length</a> = length;
<a name="l02086"></a>02086   memcpy(v-&gt;<a class="code" href="structvector__t.html#2976e8b5b8c21525a7f1fefafe029927">data</a>, array, <span class="keyword">sizeof</span>(<a class="code" href="structdfsch__object__t.html">object_t</a>*) * length);
<a name="l02087"></a>02087 
<a name="l02088"></a>02088   <span class="keywordflow">return</span> (<a class="code" href="structdfsch__object__t.html">object_t</a>*)v;
<a name="l02089"></a>02089 }
<a name="l02090"></a>02090 
<a name="l02091"></a><a class="code" href="dfsch_8c.html#ddc613786ed28cdc6a3778ddc2af69af">02091</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8h.html#ddc613786ed28cdc6a3778ddc2af69af">dfsch_vector_ref</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a> *vector, <span class="keywordtype">size_t</span> k){
<a name="l02092"></a>02092   <a class="code" href="structvector__t.html">vector_t</a>* v = <a class="code" href="dfsch_2types_8h.html#f9b3a4b9a5fe6a12721504cd292a3327">DFSCH_ASSERT_TYPE</a>(vector, <a class="code" href="dfsch_8c.html#c6e89954deaa373db52a91ac6db50884">VECTOR</a>);
<a name="l02093"></a>02093 
<a name="l02094"></a>02094   <span class="keywordflow">if</span> (v-&gt;<a class="code" href="structvector__t.html#fc0402ca1ef07006c7a28840ff092e97">length</a> &lt;= k)
<a name="l02095"></a>02095     <a class="code" href="dfsch_8h.html#646ee34c82a726fdc33d8a28af39270a">dfsch_error</a>(<span class="stringliteral">"Invalid index"</span>,<a class="code" href="number_8h.html#f04b0714b3163f77e7981e5506426a43">dfsch_make_number_from_long</a>(k));
<a name="l02096"></a>02096   
<a name="l02097"></a>02097   <span class="keywordflow">return</span> v-&gt;<a class="code" href="structvector__t.html#2976e8b5b8c21525a7f1fefafe029927">data</a>[k];
<a name="l02098"></a>02098 }
<a name="l02099"></a>02099 
<a name="l02100"></a><a class="code" href="dfsch_8c.html#af1d16c585c247af7f097c4943b880da">02100</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8h.html#af1d16c585c247af7f097c4943b880da">dfsch_vector_set</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* vector, <span class="keywordtype">size_t</span> k, 
<a name="l02101"></a>02101                                  <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* obj){
<a name="l02102"></a>02102   <a class="code" href="structvector__t.html">vector_t</a>* v = <a class="code" href="dfsch_2types_8h.html#f9b3a4b9a5fe6a12721504cd292a3327">DFSCH_ASSERT_TYPE</a>(vector, <a class="code" href="dfsch_8c.html#c6e89954deaa373db52a91ac6db50884">VECTOR</a>);
<a name="l02103"></a>02103 
<a name="l02104"></a>02104   <span class="keywordflow">if</span> (v-&gt;<a class="code" href="structvector__t.html#fc0402ca1ef07006c7a28840ff092e97">length</a> &lt;= k)
<a name="l02105"></a>02105     <a class="code" href="dfsch_8h.html#646ee34c82a726fdc33d8a28af39270a">dfsch_error</a>(<span class="stringliteral">"Invalid index"</span>,<a class="code" href="number_8h.html#f04b0714b3163f77e7981e5506426a43">dfsch_make_number_from_long</a>(k));
<a name="l02106"></a>02106   
<a name="l02107"></a>02107   v-&gt;<a class="code" href="structvector__t.html#2976e8b5b8c21525a7f1fefafe029927">data</a>[k] = obj;
<a name="l02108"></a>02108 
<a name="l02109"></a>02109   <span class="keywordflow">return</span> vector;
<a name="l02110"></a>02110 }
<a name="l02111"></a>02111 
<a name="l02112"></a><a class="code" href="dfsch_8c.html#fe505a0f0bd64a392a47f5479dbfe6d6">02112</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8h.html#fe505a0f0bd64a392a47f5479dbfe6d6">dfsch_vector_2_list</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* vector){
<a name="l02113"></a>02113   <a class="code" href="structvector__t.html">vector_t</a>* v = <a class="code" href="dfsch_2types_8h.html#f9b3a4b9a5fe6a12721504cd292a3327">DFSCH_ASSERT_TYPE</a>(vector, <a class="code" href="dfsch_8c.html#c6e89954deaa373db52a91ac6db50884">VECTOR</a>);
<a name="l02114"></a>02114 
<a name="l02115"></a>02115   <span class="keywordflow">return</span> <a class="code" href="dfsch_8h.html#3c1f03e54874c274ac91d3537e964217">dfsch_list_from_array</a>(v-&gt;<a class="code" href="structvector__t.html#2976e8b5b8c21525a7f1fefafe029927">data</a>, v-&gt;<a class="code" href="structvector__t.html#fc0402ca1ef07006c7a28840ff092e97">length</a>);
<a name="l02116"></a>02116 }
<a name="l02117"></a>02117 
<a name="l02118"></a><a class="code" href="dfsch_8c.html#fd4863c802c82d1beb98f7f9d91cfe54">02118</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8h.html#fd4863c802c82d1beb98f7f9d91cfe54">dfsch_list_2_vector</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* list){
<a name="l02119"></a>02119   <a class="code" href="structvector__t.html">vector_t</a>* vector;
<a name="l02120"></a>02120   <span class="keywordtype">size_t</span> length;
<a name="l02121"></a>02121   <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>** array;
<a name="l02122"></a>02122   array = <a class="code" href="dfsch_8h.html#8c423fcccf437f32cba17f0e9747831a">dfsch_list_as_array</a>(list, &amp;length);
<a name="l02123"></a>02123   vector = (<a class="code" href="structvector__t.html">vector_t</a>*)<a class="code" href="dfsch_8c.html#701b0d85fa7104aa9b1efb76e68bc3a7">dfsch_make_object_var</a>(<a class="code" href="dfsch_8c.html#c6e89954deaa373db52a91ac6db50884">VECTOR</a>, 
<a name="l02124"></a>02124                                             length * <span class="keyword">sizeof</span>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>*));
<a name="l02125"></a>02125   vector-&gt;<a class="code" href="structvector__t.html#fc0402ca1ef07006c7a28840ff092e97">length</a> = length;
<a name="l02126"></a>02126   memcpy(vector-&gt;<a class="code" href="structvector__t.html#2976e8b5b8c21525a7f1fefafe029927">data</a>, array, <span class="keyword">sizeof</span>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>*) * length);
<a name="l02127"></a>02127   <span class="keywordflow">return</span> (<a class="code" href="structdfsch__object__t.html">object_t</a>*)vector;
<a name="l02128"></a>02128 }
<a name="l02129"></a>02129 
<a name="l02130"></a><a class="code" href="dfsch_8c.html#45109c5c43dddadee8fcc6de8db59c1e">02130</a> <span class="keywordtype">char</span>* <a class="code" href="dfsch_8h.html#45109c5c43dddadee8fcc6de8db59c1e">dfsch_object_2_string</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* obj, 
<a name="l02131"></a>02131                             <span class="keywordtype">int</span> max_depth, <span class="keywordtype">int</span> readable){
<a name="l02132"></a>02132   <a class="code" href="structdfsch__str__list__t.html">str_list_t</a>* sl = <a class="code" href="src_2util_8h.html#8c11c689e82524c1071e22cb8b624b2b">sl_create</a>();
<a name="l02133"></a>02133   <a class="code" href="structdfsch__writer__state__t.html">dfsch_writer_state_t</a>* state = <a class="code" href="writer_8h.html#a281adf202eeb5184b9b51a4eba6e4a9">dfsch_make_writer_state</a>(max_depth,
<a name="l02134"></a>02134                                                         readable?
<a name="l02135"></a>02135                                                         <a class="code" href="writer_8h.html#ebad970a75f2b9daacd6ed19d211c4f9">DFSCH_WRITE</a>:
<a name="l02136"></a>02136                                                         <a class="code" href="writer_8h.html#86965f2edd8690922dc21ecd1419fe73">DFSCH_PRINT</a>,
<a name="l02137"></a>02137                                                         <a class="code" href="src_2util_8h.html#4e13611a313d895167bcbb5e5cc7ba78">sl_append</a>,
<a name="l02138"></a>02138                                                         sl);
<a name="l02139"></a>02139   <a class="code" href="writer_8h.html#3be6837800ae6f88ea035dc892a2ae88">dfsch_write_object</a>(state, obj);
<a name="l02140"></a>02140   <span class="keywordflow">return</span> <a class="code" href="src_2util_8h.html#5d830b7829284266f7ea5edd1c4c906a">sl_value</a>(sl);
<a name="l02141"></a>02141 }
<a name="l02142"></a>02142 
<a name="l02143"></a>02143 
<a name="l02144"></a><a class="code" href="structread__ctx__t.html">02144</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structread__ctx__t.html">read_ctx_t</a> {
<a name="l02145"></a><a class="code" href="structread__ctx__t.html#21cefacfee3662af63421302c0dace9a">02145</a>   <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="structread__ctx__t.html#21cefacfee3662af63421302c0dace9a">head</a>;
<a name="l02146"></a><a class="code" href="structread__ctx__t.html#044aefaab7bb397ecb90a729a16cddd8">02146</a>   <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="structread__ctx__t.html#044aefaab7bb397ecb90a729a16cddd8">tail</a>;  
<a name="l02147"></a>02147 } <a class="code" href="structread__ctx__t.html">read_ctx_t</a>;
<a name="l02148"></a>02148 
<a name="l02149"></a><a class="code" href="dfsch_8c.html#2f97870c62bcea7c8230b267270abf3f">02149</a> <span class="keyword">static</span> <a class="code" href="dfsch_8c.html#2f97870c62bcea7c8230b267270abf3f">read_callback</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a> *obj, <span class="keywordtype">void</span>* ctx){
<a name="l02150"></a>02150   <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* new_tail = <a class="code" href="dfsch_8h.html#ff85cf17ead5b89f43244a3010bc155c">dfsch_cons</a>(obj, NULL);
<a name="l02151"></a>02151 
<a name="l02152"></a>02152   <span class="keywordflow">if</span> (!((<a class="code" href="structread__ctx__t.html">read_ctx_t</a>*)ctx)-&gt;head){
<a name="l02153"></a>02153     ((<a class="code" href="structread__ctx__t.html">read_ctx_t</a>*)ctx)-&gt;head = new_tail;
<a name="l02154"></a>02154   }<span class="keywordflow">else</span>{
<a name="l02155"></a>02155     <a class="code" href="dfsch_8h.html#df97a679c630d7217bbcd989a65b3b55">dfsch_set_cdr</a>(((<a class="code" href="structread__ctx__t.html">read_ctx_t</a>*)ctx)-&gt;tail, new_tail);
<a name="l02156"></a>02156   }
<a name="l02157"></a>02157 
<a name="l02158"></a>02158   ((<a class="code" href="structread__ctx__t.html">read_ctx_t</a>*)ctx)-&gt;tail = new_tail;
<a name="l02159"></a>02159 
<a name="l02160"></a>02160   <span class="keywordflow">return</span> 1;
<a name="l02161"></a>02161 }
<a name="l02162"></a>02162 
<a name="l02163"></a><a class="code" href="dfsch_8c.html#bc78ddbaa282edbc1b64c960661beae6">02163</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8h.html#bc78ddbaa282edbc1b64c960661beae6">dfsch_string_2_object_list</a>(<span class="keywordtype">char</span>* str){
<a name="l02164"></a>02164   <a class="code" href="structdfsch__parser__ctx__t.html">dfsch_parser_ctx_t</a> *<a class="code" href="repl_8c.html#c10a11e18c4c45888f96553e7a222b10">parser</a> = <a class="code" href="parse_8h.html#e3c2bad9a7c1e0a3ffa16b3bb312c9a3">dfsch_parser_create</a>();
<a name="l02165"></a>02165   <a class="code" href="structread__ctx__t.html">read_ctx_t</a> ctx;
<a name="l02166"></a>02166   <span class="keywordtype">int</span> err;
<a name="l02167"></a>02167   <a class="code" href="parse_8h.html#373fd70de5ca178dddb7438f12d5a650">dfsch_parser_callback</a>(parser, <a class="code" href="dfsch_8c.html#2f97870c62bcea7c8230b267270abf3f">read_callback</a>, &amp;ctx);
<a name="l02168"></a>02168 
<a name="l02169"></a>02169   ctx.<a class="code" href="structread__ctx__t.html#21cefacfee3662af63421302c0dace9a">head</a> = ctx.<a class="code" href="structread__ctx__t.html#044aefaab7bb397ecb90a729a16cddd8">tail</a> = NULL;
<a name="l02170"></a>02170   
<a name="l02171"></a>02171   err = <a class="code" href="parse_8h.html#56151f6369a3eae859a18fe3961da46f">dfsch_parser_feed</a>(parser, str);
<a name="l02172"></a>02172   <span class="keywordflow">if</span> (!err)
<a name="l02173"></a>02173     <a class="code" href="parse_8h.html#56151f6369a3eae859a18fe3961da46f">dfsch_parser_feed</a>(parser, <span class="stringliteral">" "</span>);
<a name="l02174"></a>02174 
<a name="l02175"></a>02175   <span class="keywordflow">if</span> ((err &amp;&amp; err != <a class="code" href="parse_8h.html#4c1effd2773601b0ce33835d4c609f0e">DFSCH_PARSER_STOPPED</a>)
<a name="l02176"></a>02176       || <a class="code" href="parse_8h.html#22ff81bbce3e7b869df2672e408d4a39">dfsch_parser_get_level</a>(parser)!=0){
<a name="l02177"></a>02177     <a class="code" href="dfsch_8h.html#646ee34c82a726fdc33d8a28af39270a">dfsch_error</a>(<span class="stringliteral">"Syntax error"</span>,NULL);
<a name="l02178"></a>02178   }  
<a name="l02179"></a>02179   
<a name="l02180"></a>02180   <span class="keywordflow">return</span> ctx.<a class="code" href="structread__ctx__t.html#21cefacfee3662af63421302c0dace9a">head</a>;
<a name="l02181"></a>02181 }
<a name="l02182"></a><a class="code" href="dfsch_8c.html#440ae307840cbad7bf9093f3c0c0f62a">02182</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8h.html#440ae307840cbad7bf9093f3c0c0f62a">dfsch_string_2_object</a>(<span class="keywordtype">char</span>* str){
<a name="l02183"></a>02183   <a class="code" href="structdfsch__object__t.html">object_t</a>* list = <a class="code" href="dfsch_8h.html#bc78ddbaa282edbc1b64c960661beae6">dfsch_string_2_object_list</a>(str);
<a name="l02184"></a>02184   <span class="keywordflow">if</span> (!list) {
<a name="l02185"></a>02185     <a class="code" href="dfsch_8h.html#646ee34c82a726fdc33d8a28af39270a">dfsch_error</a>(<span class="stringliteral">"Input empty"</span>, NULL);
<a name="l02186"></a>02186   }
<a name="l02187"></a>02187   <span class="keywordflow">return</span> <a class="code" href="dfsch_8h.html#fa8b1de0edaa892e808ab624b35101b2">dfsch_car</a>(list);
<a name="l02188"></a>02188 }
<a name="l02189"></a>02189 
<a name="l02190"></a><a class="code" href="dfsch_8c.html#d723da202837febef7b07310fc616e04">02190</a> <span class="keyword">static</span> <a class="code" href="dfsch_2util_8h.html#3a2bf97f24910aad14f7a4e3211dd332">dfsch_rwlock_t</a> <a class="code" href="dfsch_8c.html#d723da202837febef7b07310fc616e04">environment_rwlock</a> = <a class="code" href="dfsch_2util_8h.html#d6f00edb0f31f6e8d4b49a6ccc5754ed">DFSCH_RWLOCK_INITIALIZER</a>;
<a name="l02191"></a>02191 
<a name="l02192"></a><a class="code" href="dfsch_8c.html#11e77e612d527677795c9e69cdcd7539">02192</a> <span class="keyword">static</span> <a class="code" href="structenvironment__t.html">environment_t</a>* <a class="code" href="dfsch_8c.html#11e77e612d527677795c9e69cdcd7539">alloc_environment</a>(<a class="code" href="structdfsch____thread__info__t.html">dfsch__thread_info_t</a>* ti){
<a name="l02193"></a>02193   <a class="code" href="structenvironment__t.html">environment_t</a>* e;
<a name="l02194"></a>02194 
<a name="l02195"></a>02195 <span class="preprocessor">#ifdef GC_NEXT</span>
<a name="l02196"></a>02196 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (!ti-&gt;<a class="code" href="structdfsch____thread__info__t.html#9efe17c0d2efaeb2ee41ee412d1afabe">env_freelist</a>){
<a name="l02197"></a>02197     ti-&gt;<a class="code" href="structdfsch____thread__info__t.html#9efe17c0d2efaeb2ee41ee412d1afabe">env_freelist</a> = GC_malloc_many(<span class="keyword">sizeof</span>(<a class="code" href="structenvironment__t.html">environment_t</a>));
<a name="l02198"></a>02198   }
<a name="l02199"></a>02199   e = ti-&gt;<a class="code" href="structdfsch____thread__info__t.html#9efe17c0d2efaeb2ee41ee412d1afabe">env_freelist</a>;
<a name="l02200"></a>02200   ti-&gt;<a class="code" href="structdfsch____thread__info__t.html#9efe17c0d2efaeb2ee41ee412d1afabe">env_freelist</a> = GC_NEXT(ti-&gt;<a class="code" href="structdfsch____thread__info__t.html#9efe17c0d2efaeb2ee41ee412d1afabe">env_freelist</a>);
<a name="l02201"></a>02201 <span class="preprocessor">#else</span>
<a name="l02202"></a>02202 <span class="preprocessor"></span>  e = GC_NEW(<a class="code" href="structenvironment__t.html">environment_t</a>);
<a name="l02203"></a>02203 <span class="preprocessor">#endif</span>
<a name="l02204"></a>02204 <span class="preprocessor"></span>
<a name="l02205"></a>02205   ((<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>*)e)-&gt;type = <a class="code" href="dfsch_2types_8h.html#e0e9762c5177d0b4932e47f39c924e22">DFSCH_ENVIRONMENT_TYPE</a>;
<a name="l02206"></a>02206   <span class="keywordflow">return</span> e;
<a name="l02207"></a>02207 }
<a name="l02208"></a>02208 
<a name="l02209"></a><a class="code" href="dfsch_8c.html#1174f03726bf92326417bbb323c2cb8f">02209</a> <span class="keyword">static</span> <a class="code" href="structenvironment__t.html">environment_t</a>* <a class="code" href="dfsch_8c.html#1174f03726bf92326417bbb323c2cb8f">new_frame_impl</a>(<a class="code" href="structenvironment__t.html">environment_t</a>* parent,
<a name="l02210"></a>02210                                      <a class="code" href="structdfsch____thread__info__t.html">dfsch__thread_info_t</a>* ti){
<a name="l02211"></a>02211   <a class="code" href="structenvironment__t.html">environment_t</a>* e = <a class="code" href="dfsch_8c.html#11e77e612d527677795c9e69cdcd7539">alloc_environment</a>(ti);
<a name="l02212"></a>02212 
<a name="l02213"></a>02213   <a class="code" href="eqhash_8h.html#d2dc24fc69f8866cb8f3f30ac2a57f36">dfsch_eqhash_init</a>(&amp;e-&gt;<a class="code" href="structenvironment__t.html#e80ab816324b8b570a48aa751bcda747">values</a>, 0);
<a name="l02214"></a>02214   e-&gt;<a class="code" href="structenvironment__t.html#0fdc6351fe74c47d5c0e26042d0b7115">decls</a> = NULL;
<a name="l02215"></a>02215   e-&gt;<a class="code" href="structenvironment__t.html#edf66fd253ec14b99dd9e56732017fc2">owner</a> = ti;
<a name="l02216"></a>02216   e-&gt;<a class="code" href="structenvironment__t.html#dd4ce7551dfe3160f313941b2df1d4ba">parent</a> = (<a class="code" href="structenvironment__t.html">environment_t</a>*)parent;
<a name="l02217"></a>02217     
<a name="l02218"></a>02218   <span class="keywordflow">return</span> e;
<a name="l02219"></a>02219 }
<a name="l02220"></a>02220 
<a name="l02221"></a><a class="code" href="dfsch_8c.html#8eb433e5eb23587eeb5102f25012e5d8">02221</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8h.html#8eb433e5eb23587eeb5102f25012e5d8">dfsch_new_frame</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* parent){
<a name="l02222"></a>02222   <span class="keywordflow">if</span> (parent){
<a name="l02223"></a>02223     parent = <a class="code" href="dfsch_2types_8h.html#f9b3a4b9a5fe6a12721504cd292a3327">DFSCH_ASSERT_TYPE</a>(parent, <a class="code" href="dfsch_2types_8h.html#e0e9762c5177d0b4932e47f39c924e22">DFSCH_ENVIRONMENT_TYPE</a>);
<a name="l02224"></a>02224   }
<a name="l02225"></a>02225   <span class="keywordflow">return</span> (<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>*)<a class="code" href="dfsch_8c.html#1174f03726bf92326417bbb323c2cb8f">new_frame_impl</a>((<a class="code" href="structenvironment__t.html">environment_t</a>*)parent,
<a name="l02226"></a>02226                                          <a class="code" href="magic_8h.html#04b33f56258adffd197b27d210525b83">dfsch__get_thread_info</a>());
<a name="l02227"></a>02227 }
<a name="l02228"></a>02228 
<a name="l02229"></a><a class="code" href="dfsch_8c.html#1f9bbf68c4ccd20f07d251e64aee5478">02229</a> <span class="keyword">static</span> <a class="code" href="structdfsch__object__t.html">object_t</a>* <a class="code" href="dfsch_8c.html#1f9bbf68c4ccd20f07d251e64aee5478">lookup_impl</a>(<a class="code" href="structdfsch__object__t.html">object_t</a>* name, 
<a name="l02230"></a>02230                              <a class="code" href="structenvironment__t.html">environment_t</a>* env,
<a name="l02231"></a>02231                              <a class="code" href="structdfsch____thread__info__t.html">dfsch__thread_info_t</a>* ti){
<a name="l02232"></a>02232   <a class="code" href="structenvironment__t.html">environment_t</a> *i;
<a name="l02233"></a>02233   <a class="code" href="structdfsch__object__t.html">object_t</a>* ret;
<a name="l02234"></a>02234 
<a name="l02235"></a>02235   i = env;
<a name="l02236"></a>02236   <span class="keywordflow">while</span> (i){
<a name="l02237"></a>02237     <span class="keywordflow">if</span> (<a class="code" href="defines_8h.html#9d3fca805f1a5348d2cb5488cab8d3d8">DFSCH_UNLIKELY</a>(i-&gt;<a class="code" href="structenvironment__t.html#edf66fd253ec14b99dd9e56732017fc2">owner</a> != ti)){
<a name="l02238"></a>02238       i-&gt;<a class="code" href="structenvironment__t.html#edf66fd253ec14b99dd9e56732017fc2">owner</a> = NULL;
<a name="l02239"></a>02239       <span class="keywordflow">goto</span> lock;
<a name="l02240"></a>02240     }
<a name="l02241"></a>02241     ret = <a class="code" href="eqhash_8h.html#c30855e3f86b29e56e5c5a366c0bd03e">dfsch_eqhash_ref</a>(&amp;i-&gt;<a class="code" href="structenvironment__t.html#e80ab816324b8b570a48aa751bcda747">values</a>, name);
<a name="l02242"></a>02242     <span class="keywordflow">if</span> (ret != <a class="code" href="dfsch_2types_8h.html#eb709d9887860cbd23490e6d0879fdf3">DFSCH_INVALID_OBJECT</a>){
<a name="l02243"></a>02243       <span class="keywordflow">return</span> ret;
<a name="l02244"></a>02244     }
<a name="l02245"></a>02245     
<a name="l02246"></a>02246     i = i-&gt;<a class="code" href="structenvironment__t.html#dd4ce7551dfe3160f313941b2df1d4ba">parent</a>;
<a name="l02247"></a>02247   }
<a name="l02248"></a>02248 
<a name="l02249"></a>02249   <a class="code" href="dfsch_8h.html#646ee34c82a726fdc33d8a28af39270a">dfsch_error</a>(<span class="stringliteral">"Unbound variable"</span>, <a class="code" href="dfsch_8h.html#ff85cf17ead5b89f43244a3010bc155c">dfsch_cons</a>(name, (<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>*)env));
<a name="l02250"></a>02250  lock:
<a name="l02251"></a>02251    <a class="code" href="dfsch_2util_8h.html#dc3566c4286a5b31a765dabe11deb87b">DFSCH_RWLOCK_RDLOCK</a>(&amp;environment_rwlock);
<a name="l02252"></a>02252   <span class="keywordflow">while</span> (i){
<a name="l02253"></a>02253     ret = <a class="code" href="eqhash_8h.html#c30855e3f86b29e56e5c5a366c0bd03e">dfsch_eqhash_ref</a>(&amp;i-&gt;<a class="code" href="structenvironment__t.html#e80ab816324b8b570a48aa751bcda747">values</a>, name);
<a name="l02254"></a>02254     <span class="keywordflow">if</span> (ret != <a class="code" href="dfsch_2types_8h.html#eb709d9887860cbd23490e6d0879fdf3">DFSCH_INVALID_OBJECT</a>){
<a name="l02255"></a>02255       <a class="code" href="dfsch_2util_8h.html#bdd281acbb77702ca1b9f49359ababa6">DFSCH_RWLOCK_UNLOCK</a>(&amp;environment_rwlock);
<a name="l02256"></a>02256       <span class="keywordflow">return</span> ret;
<a name="l02257"></a>02257     }
<a name="l02258"></a>02258     
<a name="l02259"></a>02259     i-&gt;<a class="code" href="structenvironment__t.html#edf66fd253ec14b99dd9e56732017fc2">owner</a> = NULL;
<a name="l02260"></a>02260     i = i-&gt;<a class="code" href="structenvironment__t.html#dd4ce7551dfe3160f313941b2df1d4ba">parent</a>;
<a name="l02261"></a>02261   }
<a name="l02262"></a>02262   <a class="code" href="dfsch_2util_8h.html#bdd281acbb77702ca1b9f49359ababa6">DFSCH_RWLOCK_UNLOCK</a>(&amp;environment_rwlock);
<a name="l02263"></a>02263   <a class="code" href="dfsch_8h.html#646ee34c82a726fdc33d8a28af39270a">dfsch_error</a>(<span class="stringliteral">"Unbound variable"</span>, <a class="code" href="dfsch_8h.html#ff85cf17ead5b89f43244a3010bc155c">dfsch_cons</a>(name, (<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>*)env));
<a name="l02264"></a>02264 }
<a name="l02265"></a>02265 
<a name="l02266"></a><a class="code" href="dfsch_8c.html#52cfc05353116778637b6beaa1405d97">02266</a> <a class="code" href="structdfsch__object__t.html">object_t</a>* <a class="code" href="dfsch_8h.html#906d7059ec2f65a097aedab2d14bce70">dfsch_lookup</a>(<a class="code" href="structdfsch__object__t.html">object_t</a>* name, <a class="code" href="structdfsch__object__t.html">object_t</a>* env){
<a name="l02267"></a>02267   <span class="keywordflow">return</span> <a class="code" href="dfsch_8c.html#1f9bbf68c4ccd20f07d251e64aee5478">lookup_impl</a>(name, 
<a name="l02268"></a>02268                      <a class="code" href="dfsch_2types_8h.html#f9b3a4b9a5fe6a12721504cd292a3327">DFSCH_ASSERT_TYPE</a>(env, <a class="code" href="dfsch_2types_8h.html#e0e9762c5177d0b4932e47f39c924e22">DFSCH_ENVIRONMENT_TYPE</a>),
<a name="l02269"></a>02269                      <a class="code" href="magic_8h.html#04b33f56258adffd197b27d210525b83">dfsch__get_thread_info</a>());
<a name="l02270"></a>02270 }
<a name="l02271"></a><a class="code" href="dfsch_8c.html#bb44a697256f26c1637a39413b15d5d7">02271</a> <a class="code" href="structdfsch__object__t.html">object_t</a>* <a class="code" href="dfsch_8h.html#664702768d9c9488af7f12adff54b214">dfsch_env_get</a>(<a class="code" href="structdfsch__object__t.html">object_t</a>* name, <a class="code" href="structdfsch__object__t.html">object_t</a>* env){
<a name="l02272"></a>02272   <a class="code" href="structenvironment__t.html">environment_t</a> *i;
<a name="l02273"></a>02273   <a class="code" href="structdfsch__object__t.html">object_t</a>* ret;
<a name="l02274"></a>02274 
<a name="l02275"></a>02275   i = <a class="code" href="dfsch_2types_8h.html#f9b3a4b9a5fe6a12721504cd292a3327">DFSCH_ASSERT_TYPE</a>(env, <a class="code" href="dfsch_2types_8h.html#e0e9762c5177d0b4932e47f39c924e22">DFSCH_ENVIRONMENT_TYPE</a>);
<a name="l02276"></a>02276   <a class="code" href="dfsch_2util_8h.html#dc3566c4286a5b31a765dabe11deb87b">DFSCH_RWLOCK_RDLOCK</a>(&amp;environment_rwlock);
<a name="l02277"></a>02277   <span class="keywordflow">while</span> (i){
<a name="l02278"></a>02278     ret = <a class="code" href="eqhash_8h.html#c30855e3f86b29e56e5c5a366c0bd03e">dfsch_eqhash_ref</a>(&amp;i-&gt;<a class="code" href="structenvironment__t.html#e80ab816324b8b570a48aa751bcda747">values</a>, name);
<a name="l02279"></a>02279     <span class="keywordflow">if</span> (ret != <a class="code" href="dfsch_2types_8h.html#eb709d9887860cbd23490e6d0879fdf3">DFSCH_INVALID_OBJECT</a>){
<a name="l02280"></a>02280       <a class="code" href="dfsch_2util_8h.html#bdd281acbb77702ca1b9f49359ababa6">DFSCH_RWLOCK_UNLOCK</a>(&amp;environment_rwlock);
<a name="l02281"></a>02281       <span class="keywordflow">return</span> <a class="code" href="dfsch_8h.html#ff85cf17ead5b89f43244a3010bc155c">dfsch_cons</a>(ret, NULL);
<a name="l02282"></a>02282     }
<a name="l02283"></a>02283 
<a name="l02284"></a>02284     i = i-&gt;<a class="code" href="structenvironment__t.html#dd4ce7551dfe3160f313941b2df1d4ba">parent</a>;
<a name="l02285"></a>02285   }
<a name="l02286"></a>02286   <a class="code" href="dfsch_2util_8h.html#bdd281acbb77702ca1b9f49359ababa6">DFSCH_RWLOCK_UNLOCK</a>(&amp;environment_rwlock);
<a name="l02287"></a>02287   <span class="keywordflow">return</span> NULL;
<a name="l02288"></a>02288 }
<a name="l02289"></a>02289 
<a name="l02290"></a>02290 
<a name="l02291"></a><a class="code" href="dfsch_8c.html#ad595c0ee8ff60b9e26c4f201043adb7">02291</a> <a class="code" href="structdfsch__object__t.html">object_t</a>* <a class="code" href="dfsch_8h.html#2d7b3fe2f1501d50a20abedc82bfb433">dfsch_set</a>(<a class="code" href="structdfsch__object__t.html">object_t</a>* name, <a class="code" href="structdfsch__object__t.html">object_t</a>* value, <a class="code" href="structdfsch__object__t.html">object_t</a>* env){
<a name="l02292"></a>02292   <a class="code" href="structenvironment__t.html">environment_t</a> *i;
<a name="l02293"></a>02293   <a class="code" href="structdfsch____thread__info__t.html">dfsch__thread_info_t</a> *ti = <a class="code" href="magic_8h.html#04b33f56258adffd197b27d210525b83">dfsch__get_thread_info</a>();
<a name="l02294"></a>02294 
<a name="l02295"></a>02295   i = <a class="code" href="dfsch_2types_8h.html#f9b3a4b9a5fe6a12721504cd292a3327">DFSCH_ASSERT_TYPE</a>(env, <a class="code" href="dfsch_2types_8h.html#e0e9762c5177d0b4932e47f39c924e22">DFSCH_ENVIRONMENT_TYPE</a>);
<a name="l02296"></a>02296 
<a name="l02297"></a>02297   <span class="keywordflow">while</span> (i){
<a name="l02298"></a>02298     <span class="keywordflow">if</span> (i-&gt;<a class="code" href="structenvironment__t.html#edf66fd253ec14b99dd9e56732017fc2">owner</a> != ti){
<a name="l02299"></a>02299       i-&gt;<a class="code" href="structenvironment__t.html#edf66fd253ec14b99dd9e56732017fc2">owner</a> = NULL;
<a name="l02300"></a>02300       <span class="keywordflow">goto</span> lock;
<a name="l02301"></a>02301     }
<a name="l02302"></a>02302     <span class="keywordflow">if</span>(<a class="code" href="eqhash_8h.html#4f970c6e4cf8cd5529d7683272844b37">dfsch_eqhash_set_if_exists</a>(&amp;i-&gt;<a class="code" href="structenvironment__t.html#e80ab816324b8b570a48aa751bcda747">values</a>, name, value, NULL))
<a name="l02303"></a>02303       <span class="keywordflow">return</span> value;
<a name="l02304"></a>02304 
<a name="l02305"></a>02305     i = i-&gt;<a class="code" href="structenvironment__t.html#dd4ce7551dfe3160f313941b2df1d4ba">parent</a>;
<a name="l02306"></a>02306   }
<a name="l02307"></a>02307 
<a name="l02308"></a>02308   <a class="code" href="dfsch_8h.html#646ee34c82a726fdc33d8a28af39270a">dfsch_error</a>(<span class="stringliteral">"Unbound variable"</span>,name);
<a name="l02309"></a>02309  lock:
<a name="l02310"></a>02310   
<a name="l02311"></a>02311   <a class="code" href="dfsch_2util_8h.html#5d0cff9602b4ec1bd186141d10f17501">DFSCH_RWLOCK_WRLOCK</a>(&amp;environment_rwlock);
<a name="l02312"></a>02312   <span class="keywordflow">while</span> (i){
<a name="l02313"></a>02313     <span class="keywordflow">if</span>(<a class="code" href="eqhash_8h.html#4f970c6e4cf8cd5529d7683272844b37">dfsch_eqhash_set_if_exists</a>(&amp;i-&gt;<a class="code" href="structenvironment__t.html#e80ab816324b8b570a48aa751bcda747">values</a>, name, value, NULL)){
<a name="l02314"></a>02314       <a class="code" href="dfsch_2util_8h.html#bdd281acbb77702ca1b9f49359ababa6">DFSCH_RWLOCK_UNLOCK</a>(&amp;environment_rwlock);
<a name="l02315"></a>02315       <span class="keywordflow">return</span> value;
<a name="l02316"></a>02316     }
<a name="l02317"></a>02317     i-&gt;<a class="code" href="structenvironment__t.html#edf66fd253ec14b99dd9e56732017fc2">owner</a> = NULL;
<a name="l02318"></a>02318     i = i-&gt;<a class="code" href="structenvironment__t.html#dd4ce7551dfe3160f313941b2df1d4ba">parent</a>;
<a name="l02319"></a>02319   }
<a name="l02320"></a>02320   <a class="code" href="dfsch_2util_8h.html#bdd281acbb77702ca1b9f49359ababa6">DFSCH_RWLOCK_UNLOCK</a>(&amp;environment_rwlock);
<a name="l02321"></a>02321   <a class="code" href="dfsch_8h.html#646ee34c82a726fdc33d8a28af39270a">dfsch_error</a>(<span class="stringliteral">"Unbound variable"</span>,name);
<a name="l02322"></a>02322 
<a name="l02323"></a>02323 }
<a name="l02324"></a><a class="code" href="dfsch_8c.html#65799c1f9c48bb3b9814df5b2753c4c5">02324</a> <span class="keywordtype">void</span> <a class="code" href="dfsch_8h.html#a0e7bdb22e2c74b4de865d00fdebe6fd">dfsch_unset</a>(<a class="code" href="structdfsch__object__t.html">object_t</a>* name, <a class="code" href="structdfsch__object__t.html">object_t</a>* env){
<a name="l02325"></a>02325   <a class="code" href="structenvironment__t.html">environment_t</a> *i;
<a name="l02326"></a>02326 
<a name="l02327"></a>02327   i = <a class="code" href="dfsch_2types_8h.html#f9b3a4b9a5fe6a12721504cd292a3327">DFSCH_ASSERT_TYPE</a>(env, <a class="code" href="dfsch_2types_8h.html#e0e9762c5177d0b4932e47f39c924e22">DFSCH_ENVIRONMENT_TYPE</a>);
<a name="l02328"></a>02328   <a class="code" href="dfsch_2util_8h.html#5d0cff9602b4ec1bd186141d10f17501">DFSCH_RWLOCK_WRLOCK</a>(&amp;environment_rwlock);
<a name="l02329"></a>02329   <span class="keywordflow">while</span> (i){
<a name="l02330"></a>02330     <span class="keywordflow">if</span> (i-&gt;<a class="code" href="structenvironment__t.html#0fdc6351fe74c47d5c0e26042d0b7115">decls</a>){
<a name="l02331"></a>02331       <a class="code" href="hash_8h.html#c9f1f247de93ddd258fe1f5b51ab748f">dfsch_hash_unset</a>(i-&gt;<a class="code" href="structenvironment__t.html#0fdc6351fe74c47d5c0e26042d0b7115">decls</a>, name);
<a name="l02332"></a>02332     }
<a name="l02333"></a>02333     <span class="keywordflow">if</span>(<a class="code" href="eqhash_8h.html#da4cd6f09cc53dfa109c0a73a763aa1b">dfsch_eqhash_unset</a>(&amp;i-&gt;<a class="code" href="structenvironment__t.html#e80ab816324b8b570a48aa751bcda747">values</a>, name)){
<a name="l02334"></a>02334       <a class="code" href="dfsch_2util_8h.html#bdd281acbb77702ca1b9f49359ababa6">DFSCH_RWLOCK_UNLOCK</a>(&amp;environment_rwlock);
<a name="l02335"></a>02335       <span class="keywordflow">return</span>;
<a name="l02336"></a>02336     }
<a name="l02337"></a>02337     i = i-&gt;<a class="code" href="structenvironment__t.html#dd4ce7551dfe3160f313941b2df1d4ba">parent</a>;
<a name="l02338"></a>02338   }
<a name="l02339"></a>02339   <a class="code" href="dfsch_2util_8h.html#bdd281acbb77702ca1b9f49359ababa6">DFSCH_RWLOCK_UNLOCK</a>(&amp;environment_rwlock);
<a name="l02340"></a>02340   
<a name="l02341"></a>02341   <a class="code" href="dfsch_8h.html#646ee34c82a726fdc33d8a28af39270a">dfsch_error</a>(<span class="stringliteral">"Unbound variable"</span>,name);
<a name="l02342"></a>02342 }
<a name="l02343"></a>02343 
<a name="l02344"></a>02344 
<a name="l02345"></a><a class="code" href="dfsch_8c.html#3458729fd5c0aa2a11479fa30bfeb5ec">02345</a> <a class="code" href="structdfsch__object__t.html">object_t</a>* <a class="code" href="dfsch_8h.html#0269ff68c7264db9598185860983619b">dfsch_define</a>(<a class="code" href="structdfsch__object__t.html">object_t</a>* name, <a class="code" href="structdfsch__object__t.html">object_t</a>* value, <a class="code" href="structdfsch__object__t.html">object_t</a>* env){
<a name="l02346"></a>02346   <a class="code" href="structenvironment__t.html">environment_t</a>* e = (<a class="code" href="structenvironment__t.html">environment_t</a>*)<a class="code" href="dfsch_2types_8h.html#f9b3a4b9a5fe6a12721504cd292a3327">DFSCH_ASSERT_TYPE</a>(env, 
<a name="l02347"></a>02347                                                        <a class="code" href="dfsch_2types_8h.html#e0e9762c5177d0b4932e47f39c924e22">DFSCH_ENVIRONMENT_TYPE</a>);
<a name="l02348"></a>02348   <a class="code" href="structdfsch____thread__info__t.html">dfsch__thread_info_t</a> *ti = <a class="code" href="magic_8h.html#04b33f56258adffd197b27d210525b83">dfsch__get_thread_info</a>();
<a name="l02349"></a>02349   <span class="keywordflow">if</span> (e-&gt;<a class="code" href="structenvironment__t.html#edf66fd253ec14b99dd9e56732017fc2">owner</a> != ti){
<a name="l02350"></a>02350     e-&gt;<a class="code" href="structenvironment__t.html#edf66fd253ec14b99dd9e56732017fc2">owner</a> = NULL;
<a name="l02351"></a>02351     <a class="code" href="dfsch_2util_8h.html#5d0cff9602b4ec1bd186141d10f17501">DFSCH_RWLOCK_WRLOCK</a>(&amp;environment_rwlock);
<a name="l02352"></a>02352   }
<a name="l02353"></a>02353   <a class="code" href="eqhash_8h.html#630655677694673771b6bcedd2df268e">dfsch_eqhash_set</a>(&amp;e-&gt;<a class="code" href="structenvironment__t.html#e80ab816324b8b570a48aa751bcda747">values</a>, 
<a name="l02354"></a>02354                    name, value);  
<a name="l02355"></a>02355   <span class="keywordflow">if</span> (e-&gt;<a class="code" href="structenvironment__t.html#edf66fd253ec14b99dd9e56732017fc2">owner</a> != ti){
<a name="l02356"></a>02356     <a class="code" href="dfsch_2util_8h.html#bdd281acbb77702ca1b9f49359ababa6">DFSCH_RWLOCK_UNLOCK</a>(&amp;environment_rwlock);
<a name="l02357"></a>02357   }
<a name="l02358"></a>02358   <span class="keywordflow">return</span> value;
<a name="l02359"></a>02359 
<a name="l02360"></a>02360 }
<a name="l02361"></a>02361 
<a name="l02362"></a><a class="code" href="dfsch_8c.html#8d36df005632156bd303035784be233d">02362</a> <span class="keywordtype">void</span> <a class="code" href="dfsch_8c.html#8d36df005632156bd303035784be233d">dfsch_declare</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* variable, <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* declaration,
<a name="l02363"></a>02363                    <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* env){
<a name="l02364"></a>02364   <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* old = NULL;
<a name="l02365"></a>02365   <a class="code" href="structenvironment__t.html">environment_t</a>* e = <a class="code" href="dfsch_2types_8h.html#f9b3a4b9a5fe6a12721504cd292a3327">DFSCH_ASSERT_TYPE</a>(env, <a class="code" href="dfsch_2types_8h.html#e0e9762c5177d0b4932e47f39c924e22">DFSCH_ENVIRONMENT_TYPE</a>);
<a name="l02366"></a>02366 
<a name="l02367"></a>02367   <span class="keywordflow">if</span> (!e-&gt;<a class="code" href="structenvironment__t.html#0fdc6351fe74c47d5c0e26042d0b7115">decls</a>){
<a name="l02368"></a>02368     e-&gt;<a class="code" href="structenvironment__t.html#0fdc6351fe74c47d5c0e26042d0b7115">decls</a> = <a class="code" href="hash_8h.html#e672ea9fa3e3b8bd19333d22b8ce9f34">dfsch_hash_make</a>(<a class="code" href="hash_8h.html#bf87ba8803494070ec45b00b7dfdfa0b">DFSCH_HASH_EQ</a>);
<a name="l02369"></a>02369   } <span class="keywordflow">else</span> {
<a name="l02370"></a>02370     <a class="code" href="hash_8h.html#5fb553da9297ec2a30dc6b9697190926">dfsch_hash_ref_fast</a>(e-&gt;<a class="code" href="structenvironment__t.html#0fdc6351fe74c47d5c0e26042d0b7115">decls</a>, variable, &amp;old);
<a name="l02371"></a>02371   }
<a name="l02372"></a>02372   
<a name="l02373"></a>02373   <a class="code" href="hash_8h.html#a1a0d3c69f5b6b9d27fcefe290d0e93a">dfsch_hash_set</a>(e-&gt;<a class="code" href="structenvironment__t.html#0fdc6351fe74c47d5c0e26042d0b7115">decls</a>, variable, 
<a name="l02374"></a>02374                  <a class="code" href="dfsch_8h.html#ff85cf17ead5b89f43244a3010bc155c">dfsch_cons</a>(declaration, old));  
<a name="l02375"></a>02375 }
<a name="l02376"></a>02376 
<a name="l02377"></a><a class="code" href="dfsch_8c.html#7e376548fcb5e13574c12bc346f3018d">02377</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8h.html#7e376548fcb5e13574c12bc346f3018d">dfsch_get_environment_variables</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* env){
<a name="l02378"></a>02378   <a class="code" href="structenvironment__t.html">environment_t</a>* e = <a class="code" href="dfsch_2types_8h.html#f9b3a4b9a5fe6a12721504cd292a3327">DFSCH_ASSERT_TYPE</a>(env, <a class="code" href="dfsch_2types_8h.html#e0e9762c5177d0b4932e47f39c924e22">DFSCH_ENVIRONMENT_TYPE</a>);
<a name="l02379"></a>02379   <span class="keywordflow">return</span> <a class="code" href="eqhash_8h.html#15503f942b641c12c700caff5519a356">dfsch_eqhash_2_alist</a>(&amp;e-&gt;<a class="code" href="structenvironment__t.html#e80ab816324b8b570a48aa751bcda747">values</a>);
<a name="l02380"></a>02380 }
<a name="l02381"></a>02381 
<a name="l02382"></a><a class="code" href="dfsch_8c.html#54b8f010995bf6e49721b81f485a6fae">02382</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8h.html#54b8f010995bf6e49721b81f485a6fae">dfsch_macro_expand</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* macro,
<a name="l02383"></a>02383                                    <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* args){
<a name="l02384"></a>02384 
<a name="l02385"></a>02385   <span class="keywordflow">return</span> <a class="code" href="dfsch_8h.html#2772937dcff7850968639e3054e65384">dfsch_apply</a>(((<a class="code" href="structmacro__t.html">macro_t</a>*)<a class="code" href="dfsch_2types_8h.html#f9b3a4b9a5fe6a12721504cd292a3327">DFSCH_ASSERT_TYPE</a>(macro, <a class="code" href="dfsch_8c.html#824c99cb152a3c2e9111a2cb9c34891e">MACRO</a>))-&gt;proc, args);
<a name="l02386"></a>02386 }
<a name="l02387"></a>02387 
<a name="l02388"></a>02388 <span class="comment">// Evaluator</span>
<a name="l02389"></a>02389 
<a name="l02390"></a>02390 <span class="comment">/*</span>
<a name="l02391"></a>02391 <span class="comment"> * There are some kinds of structures that are passed extensively inside the </span>
<a name="l02392"></a>02392 <span class="comment"> * evaluator, but are not exposed to public API much. Idea there is that </span>
<a name="l02393"></a>02393 <span class="comment"> * dfsch__get_thread_info() can be somewhat slow (on linux, it isn't </span>
<a name="l02394"></a>02394 <span class="comment"> * noticeably slow, but who knows) and thus it is not exactly bad idea to </span>
<a name="l02395"></a>02395 <span class="comment"> * cache it's result, but passing this value to user code causes marginal </span>
<a name="l02396"></a>02396 <span class="comment"> * speedup at cost of having one additional argument that is not useful in </span>
<a name="l02397"></a>02397 <span class="comment"> * any meaningful way to user code.</span>
<a name="l02398"></a>02398 <span class="comment"> *</span>
<a name="l02399"></a>02399 <span class="comment"> * dfsch_tail_escape_t is used to implement tail recursion, it is used only </span>
<a name="l02400"></a>02400 <span class="comment"> * in dfsch_eval_proc_impl() but it has to be passed through much of evaluator </span>
<a name="l02401"></a>02401 <span class="comment"> * and some native functions. General idea is that dfsch_eval_proc_impl stores</span>
<a name="l02402"></a>02402 <span class="comment"> * jmp_buf to it's start here and passes it to dfsch_eval_impl() during </span>
<a name="l02403"></a>02403 <span class="comment"> * evaluation of last form of procedure body. Native functions have to </span>
<a name="l02404"></a>02404 <span class="comment"> * implement same mechanism (pass dfsch_tail_escape_t argument only to </span>
<a name="l02405"></a>02405 <span class="comment"> * functions whose return value is return value of native function itself). </span>
<a name="l02406"></a>02406 <span class="comment"> * When dfsch_eval_proc_impl() is called with non-NULL tail_escape it simply</span>
<a name="l02407"></a>02407 <span class="comment"> * jumps back to previous activation record. This actually causes slow-down,</span>
<a name="l02408"></a>02408 <span class="comment"> * but enables us to do tail-recursion in simple and consistent way, that </span>
<a name="l02409"></a>02409 <span class="comment"> * works even through C-code.</span>
<a name="l02410"></a>02410 <span class="comment"> */</span>
<a name="l02411"></a>02411 
<a name="l02412"></a>02412 <span class="comment">/* TODO: finish new stack traces</span>
<a name="l02413"></a>02413 <span class="comment"> * general idea is that frames are construed by apply and then filed in </span>
<a name="l02414"></a>02414 <span class="comment"> * relevant functions. Tail recursion handling should be part of apply. */</span>
<a name="l02415"></a>02415 
<a name="l02416"></a><a class="code" href="dfsch_8c.html#6900146132b87055f68cc201a9136ed7">02416</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="dfsch_8c.html#6900146132b87055f68cc201a9136ed7">async_apply_check</a>(<a class="code" href="structdfsch____thread__info__t.html">dfsch__thread_info_t</a>* ti){
<a name="l02417"></a>02417   <span class="keywordflow">if</span> (<a class="code" href="defines_8h.html#9d3fca805f1a5348d2cb5488cab8d3d8">DFSCH_UNLIKELY</a>(ti-&gt;<a class="code" href="structdfsch____thread__info__t.html#bca619363e8adc96a32a271d637a44dd">async_apply</a>)){
<a name="l02418"></a>02418     <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* proc;
<a name="l02419"></a>02419     proc = ti-&gt;<a class="code" href="structdfsch____thread__info__t.html#bca619363e8adc96a32a271d637a44dd">async_apply</a>;
<a name="l02420"></a>02420     ti-&gt;<a class="code" href="structdfsch____thread__info__t.html#bca619363e8adc96a32a271d637a44dd">async_apply</a> = NULL;
<a name="l02421"></a>02421     <a class="code" href="dfsch_8h.html#2772937dcff7850968639e3054e65384">dfsch_apply</a>(proc, NULL);
<a name="l02422"></a>02422   }
<a name="l02423"></a>02423 }
<a name="l02424"></a>02424 
<a name="l02425"></a><a class="code" href="dfsch_8c.html#4c117c0d99bfb26d705baa5a6baded76">02425</a> <span class="keywordtype">void</span> <a class="code" href="dfsch_8h.html#4c117c0d99bfb26d705baa5a6baded76">dfsch_async_apply_check</a>(){
<a name="l02426"></a>02426   <a class="code" href="dfsch_8c.html#6900146132b87055f68cc201a9136ed7">async_apply_check</a>(<a class="code" href="magic_8h.html#04b33f56258adffd197b27d210525b83">dfsch__get_thread_info</a>());
<a name="l02427"></a>02427 }
<a name="l02428"></a>02428 
<a name="l02429"></a><a class="code" href="dfsch_8c.html#492deff75661073fd9414a7a6beea265">02429</a> <span class="keyword">typedef</span> <a class="code" href="structdfsch__tail__escape__t.html">dfsch_tail_escape_t</a> <a class="code" href="structdfsch__tail__escape__t.html">tail_escape_t</a>;
<a name="l02430"></a>02430 
<a name="l02431"></a>02431 
<a name="l02432"></a>02432 <span class="keyword">static</span> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8c.html#7ccb1ddea2583f561f49c343371da118">dfsch_eval_proc_impl</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* code, 
<a name="l02433"></a>02433                                             <a class="code" href="structenvironment__t.html">environment_t</a>* env,
<a name="l02434"></a>02434                                             tail_escape_t* esc,
<a name="l02435"></a>02435                                             <a class="code" href="structdfsch____thread__info__t.html">dfsch__thread_info_t</a>* ti);
<a name="l02436"></a>02436 <span class="keyword">static</span> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8c.html#222f54df7e431beb2bc2dddf3640b554">dfsch_eval_impl</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* exp, 
<a name="l02437"></a>02437                                        <a class="code" href="structenvironment__t.html">environment_t</a>* env,
<a name="l02438"></a>02438                                        <a class="code" href="structdfsch__tail__escape__t.html">dfsch_tail_escape_t</a>* esc,
<a name="l02439"></a>02439                                        <a class="code" href="structdfsch____thread__info__t.html">dfsch__thread_info_t</a>* ti);
<a name="l02440"></a>02440 <span class="keyword">static</span> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8c.html#74c466627982381afb580ca74202354a">dfsch_apply_impl</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* proc, 
<a name="l02441"></a>02441                                         <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* args,
<a name="l02442"></a>02442                                         <a class="code" href="structenvironment__t.html">environment_t</a>* arg_env,
<a name="l02443"></a>02443                                         tail_escape_t* esc,
<a name="l02444"></a>02444                                         <a class="code" href="structdfsch____thread__info__t.html">dfsch__thread_info_t</a>* ti);
<a name="l02445"></a>02445 
<a name="l02446"></a>02446 
<a name="l02447"></a><a class="code" href="dfsch_8c.html#b44c922d5b67a47e620c1fda623692c2">02447</a> <span class="keyword">static</span> <a class="code" href="structdfsch__object__t.html">object_t</a>* <a class="code" href="dfsch_8c.html#b44c922d5b67a47e620c1fda623692c2">eval_list</a>(<a class="code" href="structdfsch__object__t.html">object_t</a> *list, <a class="code" href="structenvironment__t.html">environment_t</a>* env, 
<a name="l02448"></a>02448                            <a class="code" href="structdfsch____thread__info__t.html">dfsch__thread_info_t</a>* ti){
<a name="l02449"></a>02449   <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a> *i;
<a name="l02450"></a>02450   <a class="code" href="structdfsch__object__t.html">object_t</a> *f=NULL;
<a name="l02451"></a>02451   <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a> *t, *p;
<a name="l02452"></a>02452   <a class="code" href="structdfsch__object__t.html">object_t</a> *r; 
<a name="l02453"></a>02453 
<a name="l02454"></a>02454   <span class="keywordflow">if</span> (!list)
<a name="l02455"></a>02455     <span class="keywordflow">return</span> NULL;
<a name="l02456"></a>02456   
<a name="l02457"></a>02457   <span class="keywordflow">if</span> (!<a class="code" href="dfsch_2types_8h.html#6ec0a17695d07350d56eaffe994e29f4">DFSCH_PAIR_P</a>(list)){
<a name="l02458"></a>02458     <a class="code" href="dfsch_8h.html#646ee34c82a726fdc33d8a28af39270a">dfsch_error</a>(<span class="stringliteral">"Not a proper list"</span>, list);    
<a name="l02459"></a>02459   }
<a name="l02460"></a>02460 
<a name="l02461"></a>02461   r = <a class="code" href="dfsch_8c.html#222f54df7e431beb2bc2dddf3640b554">dfsch_eval_impl</a>(<a class="code" href="dfsch_2types_8h.html#873da07e10c696bf321a42629cdb863e">DFSCH_FAST_CAR</a>(list), env, NULL, ti);
<a name="l02462"></a>02462   t = <a class="code" href="dfsch_8c.html#c8138a49f893766dd443e7a7b7552e28">tl_cons</a>(ti, r, NULL);
<a name="l02463"></a>02463   f = p = t;
<a name="l02464"></a>02464 
<a name="l02465"></a>02465   i = <a class="code" href="dfsch_2types_8h.html#9621e19e10bbf916d031fc55631f48df">DFSCH_FAST_CDR</a>(list);
<a name="l02466"></a>02466   <span class="keywordflow">while</span> (<a class="code" href="dfsch_2types_8h.html#6ec0a17695d07350d56eaffe994e29f4">DFSCH_PAIR_P</a>(i)){
<a name="l02467"></a>02467     r = <a class="code" href="dfsch_2types_8h.html#873da07e10c696bf321a42629cdb863e">DFSCH_FAST_CAR</a>(i);
<a name="l02468"></a>02468     <span class="keywordflow">if</span> (<a class="code" href="dfsch_2types_8h.html#e07b27ad78750f065d7222def7f196db">DFSCH_SYMBOL_P</a>(r)){
<a name="l02469"></a>02469       r = <a class="code" href="dfsch_8c.html#1f9bbf68c4ccd20f07d251e64aee5478">lookup_impl</a>(r, env, ti);
<a name="l02470"></a>02470     } <span class="keywordflow">else</span> {
<a name="l02471"></a>02471       r = <a class="code" href="dfsch_8c.html#222f54df7e431beb2bc2dddf3640b554">dfsch_eval_impl</a>(r, env, NULL, ti);
<a name="l02472"></a>02472     }
<a name="l02473"></a>02473 
<a name="l02474"></a>02474     t = <a class="code" href="dfsch_8c.html#c8138a49f893766dd443e7a7b7552e28">tl_cons</a>(ti, r, NULL);
<a name="l02475"></a>02475     <a class="code" href="dfsch_2types_8h.html#bb4a2056ae9d34d125eba3ac229f8ada">DFSCH_FAST_CDR_MUT</a>(p) = (<a class="code" href="structdfsch__object__t.html">object_t</a>*)t;
<a name="l02476"></a>02476     p = t;
<a name="l02477"></a>02477 
<a name="l02478"></a>02478     i = <a class="code" href="dfsch_2types_8h.html#9621e19e10bbf916d031fc55631f48df">DFSCH_FAST_CDR</a>(i);
<a name="l02479"></a>02479   }
<a name="l02480"></a>02480 
<a name="l02481"></a>02481   <span class="keywordflow">if</span> (i){
<a name="l02482"></a>02482     <a class="code" href="dfsch_8h.html#646ee34c82a726fdc33d8a28af39270a">dfsch_error</a>(<span class="stringliteral">"Not a proper list"</span>, list);    
<a name="l02483"></a>02483   }
<a name="l02484"></a>02484 
<a name="l02485"></a>02485   <span class="keywordflow">return</span> f;
<a name="l02486"></a>02486 }
<a name="l02487"></a>02487 
<a name="l02488"></a><a class="code" href="dfsch_8c.html#e5fd2adad92b70832d770e2254bfd970">02488</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8h.html#e5fd2adad92b70832d770e2254bfd970">dfsch_eval_list</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* list, <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* env){
<a name="l02489"></a>02489   <span class="keywordflow">return</span> <a class="code" href="dfsch_8c.html#b44c922d5b67a47e620c1fda623692c2">eval_list</a>(list, env, <a class="code" href="magic_8h.html#04b33f56258adffd197b27d210525b83">dfsch__get_thread_info</a>());
<a name="l02490"></a>02490 }
<a name="l02491"></a>02491 
<a name="l02492"></a><a class="code" href="dfsch_8c.html#222f54df7e431beb2bc2dddf3640b554">02492</a> <span class="keyword">static</span> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8c.html#222f54df7e431beb2bc2dddf3640b554">dfsch_eval_impl</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* exp, 
<a name="l02493"></a>02493                                        <a class="code" href="structenvironment__t.html">environment_t</a>* env,
<a name="l02494"></a>02494                                        <a class="code" href="structdfsch__tail__escape__t.html">dfsch_tail_escape_t</a>* esc,
<a name="l02495"></a>02495                                        <a class="code" href="structdfsch____thread__info__t.html">dfsch__thread_info_t</a>* ti){
<a name="l02496"></a>02496   <a class="code" href="magic_8h.html#25dac35224d3e6e93d15504ac68c5b5e">DFSCH__TRACEPOINT_EVAL</a>(ti, exp, env);
<a name="l02497"></a>02497 
<a name="l02498"></a>02498   <span class="keywordflow">if</span> (!exp) 
<a name="l02499"></a>02499     <span class="keywordflow">return</span> NULL;
<a name="l02500"></a>02500 
<a name="l02501"></a>02501   <span class="keywordflow">if</span>(<a class="code" href="dfsch_2types_8h.html#e07b27ad78750f065d7222def7f196db">DFSCH_SYMBOL_P</a>(exp)){
<a name="l02502"></a>02502     <span class="keywordflow">return</span> <a class="code" href="dfsch_8c.html#1f9bbf68c4ccd20f07d251e64aee5478">lookup_impl</a>(exp, env, ti);
<a name="l02503"></a>02503   }
<a name="l02504"></a>02504 
<a name="l02505"></a>02505   <span class="keywordflow">if</span>(<a class="code" href="dfsch_2types_8h.html#6ec0a17695d07350d56eaffe994e29f4">DFSCH_PAIR_P</a>(exp)){
<a name="l02506"></a>02506     <a class="code" href="structdfsch__object__t.html">object_t</a> *f = <a class="code" href="dfsch_2types_8h.html#873da07e10c696bf321a42629cdb863e">DFSCH_FAST_CAR</a>(exp);
<a name="l02507"></a>02507 
<a name="l02508"></a>02508     <span class="keywordflow">if</span> (<a class="code" href="defines_8h.html#63267c56f2c4d513caca2843866d6488">DFSCH_LIKELY</a>(<a class="code" href="dfsch_2types_8h.html#e07b27ad78750f065d7222def7f196db">DFSCH_SYMBOL_P</a>(f))){
<a name="l02509"></a>02509       f = <a class="code" href="dfsch_8c.html#1f9bbf68c4ccd20f07d251e64aee5478">lookup_impl</a>(f, env, ti);
<a name="l02510"></a>02510     } <span class="keywordflow">else</span> {
<a name="l02511"></a>02511       f = <a class="code" href="dfsch_8c.html#222f54df7e431beb2bc2dddf3640b554">dfsch_eval_impl</a>(f , env, NULL, ti);
<a name="l02512"></a>02512     }
<a name="l02513"></a>02513 
<a name="l02514"></a>02514 
<a name="l02515"></a>02515     
<a name="l02516"></a>02516     <span class="keywordflow">if</span> (<a class="code" href="dfsch_2types_8h.html#5f142f7ca5170520a5c736a4a7d3a2b7">DFSCH_TYPE_OF</a>(f) == <a class="code" href="dfsch_8c.html#ff4519d858ed63ac8308bb4f95d7afa4">FORM</a>){
<a name="l02517"></a>02517       <span class="keywordflow">return</span> ((<a class="code" href="structdfsch__form__t.html">dfsch_form_t</a>*)f)-&gt;impl(((<a class="code" href="structdfsch__form__t.html">dfsch_form_t</a>*)f), 
<a name="l02518"></a>02518                                       env, 
<a name="l02519"></a>02519                                       <a class="code" href="dfsch_2types_8h.html#9621e19e10bbf916d031fc55631f48df">DFSCH_FAST_CDR</a>(exp), 
<a name="l02520"></a>02520                                       esc);
<a name="l02521"></a>02521     }
<a name="l02522"></a>02522 
<a name="l02523"></a>02523     <span class="keywordflow">if</span> (<a class="code" href="dfsch_2types_8h.html#5f142f7ca5170520a5c736a4a7d3a2b7">DFSCH_TYPE_OF</a>(f) == <a class="code" href="dfsch_8c.html#824c99cb152a3c2e9111a2cb9c34891e">MACRO</a>){
<a name="l02524"></a>02524       <span class="keywordflow">return</span> <a class="code" href="dfsch_8c.html#222f54df7e431beb2bc2dddf3640b554">dfsch_eval_impl</a>(<a class="code" href="dfsch_8h.html#54b8f010995bf6e49721b81f485a6fae">dfsch_macro_expand</a>(f, <a class="code" href="dfsch_2types_8h.html#9621e19e10bbf916d031fc55631f48df">DFSCH_FAST_CDR</a>(exp)),
<a name="l02525"></a>02525                              env,
<a name="l02526"></a>02526                              esc,
<a name="l02527"></a>02527                              ti);
<a name="l02528"></a>02528     }
<a name="l02529"></a>02529 
<a name="l02530"></a>02530     <span class="keywordflow">return</span> <a class="code" href="dfsch_8c.html#74c466627982381afb580ca74202354a">dfsch_apply_impl</a>(f, <a class="code" href="dfsch_2types_8h.html#9621e19e10bbf916d031fc55631f48df">DFSCH_FAST_CDR</a>(exp), env, esc, ti);
<a name="l02531"></a>02531   }  
<a name="l02532"></a>02532   
<a name="l02533"></a>02533   <span class="keywordflow">return</span> exp;
<a name="l02534"></a>02534 }
<a name="l02535"></a>02535 
<a name="l02536"></a><a class="code" href="dfsch_8c.html#616f86ad7d16ae8f2d8867c73f88d45e">02536</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8h.html#616f86ad7d16ae8f2d8867c73f88d45e">dfsch_eval_tr</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* exp, 
<a name="l02537"></a>02537                               <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* env,
<a name="l02538"></a>02538                               <a class="code" href="structdfsch__tail__escape__t.html">dfsch_tail_escape_t</a>* esc){
<a name="l02539"></a>02539   <span class="keywordflow">return</span> <a class="code" href="dfsch_8c.html#222f54df7e431beb2bc2dddf3640b554">dfsch_eval_impl</a>(exp, 
<a name="l02540"></a>02540                          <a class="code" href="dfsch_2types_8h.html#f9b3a4b9a5fe6a12721504cd292a3327">DFSCH_ASSERT_TYPE</a>(env, <a class="code" href="dfsch_2types_8h.html#e0e9762c5177d0b4932e47f39c924e22">DFSCH_ENVIRONMENT_TYPE</a>), 
<a name="l02541"></a>02541                          esc, <a class="code" href="magic_8h.html#04b33f56258adffd197b27d210525b83">dfsch__get_thread_info</a>());
<a name="l02542"></a>02542 }
<a name="l02543"></a><a class="code" href="dfsch_8c.html#bed96c7cb06a32b19436904f93b957ca">02543</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8h.html#bed96c7cb06a32b19436904f93b957ca">dfsch_eval</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* exp, <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* env){
<a name="l02544"></a>02544   <span class="keywordflow">return</span> <a class="code" href="dfsch_8c.html#222f54df7e431beb2bc2dddf3640b554">dfsch_eval_impl</a>(exp, 
<a name="l02545"></a>02545                          <a class="code" href="dfsch_2types_8h.html#f9b3a4b9a5fe6a12721504cd292a3327">DFSCH_ASSERT_TYPE</a>(env, <a class="code" href="dfsch_2types_8h.html#e0e9762c5177d0b4932e47f39c924e22">DFSCH_ENVIRONMENT_TYPE</a>), 
<a name="l02546"></a>02546                          NULL, <a class="code" href="magic_8h.html#04b33f56258adffd197b27d210525b83">dfsch__get_thread_info</a>());
<a name="l02547"></a>02547 }
<a name="l02548"></a>02548 
<a name="l02549"></a><a class="code" href="dfsch_8c.html#f2ab6203cb4fc3a0c7bb25116da486a2">02549</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8h.html#f2ab6203cb4fc3a0c7bb25116da486a2">dfsch_compile_lambda_list</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* list){
<a name="l02550"></a>02550   <a class="code" href="structlambda__list__t.html">lambda_list_t</a>* ll;
<a name="l02551"></a>02551   <span class="keywordtype">long</span> count = <a class="code" href="dfsch_8h.html#26c642487bb2b16a3ec386eac30b4575">dfsch_list_length_fast</a>(list);
<a name="l02552"></a>02552   <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* i = list;
<a name="l02553"></a>02553   <span class="keywordtype">size_t</span> j;
<a name="l02554"></a>02554   <span class="keywordflow">if</span> (count == -1){
<a name="l02555"></a>02555     count = 0;
<a name="l02556"></a>02556   }
<a name="l02557"></a>02557   ll = <a class="code" href="dfsch_8c.html#701b0d85fa7104aa9b1efb76e68bc3a7">dfsch_make_object_var</a>(<a class="code" href="dfsch_2types_8h.html#a44d3dbbc63a5befb5f6ac2c6521b5ae">DFSCH_LAMBDA_LIST_TYPE</a>, 
<a name="l02558"></a>02558                              <span class="keyword">sizeof</span>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>*) * count);
<a name="l02559"></a>02559   ll-&gt;<a class="code" href="structlambda__list__t.html#400c2dbdf6c03556c2a2e2c1c17811a5">positional_count</a> = count;
<a name="l02560"></a>02560   j = 0;
<a name="l02561"></a>02561   <span class="keywordflow">while</span> (<a class="code" href="dfsch_2types_8h.html#6ec0a17695d07350d56eaffe994e29f4">DFSCH_PAIR_P</a>(i)){
<a name="l02562"></a>02562     <span class="keywordflow">if</span> (j &gt;= count){
<a name="l02563"></a>02563       <a class="code" href="dfsch_8h.html#646ee34c82a726fdc33d8a28af39270a">dfsch_error</a>(<span class="stringliteral">"wtf?"</span>, NULL);
<a name="l02564"></a>02564     }
<a name="l02565"></a>02565     ll-&gt;<a class="code" href="structlambda__list__t.html#7e821448243aab6adbbb23e29fc5906a">positional</a>[j] = <a class="code" href="dfsch_2types_8h.html#873da07e10c696bf321a42629cdb863e">DFSCH_FAST_CAR</a>(i);
<a name="l02566"></a>02566     j++;
<a name="l02567"></a>02567     i = <a class="code" href="dfsch_2types_8h.html#9621e19e10bbf916d031fc55631f48df">DFSCH_FAST_CDR</a>(i);
<a name="l02568"></a>02568   }
<a name="l02569"></a>02569   ll-&gt;<a class="code" href="structlambda__list__t.html#9b8f3afdedc6a741e7997f0b78b386ca">rest</a> = i;
<a name="l02570"></a>02570   <span class="keywordflow">return</span> ll;
<a name="l02571"></a>02571 }
<a name="l02572"></a>02572 
<a name="l02573"></a><a class="code" href="dfsch_8c.html#bbb429e8b99ada26ee7a1d17c18ccde3">02573</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="dfsch_8c.html#bbb429e8b99ada26ee7a1d17c18ccde3">destructure_impl</a>(<a class="code" href="structlambda__list__t.html">lambda_list_t</a>* ll,
<a name="l02574"></a>02574                              <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* list,
<a name="l02575"></a>02575                              <a class="code" href="structenvironment__t.html">environment_t</a>* env){
<a name="l02576"></a>02576   <span class="keywordtype">int</span> i;
<a name="l02577"></a>02577   <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* j = list;
<a name="l02578"></a>02578 
<a name="l02579"></a>02579   <span class="keywordflow">for</span> (i = 0; i &lt; ll-&gt;<a class="code" href="structlambda__list__t.html#400c2dbdf6c03556c2a2e2c1c17811a5">positional_count</a>; i++){
<a name="l02580"></a>02580     <span class="keywordflow">if</span> (<a class="code" href="defines_8h.html#9d3fca805f1a5348d2cb5488cab8d3d8">DFSCH_UNLIKELY</a>(!<a class="code" href="dfsch_2types_8h.html#6ec0a17695d07350d56eaffe994e29f4">DFSCH_PAIR_P</a>(j))){
<a name="l02581"></a>02581       <a class="code" href="dfsch_8h.html#646ee34c82a726fdc33d8a28af39270a">dfsch_error</a>(<span class="stringliteral">"Too few arguments"</span>, <a class="code" href="dfsch_8h.html#d1735dbe5d8d5331eebbe8e20bbb37be">dfsch_list</a>(2, ll, list));
<a name="l02582"></a>02582     }
<a name="l02583"></a>02583     <a class="code" href="eqhash_8h.html#c5735e02d3bcc3436823316b359d6056">dfsch_eqhash_put</a>(&amp;env-&gt;<a class="code" href="structenvironment__t.html#e80ab816324b8b570a48aa751bcda747">values</a>, ll-&gt;<a class="code" href="structlambda__list__t.html#7e821448243aab6adbbb23e29fc5906a">positional</a>[i], <a class="code" href="dfsch_2types_8h.html#873da07e10c696bf321a42629cdb863e">DFSCH_FAST_CAR</a>(j));
<a name="l02584"></a>02584     j = <a class="code" href="dfsch_2types_8h.html#9621e19e10bbf916d031fc55631f48df">DFSCH_FAST_CDR</a>(j);
<a name="l02585"></a>02585   }
<a name="l02586"></a>02586   
<a name="l02587"></a>02587   <span class="keywordflow">if</span> (<a class="code" href="defines_8h.html#9d3fca805f1a5348d2cb5488cab8d3d8">DFSCH_UNLIKELY</a>(ll-&gt;<a class="code" href="structlambda__list__t.html#9b8f3afdedc6a741e7997f0b78b386ca">rest</a>)) {
<a name="l02588"></a>02588     <a class="code" href="eqhash_8h.html#c5735e02d3bcc3436823316b359d6056">dfsch_eqhash_put</a>(&amp;env-&gt;<a class="code" href="structenvironment__t.html#e80ab816324b8b570a48aa751bcda747">values</a>, ll-&gt;<a class="code" href="structlambda__list__t.html#9b8f3afdedc6a741e7997f0b78b386ca">rest</a>, j);
<a name="l02589"></a>02589   } <span class="keywordflow">else</span> {
<a name="l02590"></a>02590     <span class="keywordflow">if</span> (<a class="code" href="defines_8h.html#9d3fca805f1a5348d2cb5488cab8d3d8">DFSCH_UNLIKELY</a>(j)) {
<a name="l02591"></a>02591       <a class="code" href="dfsch_8h.html#646ee34c82a726fdc33d8a28af39270a">dfsch_error</a>(<span class="stringliteral">"Too many arguments"</span>, <a class="code" href="dfsch_8h.html#d1735dbe5d8d5331eebbe8e20bbb37be">dfsch_list</a>(2,ll, list));
<a name="l02592"></a>02592     }
<a name="l02593"></a>02593   }
<a name="l02594"></a>02594 }
<a name="l02595"></a>02595 
<a name="l02596"></a><a class="code" href="dfsch_8c.html#525fb1cbeaae025c4cbd58d5500aed7f">02596</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="dfsch_8c.html#525fb1cbeaae025c4cbd58d5500aed7f">destructuring_eval</a>(<a class="code" href="structlambda__list__t.html">lambda_list_t</a>* ll,
<a name="l02597"></a>02597                                <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* list,
<a name="l02598"></a>02598                                <a class="code" href="structenvironment__t.html">environment_t</a>* env,
<a name="l02599"></a>02599                                <a class="code" href="structenvironment__t.html">environment_t</a>* outer,
<a name="l02600"></a>02600                                <a class="code" href="structdfsch____thread__info__t.html">dfsch__thread_info_t</a>* ti){
<a name="l02601"></a>02601   <span class="keywordtype">int</span> i;
<a name="l02602"></a>02602   <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* j = list;
<a name="l02603"></a>02603 
<a name="l02604"></a>02604   <span class="keywordflow">for</span> (i = 0; i &lt; ll-&gt;<a class="code" href="structlambda__list__t.html#400c2dbdf6c03556c2a2e2c1c17811a5">positional_count</a>; i++){
<a name="l02605"></a>02605     <span class="keywordflow">if</span> (<a class="code" href="defines_8h.html#9d3fca805f1a5348d2cb5488cab8d3d8">DFSCH_UNLIKELY</a>(!<a class="code" href="dfsch_2types_8h.html#6ec0a17695d07350d56eaffe994e29f4">DFSCH_PAIR_P</a>(j))){
<a name="l02606"></a>02606       <a class="code" href="dfsch_8h.html#646ee34c82a726fdc33d8a28af39270a">dfsch_error</a>(<span class="stringliteral">"Too few arguments"</span>, <a class="code" href="dfsch_8h.html#d1735dbe5d8d5331eebbe8e20bbb37be">dfsch_list</a>(2, ll, list));
<a name="l02607"></a>02607     }
<a name="l02608"></a>02608     <a class="code" href="eqhash_8h.html#c5735e02d3bcc3436823316b359d6056">dfsch_eqhash_put</a>(&amp;env-&gt;<a class="code" href="structenvironment__t.html#e80ab816324b8b570a48aa751bcda747">values</a>, ll-&gt;<a class="code" href="structlambda__list__t.html#7e821448243aab6adbbb23e29fc5906a">positional</a>[i], 
<a name="l02609"></a>02609                      <a class="code" href="dfsch_8c.html#222f54df7e431beb2bc2dddf3640b554">dfsch_eval_impl</a>(<a class="code" href="dfsch_2types_8h.html#873da07e10c696bf321a42629cdb863e">DFSCH_FAST_CAR</a>(j), outer, NULL, ti));
<a name="l02610"></a>02610     j = <a class="code" href="dfsch_2types_8h.html#9621e19e10bbf916d031fc55631f48df">DFSCH_FAST_CDR</a>(j);
<a name="l02611"></a>02611   }
<a name="l02612"></a>02612   
<a name="l02613"></a>02613   <span class="keywordflow">if</span> (<a class="code" href="defines_8h.html#9d3fca805f1a5348d2cb5488cab8d3d8">DFSCH_UNLIKELY</a>(ll-&gt;<a class="code" href="structlambda__list__t.html#9b8f3afdedc6a741e7997f0b78b386ca">rest</a>)) {
<a name="l02614"></a>02614     <a class="code" href="eqhash_8h.html#c5735e02d3bcc3436823316b359d6056">dfsch_eqhash_put</a>(&amp;env-&gt;<a class="code" href="structenvironment__t.html#e80ab816324b8b570a48aa751bcda747">values</a>, ll-&gt;<a class="code" href="structlambda__list__t.html#9b8f3afdedc6a741e7997f0b78b386ca">rest</a>, <a class="code" href="dfsch_8c.html#b44c922d5b67a47e620c1fda623692c2">eval_list</a>(j, outer, ti));
<a name="l02615"></a>02615   } <span class="keywordflow">else</span> {
<a name="l02616"></a>02616     <span class="keywordflow">if</span> (<a class="code" href="defines_8h.html#9d3fca805f1a5348d2cb5488cab8d3d8">DFSCH_UNLIKELY</a>(j)) {
<a name="l02617"></a>02617       <a class="code" href="dfsch_8h.html#646ee34c82a726fdc33d8a28af39270a">dfsch_error</a>(<span class="stringliteral">"Too many arguments"</span>, <a class="code" href="dfsch_8h.html#d1735dbe5d8d5331eebbe8e20bbb37be">dfsch_list</a>(2,ll, list));
<a name="l02618"></a>02618     }
<a name="l02619"></a>02619   }
<a name="l02620"></a>02620 }
<a name="l02621"></a>02621 
<a name="l02622"></a><a class="code" href="dfsch_8c.html#b99166d0686d67bf1ed5ae78b03a7803">02622</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8h.html#b99166d0686d67bf1ed5ae78b03a7803">dfsch_destructuring_bind</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* arglist, 
<a name="l02623"></a>02623                                          <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* list, 
<a name="l02624"></a>02624                                          <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* env){
<a name="l02625"></a>02625   <a class="code" href="structenvironment__t.html">environment_t</a>* e = <a class="code" href="dfsch_8h.html#8eb433e5eb23587eeb5102f25012e5d8">dfsch_new_frame</a>(env);
<a name="l02626"></a>02626   <a class="code" href="structlambda__list__t.html">lambda_list_t</a>* l;
<a name="l02627"></a>02627   <span class="keywordflow">if</span> (<a class="code" href="dfsch_2types_8h.html#5f142f7ca5170520a5c736a4a7d3a2b7">DFSCH_TYPE_OF</a>(arglist) != <a class="code" href="dfsch_2types_8h.html#a44d3dbbc63a5befb5f6ac2c6521b5ae">DFSCH_LAMBDA_LIST_TYPE</a>){
<a name="l02628"></a>02628     l = <a class="code" href="dfsch_8h.html#f2ab6203cb4fc3a0c7bb25116da486a2">dfsch_compile_lambda_list</a>(arglist);
<a name="l02629"></a>02629   } <span class="keywordflow">else</span> {
<a name="l02630"></a>02630     l = arglist;
<a name="l02631"></a>02631   }
<a name="l02632"></a>02632   <a class="code" href="dfsch_8c.html#bbb429e8b99ada26ee7a1d17c18ccde3">destructure_impl</a>(l, list, e);
<a name="l02633"></a>02633   <span class="keywordflow">return</span> e;
<a name="l02634"></a>02634 }
<a name="l02635"></a>02635 
<a name="l02636"></a><a class="code" href="dfsch_8c.html#7ccb1ddea2583f561f49c343371da118">02636</a> <span class="keyword">static</span> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8c.html#7ccb1ddea2583f561f49c343371da118">dfsch_eval_proc_impl</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* code, 
<a name="l02637"></a>02637                                             <a class="code" href="structenvironment__t.html">environment_t</a>* env,
<a name="l02638"></a>02638                                             tail_escape_t* esc,
<a name="l02639"></a>02639                                             <a class="code" href="structdfsch____thread__info__t.html">dfsch__thread_info_t</a>* ti){
<a name="l02640"></a>02640   <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a> *i;
<a name="l02641"></a>02641   <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a> *old_frame;
<a name="l02642"></a>02642   <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a> *my_frame;
<a name="l02643"></a>02643 
<a name="l02644"></a>02644   <span class="keywordflow">if</span> (!env)
<a name="l02645"></a>02645     <span class="keywordflow">return</span> NULL;
<a name="l02646"></a>02646   <span class="keywordflow">if</span> (!code)
<a name="l02647"></a>02647     <span class="keywordflow">return</span> NULL;
<a name="l02648"></a>02648 
<a name="l02649"></a>02649   <a class="code" href="dfsch_8c.html#6900146132b87055f68cc201a9136ed7">async_apply_check</a>(ti);
<a name="l02650"></a>02650     
<a name="l02651"></a>02651   i = code;
<a name="l02652"></a>02652 
<a name="l02653"></a>02653   <span class="keywordflow">while</span> (<a class="code" href="dfsch_2types_8h.html#6ec0a17695d07350d56eaffe994e29f4">DFSCH_PAIR_P</a>(i)){
<a name="l02654"></a>02654     <a class="code" href="structdfsch__object__t.html">object_t</a>* exp = <a class="code" href="dfsch_2types_8h.html#873da07e10c696bf321a42629cdb863e">DFSCH_FAST_CAR</a>(i); 
<a name="l02655"></a>02655     <span class="keywordflow">if</span> (<a class="code" href="defines_8h.html#63267c56f2c4d513caca2843866d6488">DFSCH_LIKELY</a>(<a class="code" href="dfsch_2types_8h.html#9621e19e10bbf916d031fc55631f48df">DFSCH_FAST_CDR</a>(i))) {
<a name="l02656"></a>02656       <a class="code" href="dfsch_8c.html#222f54df7e431beb2bc2dddf3640b554">dfsch_eval_impl</a>(exp, env, NULL, ti);
<a name="l02657"></a>02657     } <span class="keywordflow">else</span> {
<a name="l02658"></a>02658       <span class="keywordflow">return</span> <a class="code" href="dfsch_8c.html#222f54df7e431beb2bc2dddf3640b554">dfsch_eval_impl</a>(exp, env, esc, ti);
<a name="l02659"></a>02659     }
<a name="l02660"></a>02660    
<a name="l02661"></a>02661     i = <a class="code" href="dfsch_2types_8h.html#9621e19e10bbf916d031fc55631f48df">DFSCH_FAST_CDR</a>(i);
<a name="l02662"></a>02662   }
<a name="l02663"></a>02663 
<a name="l02664"></a>02664   <a class="code" href="dfsch_8h.html#646ee34c82a726fdc33d8a28af39270a">dfsch_error</a>(<span class="stringliteral">"eval-proc called on improper list"</span>, code);
<a name="l02665"></a>02665 }
<a name="l02666"></a>02666 
<a name="l02667"></a><a class="code" href="dfsch_8c.html#d4742b48fc4dd2bb6117b989791adc1c">02667</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8h.html#19241bf557791bdf2f2d2664019d2f09">dfsch_eval_proc_tr</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* code, 
<a name="l02668"></a>02668                                    <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* env,
<a name="l02669"></a>02669                                    tail_escape_t* esc){
<a name="l02670"></a>02670   <span class="keywordflow">return</span> <a class="code" href="dfsch_8c.html#7ccb1ddea2583f561f49c343371da118">dfsch_eval_proc_impl</a>(code,
<a name="l02671"></a>02671                               <a class="code" href="dfsch_2types_8h.html#f9b3a4b9a5fe6a12721504cd292a3327">DFSCH_ASSERT_TYPE</a>(env, <a class="code" href="dfsch_2types_8h.html#e0e9762c5177d0b4932e47f39c924e22">DFSCH_ENVIRONMENT_TYPE</a>),
<a name="l02672"></a>02672                               esc, 
<a name="l02673"></a>02673                               <a class="code" href="magic_8h.html#04b33f56258adffd197b27d210525b83">dfsch__get_thread_info</a>());
<a name="l02674"></a>02674 }
<a name="l02675"></a><a class="code" href="dfsch_8c.html#0d83ea8ff6ef6300abbaccf16ee42f42">02675</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8h.html#615b6b15100a69e343f731ae4e808a0c">dfsch_eval_proc</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* code, <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* env){
<a name="l02676"></a>02676   <span class="keywordflow">return</span> <a class="code" href="dfsch_8c.html#7ccb1ddea2583f561f49c343371da118">dfsch_eval_proc_impl</a>(code, 
<a name="l02677"></a>02677                               <a class="code" href="dfsch_2types_8h.html#f9b3a4b9a5fe6a12721504cd292a3327">DFSCH_ASSERT_TYPE</a>(env, <a class="code" href="dfsch_2types_8h.html#e0e9762c5177d0b4932e47f39c924e22">DFSCH_ENVIRONMENT_TYPE</a>),
<a name="l02678"></a>02678                               NULL, 
<a name="l02679"></a>02679                               <a class="code" href="magic_8h.html#04b33f56258adffd197b27d210525b83">dfsch__get_thread_info</a>());
<a name="l02680"></a>02680 }
<a name="l02681"></a>02681 
<a name="l02682"></a><a class="code" href="structdfsch__tail__escape__t.html">02682</a> <span class="keyword">struct </span><a class="code" href="structdfsch__tail__escape__t.html">dfsch_tail_escape_t</a> {
<a name="l02683"></a><a class="code" href="structdfsch__tail__escape__t.html#8ee14b58e03221d8c2c8f8873d8c10e4">02683</a>   jmp_buf <a class="code" href="structdfsch__tail__escape__t.html#8ee14b58e03221d8c2c8f8873d8c10e4">ret</a>;
<a name="l02684"></a><a class="code" href="structdfsch__tail__escape__t.html#cd59826c6546000a244b631b742780f0">02684</a>   <a class="code" href="structdfsch__object__t.html">object_t</a> *<a class="code" href="structdfsch__tail__escape__t.html#cd59826c6546000a244b631b742780f0">proc</a>;
<a name="l02685"></a><a class="code" href="structdfsch__tail__escape__t.html#64746b003a22466677f1580eddf0f867">02685</a>   <a class="code" href="structdfsch__object__t.html">object_t</a> *<a class="code" href="structdfsch__tail__escape__t.html#64746b003a22466677f1580eddf0f867">args</a>;
<a name="l02686"></a><a class="code" href="structdfsch__tail__escape__t.html#16115a85c47f4fe5d96e429841c67ddf">02686</a>   <a class="code" href="structdfsch__object__t.html">object_t</a> *<a class="code" href="structdfsch__tail__escape__t.html#16115a85c47f4fe5d96e429841c67ddf">arg_env</a>;
<a name="l02687"></a>02687 };
<a name="l02688"></a>02688 
<a name="l02689"></a>02689 <span class="comment">/* it might be interesting to optionally disable tail-calls for slight </span>
<a name="l02690"></a>02690 <span class="comment"> * performance boost (~5%) */</span>
<a name="l02691"></a>02691 
<a name="l02692"></a><a class="code" href="dfsch_8c.html#74c466627982381afb580ca74202354a">02692</a> <span class="keyword">static</span> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8c.html#74c466627982381afb580ca74202354a">dfsch_apply_impl</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* proc, 
<a name="l02693"></a>02693                                         <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* args,
<a name="l02694"></a>02694                                         <a class="code" href="structenvironment__t.html">environment_t</a>* arg_env,
<a name="l02695"></a>02695                                         tail_escape_t* esc,
<a name="l02696"></a>02696                                         <a class="code" href="structdfsch____thread__info__t.html">dfsch__thread_info_t</a>* ti){
<a name="l02697"></a>02697   <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* r;
<a name="l02698"></a>02698   tail_escape_t myesc;
<a name="l02699"></a>02699 
<a name="l02700"></a>02700   <span class="keywordflow">if</span> (<a class="code" href="defines_8h.html#9d3fca805f1a5348d2cb5488cab8d3d8">DFSCH_UNLIKELY</a>(esc)){
<a name="l02701"></a>02701     esc-&gt;<a class="code" href="structdfsch__tail__escape__t.html#cd59826c6546000a244b631b742780f0">proc</a> = proc;
<a name="l02702"></a>02702     esc-&gt;<a class="code" href="structdfsch__tail__escape__t.html#64746b003a22466677f1580eddf0f867">args</a> = args;
<a name="l02703"></a>02703     esc-&gt;<a class="code" href="structdfsch__tail__escape__t.html#16115a85c47f4fe5d96e429841c67ddf">arg_env</a> = arg_env;
<a name="l02704"></a>02704     longjmp(esc-&gt;<a class="code" href="structdfsch__tail__escape__t.html#8ee14b58e03221d8c2c8f8873d8c10e4">ret</a>,1);
<a name="l02705"></a>02705   }
<a name="l02706"></a>02706 
<a name="l02707"></a>02707 
<a name="l02708"></a>02708   <span class="keywordflow">if</span> (setjmp(myesc.<a class="code" href="structdfsch__tail__escape__t.html#8ee14b58e03221d8c2c8f8873d8c10e4">ret</a>)){  
<a name="l02709"></a>02709     proc = myesc.<a class="code" href="structdfsch__tail__escape__t.html#cd59826c6546000a244b631b742780f0">proc</a>;
<a name="l02710"></a>02710     args = myesc.<a class="code" href="structdfsch__tail__escape__t.html#64746b003a22466677f1580eddf0f867">args</a>;
<a name="l02711"></a>02711     arg_env = myesc.<a class="code" href="structdfsch__tail__escape__t.html#16115a85c47f4fe5d96e429841c67ddf">arg_env</a>;
<a name="l02712"></a>02712     <a class="code" href="magic_8h.html#2cb23c95586995403e7c38334c2ea10a">DFSCH__TRACEPOINT_APPLY</a>(ti, proc, args, 
<a name="l02713"></a>02713                            <a class="code" href="magic_8h.html#cd985f960da71003cd089f21a9ca307b">DFSCH_TRACEPOINT_FLAG_APPLY_TAIL</a> | 
<a name="l02714"></a>02714                            (arg_env ? <a class="code" href="magic_8h.html#1a13843e88792381b9a9dc5fe06d96a0">DFSCH_TRACEPOINT_FLAG_APPLY_LAZY</a> : 0));
<a name="l02715"></a>02715   } <span class="keywordflow">else</span> {
<a name="l02716"></a>02716     <a class="code" href="magic_8h.html#2cb23c95586995403e7c38334c2ea10a">DFSCH__TRACEPOINT_APPLY</a>(ti, proc, args, 
<a name="l02717"></a>02717                            (arg_env ? <a class="code" href="magic_8h.html#1a13843e88792381b9a9dc5fe06d96a0">DFSCH_TRACEPOINT_FLAG_APPLY_LAZY</a> : 0));
<a name="l02718"></a>02718   }
<a name="l02719"></a>02719 
<a name="l02720"></a>02720 
<a name="l02721"></a>02721 
<a name="l02722"></a>02722   <span class="comment">/*</span>
<a name="l02723"></a>02723 <span class="comment">   * Two most common cases are written here explicitly (for historical</span>
<a name="l02724"></a>02724 <span class="comment">   * and performance reasons)</span>
<a name="l02725"></a>02725 <span class="comment">   */</span>
<a name="l02726"></a>02726 
<a name="l02727"></a>02727   <span class="keywordflow">if</span> (<a class="code" href="dfsch_2types_8h.html#5f142f7ca5170520a5c736a4a7d3a2b7">DFSCH_TYPE_OF</a>(proc) == <a class="code" href="dfsch_8c.html#a0f458f5ca6cb8ca94e5f076f5b88be9">PRIMITIVE</a>){
<a name="l02728"></a>02728     <span class="keywordflow">if</span> (<a class="code" href="defines_8h.html#63267c56f2c4d513caca2843866d6488">DFSCH_LIKELY</a>(arg_env)){
<a name="l02729"></a>02729       args = <a class="code" href="dfsch_8c.html#b44c922d5b67a47e620c1fda623692c2">eval_list</a>(args, arg_env, ti);
<a name="l02730"></a>02730     }
<a name="l02731"></a>02731     <span class="keywordflow">return</span> ((<a class="code" href="structdfsch__primitive__t.html">primitive_t</a>*)proc)-&gt;proc(((<a class="code" href="structdfsch__primitive__t.html">primitive_t</a>*)proc)-&gt;baton,args,
<a name="l02732"></a>02732                                       &amp;myesc);
<a name="l02733"></a>02733   }
<a name="l02734"></a>02734 
<a name="l02735"></a>02735   <span class="keywordflow">if</span> (<a class="code" href="dfsch_2types_8h.html#5f142f7ca5170520a5c736a4a7d3a2b7">DFSCH_TYPE_OF</a>(proc) == <a class="code" href="dfsch_2types_8h.html#ff428d311e2ce0959378f161d056deb4">DFSCH_STANDARD_FUNCTION_TYPE</a>){
<a name="l02736"></a>02736     <a class="code" href="structenvironment__t.html">environment_t</a>* env = <a class="code" href="dfsch_8c.html#1174f03726bf92326417bbb323c2cb8f">new_frame_impl</a>(((<a class="code" href="structclosure__t.html">closure_t</a>*) proc)-&gt;env,
<a name="l02737"></a>02737                                         ti);
<a name="l02738"></a>02738     <span class="keywordflow">if</span> (<a class="code" href="defines_8h.html#63267c56f2c4d513caca2843866d6488">DFSCH_LIKELY</a>(arg_env)){
<a name="l02739"></a>02739       <a class="code" href="dfsch_8c.html#525fb1cbeaae025c4cbd58d5500aed7f">destructuring_eval</a>(((<a class="code" href="structclosure__t.html">closure_t</a>*)proc)-&gt;args, args, env, arg_env, ti);
<a name="l02740"></a>02740     } <span class="keywordflow">else</span> {
<a name="l02741"></a>02741       <a class="code" href="dfsch_8c.html#bbb429e8b99ada26ee7a1d17c18ccde3">destructure_impl</a>(((<a class="code" href="structclosure__t.html">closure_t</a>*)proc)-&gt;args, args, env);
<a name="l02742"></a>02742     }
<a name="l02743"></a>02743     <span class="keywordflow">return</span> <a class="code" href="dfsch_8c.html#7ccb1ddea2583f561f49c343371da118">dfsch_eval_proc_impl</a>(((<a class="code" href="structclosure__t.html">closure_t</a>*)proc)-&gt;code,
<a name="l02744"></a>02744                                 env,
<a name="l02745"></a>02745                                 &amp;myesc,
<a name="l02746"></a>02746                                 ti);
<a name="l02747"></a>02747   }
<a name="l02748"></a>02748 
<a name="l02749"></a>02749   <span class="keywordflow">if</span> (<a class="code" href="dfsch_2types_8h.html#5f142f7ca5170520a5c736a4a7d3a2b7">DFSCH_TYPE_OF</a>(proc)-&gt;apply){
<a name="l02750"></a>02750     <span class="keywordflow">if</span> (<a class="code" href="defines_8h.html#63267c56f2c4d513caca2843866d6488">DFSCH_LIKELY</a>(arg_env)){
<a name="l02751"></a>02751       args = <a class="code" href="dfsch_8c.html#b44c922d5b67a47e620c1fda623692c2">eval_list</a>(args, arg_env, ti);
<a name="l02752"></a>02752     }
<a name="l02753"></a>02753     <span class="keywordflow">return</span> <a class="code" href="dfsch_2types_8h.html#5f142f7ca5170520a5c736a4a7d3a2b7">DFSCH_TYPE_OF</a>(proc)-&gt;apply(proc, args, &amp;myesc);
<a name="l02754"></a>02754   }
<a name="l02755"></a>02755 
<a name="l02756"></a>02756   <a class="code" href="dfsch_8h.html#646ee34c82a726fdc33d8a28af39270a">dfsch_error</a>(<span class="stringliteral">"Not a procedure"</span>, proc);
<a name="l02757"></a>02757 
<a name="l02758"></a>02758 }
<a name="l02759"></a>02759 
<a name="l02760"></a><a class="code" href="dfsch_8c.html#b9c7a22b73a9a453c08796d9f02584cb">02760</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8h.html#cea76356e66407cbe4bd743ca1f5e252">dfsch_apply_tr</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* proc, 
<a name="l02761"></a>02761                                <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* args,
<a name="l02762"></a>02762                                tail_escape_t* esc){
<a name="l02763"></a>02763   <span class="keywordflow">return</span> <a class="code" href="dfsch_8c.html#74c466627982381afb580ca74202354a">dfsch_apply_impl</a>(proc, args, NULL, esc, <a class="code" href="magic_8h.html#04b33f56258adffd197b27d210525b83">dfsch__get_thread_info</a>());
<a name="l02764"></a>02764 }
<a name="l02765"></a><a class="code" href="dfsch_8c.html#2772937dcff7850968639e3054e65384">02765</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8h.html#2772937dcff7850968639e3054e65384">dfsch_apply</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* proc, <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* args){
<a name="l02766"></a>02766   <span class="keywordflow">return</span> <a class="code" href="dfsch_8c.html#74c466627982381afb580ca74202354a">dfsch_apply_impl</a>(proc, args, NULL, NULL, <a class="code" href="magic_8h.html#04b33f56258adffd197b27d210525b83">dfsch__get_thread_info</a>());
<a name="l02767"></a>02767 }
<a name="l02768"></a>02768 
<a name="l02769"></a><a class="code" href="dfsch_8c.html#a1cef506f9ca616665ccce0518406c42">02769</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8h.html#a1cef506f9ca616665ccce0518406c42">dfsch_quasiquote</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* env, <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* arg){
<a name="l02770"></a>02770   <span class="keywordflow">if</span> (<a class="code" href="dfsch_8h.html#0515779c8c66eadcdd9fa52d1efd957e">dfsch_pair_p</a>(arg)){
<a name="l02771"></a>02771     <a class="code" href="structdfsch__object__t.html">object_t</a>* car = <a class="code" href="dfsch_8h.html#fa8b1de0edaa892e808ab624b35101b2">dfsch_car</a>(arg);
<a name="l02772"></a>02772     <a class="code" href="structdfsch__object__t.html">object_t</a>* cdr = <a class="code" href="dfsch_8h.html#41cae0a7d870e4727489a6af6fee335a">dfsch_cdr</a>(arg);
<a name="l02773"></a>02773 
<a name="l02774"></a>02774     <span class="keywordflow">if</span> (car == <a class="code" href="dfsch_2types_8h.html#bd69be4c5785ba1852df72c08395da3e">DFSCH_SYM_UNQUOTE</a> &amp;&amp; <a class="code" href="dfsch_8h.html#0515779c8c66eadcdd9fa52d1efd957e">dfsch_pair_p</a>(cdr)){
<a name="l02775"></a>02775       <span class="keywordflow">return</span> <a class="code" href="dfsch_8h.html#bed96c7cb06a32b19436904f93b957ca">dfsch_eval</a>(<a class="code" href="dfsch_8h.html#fa8b1de0edaa892e808ab624b35101b2">dfsch_car</a>(cdr), env);
<a name="l02776"></a>02776     }<span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="dfsch_8h.html#0515779c8c66eadcdd9fa52d1efd957e">dfsch_pair_p</a>(car)){
<a name="l02777"></a>02777       <span class="keywordflow">if</span> (<a class="code" href="dfsch_8h.html#fa8b1de0edaa892e808ab624b35101b2">dfsch_car</a>(car) == <a class="code" href="dfsch_2types_8h.html#06900e07f20abb94e30eb09c2767de1c">DFSCH_SYM_UNQUOTE_SPLICING</a>){
<a name="l02778"></a>02778         <span class="keywordflow">return</span> <a class="code" href="dfsch_8h.html#0ee779bec69600534328fa366e2aa56c">dfsch_append</a>(<a class="code" href="dfsch_8h.html#d1735dbe5d8d5331eebbe8e20bbb37be">dfsch_list</a>(2,
<a name="l02779"></a>02779                                        <a class="code" href="dfsch_8h.html#bed96c7cb06a32b19436904f93b957ca">dfsch_eval</a>(<a class="code" href="dfsch_8h.html#fa8b1de0edaa892e808ab624b35101b2">dfsch_car</a>(<a class="code" href="dfsch_8h.html#41cae0a7d870e4727489a6af6fee335a">dfsch_cdr</a>(car)), 
<a name="l02780"></a>02780                                                   env),
<a name="l02781"></a>02781                                        <a class="code" href="dfsch_8h.html#a1cef506f9ca616665ccce0518406c42">dfsch_quasiquote</a>(env, cdr)));
<a name="l02782"></a>02782       }
<a name="l02783"></a>02783     }
<a name="l02784"></a>02784 
<a name="l02785"></a>02785     <span class="keywordflow">return</span> <a class="code" href="dfsch_8h.html#ff85cf17ead5b89f43244a3010bc155c">dfsch_cons</a>(<a class="code" href="dfsch_8h.html#a1cef506f9ca616665ccce0518406c42">dfsch_quasiquote</a>(env,car), <a class="code" href="dfsch_8h.html#a1cef506f9ca616665ccce0518406c42">dfsch_quasiquote</a>(env,cdr));
<a name="l02786"></a>02786   }<span class="keywordflow">else</span>{
<a name="l02787"></a>02787     <span class="keywordflow">return</span> arg;
<a name="l02788"></a>02788   }
<a name="l02789"></a>02789 }
<a name="l02790"></a>02790 
<a name="l02791"></a><a class="code" href="dfsch_8c.html#c7190ed8945b9a06cec6e8998b7dad66">02791</a> <span class="keyword">static</span> <a class="code" href="structdfsch__object__t.html">object_t</a>* <a class="code" href="dfsch_8c.html#c7190ed8945b9a06cec6e8998b7dad66">native_top_level_environment</a>(<span class="keywordtype">void</span> *baton, <a class="code" href="structdfsch__object__t.html">object_t</a>* args,
<a name="l02792"></a>02792                                               <a class="code" href="structdfsch__tail__escape__t.html">dfsch_tail_escape_t</a>* esc){
<a name="l02793"></a>02793   <span class="keywordflow">return</span> baton;
<a name="l02794"></a>02794 }
<a name="l02795"></a>02795 
<a name="l02796"></a><a class="code" href="dfsch_8c.html#e510aa398e33aa8f071c1517c9f53702">02796</a> <a class="code" href="dfsch_2types_8h.html#e22ee7acf5e872fce5625c1b3995f247">DFSCH_DEFINE_FORM_IMPL</a>(current_environment, 
<a name="l02797"></a>02797                        <span class="stringliteral">"Return lexically-enclosing environment"</span>){
<a name="l02798"></a>02798   <span class="keywordflow">return</span> env;
<a name="l02799"></a>02799 }
<a name="l02800"></a>02800 
<a name="l02801"></a><a class="code" href="dfsch_8c.html#f69d7de87ba6a964e00e93c4aa57275e">02801</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8h.html#f69d7de87ba6a964e00e93c4aa57275e">dfsch_make_context</a>(){
<a name="l02802"></a>02802   <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* ctx;
<a name="l02803"></a>02803 
<a name="l02804"></a>02804   ctx = <a class="code" href="dfsch_8h.html#8eb433e5eb23587eeb5102f25012e5d8">dfsch_new_frame</a>(NULL);
<a name="l02805"></a>02805 
<a name="l02806"></a>02806   <a class="code" href="dfsch_8h.html#ced9beff50ffd827c21ca62715d58e77">dfsch_define_cstr</a>(ctx, <span class="stringliteral">"&lt;standard-type&gt;"</span>, DFSCH_STANDARD_TYPE);
<a name="l02807"></a>02807   <a class="code" href="dfsch_8h.html#ced9beff50ffd827c21ca62715d58e77">dfsch_define_cstr</a>(ctx, <span class="stringliteral">"&lt;abstract-type&gt;"</span>, <a class="code" href="dfsch_2types_8h.html#901cee456df0772ed6f8047d5db26e05">DFSCH_ABSTRACT_TYPE</a>);
<a name="l02808"></a>02808   <a class="code" href="dfsch_8h.html#ced9beff50ffd827c21ca62715d58e77">dfsch_define_cstr</a>(ctx, <span class="stringliteral">"&lt;meta-type&gt;"</span>, <a class="code" href="dfsch_2types_8h.html#d926c26c3c386619db91d5ab879d2a4c">DFSCH_META_TYPE</a>);
<a name="l02809"></a>02809   <a class="code" href="dfsch_8h.html#ced9beff50ffd827c21ca62715d58e77">dfsch_define_cstr</a>(ctx, <span class="stringliteral">"&lt;special-type&gt;"</span>, <a class="code" href="dfsch_2types_8h.html#53189e7bb2cca77f7a85457ddef3cc29">DFSCH_SPECIAL_TYPE</a>);
<a name="l02810"></a>02810   <a class="code" href="dfsch_8h.html#ced9beff50ffd827c21ca62715d58e77">dfsch_define_cstr</a>(ctx, <span class="stringliteral">"&lt;standard-function&gt;"</span>, <a class="code" href="dfsch_2types_8h.html#ff428d311e2ce0959378f161d056deb4">DFSCH_STANDARD_FUNCTION_TYPE</a>);
<a name="l02811"></a>02811 
<a name="l02812"></a>02812   <a class="code" href="dfsch_8h.html#ced9beff50ffd827c21ca62715d58e77">dfsch_define_cstr</a>(ctx, <span class="stringliteral">"&lt;slot-type&gt;"</span>, <a class="code" href="dfsch_2types_8h.html#204fc00dce8f99d552b7835f0c97f135">DFSCH_SLOT_TYPE_TYPE</a>);
<a name="l02813"></a>02813   <a class="code" href="dfsch_8h.html#ced9beff50ffd827c21ca62715d58e77">dfsch_define_cstr</a>(ctx, <span class="stringliteral">"&lt;slot&gt;"</span>, <a class="code" href="dfsch_2types_8h.html#42c7c2f93340260aa0cc689387c9bb98">DFSCH_SLOT_TYPE</a>);
<a name="l02814"></a>02814   <a class="code" href="dfsch_8h.html#ced9beff50ffd827c21ca62715d58e77">dfsch_define_cstr</a>(ctx, <span class="stringliteral">"&lt;object-slot&gt;"</span>, <a class="code" href="dfsch_2types_8h.html#8c4708fef104e9e819ff94be5f49268d">DFSCH_OBJECT_SLOT_TYPE</a>);
<a name="l02815"></a>02815   <a class="code" href="dfsch_8h.html#ced9beff50ffd827c21ca62715d58e77">dfsch_define_cstr</a>(ctx, <span class="stringliteral">"&lt;boolean-slot&gt;"</span>, <a class="code" href="dfsch_2types_8h.html#fffa9520317b1770d6c87ad49555f96b">DFSCH_BOOLEAN_SLOT_TYPE</a>);
<a name="l02816"></a>02816   <a class="code" href="dfsch_8h.html#ced9beff50ffd827c21ca62715d58e77">dfsch_define_cstr</a>(ctx, <span class="stringliteral">"&lt;string-slot&gt;"</span>, <a class="code" href="dfsch_2types_8h.html#51d6b638b6b2735f61cb90d853d3d3ed">DFSCH_STRING_SLOT_TYPE</a>);
<a name="l02817"></a>02817   <a class="code" href="dfsch_8h.html#ced9beff50ffd827c21ca62715d58e77">dfsch_define_cstr</a>(ctx, <span class="stringliteral">"&lt;size_t-slot&gt;"</span>, <a class="code" href="dfsch_2types_8h.html#2dafca51038f45790ce84752d5d08396">DFSCH_SIZE_T_SLOT_TYPE</a>);
<a name="l02818"></a>02818   <a class="code" href="dfsch_8h.html#ced9beff50ffd827c21ca62715d58e77">dfsch_define_cstr</a>(ctx, <span class="stringliteral">"&lt;int-slot&gt;"</span>, <a class="code" href="dfsch_2types_8h.html#c65b3b3dcf368c6db80bb7e95f35d561">DFSCH_INT_SLOT_TYPE</a>);
<a name="l02819"></a>02819   <a class="code" href="dfsch_8h.html#ced9beff50ffd827c21ca62715d58e77">dfsch_define_cstr</a>(ctx, <span class="stringliteral">"&lt;long-slot&gt;"</span>, <a class="code" href="dfsch_2types_8h.html#52bd2fe697515f4e1eb61cf097b00627">DFSCH_LONG_SLOT_TYPE</a>);
<a name="l02820"></a>02820 
<a name="l02821"></a>02821   <a class="code" href="dfsch_8h.html#ced9beff50ffd827c21ca62715d58e77">dfsch_define_cstr</a>(ctx, <span class="stringliteral">"&lt;list&gt;"</span>, <a class="code" href="dfsch_2types_8h.html#f68c7145dd8463d15d30fa4a1ffc532e">DFSCH_LIST_TYPE</a>);
<a name="l02822"></a>02822   <a class="code" href="dfsch_8h.html#ced9beff50ffd827c21ca62715d58e77">dfsch_define_cstr</a>(ctx, <span class="stringliteral">"&lt;pair&gt;"</span>, <a class="code" href="dfsch_2types_8h.html#b7f8ae918d879f11a2cfb049a568bb66">DFSCH_PAIR_TYPE</a>);
<a name="l02823"></a>02823   <a class="code" href="dfsch_8h.html#ced9beff50ffd827c21ca62715d58e77">dfsch_define_cstr</a>(ctx, <span class="stringliteral">"&lt;mutable-pair&gt;"</span>, <a class="code" href="dfsch_2types_8h.html#eb83bb2d546d88e25d9298fbbee1a293">DFSCH_MUTABLE_PAIR_TYPE</a>);
<a name="l02824"></a>02824   <a class="code" href="dfsch_8h.html#ced9beff50ffd827c21ca62715d58e77">dfsch_define_cstr</a>(ctx, <span class="stringliteral">"&lt;immutable-pair&gt;"</span>, <a class="code" href="dfsch_2types_8h.html#bb95cba20c3135562f58335551f68e85">DFSCH_IMMUTABLE_PAIR_TYPE</a>);
<a name="l02825"></a>02825   <a class="code" href="dfsch_8h.html#ced9beff50ffd827c21ca62715d58e77">dfsch_define_cstr</a>(ctx, <span class="stringliteral">"&lt;empty-list&gt;"</span>, <a class="code" href="dfsch_2types_8h.html#e920ad6e5c784ae97258dbc2de1c4147">DFSCH_EMPTY_LIST_TYPE</a>);
<a name="l02826"></a>02826   <a class="code" href="dfsch_8h.html#ced9beff50ffd827c21ca62715d58e77">dfsch_define_cstr</a>(ctx, <span class="stringliteral">"&lt;symbol&gt;"</span>, <a class="code" href="dfsch_2types_8h.html#6d2e21544b920ea832f2081b20915fdf">DFSCH_SYMBOL_TYPE</a>);
<a name="l02827"></a>02827   <a class="code" href="dfsch_8h.html#ced9beff50ffd827c21ca62715d58e77">dfsch_define_cstr</a>(ctx, <span class="stringliteral">"&lt;primitive&gt;"</span>, <a class="code" href="dfsch_2types_8h.html#69151aa1c04b487a24a6fc6b6813e8b2">DFSCH_PRIMITIVE_TYPE</a>);
<a name="l02828"></a>02828   <a class="code" href="dfsch_8h.html#ced9beff50ffd827c21ca62715d58e77">dfsch_define_cstr</a>(ctx, <span class="stringliteral">"&lt;function&gt;"</span>, <a class="code" href="dfsch_2types_8h.html#5549eb83828d7b0306cc53cf745987ce">DFSCH_FUNCTION_TYPE</a>);
<a name="l02829"></a>02829   <a class="code" href="dfsch_8h.html#ced9beff50ffd827c21ca62715d58e77">dfsch_define_cstr</a>(ctx, <span class="stringliteral">"&lt;macro&gt;"</span>, <a class="code" href="dfsch_2types_8h.html#c550783d9599e325e9e16a695292303b">DFSCH_MACRO_TYPE</a>);
<a name="l02830"></a>02830   <a class="code" href="dfsch_8h.html#ced9beff50ffd827c21ca62715d58e77">dfsch_define_cstr</a>(ctx, <span class="stringliteral">"&lt;form&gt;"</span>, <a class="code" href="dfsch_2types_8h.html#b1b124112dc8826713e4939574d9cfa3">DFSCH_FORM_TYPE</a>);
<a name="l02831"></a>02831   <a class="code" href="dfsch_8h.html#ced9beff50ffd827c21ca62715d58e77">dfsch_define_cstr</a>(ctx, <span class="stringliteral">"&lt;vector&gt;"</span>, <a class="code" href="dfsch_2types_8h.html#eac9b11753c7f265913a066af9264d28">DFSCH_VECTOR_TYPE</a>);
<a name="l02832"></a>02832 
<a name="l02833"></a>02833   <a class="code" href="dfsch_8h.html#ced9beff50ffd827c21ca62715d58e77">dfsch_define_cstr</a>(ctx, <span class="stringliteral">"&lt;environment&gt;"</span>, <a class="code" href="dfsch_2types_8h.html#e0e9762c5177d0b4932e47f39c924e22">DFSCH_ENVIRONMENT_TYPE</a>);
<a name="l02834"></a>02834 
<a name="l02835"></a>02835   <a class="code" href="dfsch_8h.html#ced9beff50ffd827c21ca62715d58e77">dfsch_define_cstr</a>(ctx, <span class="stringliteral">"top-level-environment"</span>, 
<a name="l02836"></a>02836                     <a class="code" href="dfsch_8h.html#e65da936bd129e8b9ece1e37b1885a30">dfsch_make_primitive</a>(&amp;<a class="code" href="dfsch_8c.html#c7190ed8945b9a06cec6e8998b7dad66">native_top_level_environment</a>, ctx));
<a name="l02837"></a>02837   <a class="code" href="dfsch_8h.html#ced9beff50ffd827c21ca62715d58e77">dfsch_define_cstr</a>(ctx, <span class="stringliteral">"current-environment"</span>, 
<a name="l02838"></a>02838                     <a class="code" href="dfsch_2types_8h.html#e126d23de7e8bff74fe33ff180900f74">DFSCH_FORM_REF</a>(current_environment));
<a name="l02839"></a>02839   <a class="code" href="dfsch_8h.html#ced9beff50ffd827c21ca62715d58e77">dfsch_define_cstr</a>(ctx,<span class="stringliteral">"*dfsch-version*"</span>,<a class="code" href="strings_8h.html#537f9a00a23ad18b6dffb9a9c00f5a30">dfsch_make_string_cstr</a>(<a class="code" href="build-prof_2config_8h.html#a326a05d5e30f9e9a4bb0b4469d5d0c0">PACKAGE_VERSION</a>));
<a name="l02840"></a>02840   <a class="code" href="dfsch_8h.html#ced9beff50ffd827c21ca62715d58e77">dfsch_define_cstr</a>(ctx,<span class="stringliteral">"*dfsch-platform*"</span>,<a class="code" href="strings_8h.html#537f9a00a23ad18b6dffb9a9c00f5a30">dfsch_make_string_cstr</a>(<a class="code" href="build-prof_2config_8h.html#97f5774697030c0f14904cdb2d3633af">HOST_TRIPLET</a>));
<a name="l02841"></a>02841 
<a name="l02842"></a>02842   <a class="code" href="internal_8h.html#1ce6ce67aa5c1b29f0e6bb8d8de529fd">dfsch__native_register</a>(ctx);
<a name="l02843"></a>02843 
<a name="l02844"></a>02844   <span class="keywordflow">return</span> ctx;
<a name="l02845"></a>02845 }
<a name="l02846"></a>02846 
<a name="l02847"></a>02847 
<a name="l02848"></a><a class="code" href="dfsch_8c.html#ced9beff50ffd827c21ca62715d58e77">02848</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8h.html#ced9beff50ffd827c21ca62715d58e77">dfsch_define_cstr</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a> *ctx, 
<a name="l02849"></a>02849                                   <span class="keywordtype">char</span> *name, 
<a name="l02850"></a>02850                                   <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a> *obj){
<a name="l02851"></a>02851   
<a name="l02852"></a>02852   <span class="keywordflow">return</span> <a class="code" href="dfsch_8h.html#0269ff68c7264db9598185860983619b">dfsch_define</a>(<a class="code" href="dfsch_8h.html#f089f50dde23f0a132670368a9e341d5">dfsch_make_symbol</a>(name),
<a name="l02853"></a>02853                       obj,
<a name="l02854"></a>02854                       ctx);
<a name="l02855"></a>02855   
<a name="l02856"></a>02856 }
<a name="l02857"></a><a class="code" href="dfsch_8c.html#1734e11d66e2457153bbbb072cd3adcd">02857</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8h.html#7f34f390a715e16fc3a64f631db4b4ec">dfsch_set_cstr</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a> *ctx, 
<a name="l02858"></a>02858                                <span class="keywordtype">char</span> *name, 
<a name="l02859"></a>02859                                <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a> *obj){
<a name="l02860"></a>02860   
<a name="l02861"></a>02861   <span class="keywordflow">return</span> <a class="code" href="dfsch_8h.html#2d7b3fe2f1501d50a20abedc82bfb433">dfsch_set</a>(<a class="code" href="dfsch_8h.html#f089f50dde23f0a132670368a9e341d5">dfsch_make_symbol</a>(name),
<a name="l02862"></a>02862                    obj,
<a name="l02863"></a>02863                    ctx);
<a name="l02864"></a>02864   
<a name="l02865"></a>02865 }
<a name="l02866"></a><a class="code" href="dfsch_8c.html#c278adb93911b145731f2dbc9f667350">02866</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8h.html#c278adb93911b145731f2dbc9f667350">dfsch_lookup_cstr</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a> *ctx, <span class="keywordtype">char</span> *name){
<a name="l02867"></a>02867   <span class="keywordflow">return</span> <a class="code" href="dfsch_8h.html#906d7059ec2f65a097aedab2d14bce70">dfsch_lookup</a>(<a class="code" href="dfsch_8h.html#f089f50dde23f0a132670368a9e341d5">dfsch_make_symbol</a>(name), ctx);
<a name="l02868"></a>02868 }
<a name="l02869"></a><a class="code" href="dfsch_8c.html#9646e49e232f9e23fb7e852ca7094ef0">02869</a> <a class="code" href="structdfsch__object__t.html">dfsch_object_t</a>* <a class="code" href="dfsch_8h.html#9646e49e232f9e23fb7e852ca7094ef0">dfsch_env_get_cstr</a>(<a class="code" href="structdfsch__object__t.html">dfsch_object_t</a> *ctx, <span class="keywordtype">char</span> *name){
<a name="l02870"></a>02870   <span class="keywordflow">return</span> <a class="code" href="dfsch_8h.html#664702768d9c9488af7f12adff54b214">dfsch_env_get</a>(<a class="code" href="dfsch_8h.html#f089f50dde23f0a132670368a9e341d5">dfsch_make_symbol</a>(name), ctx);
<a name="l02871"></a>02871 }
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Fri Jul 3 16:02:13 2009 for dfsch by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.9 </small></address>
</body>
</html>
